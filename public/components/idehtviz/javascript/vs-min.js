var THREE={REVISION:"67"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}};
(function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!self.requestAnimationFrame;++c)self.requestAnimationFrame=self[b[c]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[b[c]+"CancelAnimationFrame"]||self[b[c]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(b){var c=Date.now(),f=Math.max(0,16-(c-a)),g=self.setTimeout(function(){b(c+f)},f);a=c+f;return g});void 0===self.cancelAnimationFrame&&void 0!==
self.clearTimeout&&(self.cancelAnimationFrame=function(a){self.clearTimeout(a)})})();THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;
THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;
THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=1E3;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;
THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;
THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.Color=function(a){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(a)};
THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a instanceof THREE.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(a,b,c){if(0===b)this.r=this.g=this.b=c;else{var d=function(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*
c:.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a};b=.5>=c?c*(1+b):c+b-c*b;c=2*c-b;this.r=d(c,b,a+1/3);this.g=d(c,b,a);this.b=d(c,b,a-1/3)}return this},setStyle:function(a){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a))return a=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a),this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,this;if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(a))return a=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(a),this.r=
Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,this;if(/^\#([0-9a-f]{6})$/i.test(a))return a=/^\#([0-9a-f]{6})$/i.exec(a),this.setHex(parseInt(a[1],16)),this;if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))return a=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a),this.setHex(parseInt(a[1]+a[1]+a[2]+a[2]+a[3]+a[3],16)),this;if(/^(\w+)$/i.test(a))return this.setHex(THREE.ColorKeywords[a]),this},copy:function(a){this.r=a.r;this.g=
a.g;this.b=a.b;return this},copyGammaToLinear:function(a){this.r=a.r*a.r;this.g=a.g*a.g;this.b=a.b*a.b;return this},copyLinearToGamma:function(a){this.r=Math.sqrt(a.r);this.g=Math.sqrt(a.g);this.b=Math.sqrt(a.b);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<
8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,h=(f+e)/2;if(f===e)f=g=0;else{var k=e-f,f=.5>=h?k/(e+f):k/(2-e-f);switch(e){case b:g=(c-d)/k+(c<d?6:0);break;case c:g=(d-b)/k+2;break;case d:g=(b-c)/k+4}g/=6}a.h=g;a.s=f;a.l=h;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,
b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;
this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a){this.r=a[0];this.g=a[1];this.b=a[2];return this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};
THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,
tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1};
THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;
this._w=a._w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof THREE.Euler)throw Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2);"XYZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"YXZ"===a.order?(this._x=f*d*e+c*g*h,
this._y=c*g*e-f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"ZXY"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"ZYX"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"YZX"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):"XZY"===a.order&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h);if(!1!==b)this.onChangeCallback();return this},
setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);this._x=a.x*d;this._y=a.y*d;this._z=a.z*d;this._w=Math.cos(c);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],h=b[2],k=b[6],b=b[10],m=c+f+b;0<m?(c=.5/Math.sqrt(m+1),this._w=.25/c,this._x=(k-g)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(k-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=
(d-h)/c,this._x=(a+e)/c,this._y=.25*c,this._z=(g+k)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();
return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},multiply:function(a,b){return void 0!==
b?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,k=b._z,m=b._w;this._x=c*m+f*g+d*k-e*h;this._y=d*m+f*h+e*g-c*k;this._z=e*m+f*k+c*h-d*g;this._w=f*m-c*g-d*h-e*k;this.onChangeCallback();return this},multiplyVector3:function(a){console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
return a.applyQuaternion(this)},slerp:function(a,b){var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.acos(g),k=Math.sqrt(1-g*g);if(.001>Math.abs(k))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;g=Math.sin((1-b)*h)/k;h=Math.sin(b*h)/k;this._w=f*g+this._w*h;this._x=c*g+
this._x*h;this._y=d*g+this._y*h;this._z=e*g+this._z*h;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];this._w=a[3];this.onChangeCallback();return this},toArray:function(){return[this._x,this._y,this._z,this._w]},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,
this._z,this._w)}};THREE.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};
THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){this.x=a;this.y=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,
b){if(void 0!==b)return console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},sub:function(a,b){if(void 0!==b)return console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=
a.y;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);return this},
clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);
return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},
distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a){this.x=a[0];this.y=a[1];return this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}};
THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+
a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(a,b){if(void 0!==b)return console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},multiplyVectors:function(a,b){this.x=a.x*
b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromEuler(b));return this}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromAxisAngle(b,c));return this}}(),
applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=
(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var h=a*b+f*d-g*c,k=a*c+g*b-e*d,m=a*d+e*c-f*b,b=-e*b-f*c-g*d;this.x=h*a+b*-e+k*-g-m*-f;this.y=k*a+b*-f+m*-e-h*-g;this.z=m*a+b*-g+h*-f-k*-e;return this},transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;this.normalize();return this},
divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<
a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);
return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+
Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},cross:function(a,b){if(void 0!==b)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;this.x=
d*a.z-e*a.y;this.y=e*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;this.x=d*h-e*g;this.y=e*f-c*h;this.z=c*g-d*f;return this},projectOnVector:function(){var a,b;return function(c){void 0===a&&(a=new THREE.Vector3);a.copy(c).normalize();b=this.dot(a);return this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;
return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/(this.length()*a.length());return Math.acos(THREE.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setEulerFromRotationMatrix:function(a,b){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},
setEulerFromQuaternion:function(a,b){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(a){console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code.");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code.");
return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code.");return this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();
a=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;this.x=d[c];this.y=d[c+1];this.z=d[c+2];return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a){this.x=a[0];this.y=a[1];this.z=a[2];return this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};
THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};
THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},
addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(a,b){if(void 0!==b)return console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},
applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a):(this.z=this.y=this.x=0,this.w=1);return this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,
this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){var b,c,d;a=a.elements;var e=a[0];d=a[4];var f=a[8],g=a[1],h=a[5],k=a[9];c=a[2];b=a[6];var m=a[10];if(.01>Math.abs(d-g)&&.01>Math.abs(f-c)&&.01>Math.abs(k-b)){if(.1>Math.abs(d+g)&&.1>Math.abs(f+c)&&.1>Math.abs(k+b)&&.1>Math.abs(e+h+m-3))return this.set(1,0,0,0),this;a=Math.PI;e=(e+1)/2;h=(h+1)/2;m=(m+1)/2;d=(d+g)/4;f=(f+c)/4;k=(k+b)/4;e>h&&e>m?.01>e?(b=0,d=c=.707106781):(b=Math.sqrt(e),c=d/b,d=f/b):h>m?.01>h?(b=.707106781,
c=0,d=.707106781):(c=Math.sqrt(h),b=d/c,d=k/c):.01>m?(c=b=.707106781,d=0):(d=Math.sqrt(m),b=f/d,c=k/d);this.set(b,c,d,a);return this}a=Math.sqrt((b-k)*(b-k)+(f-c)*(f-c)+(g-d)*(g-d));.001>Math.abs(a)&&(a=1);this.x=(b-k)/a;this.y=(f-c)/a;this.z=(g-d)/a;this.w=Math.acos((e+h+m-1)/2);return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);this.w>a.w&&(this.w=a.w);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&
(this.z=a.z);this.w<a.w&&(this.w=a.w);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);
this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);
this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},
setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a){this.x=a[0];this.y=a[1];this.z=a[2];this.w=a[3];return this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,
this.w)}};THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");THREE.Euler.DefaultOrder="XYZ";
THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},copy:function(a){this._x=
a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b){var c=THREE.Math.clamp,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[1],k=d[5],m=d[9],l=d[2],n=d[6],d=d[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(c(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-m,d),this._z=Math.atan2(-f,e)):(this._x=Math.atan2(n,k),this._z=0)):"YXZ"===b?(this._x=Math.asin(-c(m,-1,1)),.99999>Math.abs(m)?(this._y=Math.atan2(g,d),this._z=Math.atan2(h,k)):(this._y=
Math.atan2(-l,e),this._z=0)):"ZXY"===b?(this._x=Math.asin(c(n,-1,1)),.99999>Math.abs(n)?(this._y=Math.atan2(-l,d),this._z=Math.atan2(-f,k)):(this._y=0,this._z=Math.atan2(h,e))):"ZYX"===b?(this._y=Math.asin(-c(l,-1,1)),.99999>Math.abs(l)?(this._x=Math.atan2(n,d),this._z=Math.atan2(h,e)):(this._x=0,this._z=Math.atan2(-f,k))):"YZX"===b?(this._z=Math.asin(c(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-m,k),this._y=Math.atan2(-l,e)):(this._x=0,this._y=Math.atan2(g,d))):"XZY"===b?(this._z=Math.asin(-c(f,
-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(n,k),this._y=Math.atan2(g,e)):(this._x=Math.atan2(-m,d),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+b);this._order=b;this.onChangeCallback();return this},setFromQuaternion:function(a,b,c){var d=THREE.Math.clamp,e=a.x*a.x,f=a.y*a.y,g=a.z*a.z,h=a.w*a.w;b=b||this._order;"XYZ"===b?(this._x=Math.atan2(2*(a.x*a.w-a.y*a.z),h-e-f+g),this._y=Math.asin(d(2*(a.x*a.z+a.y*a.w),-1,1)),this._z=Math.atan2(2*(a.z*a.w-a.x*
a.y),h+e-f-g)):"YXZ"===b?(this._x=Math.asin(d(2*(a.x*a.w-a.y*a.z),-1,1)),this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),h-e-f+g),this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),h-e+f-g)):"ZXY"===b?(this._x=Math.asin(d(2*(a.x*a.w+a.y*a.z),-1,1)),this._y=Math.atan2(2*(a.y*a.w-a.z*a.x),h-e-f+g),this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),h-e+f-g)):"ZYX"===b?(this._x=Math.atan2(2*(a.x*a.w+a.z*a.y),h-e-f+g),this._y=Math.asin(d(2*(a.y*a.w-a.x*a.z),-1,1)),this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),h+e-f-g)):"YZX"===b?(this._x=Math.atan2(2*
(a.x*a.w-a.z*a.y),h-e+f-g),this._y=Math.atan2(2*(a.y*a.w-a.x*a.z),h+e-f-g),this._z=Math.asin(d(2*(a.x*a.y+a.z*a.w),-1,1))):"XZY"===b?(this._x=Math.atan2(2*(a.x*a.w+a.y*a.z),h-e+f-g),this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),h+e-f-g),this._z=Math.asin(d(2*(a.z*a.w-a.x*a.y),-1,1))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);
this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};
THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};
THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,
b){var c=b||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var e=b.dot(b),e=b.dot(a)/e;d&&(e=THREE.Math.clamp(e,0,1));return e}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);
this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};
THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){if(0<a.length){var b=a[0];this.min.copy(b);this.max.copy(b);for(var c=1,d=a.length;c<d;c++)b=a[c],b.x<this.min.x?this.min.x=b.x:b.x>this.max.x&&(this.max.x=b.x),b.y<this.min.y?this.min.y=b.y:b.y>this.max.y&&(this.max.y=b.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var a=new THREE.Vector2;return function(b,c){var d=a.copy(c).multiplyScalar(.5);
this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);
this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),
(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);
return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};
THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},addPoint:function(a){a.x<this.min.x?this.min.x=a.x:a.x>this.max.x&&(this.max.x=a.x);a.y<this.min.y?this.min.y=a.y:a.y>this.max.y&&(this.max.y=a.y);a.z<this.min.z?this.min.z=a.z:a.z>this.max.z&&(this.max.z=a.z);return this},setFromPoints:function(a){if(0<a.length){var b=a[0];this.min.copy(b);this.max.copy(b);for(var b=1,c=a.length;b<c;b++)this.addPoint(a[b])}else this.makeEmpty();return this},
setFromCenterAndSize:function(){var a=new THREE.Vector3;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),setFromObject:function(){var a=new THREE.Vector3;return function(b){var c=this;b.updateMatrixWorld(!0);this.makeEmpty();b.traverse(function(b){if(void 0!==b.geometry&&void 0!==b.geometry.vertices)for(var e=b.geometry.vertices,f=0,g=e.length;f<g;f++)a.copy(e[f]),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a)});return this}}(),
copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);
this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,
b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,
this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];
return function(b){a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();
this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};THREE.Matrix3=function(a,b,c,d,e,f,g,h,k){var m=this.elements=new Float32Array(9);m[0]=void 0!==a?a:1;m[3]=b||0;m[6]=c||0;m[1]=d||0;m[4]=void 0!==e?e:1;m[7]=f||0;m[2]=g||0;m[5]=h||0;m[8]=void 0!==k?k:1};
THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,e,f,g,h,k){var m=this.elements;m[0]=a;m[3]=b;m[6]=c;m[1]=d;m[4]=e;m[7]=f;m[2]=g;m[5]=h;m[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},multiplyVector3:function(a){console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},
multiplyVector3Array:function(a){console.warn("DEPRECATED: Matrix3's .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix3(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=
a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],k=a[7],a=a[8];return b*f*a-b*g*k-c*e*a+c*g*h+d*e*k-d*f*h},getInverse:function(a,b){var c=a.elements,d=this.elements;d[0]=c[10]*c[5]-c[6]*c[9];d[1]=-c[10]*c[1]+c[2]*c[9];d[2]=c[6]*c[1]-c[2]*c[5];d[3]=-c[10]*c[4]+c[6]*c[8];d[4]=c[10]*c[0]-c[2]*c[8];d[5]=-c[6]*c[0]+c[2]*c[4];d[6]=c[9]*c[4]-c[5]*c[8];d[7]=-c[9]*c[0]+c[1]*c[8];d[8]=c[5]*c[0]-
c[1]*c[4];c=c[0]*d[0]+c[1]*d[3]+c[2]*d[6];if(0===c){if(b)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];
a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a},getNormalMatrix:function(a){this.getInverse(a).transpose();return this},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]},clone:function(){var a=this.elements;return new THREE.Matrix3(a[0],
a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8])}};THREE.Matrix4=function(a,b,c,d,e,f,g,h,k,m,l,n,t,q,u,p){var v=this.elements=new Float32Array(16);v[0]=void 0!==a?a:1;v[4]=b||0;v[8]=c||0;v[12]=d||0;v[1]=e||0;v[5]=void 0!==f?f:1;v[9]=g||0;v[13]=h||0;v[2]=k||0;v[6]=m||0;v[10]=void 0!==l?l:1;v[14]=n||0;v[3]=t||0;v[7]=q||0;v[11]=u||0;v[15]=void 0!==p?p:1};
THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,h,k,m,l,n,t,q,u,p){var v=this.elements;v[0]=a;v[4]=b;v[8]=c;v[12]=d;v[1]=e;v[5]=f;v[9]=g;v[13]=h;v[2]=k;v[6]=m;v[10]=l;v[14]=n;v[3]=t;v[7]=q;v[11]=u;v[15]=p;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.elements.set(a.elements);return this},extractPosition:function(a){console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition().");
return this.copyPosition(a)},copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractRotation:function(){var a=new THREE.Vector3;return function(b){var c=this.elements;b=b.elements;var d=1/a.set(b[0],b[1],b[2]).length(),e=1/a.set(b[4],b[5],b[6]).length(),f=1/a.set(b[8],b[9],b[10]).length();c[0]=b[0]*d;c[1]=b[1]*d;c[2]=b[2]*d;c[4]=b[4]*e;c[5]=b[5]*e;c[6]=b[6]*e;c[8]=b[8]*f;c[9]=b[9]*f;c[10]=b[10]*f;return this}}(),makeRotationFromEuler:function(a){!1===
a instanceof THREE.Euler&&console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),c=Math.sin(c),g=Math.cos(d),d=Math.sin(d),h=Math.cos(e),e=Math.sin(e);if("XYZ"===a.order){a=f*h;var k=f*e,m=c*h,l=c*e;b[0]=g*h;b[4]=-g*e;b[8]=d;b[1]=k+m*d;b[5]=a-l*d;b[9]=-c*g;b[2]=l-a*d;b[6]=m+k*d;b[10]=f*g}else"YXZ"===a.order?(a=g*h,k=g*e,m=d*h,l=d*e,b[0]=a+l*c,b[4]=m*c-k,b[8]=
f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=k*c-m,b[6]=l+a*c,b[10]=f*g):"ZXY"===a.order?(a=g*h,k=g*e,m=d*h,l=d*e,b[0]=a-l*c,b[4]=-f*e,b[8]=m+k*c,b[1]=k+m*c,b[5]=f*h,b[9]=l-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*h,k=f*e,m=c*h,l=c*e,b[0]=g*h,b[4]=m*d-k,b[8]=a*d+l,b[1]=g*e,b[5]=l*d+a,b[9]=k*d-m,b[2]=-d,b[6]=c*g,b[10]=f*g):"YZX"===a.order?(a=f*g,k=f*d,m=c*g,l=c*d,b[0]=g*h,b[4]=l-a*e,b[8]=m*e+k,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+m,b[10]=a-l*e):"XZY"===a.order&&(a=f*g,k=f*d,m=c*g,l=c*d,b[0]=
g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+l,b[5]=f*h,b[9]=k*e-m,b[2]=m*e-k,b[6]=c*h,b[10]=l*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},setRotationFromQuaternion:function(a){console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code.");return this.makeRotationFromQuaternion(a)},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,k=e+e;a=c*g;var m=c*
h,c=c*k,l=d*h,d=d*k,e=e*k,g=f*g,h=f*h,f=f*k;b[0]=1-(l+e);b[4]=m-f;b[8]=c+h;b[1]=m+f;b[5]=1-(a+e);b[9]=d-g;b[2]=c-h;b[6]=d+g;b[10]=1-(a+l);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f){var g=this.elements;c.subVectors(d,e).normalize();0===c.length()&&(c.z=1);a.crossVectors(f,c).normalize();0===a.length()&&(c.x+=1E-4,a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=
a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],k=c[12],m=c[1],l=c[5],n=c[9],t=c[13],q=c[2],u=c[6],p=c[10],v=c[14],x=c[3],w=c[7],y=c[11],
c=c[15],M=d[0],z=d[4],K=d[8],H=d[12],D=d[1],L=d[5],A=d[9],E=d[13],F=d[2],J=d[6],N=d[10],B=d[14],C=d[3],G=d[7],Q=d[11],d=d[15];e[0]=f*M+g*D+h*F+k*C;e[4]=f*z+g*L+h*J+k*G;e[8]=f*K+g*A+h*N+k*Q;e[12]=f*H+g*E+h*B+k*d;e[1]=m*M+l*D+n*F+t*C;e[5]=m*z+l*L+n*J+t*G;e[9]=m*K+l*A+n*N+t*Q;e[13]=m*H+l*E+n*B+t*d;e[2]=q*M+u*D+p*F+v*C;e[6]=q*z+u*L+p*J+v*G;e[10]=q*K+u*A+p*N+v*Q;e[14]=q*H+u*E+p*B+v*d;e[3]=x*M+w*D+y*F+c*C;e[7]=x*z+w*L+y*J+c*G;e[11]=x*K+w*A+y*N+c*Q;e[15]=x*H+w*E+y*B+c*d;return this},multiplyToArray:function(a,
b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");
return a.applyProjection(this)},multiplyVector4:function(a){console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("DEPRECATED: Matrix4's .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);
void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix4(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),rotateAxis:function(a){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},determinant:function(){var a=
this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],k=a[13],m=a[2],l=a[6],n=a[10],t=a[14];return a[3]*(+e*h*l-d*k*l-e*g*n+c*k*n+d*g*t-c*h*t)+a[7]*(+b*h*t-b*k*n+e*f*n-d*f*t+d*k*m-e*h*m)+a[11]*(+b*k*l-b*g*t-e*f*l+c*f*t+e*g*m-c*k*m)+a[15]*(-d*g*m-b*h*l+b*g*n+d*f*l-c*f*n+c*h*m)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,
b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a=new THREE.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=
this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],k=d[1],m=d[5],l=d[9],n=d[13],t=d[2],q=d[6],u=d[10],p=d[14],v=d[3],x=d[7],w=d[11],d=d[15];c[0]=l*p*x-n*u*x+n*q*w-m*p*w-l*q*d+m*u*d;c[4]=h*u*x-g*p*x-h*q*w+f*p*w+g*q*d-f*u*d;c[8]=g*n*x-h*l*x+h*m*w-f*n*w-g*m*d+f*l*d;c[12]=h*l*q-g*n*q-h*m*u+f*n*u+g*m*p-f*l*p;c[1]=n*u*v-l*p*v-n*t*w+k*p*w+l*t*d-k*u*d;c[5]=g*p*v-h*u*v+h*t*w-e*p*w-g*t*d+e*u*d;c[9]=h*l*v-g*n*v-h*k*
w+e*n*w+g*k*d-e*l*d;c[13]=g*n*t-h*l*t+h*k*u-e*n*u-g*k*p+e*l*p;c[2]=m*p*v-n*q*v+n*t*x-k*p*x-m*t*d+k*q*d;c[6]=h*q*v-f*p*v-h*t*x+e*p*x+f*t*d-e*q*d;c[10]=f*n*v-h*m*v+h*k*x-e*n*x-f*k*d+e*m*d;c[14]=h*m*t-f*n*t-h*k*q+e*n*q+f*k*p-e*m*p;c[3]=l*q*v-m*u*v-l*t*x+k*u*x+m*t*w-k*q*w;c[7]=f*u*v-g*q*v+g*t*x-e*u*x-f*t*w+e*q*w;c[11]=g*m*v-f*l*v-g*k*x+e*l*x+f*k*w-e*m*w;c[15]=f*l*t-g*m*t+g*k*q-e*l*q-f*k*u+e*m*u;c=e*c[0]+k*c[4]+t*c[8]+v*c[12];if(0==c){if(b)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");
console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},translate:function(a){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(a){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(a){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(a){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(a,
b){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],Math.max(a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10])))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},
makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,k=e*f,m=e*g;this.set(k*f+c,k*g-d*h,k*h+d*g,0,k*g+d*h,m*g+c,m*h-d*f,0,k*h-
d*g,m*h+d*f,e*h*h+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a=new THREE.Vector3,b=new THREE.Matrix4;return function(c,d,e){var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),k=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=f[12];c.y=f[13];c.z=f[14];b.elements.set(this.elements);
c=1/g;var f=1/h,m=1/k;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=m;b.elements[9]*=m;b.elements[10]*=m;d.setFromRotationMatrix(b);e.x=g;e.y=h;e.z=k;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this},makePerspective:function(a,
b,c,d){a=c*Math.tan(THREE.Math.degToRad(.5*a));var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=b-a,k=c-d,m=f-e;g[0]=2/h;g[4]=0;g[8]=0;g[12]=-((b+a)/h);g[1]=0;g[5]=2/k;g[9]=0;g[13]=-((c+d)/k);g[2]=0;g[6]=0;g[10]=-2/m;g[14]=-((f+e)/m);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],
a[12],a[13],a[14],a[15]]},clone:function(){var a=this.elements;return new THREE.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};
THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){var c=b||new THREE.Vector3;c.subVectors(a,this.origin);
var d=c.dot(this.direction);return 0>d?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceTo(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceTo(b)}}(),distanceSqToSegment:function(a,b,c,d){var e=a.clone().add(b).multiplyScalar(.5),f=b.clone().sub(a).normalize(),g=.5*a.distanceTo(b),h=
this.origin.clone().sub(e);a=-this.direction.dot(f);b=h.dot(this.direction);var k=-h.dot(f),m=h.lengthSq(),l=Math.abs(1-a*a),n,t;0<=l?(h=a*k-b,n=a*b-k,t=g*l,0<=h?n>=-t?n<=t?(g=1/l,h*=g,n*=g,a=h*(h+a*n+2*b)+n*(a*h+n+2*k)+m):(n=g,h=Math.max(0,-(a*n+b)),a=-h*h+n*(n+2*k)+m):(n=-g,h=Math.max(0,-(a*n+b)),a=-h*h+n*(n+2*k)+m):n<=-t?(h=Math.max(0,-(-a*g+b)),n=0<h?-g:Math.min(Math.max(-g,-k),g),a=-h*h+n*(n+2*k)+m):n<=t?(h=0,n=Math.min(Math.max(-g,-k),g),a=n*(n+2*k)+m):(h=Math.max(0,-(a*g+b)),n=0<h?g:Math.min(Math.max(-g,
-k),g),a=-h*h+n*(n+2*k)+m)):(n=0<a?-g:g,h=Math.max(0,-(a*n+b)),a=-h*h+n*(n+2*k)+m);c&&c.copy(this.direction.clone().multiplyScalar(h).add(this.origin));d&&d.copy(f.clone().multiplyScalar(n).add(e));return a},isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0==b)return 0==a.distanceToPoint(this.origin)?
0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){var c=this.distanceToPlane(a);return null===c?null:this.at(c,b)},isIntersectionBox:function(){var a=new THREE.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectBox:function(a,b){var c,d,e,f,g;d=1/this.direction.x;f=1/this.direction.y;g=1/this.direction.z;var h=this.origin;0<=d?(c=(a.min.x-h.x)*d,d*=a.max.x-h.x):(c=(a.max.x-h.x)*d,d*=a.min.x-h.x);0<=f?(e=(a.min.y-h.y)*f,f*=
a.max.y-h.y):(e=(a.max.y-h.y)*f,f*=a.min.y-h.y);if(c>f||e>d)return null;if(e>c||c!==c)c=e;if(f<d||d!==d)d=f;0<=g?(e=(a.min.z-h.z)*g,g*=a.max.z-h.z):(e=(a.max.z-h.z)*g,g*=a.min.z-h.z);if(c>g||e>d)return null;if(e>c||c!==c)c=e;if(g<d||d!==d)d=g;return 0>d?null:this.at(0<=c?c:d,b)},intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h,k){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);if(0<
f){if(h)return null;h=1}else if(0>f)h=-1,f=-f;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;g=h*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;e=-h*a.dot(d);return 0>e?null:this.at(e/f,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},
clone:function(){return(new THREE.Ray).copy(this)}};THREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};
THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=0,f=0,g=b.length;f<g;f++)e=Math.max(e,d.distanceToSquared(b[f]));this.radius=Math.sqrt(e);return this}}(),copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=
this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a),d=b||new THREE.Vector3;d.copy(a);c>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center));return d},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);
return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};
THREE.Frustum=function(a,b,c,d,e,f){this.planes=[void 0!==a?a:new THREE.Plane,void 0!==b?b:new THREE.Plane,void 0!==c?c:new THREE.Plane,void 0!==d?d:new THREE.Plane,void 0!==e?e:new THREE.Plane,void 0!==f?f:new THREE.Plane]};
THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],k=c[6],m=c[7],l=c[8],n=c[9],t=c[10],q=c[11],u=c[12],p=c[13],v=c[14],c=c[15];b[0].setComponents(f-a,m-g,q-l,c-u).normalize();b[1].setComponents(f+
a,m+g,q+l,c+u).normalize();b[2].setComponents(f+d,m+h,q+n,c+p).normalize();b[3].setComponents(f-d,m-h,q-n,c-p).normalize();b[4].setComponents(f-e,m-k,q-t,c-v).normalize();b[5].setComponents(f+e,m+k,q+t,c+v).normalize();return this},intersectsObject:function(){var a=new THREE.Sphere;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere);a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,
c=a.center;a=-a.radius;for(var d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){for(var d=this.planes,e=0;6>e;e++){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x?c.max.x:c.min.x;a.y=0<f.normal.y?c.min.y:c.max.y;b.y=0<f.normal.y?c.max.y:c.min.y;a.z=0<f.normal.z?c.min.z:c.max.z;b.z=0<f.normal.z?c.max.z:c.min.z;var g=f.distanceToPoint(a),f=f.distanceToPoint(b);if(0>g&&0>f)return!1}return!0}}(),
containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};
THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,
c);return this}}(),copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,
b){var c=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(c)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){var d=c||new THREE.Vector3,e=b.delta(a),f=this.normal.dot(e);if(0==f){if(0==this.distanceToPoint(b.start))return d.copy(b.start)}else return f=-(b.start.dot(this.normal)+this.constant)/f,0>f||1<f?void 0:d.copy(e).multiplyScalar(f).add(b.start)}}(),
coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(d,e){var f=e||c.getNormalMatrix(d),f=a.copy(this.normal).applyMatrix3(f),g=this.coplanarPoint(b);g.applyMatrix4(d);this.setFromNormalAndCoplanarPoint(f,g);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&
a.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};
THREE.Math={generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8==e||13==e||18==e||23==e?b[e]="-":14==e?b[e]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19==e?d&3|8:d]);return b.join("")}}(),clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=
b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},sign:function(a){return 0>a?-1:0<a?1:0},degToRad:function(){var a=Math.PI/180;return function(b){return b*
a}}(),radToDeg:function(){var a=180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a}};
THREE.Spline=function(a){function b(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c=[],d={x:0,y:0,z:0},e,f,g,h,k,m,l,n,t;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getPoint=function(a){e=(this.points.length-1)*a;f=Math.floor(e);g=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f>this.points.length-2?this.points.length-1:f+1;c[3]=f>this.points.length-3?this.points.length-1:f+
2;m=this.points[c[0]];l=this.points[c[1]];n=this.points[c[2]];t=this.points[c[3]];h=g*g;k=g*h;d.x=b(m.x,l.x,n.x,t.x,g,h,k);d.y=b(m.y,l.y,n.y,t.y,g,h,k);d.z=b(m.z,l.z,n.z,t.z,g,h,k);return d};this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d};this.getLength=function(a){var b,c,d,e=0,f=new THREE.Vector3,g=new THREE.Vector3,h=[],l=0;h[0]=0;a||(a=100);c=this.points.length*a;f.copy(this.points[0]);for(a=1;a<c;a++)b=a/c,
d=this.getPoint(b),g.copy(d),l+=g.distanceTo(f),f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!=e&&(h[b]=l,e=b);h[h.length]=l;return{chunks:h,total:l}};this.reparametrizeByArcLength=function(a){var b,c,d,e,f,g,h=[],l=new THREE.Vector3,k=this.getLength();h.push(l.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){c=k.chunks[b]-k.chunks[b-1];g=Math.ceil(a*c/k.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<g-1;c++)d=e+1/g*c*(f-e),d=this.getPoint(d),h.push(l.copy(d).clone());
h.push(l.copy(this.points[b]).clone())}this.points=h}};THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3;this.b=void 0!==b?b:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,d,e){e=e||new THREE.Vector3;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();
THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g,h){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var k=b.dot(b);g=b.dot(c);var m=d*k-e*e;h=h||new THREE.Vector3;if(0==m)return h.set(-2,-1,-1);m=1/m;k=(k*f-e*g)*m;d=(d*g-e*f)*m;return h.set(1-k-d,d,k)}}();
THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,d,e){b=THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();
THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||
new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},
clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Vertex=function(a){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.");return a};THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),
a=.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};
THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(a){a.addEventListener=THREE.EventDispatcher.prototype.addEventListener;a.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;a.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&
c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var d=c.indexOf(b);-1!==d&&c.splice(d,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=b.length,e=0;e<d;e++)c[e]=b[e];for(e=0;e<d;e++)c[e].call(this,a)}}}};
(function(a){a.Raycaster=function(b,c,d,e){this.ray=new a.Ray(b,c);this.near=d||0;this.far=e||Infinity};var b=new a.Sphere,c=new a.Ray;new a.Plane;new a.Vector3;var d=new a.Vector3,e=new a.Matrix4,f=function(a,b){return a.distance-b.distance},g=new a.Vector3,h=new a.Vector3,k=new a.Vector3,m=function(f,l,q){if(f instanceof a.Sprite){d.setFromMatrixPosition(f.matrixWorld);var u=l.ray.distanceToPoint(d);if(u>f.scale.x)return q;q.push({distance:u,point:f.position,face:null,object:f})}else if(f instanceof
a.LOD)d.setFromMatrixPosition(f.matrixWorld),u=l.ray.origin.distanceTo(d),m(f.getObjectForDistance(u),l,q);else if(f instanceof a.Mesh){var p=f.geometry;null===p.boundingSphere&&p.computeBoundingSphere();b.copy(p.boundingSphere);b.applyMatrix4(f.matrixWorld);if(!1===l.ray.isIntersectionSphere(b))return q;e.getInverse(f.matrixWorld);c.copy(l.ray).applyMatrix4(e);if(null!==p.boundingBox&&!1===c.isIntersectionBox(p.boundingBox))return q;if(p instanceof a.BufferGeometry){var v=f.material;if(void 0===
v)return q;var x=p.attributes,w,y,M=l.precision;if(void 0!==x.index){var z=x.index.array,K=x.position.array,H=p.offsets;0===H.length&&(H=[{start:0,count:K.length,index:0}]);for(var D=0,L=H.length;D<L;++D)for(var x=H[D].start,A=H[D].index,p=x,E=x+H[D].count;p<E;p+=3){x=A+z[p];w=A+z[p+1];y=A+z[p+2];g.set(K[3*x],K[3*x+1],K[3*x+2]);h.set(K[3*w],K[3*w+1],K[3*w+2]);k.set(K[3*y],K[3*y+1],K[3*y+2]);var F=v.side===a.BackSide?c.intersectTriangle(k,h,g,!0):c.intersectTriangle(g,h,k,v.side!==a.DoubleSide);null!==
F&&(F.applyMatrix4(f.matrixWorld),u=l.ray.origin.distanceTo(F),u<M||u<l.near||u>l.far||q.push({distance:u,point:F,indices:[x,w,y],face:null,faceIndex:null,object:f}))}}else for(K=x.position.array,p=0,E=x.position.array.length;p<E;p+=3)x=p,w=p+1,y=p+2,g.set(K[3*x],K[3*x+1],K[3*x+2]),h.set(K[3*w],K[3*w+1],K[3*w+2]),k.set(K[3*y],K[3*y+1],K[3*y+2]),F=v.side===a.BackSide?c.intersectTriangle(k,h,g,!0):c.intersectTriangle(g,h,k,v.side!==a.DoubleSide),null!==F&&(F.applyMatrix4(f.matrixWorld),u=l.ray.origin.distanceTo(F),
u<M||u<l.near||u>l.far||q.push({distance:u,point:F,indices:[x,w,y],face:null,faceIndex:null,object:f}))}else if(p instanceof a.Geometry)for(K=f.material instanceof a.MeshFaceMaterial,H=!0===K?f.material.materials:null,M=l.precision,z=p.vertices,D=0,L=p.faces.length;D<L;D++)if(A=p.faces[D],v=!0===K?H[A.materialIndex]:f.material,void 0!==v){x=z[A.a];w=z[A.b];y=z[A.c];if(!0===v.morphTargets){u=p.morphTargets;F=f.morphTargetInfluences;g.set(0,0,0);h.set(0,0,0);k.set(0,0,0);for(var E=0,J=u.length;E<J;E++){var N=
F[E];if(0!==N){var B=u[E].vertices;g.x+=(B[A.a].x-x.x)*N;g.y+=(B[A.a].y-x.y)*N;g.z+=(B[A.a].z-x.z)*N;h.x+=(B[A.b].x-w.x)*N;h.y+=(B[A.b].y-w.y)*N;h.z+=(B[A.b].z-w.z)*N;k.x+=(B[A.c].x-y.x)*N;k.y+=(B[A.c].y-y.y)*N;k.z+=(B[A.c].z-y.z)*N}}g.add(x);h.add(w);k.add(y);x=g;w=h;y=k}F=v.side===a.BackSide?c.intersectTriangle(y,w,x,!0):c.intersectTriangle(x,w,y,v.side!==a.DoubleSide);null!==F&&(F.applyMatrix4(f.matrixWorld),u=l.ray.origin.distanceTo(F),u<M||u<l.near||u>l.far||q.push({distance:u,point:F,face:A,
faceIndex:D,object:f}))}}else if(f instanceof a.Line){M=l.linePrecision;v=M*M;p=f.geometry;null===p.boundingSphere&&p.computeBoundingSphere();b.copy(p.boundingSphere);b.applyMatrix4(f.matrixWorld);if(!1===l.ray.isIntersectionSphere(b))return q;e.getInverse(f.matrixWorld);c.copy(l.ray).applyMatrix4(e);if(p instanceof a.Geometry)for(z=p.vertices,M=z.length,x=new a.Vector3,w=new a.Vector3,y=f.type===a.LineStrip?1:2,p=0;p<M-1;p+=y)c.distanceSqToSegment(z[p],z[p+1],w,x)>v||(u=c.origin.distanceTo(w),u<
l.near||u>l.far||q.push({distance:u,point:x.clone().applyMatrix4(f.matrixWorld),face:null,faceIndex:null,object:f}))}},l=function(a,b,c){a=a.getDescendants();for(var d=0,e=a.length;d<e;d++)m(a[d],b,c)};a.Raycaster.prototype.precision=1E-4;a.Raycaster.prototype.linePrecision=1;a.Raycaster.prototype.set=function(a,b){this.ray.set(a,b)};a.Raycaster.prototype.intersectObject=function(a,b){var c=[];!0===b&&l(a,this,c);m(a,this,c);c.sort(f);return c};a.Raycaster.prototype.intersectObjects=function(a,b){for(var c=
[],d=0,e=a.length;d<e;d++)m(a[d],this,c),!0===b&&l(a[d],this,c);c.sort(f);return c}})(THREE);
THREE.Object3D=function(){this.id=THREE.Object3DIdCount++;this.uuid=THREE.Math.generateUUID();this.name="";this.parent=void 0;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;var a=this;Object.defineProperties(this,{rotation:{enumerable:!0,value:(new THREE.Euler).onChange(function(){a.quaternion.setFromEuler(a.rotation,!1)})},quaternion:{enumerable:!0,value:(new THREE.Quaternion).onChange(function(){a.rotation.setFromQuaternion(a.quaternion,void 0,!1)})},scale:{enumerable:!0,
value:new THREE.Vector3(1,1,1)}});this.renderDepth=null;this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.userData={}};
THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order.");return this.rotation.order},set eulerOrder(a){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order.");this.rotation.order=a},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(a){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},
applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new THREE.Quaternion;return function(b,c){a.setFromAxisAngle(b,
c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b);a.applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(c));
return this}}(),translate:function(a,b){console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed.");return this.translateOnAxis(b,a)},translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,
b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(a===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(a instanceof THREE.Object3D){void 0!==a.parent&&
a.parent.remove(a);a.parent=this;a.dispatchEvent({type:"added"});this.children.push(a);for(var b=this;void 0!==b.parent;)b=b.parent;void 0!==b&&b instanceof THREE.Scene&&b.__addObject(a)}},remove:function(a){var b=this.children.indexOf(a);if(-1!==b){a.parent=void 0;a.dispatchEvent({type:"removed"});this.children.splice(b,1);for(b=this;void 0!==b.parent;)b=b.parent;void 0!==b&&b instanceof THREE.Scene&&b.__removeObject(a)}},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)},
getObjectById:function(a,b){for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c];if(e.id===a||!0===b&&(e=e.getObjectById(a,b),void 0!==e))return e}},getObjectByName:function(a,b){for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c];if(e.name===a||!0===b&&(e=e.getObjectByName(a,b),void 0!==e))return e}},getChildByName:function(a,b){console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a,b)},getDescendants:function(a){void 0===
a&&(a=[]);Array.prototype.push.apply(a,this.children);for(var b=0,c=this.children.length;b<c;b++)this.children[b].getDescendants(a);return a},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),
this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},clone:function(a,b){void 0===a&&(a=new THREE.Object3D);void 0===b&&(b=!0);a.name=this.name;a.up.copy(this.up);a.position.copy(this.position);a.quaternion.copy(this.quaternion);a.scale.copy(this.scale);a.renderDepth=this.renderDepth;a.rotationAutoUpdate=this.rotationAutoUpdate;a.matrix.copy(this.matrix);a.matrixWorld.copy(this.matrixWorld);a.matrixAutoUpdate=this.matrixAutoUpdate;a.matrixWorldNeedsUpdate=
this.matrixWorldNeedsUpdate;a.visible=this.visible;a.castShadow=this.castShadow;a.receiveShadow=this.receiveShadow;a.frustumCulled=this.frustumCulled;a.userData=JSON.parse(JSON.stringify(this.userData));if(!0===b)for(var c=0;c<this.children.length;c++)a.add(this.children[c].clone());return a}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;
THREE.Projector=function(){function a(){if(l===t){var a=new THREE.RenderableVertex;n.push(a);t++;l++;return a}return n[l++]}function b(){if(u===v){var a=new THREE.RenderableFace;p.push(a);v++;u++;return a}return p[u++]}function c(){if(w===M){var a=new THREE.RenderableLine;y.push(a);M++;w++;return a}return y[w++]}function d(a,b){return a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}function e(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;if(0<=e&&0<=f&&0<=g&&0<=h)return!0;if(0>e&&0>f||0>g&&
0>h)return!1;0>e?c=Math.max(c,e/(e-f)):0>f&&(d=Math.min(d,e/(e-f)));0>g?c=Math.max(c,g/(g-h)):0>h&&(d=Math.min(d,g/(g-h)));if(d<c)return!1;a.lerp(b,c);b.lerp(a,1-d);return!0}var f,g,h=[],k=0,m,l,n=[],t=0,q,u,p=[],v=0,x,w,y=[],M=0,z,K,H=[],D=0,L={objects:[],lights:[],elements:[]},A=new THREE.Vector3,E=new THREE.Vector3,F=new THREE.Vector3,J=new THREE.Vector3,N=new THREE.Vector4,B=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),C=new THREE.Box3,G=Array(3),Q=new THREE.Matrix4,Z=
new THREE.Matrix4,T,ba=new THREE.Matrix4,V=new THREE.Matrix3,S=new THREE.Frustum,I=new THREE.Vector4,Y=new THREE.Vector4;this.projectVector=function(a,b){b.matrixWorldInverse.getInverse(b.matrixWorld);Z.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);return a.applyProjection(Z)};this.unprojectVector=function(){var a=new THREE.Matrix4;return function(b,c){a.getInverse(c.projectionMatrix);Z.multiplyMatrices(c.matrixWorld,a);return b.applyProjection(Z)}}();this.pickingRay=function(a,b){a.z=
-1;var c=new THREE.Vector3(a.x,a.y,1);this.unprojectVector(a,b);this.unprojectVector(c,b);c.sub(a).normalize();return new THREE.Raycaster(a,c)};var $=function(a){if(!1!==a.visible){if(a instanceof THREE.Light)L.lights.push(a);else if(a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Sprite)if(!1===a.frustumCulled||!0===S.intersectsObject(a)){if(g===k){var b=new THREE.RenderableObject;h.push(b);k++;g++;f=b}else f=h[g++];f.id=a.id;f.object=a;null!==a.renderDepth?f.z=a.renderDepth:
(J.setFromMatrixPosition(a.matrixWorld),J.applyProjection(Z),f.z=J.z);L.objects.push(f)}for(var b=0,c=a.children.length;b<c;b++)$(a.children[b])}},ca=new function(){var d=[],e=[],f=null,g=null,h=new THREE.Matrix3,l=function(a){var b=a.positionWorld,c=a.positionScreen;b.copy(a.position).applyMatrix4(T);c.copy(b).applyMatrix4(Z);b=1/c.w;c.x*=b;c.y*=b;c.z*=b;a.visible=-1<=c.x&&1>=c.x&&-1<=c.y&&1>=c.y&&-1<=c.z&&1>=c.z},k=function(a,b,c){if(!0===a.visible||!0===b.visible||!0===c.visible)return!0;G[0]=
a.positionScreen;G[1]=b.positionScreen;G[2]=c.positionScreen;return B.isIntersectionBox(C.setFromPoints(G))},u=function(a,b,c){return 0>(c.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)};return{setObject:function(a){f=a;g=f.material;h.getNormalMatrix(f.matrixWorld);d.length=0;e.length=0},projectVertex:l,checkTriangleVisibility:k,checkBackfaceCulling:u,pushVertex:function(b,c,d){m=a();m.position.set(b,
c,d);l(m)},pushNormal:function(a,b,c){d.push(a,b,c)},pushUv:function(a,b){e.push(a,b)},pushLine:function(a,b){var d=n[a],e=n[b];x=c();x.id=f.id;x.v1.copy(d);x.v2.copy(e);x.z=(d.positionScreen.z+e.positionScreen.z)/2;x.material=f.material;L.elements.push(x)},pushTriangle:function(a,c,l){var m=n[a],p=n[c],t=n[l];if(!1!==k(m,p,t)&&(g.side===THREE.DoubleSide||!0===u(m,p,t))){q=b();q.id=f.id;q.v1.copy(m);q.v2.copy(p);q.v3.copy(t);q.z=(m.positionScreen.z+p.positionScreen.z+t.positionScreen.z)/3;for(m=0;3>
m;m++)p=3*arguments[m],t=q.vertexNormalsModel[m],t.set(d[p],d[p+1],d[p+2]),t.applyMatrix3(h).normalize(),p=2*arguments[m],q.uvs[m].set(e[p],e[p+1]);q.vertexNormalsLength=3;q.material=f.material;L.elements.push(q)}}}};this.projectScene=function(f,h,k,m){var p,t,v,y,J,r,M,B;K=w=u=0;L.elements.length=0;!0===f.autoUpdate&&f.updateMatrixWorld();void 0===h.parent&&h.updateMatrixWorld();Q.copy(h.matrixWorldInverse.getInverse(h.matrixWorld));Z.multiplyMatrices(h.projectionMatrix,Q);S.setFromMatrix(Z);g=0;
L.objects.length=0;L.lights.length=0;$(f);!0===k&&L.objects.sort(d);f=0;for(k=L.objects.length;f<k;f++)if(p=L.objects[f].object,t=p.geometry,ca.setObject(p),T=p.matrixWorld,l=0,p instanceof THREE.Mesh)if(t instanceof THREE.BufferGeometry){if(r=t.attributes,p=t.offsets,void 0!==r.position){M=r.position.array;t=0;for(y=M.length;t<y;t+=3)ca.pushVertex(M[t],M[t+1],M[t+2]);if(void 0!==r.normal)for(B=r.normal.array,t=0,y=B.length;t<y;t+=3)ca.pushNormal(B[t],B[t+1],B[t+2]);if(void 0!==r.uv)for(B=r.uv.array,
t=0,y=B.length;t<y;t+=2)ca.pushUv(B[t],B[t+1]);if(void 0!==r.index)if(r=r.index.array,0<p.length)for(f=0;f<p.length;f++)for(y=p[f],M=y.index,t=y.start,y=y.start+y.count;t<y;t+=3)ca.pushTriangle(r[t]+M,r[t+1]+M,r[t+2]+M);else for(t=0,y=r.length;t<y;t+=3)ca.pushTriangle(r[t],r[t+1],r[t+2]);else for(t=0,y=M.length/3;t<y;t+=3)ca.pushTriangle(t,t+1,t+2)}}else{if(t instanceof THREE.Geometry){v=t.vertices;y=t.faces;r=t.faceVertexUvs[0];V.getNormalMatrix(T);M=p.material instanceof THREE.MeshFaceMaterial;
B=!0===M?p.material:null;for(var C=0,G=v.length;C<G;C++){var la=v[C];ca.pushVertex(la.x,la.y,la.z)}C=0;for(G=y.length;C<G;C++){v=y[C];var ya=!0===M?B.materials[v.materialIndex]:p.material;if(void 0!==ya){var Aa=ya.side,la=n[v.a],fa=n[v.b],ka=n[v.c];if(!0===ya.morphTargets){J=t.morphTargets;var oa=p.morphTargetInfluences,U=la.position,Pa=fa.position,Da=ka.position;A.set(0,0,0);E.set(0,0,0);F.set(0,0,0);for(var Ea=0,ga=J.length;Ea<ga;Ea++){var da=oa[Ea];if(0!==da){var ta=J[Ea].vertices;A.x+=(ta[v.a].x-
U.x)*da;A.y+=(ta[v.a].y-U.y)*da;A.z+=(ta[v.a].z-U.z)*da;E.x+=(ta[v.b].x-Pa.x)*da;E.y+=(ta[v.b].y-Pa.y)*da;E.z+=(ta[v.b].z-Pa.z)*da;F.x+=(ta[v.c].x-Da.x)*da;F.y+=(ta[v.c].y-Da.y)*da;F.z+=(ta[v.c].z-Da.z)*da}}la.position.add(A);fa.position.add(E);ka.position.add(F);ca.projectVertex(la);ca.projectVertex(fa);ca.projectVertex(ka)}if(!1!==ca.checkTriangleVisibility(la,fa,ka)){oa=ca.checkBackfaceCulling(la,fa,ka);if(Aa!==THREE.DoubleSide){if(Aa===THREE.FrontSide&&!1===oa)continue;if(Aa===THREE.BackSide&&
!0===oa)continue}q=b();q.id=p.id;q.v1.copy(la);q.v2.copy(fa);q.v3.copy(ka);q.normalModel.copy(v.normal);!1!==oa||Aa!==THREE.BackSide&&Aa!==THREE.DoubleSide||q.normalModel.negate();q.normalModel.applyMatrix3(V).normalize();J=v.vertexNormals;U=0;for(Pa=Math.min(J.length,3);U<Pa;U++)Da=q.vertexNormalsModel[U],Da.copy(J[U]),!1!==oa||Aa!==THREE.BackSide&&Aa!==THREE.DoubleSide||Da.negate(),Da.applyMatrix3(V).normalize();q.vertexNormalsLength=J.length;Aa=r[C];if(void 0!==Aa)for(J=0;3>J;J++)q.uvs[J].copy(Aa[J]);
q.color=v.color;q.material=ya;q.z=(la.positionScreen.z+fa.positionScreen.z+ka.positionScreen.z)/3;L.elements.push(q)}}}}}else if(p instanceof THREE.Line)if(t instanceof THREE.BufferGeometry){if(r=t.attributes,void 0!==r.position){M=r.position.array;t=0;for(y=M.length;t<y;t+=3)ca.pushVertex(M[t],M[t+1],M[t+2]);if(void 0!==r.index)for(r=r.index.array,t=0,y=r.length;t<y;t+=2)ca.pushLine(r[t],r[t+1]);else for(t=0,y=M.length/3-1;t<y;t++)ca.pushLine(t,t+1)}}else{if(t instanceof THREE.Geometry&&(ba.multiplyMatrices(Z,
T),v=p.geometry.vertices,0!==v.length))for(la=a(),la.positionScreen.copy(v[0]).applyMatrix4(ba),t=p.type===THREE.LinePieces?2:1,C=1,G=v.length;C<G;C++)la=a(),la.positionScreen.copy(v[C]).applyMatrix4(ba),0<(C+1)%t||(fa=n[l-2],I.copy(la.positionScreen),Y.copy(fa.positionScreen),!0===e(I,Y)&&(I.multiplyScalar(1/I.w),Y.multiplyScalar(1/Y.w),x=c(),x.id=p.id,x.v1.positionScreen.copy(I),x.v2.positionScreen.copy(Y),x.z=Math.max(I.z,Y.z),x.material=p.material,p.material.vertexColors===THREE.VertexColors&&
(x.vertexColors[0].copy(p.geometry.colors[C]),x.vertexColors[1].copy(p.geometry.colors[C-1])),L.elements.push(x)))}else p instanceof THREE.Sprite&&(N.set(T.elements[12],T.elements[13],T.elements[14],1),N.applyMatrix4(Z),t=1/N.w,N.z*=t,-1<=N.z&&1>=N.z&&(K===D?(y=new THREE.RenderableSprite,H.push(y),D++,K++,z=y):z=H[K++],z.id=p.id,z.x=N.x*t,z.y=N.y*t,z.z=N.z,z.object=p,z.rotation=p.rotation,z.scale.x=p.scale.x*Math.abs(z.x-(N.x+h.projectionMatrix.elements[0])/(N.w+h.projectionMatrix.elements[12])),
z.scale.y=p.scale.y*Math.abs(z.y-(N.y+h.projectionMatrix.elements[5])/(N.w+h.projectionMatrix.elements[13])),z.material=p.material,L.elements.push(z)));!0===m&&L.elements.sort(d);return L}};
THREE.Face3=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=e instanceof THREE.Color?e:new THREE.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=void 0!==f?f:0};
THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var a=new THREE.Face3(this.a,this.b,this.c);a.normal.copy(this.normal);a.color.copy(this.color);a.materialIndex=this.materialIndex;var b,c;b=0;for(c=this.vertexNormals.length;b<c;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();b=0;for(c=this.vertexColors.length;b<c;b++)a.vertexColors[b]=this.vertexColors[b].clone();b=0;for(c=this.vertexTangents.length;b<c;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}};
THREE.Face4=function(a,b,c,d,e,f,g){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(a,b,c,e,f,g)};THREE.BufferAttribute=function(){};
THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},set:function(a){this.array.set(a)},setX:function(a,b){this.array[a*this.itemSize]=b},setY:function(a,b){this.array[a*this.itemSize+1]=b},setZ:function(a,b){this.array[a*this.itemSize+2]=b},setXY:function(a,b,c){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d},setXYZW:function(a,b,c,d,e){a*=this.itemSize;
this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e}};THREE.Int8Attribute=function(a,b){this.array=new Int8Array(a*b);this.itemSize=b};THREE.Int8Attribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.Uint8Attribute=function(a,b){this.array=new Uint8Array(a*b);this.itemSize=b};THREE.Uint8Attribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.Uint8ClampedAttribute=function(a,b){this.array=new Uint8ClampedArray(a*b);this.itemSize=b};
THREE.Uint8ClampedAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.Int16Attribute=function(a,b){this.array=new Int16Array(a*b);this.itemSize=b};THREE.Int16Attribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.Uint16Attribute=function(a,b){this.array=new Uint16Array(a*b);this.itemSize=b};THREE.Uint16Attribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.Int32Attribute=function(a,b){this.array=new Int32Array(a*b);this.itemSize=b};
THREE.Int32Attribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.Uint32Attribute=function(a,b){this.array=new Uint32Array(a*b);this.itemSize=b};THREE.Uint32Attribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.Float32Attribute=function(a,b){this.array=new Float32Array(a*b);this.itemSize=b};THREE.Float32Attribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.Float64Attribute=function(a,b){this.array=new Float64Array(a*b);this.itemSize=b};
THREE.Float64Attribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++;this.uuid=THREE.Math.generateUUID();this.name="";this.attributes={};this.offsets=this.drawcalls=[];this.boundingSphere=this.boundingBox=null};
THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(a,b,c){!1===b instanceof THREE.BufferAttribute?(console.warn("DEPRECATED: BufferGeometry's addAttribute() now expects ( name, attribute )."),this.attributes[a]={array:b,itemSize:c}):this.attributes[a]=b},getAttribute:function(a){return this.attributes[a]},addDrawCall:function(a,b,c){this.drawcalls.push({start:a,count:b,index:void 0!==c?c:0})},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),
b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),b.needsUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var a=this.attributes.position.array;if(a){var b=this.boundingBox;3<=a.length&&(b.min.x=b.max.x=a[0],b.min.y=b.max.y=a[1],b.min.z=b.max.z=a[2]);for(var c=3,d=a.length;c<d;c+=3){var e=a[c],f=a[c+1],g=a[c+2];e<b.min.x?b.min.x=e:e>b.max.x&&(b.max.x=e);f<b.min.y?b.min.y=f:
f>b.max.y&&(b.max.y=f);g<b.min.z?b.min.z=g:g>b.max.z&&(b.max.z=g)}}if(void 0===a||0===a.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position.array;if(c){a.makeEmpty();for(var d=this.boundingSphere.center,e=0,f=c.length;e<f;e+=3)b.set(c[e],c[e+1],c[e+2]),a.addPoint(b);a.center(d);for(var g=0,
e=0,f=c.length;e<f;e+=3)b.set(c[e],c[e+1],c[e+2]),g=Math.max(g,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(g)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){if(this.attributes.position){var a,b,c,d;a=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(a)};else for(a=0,b=this.attributes.normal.array.length;a<b;a++)this.attributes.normal.array[a]=0;var e=this.attributes.position.array,
f=this.attributes.normal.array,g,h,k,m,l,n,t=new THREE.Vector3,q=new THREE.Vector3,u=new THREE.Vector3,p=new THREE.Vector3,v=new THREE.Vector3;if(this.attributes.index){var x=this.attributes.index.array,w=0<this.offsets.length?this.offsets:[{start:0,count:x.length,index:0}];c=0;for(d=w.length;c<d;++c){b=w[c].start;g=w[c].count;var y=w[c].index;a=b;for(b+=g;a<b;a+=3)g=y+x[a],h=y+x[a+1],k=y+x[a+2],m=e[3*g],l=e[3*g+1],n=e[3*g+2],t.set(m,l,n),m=e[3*h],l=e[3*h+1],n=e[3*h+2],q.set(m,l,n),m=e[3*k],l=e[3*
k+1],n=e[3*k+2],u.set(m,l,n),p.subVectors(u,q),v.subVectors(t,q),p.cross(v),f[3*g]+=p.x,f[3*g+1]+=p.y,f[3*g+2]+=p.z,f[3*h]+=p.x,f[3*h+1]+=p.y,f[3*h+2]+=p.z,f[3*k]+=p.x,f[3*k+1]+=p.y,f[3*k+2]+=p.z}}else for(a=0,b=e.length;a<b;a+=9)m=e[a],l=e[a+1],n=e[a+2],t.set(m,l,n),m=e[a+3],l=e[a+4],n=e[a+5],q.set(m,l,n),m=e[a+6],l=e[a+7],n=e[a+8],u.set(m,l,n),p.subVectors(u,q),v.subVectors(t,q),p.cross(v),f[a]=p.x,f[a+1]=p.y,f[a+2]=p.z,f[a+3]=p.x,f[a+4]=p.y,f[a+5]=p.z,f[a+6]=p.x,f[a+7]=p.y,f[a+8]=p.z;this.normalizeNormals();
this.normalsNeedUpdate=!0}},computeTangents:function(){function a(a,b,c){n=d[3*a];t=d[3*a+1];q=d[3*a+2];u=d[3*b];p=d[3*b+1];v=d[3*b+2];x=d[3*c];w=d[3*c+1];y=d[3*c+2];M=f[2*a];z=f[2*a+1];K=f[2*b];H=f[2*b+1];D=f[2*c];L=f[2*c+1];A=u-n;E=x-n;F=p-t;J=w-t;N=v-q;B=y-q;C=K-M;G=D-M;Q=H-z;Z=L-z;T=1/(C*Z-G*Q);ba.set((Z*A-Q*E)*T,(Z*F-Q*J)*T,(Z*N-Q*B)*T);V.set((C*E-G*A)*T,(C*J-G*F)*T,(C*B-G*N)*T);k[a].add(ba);k[b].add(ba);k[c].add(ba);m[a].add(V);m[b].add(V);m[c].add(V)}function b(a){ea.x=e[3*a];ea.y=e[3*a+1];
ea.z=e[3*a+2];aa.copy(ea);xa=k[a];ua.copy(xa);ua.sub(ea.multiplyScalar(ea.dot(xa))).normalize();Ca.crossVectors(aa,xa);Ka=Ca.dot(m[a]);Qa=0>Ka?-1:1;h[4*a]=ua.x;h[4*a+1]=ua.y;h[4*a+2]=ua.z;h[4*a+3]=Qa}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var c=this.attributes.index.array,d=this.attributes.position.array,
e=this.attributes.normal.array,f=this.attributes.uv.array,g=d.length/3;void 0===this.attributes.tangent&&(this.attributes.tangent={itemSize:4,array:new Float32Array(4*g)});for(var h=this.attributes.tangent.array,k=[],m=[],l=0;l<g;l++)k[l]=new THREE.Vector3,m[l]=new THREE.Vector3;var n,t,q,u,p,v,x,w,y,M,z,K,H,D,L,A,E,F,J,N,B,C,G,Q,Z,T,ba=new THREE.Vector3,V=new THREE.Vector3,S,I,Y,$,ca,P=this.offsets,l=0;for(I=P.length;l<I;++l){S=P[l].start;Y=P[l].count;var na=P[l].index,g=S;for(S+=Y;g<S;g+=3)Y=na+
c[g],$=na+c[g+1],ca=na+c[g+2],a(Y,$,ca)}var ua=new THREE.Vector3,Ca=new THREE.Vector3,ea=new THREE.Vector3,aa=new THREE.Vector3,Qa,xa,Ka,l=0;for(I=P.length;l<I;++l)for(S=P[l].start,Y=P[l].count,na=P[l].index,g=S,S+=Y;g<S;g+=3)Y=na+c[g],$=na+c[g+1],ca=na+c[g+2],b(Y),b($),b(ca)}},computeOffsets:function(a){var b=a;void 0===a&&(b=65535);Date.now();a=this.attributes.index.array;for(var c=this.attributes.position.array,d=a.length/3,e=new Uint16Array(a.length),f=0,g=0,h=[{start:0,count:0,index:0}],k=h[0],
m=0,l=0,n=new Int32Array(6),t=new Int32Array(c.length),q=new Int32Array(c.length),u=0;u<c.length;u++)t[u]=-1,q[u]=-1;for(c=0;c<d;c++){for(var p=l=0;3>p;p++)u=a[3*c+p],-1==t[u]?(n[2*p]=u,n[2*p+1]=-1,l++):t[u]<k.index?(n[2*p]=u,n[2*p+1]=-1,m++):(n[2*p]=u,n[2*p+1]=t[u]);if(g+l>k.index+b)for(k={start:f,count:0,index:g},h.push(k),l=0;6>l;l+=2)p=n[l+1],-1<p&&p<k.index&&(n[l+1]=-1);for(l=0;6>l;l+=2)u=n[l],p=n[l+1],-1===p&&(p=g++),t[u]=p,q[p]=u,e[f++]=p-k.index,k.count++}this.reorderBuffers(e,q,g);return this.offsets=
h},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,d,e=0,f=a.length;e<f;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),a[e]*=b,a[e+1]*=b,a[e+2]*=b},reorderBuffers:function(a,b,c){var d={},e=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],f;for(f in this.attributes)if("index"!=f)for(var g=this.attributes[f].array,h=0,k=e.length;h<k;h++){var m=
e[h];if(g instanceof m){d[f]=new m(this.attributes[f].itemSize*c);break}}for(e=0;e<c;e++)for(f in g=b[e],this.attributes)if("index"!=f)for(var h=this.attributes[f].array,k=this.attributes[f].itemSize,m=d[f],l=0;l<k;l++)m[e*k+l]=h[g*k+l];this.attributes.index.array=a;for(f in this.attributes)"index"!=f&&(this.attributes[f].array=d[f],this.attributes[f].numItems=this.attributes[f].itemSize*c)},clone:function(){var a=new THREE.BufferGeometry,b=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,
Int32Array,Uint32Array,Float32Array,Float64Array],c;for(c in this.attributes){for(var d=this.attributes[c],e=d.array,f={itemSize:d.itemSize,array:null},d=0,g=b.length;d<g;d++){var h=b[d];if(e instanceof h){f.array=new h(e);break}}a.attributes[c]=f}d=0;for(g=this.offsets.length;d<g;d++)b=this.offsets[d],a.offsets.push({start:b.start,index:b.index,count:b.count});return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);
THREE.Geometry=function(){this.id=THREE.GeometryIdCount++;this.uuid=THREE.Math.generateUUID();this.name="";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1;this.dynamic=!0;this.buffersNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=
this.elementsNeedUpdate=this.verticesNeedUpdate=!1};
THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(a){for(var b=(new THREE.Matrix3).getNormalMatrix(a),c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(a);c=0;for(d=this.faces.length;c<d;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var e=0,f=a.vertexNormals.length;e<f;e++)a.vertexNormals[e].applyMatrix3(b).normalize()}this.boundingBox instanceof THREE.Box3&&this.computeBoundingBox();this.boundingSphere instanceof THREE.Sphere&&this.computeBoundingSphere()},
computeFaceNormals:function(){for(var a=new THREE.Vector3,b=new THREE.Vector3,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b];a.subVectors(this.vertices[e.c],g);b.subVectors(f,g);a.cross(b);a.normalize();e.normal.copy(a)}},computeVertexNormals:function(a){var b,c,d;d=Array(this.vertices.length);b=0;for(c=this.vertices.length;b<c;b++)d[b]=new THREE.Vector3;if(a){var e,f,g,h=new THREE.Vector3,k=new THREE.Vector3;new THREE.Vector3;new THREE.Vector3;new THREE.Vector3;
a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],e=this.vertices[c.a],f=this.vertices[c.b],g=this.vertices[c.c],h.subVectors(g,f),k.subVectors(e,f),h.cross(k),d[c.a].add(h),d[c.b].add(h),d[c.c].add(h)}else for(a=0,b=this.faces.length;a<b;a++)c=this.faces[a],d[c.a].add(c.normal),d[c.b].add(c.normal),d[c.c].add(c.normal);b=0;for(c=this.vertices.length;b<c;b++)d[b].normalize();a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],c.vertexNormals[0]=d[c.a].clone(),c.vertexNormals[1]=d[c.b].clone(),c.vertexNormals[2]=
d[c.c].clone()},computeMorphNormals:function(){var a,b,c,d,e;c=0;for(d=this.faces.length;c<d;c++)for(e=this.faces[c],e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]),a=0,b=e.vertexNormals.length;a<b;a++)e.__originalVertexNormals[a]?e.__originalVertexNormals[a].copy(e.vertexNormals[a]):e.__originalVertexNormals[a]=e.vertexNormals[a].clone();var f=new THREE.Geometry;f.faces=this.faces;a=0;for(b=
this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];e=this.morphNormals[a].faceNormals;var g=this.morphNormals[a].vertexNormals,h,k;c=0;for(d=this.faces.length;c<d;c++)h=new THREE.Vector3,k={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},e.push(h),g.push(k)}g=this.morphNormals[a];f.vertices=this.morphTargets[a].vertices;f.computeFaceNormals();f.computeVertexNormals();c=0;for(d=this.faces.length;c<
d;c++)e=this.faces[c],h=g.faceNormals[c],k=g.vertexNormals[c],h.copy(e.normal),k.a.copy(e.vertexNormals[0]),k.b.copy(e.vertexNormals[1]),k.c.copy(e.vertexNormals[2])}c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals},computeTangents:function(){var a,b,c,d,e,f,g,h,k,m,l,n,t,q,u,p,v,x=[],w=[];c=new THREE.Vector3;var y=new THREE.Vector3,M=new THREE.Vector3,z=new THREE.Vector3,K=new THREE.Vector3;a=0;for(b=this.vertices.length;a<
b;a++)x[a]=new THREE.Vector3,w[a]=new THREE.Vector3;a=0;for(b=this.faces.length;a<b;a++)e=this.faces[a],f=this.faceVertexUvs[0][a],d=e.a,v=e.b,e=e.c,g=this.vertices[d],h=this.vertices[v],k=this.vertices[e],m=f[0],l=f[1],n=f[2],f=h.x-g.x,t=k.x-g.x,q=h.y-g.y,u=k.y-g.y,h=h.z-g.z,g=k.z-g.z,k=l.x-m.x,p=n.x-m.x,l=l.y-m.y,m=n.y-m.y,n=1/(k*m-p*l),c.set((m*f-l*t)*n,(m*q-l*u)*n,(m*h-l*g)*n),y.set((k*t-p*f)*n,(k*u-p*q)*n,(k*g-p*h)*n),x[d].add(c),x[v].add(c),x[e].add(c),w[d].add(y),w[v].add(y),w[e].add(y);y=
["a","b","c","d"];a=0;for(b=this.faces.length;a<b;a++)for(e=this.faces[a],c=0;c<Math.min(e.vertexNormals.length,3);c++)K.copy(e.vertexNormals[c]),d=e[y[c]],v=x[d],M.copy(v),M.sub(K.multiplyScalar(K.dot(v))).normalize(),z.crossVectors(e.vertexNormals[c],v),d=z.dot(w[d]),d=0>d?-1:1,e.vertexTangents[c]=new THREE.Vector4(M.x,M.y,M.z,d);this.hasTangents=!0},computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,d=b.length;c<d;c++)0<c&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===
this.boundingBox&&(this.boundingBox=new THREE.Box3);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(!1===a instanceof THREE.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);else{var d,e=this.vertices.length,f=this.vertices,g=a.vertices,h=this.faces,k=a.faces,m=this.faceVertexUvs[0];
a=a.faceVertexUvs[0];void 0===c&&(c=0);void 0!==b&&(d=(new THREE.Matrix3).getNormalMatrix(b));for(var l=0,n=g.length;l<n;l++){var t=g[l].clone();void 0!==b&&t.applyMatrix4(b);f.push(t)}l=0;for(n=k.length;l<n;l++){var g=k[l],q,u=g.vertexNormals,p=g.vertexColors,t=new THREE.Face3(g.a+e,g.b+e,g.c+e);t.normal.copy(g.normal);void 0!==d&&t.normal.applyMatrix3(d).normalize();b=0;for(f=u.length;b<f;b++)q=u[b].clone(),void 0!==d&&q.applyMatrix3(d).normalize(),t.vertexNormals.push(q);t.color.copy(g.color);
b=0;for(f=p.length;b<f;b++)q=p[b],t.vertexColors.push(q.clone());t.materialIndex=g.materialIndex+c;h.push(t)}l=0;for(n=a.length;l<n;l++)if(c=a[l],d=[],void 0!==c){b=0;for(f=c.length;b<f;b++)d.push(new THREE.Vector2(c[b].x,c[b].y));m.push(d)}}},mergeVertices:function(){var a={},b=[],c=[],d,e=Math.pow(10,4),f,g;f=0;for(g=this.vertices.length;f<g;f++)d=this.vertices[f],d=Math.round(d.x*e)+"_"+Math.round(d.y*e)+"_"+Math.round(d.z*e),void 0===a[d]?(a[d]=f,b.push(this.vertices[f]),c[f]=b.length-1):c[f]=
c[a[d]];a=[];f=0;for(g=this.faces.length;f<g;f++)for(e=this.faces[f],e.a=c[e.a],e.b=c[e.b],e.c=c[e.c],e=[e.a,e.b,e.c],d=0;3>d;d++)if(e[d]==e[(d+1)%3]){a.push(f);break}for(f=a.length-1;0<=f;f--)for(e=a[f],this.faces.splice(e,1),c=0,g=this.faceVertexUvs.length;c<g;c++)this.faceVertexUvs[c].splice(e,1);f=this.vertices.length-b.length;this.vertices=b;return f},makeGroups:function(){var a=0;return function(b,c){var d,e,f,g,h={},k=this.morphTargets.length,m=this.morphNormals.length;this.geometryGroups=
{};d=0;for(e=this.faces.length;d<e;d++)f=this.faces[d],f=b?f.materialIndex:0,f in h||(h[f]={hash:f,counter:0}),g=h[f].hash+"_"+h[f].counter,g in this.geometryGroups||(this.geometryGroups[g]={faces3:[],materialIndex:f,vertices:0,numMorphTargets:k,numMorphNormals:m}),this.geometryGroups[g].vertices+3>c&&(h[f].counter+=1,g=h[f].hash+"_"+h[f].counter,g in this.geometryGroups||(this.geometryGroups[g]={faces3:[],materialIndex:f,vertices:0,numMorphTargets:k,numMorphNormals:m})),this.geometryGroups[g].faces3.push(d),
this.geometryGroups[g].vertices+=3;this.geometryGroupsList=[];for(var l in this.geometryGroups)this.geometryGroups[l].id=a++,this.geometryGroupsList.push(this.geometryGroups[l])}}(),clone:function(){for(var a=new THREE.Geometry,b=this.vertices,c=0,d=b.length;c<d;c++)a.vertices.push(b[c].clone());b=this.faces;c=0;for(d=b.length;c<d;c++)a.faces.push(b[c].clone());b=this.faceVertexUvs[0];c=0;for(d=b.length;c<d;c++){for(var e=b[c],f=[],g=0,h=e.length;g<h;g++)f.push(new THREE.Vector2(e[g].x,e[g].y));a.faceVertexUvs[0].push(f)}return a},
dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();
THREE.Camera.prototype.clone=function(a){void 0===a&&(a=new THREE.Camera);THREE.Object3D.prototype.clone.call(this,a);a.matrixWorldInverse.copy(this.matrixWorldInverse);a.projectionMatrix.copy(this.projectionMatrix);return a};THREE.OrthographicCamera=function(a,b,c,d,e,f){THREE.Camera.call(this);this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);
THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)};THREE.OrthographicCamera.prototype.clone=function(){var a=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,a);a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;return a};
THREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this);this.fov=void 0!==a?a:50;this.aspect=void 0!==b?b:1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);this.fov=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=d;this.width=e;this.height=f;this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var a=this.fullWidth/this.fullHeight,b=Math.tan(THREE.Math.degToRad(.5*this.fov))*this.near,c=-b,d=a*c,a=Math.abs(a*b-d),c=Math.abs(b-c);this.projectionMatrix.makeFrustum(d+this.x*a/this.fullWidth,d+(this.x+this.width)*a/this.fullWidth,b-(this.y+this.height)*c/this.fullHeight,b-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)};
THREE.PerspectiveCamera.prototype.clone=function(){var a=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,a);a.fov=this.fov;a.aspect=this.aspect;a.near=this.near;a.far=this.far;return a};THREE.Light=function(a){THREE.Object3D.call(this);this.color=new THREE.Color(a)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.clone=function(a){void 0===a&&(a=new THREE.Light);THREE.Object3D.prototype.clone.call(this,a);a.color.copy(this.color);return a};
THREE.AmbientLight=function(a){THREE.Light.call(this,a)};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.clone=function(){var a=new THREE.AmbientLight;THREE.Light.prototype.clone.call(this,a);return a};
THREE.AreaLight=function(a,b){THREE.Light.call(this,a);this.normal=new THREE.Vector3(0,-1,0);this.right=new THREE.Vector3(1,0,0);this.intensity=void 0!==b?b:1;this.height=this.width=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);
THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a);this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=void 0!==b?b:1;this.onlyShadow=this.castShadow=!1;this.shadowCameraNear=50;this.shadowCameraFar=5E3;this.shadowCameraLeft=-500;this.shadowCameraTop=this.shadowCameraRight=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=!1;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCascade=!1;this.shadowCascadeOffset=new THREE.Vector3(0,
0,-1E3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);
THREE.DirectionalLight.prototype.clone=function(){var a=new THREE.DirectionalLight;THREE.Light.prototype.clone.call(this,a);a.target=this.target.clone();a.intensity=this.intensity;a.castShadow=this.castShadow;a.onlyShadow=this.onlyShadow;a.shadowCameraNear=this.shadowCameraNear;a.shadowCameraFar=this.shadowCameraFar;a.shadowCameraLeft=this.shadowCameraLeft;a.shadowCameraRight=this.shadowCameraRight;a.shadowCameraTop=this.shadowCameraTop;a.shadowCameraBottom=this.shadowCameraBottom;a.shadowCameraVisible=
this.shadowCameraVisible;a.shadowBias=this.shadowBias;a.shadowDarkness=this.shadowDarkness;a.shadowMapWidth=this.shadowMapWidth;a.shadowMapHeight=this.shadowMapHeight;a.shadowCascade=this.shadowCascade;a.shadowCascadeOffset.copy(this.shadowCascadeOffset);a.shadowCascadeCount=this.shadowCascadeCount;a.shadowCascadeBias=this.shadowCascadeBias.slice(0);a.shadowCascadeWidth=this.shadowCascadeWidth.slice(0);a.shadowCascadeHeight=this.shadowCascadeHeight.slice(0);a.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0);
a.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0);return a};THREE.HemisphereLight=function(a,b,c){THREE.Light.call(this,a);this.position.set(0,100,0);this.groundColor=new THREE.Color(b);this.intensity=void 0!==c?c:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.clone=function(){var a=new THREE.HemisphereLight;THREE.Light.prototype.clone.call(this,a);a.groundColor.copy(this.groundColor);a.intensity=this.intensity;return a};
THREE.PointLight=function(a,b,c){THREE.Light.call(this,a);this.intensity=void 0!==b?b:1;this.distance=void 0!==c?c:0};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.clone=function(){var a=new THREE.PointLight;THREE.Light.prototype.clone.call(this,a);a.intensity=this.intensity;a.distance=this.distance;return a};
THREE.SpotLight=function(a,b,c,d,e){THREE.Light.call(this,a);this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=void 0!==b?b:1;this.distance=void 0!==c?c:0;this.angle=void 0!==d?d:Math.PI/3;this.exponent=void 0!==e?e:10;this.onlyShadow=this.castShadow=!1;this.shadowCameraNear=50;this.shadowCameraFar=5E3;this.shadowCameraFov=50;this.shadowCameraVisible=!1;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowMatrix=this.shadowCamera=this.shadowMapSize=
this.shadowMap=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);
THREE.SpotLight.prototype.clone=function(){var a=new THREE.SpotLight;THREE.Light.prototype.clone.call(this,a);a.target=this.target.clone();a.intensity=this.intensity;a.distance=this.distance;a.angle=this.angle;a.exponent=this.exponent;a.castShadow=this.castShadow;a.onlyShadow=this.onlyShadow;a.shadowCameraNear=this.shadowCameraNear;a.shadowCameraFar=this.shadowCameraFar;a.shadowCameraFov=this.shadowCameraFov;a.shadowCameraVisible=this.shadowCameraVisible;a.shadowBias=this.shadowBias;a.shadowDarkness=
this.shadowDarkness;a.shadowMapWidth=this.shadowMapWidth;a.shadowMapHeight=this.shadowMapHeight;return a};THREE.Cache=function(){this.files={}};THREE.Cache.prototype={constructor:THREE.Cache,add:function(a,b){this.files[a]=b},get:function(a){return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};
THREE.Loader=function(a){this.statusDomElement=(this.showStatus=a)?THREE.Loader.prototype.addStatusElement():null;this.imageLoader=new THREE.ImageLoader;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,addStatusElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="0px";a.style.top="0px";a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="rgba(0,0,0,0.25)";a.style.color="#fff";a.style.width="120px";a.style.padding="0.5em 0.5em 0.5em 0.5em";a.style.zIndex=1E3;a.innerHTML="Loading ...";return a},updateProgress:function(a){var b="Loaded ",b=a.total?b+((100*a.loaded/a.total).toFixed(0)+
"%"):b+((a.loaded/1024).toFixed(2)+" KB");this.statusDomElement.innerHTML=b},extractUrlBase:function(a){a=a.split("/");if(1===a.length)return"./";a.pop();return a.join("/")+"/"},initMaterials:function(a,b){for(var c=[],d=0;d<a.length;++d)c[d]=this.createMaterial(a[d],b);return c},needsTangents:function(a){for(var b=0,c=a.length;b<c;b++)if(a[b]instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(a,b){function c(a){a=Math.log(a)/Math.LN2;return Math.pow(2,Math.round(a))}function d(a,
d,e,g,h,k,p){var v=/\.dds$/i.test(e),x=b+e;if(v){var w=THREE.ImageUtils.loadCompressedTexture(x);a[d]=w}else w=document.createElement("canvas"),a[d]=new THREE.Texture(w);a[d].sourceFile=e;g&&(a[d].repeat.set(g[0],g[1]),1!==g[0]&&(a[d].wrapS=THREE.RepeatWrapping),1!==g[1]&&(a[d].wrapT=THREE.RepeatWrapping));h&&a[d].offset.set(h[0],h[1]);k&&(e={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==e[k[0]]&&(a[d].wrapS=e[k[0]]),void 0!==e[k[1]]&&(a[d].wrapT=e[k[1]]));p&&(a[d].anisotropy=
p);v||(w=a[d],f.imageLoader.crossOrigin=f.crossOrigin,f.imageLoader.load(x,function(a){if(!1===THREE.Math.isPowerOfTwo(a.width)||!1===THREE.Math.isPowerOfTwo(a.height)){var b=c(a.width),d=c(a.height);w.image.width=b;w.image.height=d;w.image.getContext("2d").drawImage(a,0,0,b,d)}else w.image=a;w.needsUpdate=!0}))}function e(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]}var f=this,g="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(a.shading){var k=
a.shading.toLowerCase();"phong"===k?g="MeshPhongMaterial":"basic"===k&&(g="MeshBasicMaterial")}void 0!==a.blending&&void 0!==THREE[a.blending]&&(h.blending=THREE[a.blending]);if(void 0!==a.transparent||1>a.opacity)h.transparent=a.transparent;void 0!==a.depthTest&&(h.depthTest=a.depthTest);void 0!==a.depthWrite&&(h.depthWrite=a.depthWrite);void 0!==a.visible&&(h.visible=a.visible);void 0!==a.flipSided&&(h.side=THREE.BackSide);void 0!==a.doubleSided&&(h.side=THREE.DoubleSide);void 0!==a.wireframe&&
(h.wireframe=a.wireframe);void 0!==a.vertexColors&&("face"===a.vertexColors?h.vertexColors=THREE.FaceColors:a.vertexColors&&(h.vertexColors=THREE.VertexColors));a.colorDiffuse?h.color=e(a.colorDiffuse):a.DbgColor&&(h.color=a.DbgColor);a.colorSpecular&&(h.specular=e(a.colorSpecular));a.colorAmbient&&(h.ambient=e(a.colorAmbient));a.colorEmissive&&(h.emissive=e(a.colorEmissive));a.transparency&&(h.opacity=a.transparency);a.specularCoef&&(h.shininess=a.specularCoef);a.mapDiffuse&&b&&d(h,"map",a.mapDiffuse,
a.mapDiffuseRepeat,a.mapDiffuseOffset,a.mapDiffuseWrap,a.mapDiffuseAnisotropy);a.mapLight&&b&&d(h,"lightMap",a.mapLight,a.mapLightRepeat,a.mapLightOffset,a.mapLightWrap,a.mapLightAnisotropy);a.mapBump&&b&&d(h,"bumpMap",a.mapBump,a.mapBumpRepeat,a.mapBumpOffset,a.mapBumpWrap,a.mapBumpAnisotropy);a.mapNormal&&b&&d(h,"normalMap",a.mapNormal,a.mapNormalRepeat,a.mapNormalOffset,a.mapNormalWrap,a.mapNormalAnisotropy);a.mapSpecular&&b&&d(h,"specularMap",a.mapSpecular,a.mapSpecularRepeat,a.mapSpecularOffset,
a.mapSpecularWrap,a.mapSpecularAnisotropy);a.mapBumpScale&&(h.bumpScale=a.mapBumpScale);a.mapNormal?(g=THREE.ShaderLib.normalmap,k=THREE.UniformsUtils.clone(g.uniforms),k.tNormal.value=h.normalMap,a.mapNormalFactor&&k.uNormalScale.value.set(a.mapNormalFactor,a.mapNormalFactor),h.map&&(k.tDiffuse.value=h.map,k.enableDiffuse.value=!0),h.specularMap&&(k.tSpecular.value=h.specularMap,k.enableSpecular.value=!0),h.lightMap&&(k.tAO.value=h.lightMap,k.enableAO.value=!0),k.diffuse.value.setHex(h.color),k.specular.value.setHex(h.specular),
k.ambient.value.setHex(h.ambient),k.shininess.value=h.shininess,void 0!==h.opacity&&(k.opacity.value=h.opacity),g=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:k,lights:!0,fog:!0}),h.transparent&&(g.transparent=!0)):g=new THREE[g](h);void 0!==a.DbgName&&(g.name=a.DbgName);return g}};THREE.XHRLoader=function(a){this.cache=new THREE.Cache;this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(a,b,c,d){var e=this,f=e.cache.get(a);void 0!==f?b(f):(f=new XMLHttpRequest,void 0!==b&&f.addEventListener("load",function(c){e.cache.add(a,c.target.responseText);b(c.target.responseText);e.manager.itemEnd(a)},!1),void 0!==c&&f.addEventListener("progress",function(a){c(a)},!1),void 0!==d&&f.addEventListener("error",function(a){d(a)},!1),void 0!==this.crossOrigin&&(f.crossOrigin=this.crossOrigin),f.open("GET",a,!0),f.send(null),e.manager.itemStart(a))},
setCrossOrigin:function(a){this.crossOrigin=a}};THREE.ImageLoader=function(a){this.cache=new THREE.Cache;this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(a,b,c,d){var e=this,f=e.cache.get(a);if(void 0!==f)b(f);else return f=document.createElement("img"),void 0!==b&&f.addEventListener("load",function(c){e.cache.add(a,this);b(this);e.manager.itemEnd(a)},!1),void 0!==c&&f.addEventListener("progress",function(a){c(a)},!1),void 0!==d&&f.addEventListener("error",function(a){d(a)},!1),void 0!==this.crossOrigin&&(f.crossOrigin=this.crossOrigin),f.src=a,e.manager.itemStart(a),f},setCrossOrigin:function(a){this.crossOrigin=
a}};THREE.JSONLoader=function(a){THREE.Loader.call(this,a);this.withCredentials=!1};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.load=function(a,b,c){c=c&&"string"===typeof c?c:this.extractUrlBase(a);this.onLoadStart();this.loadAjaxJSON(this,a,b,c)};
THREE.JSONLoader.prototype.loadAjaxJSON=function(a,b,c,d,e){var f=new XMLHttpRequest,g=0;f.onreadystatechange=function(){if(f.readyState===f.DONE)if(200===f.status||0===f.status){if(f.responseText){var h=JSON.parse(f.responseText);if(void 0!==h.metadata&&"scene"===h.metadata.type){console.error('THREE.JSONLoader: "'+b+'" seems to be a Scene. Use THREE.SceneLoader instead.');return}h=a.parse(h,d);c(h.geometry,h.materials)}else console.error('THREE.JSONLoader: "'+b+'" seems to be unreachable or the file is empty.');
a.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+b+'" ('+f.status+")");else f.readyState===f.LOADING?e&&(0===g&&(g=f.getResponseHeader("Content-Length")),e({total:g,loaded:f.responseText.length})):f.readyState===f.HEADERS_RECEIVED&&void 0!==e&&(g=f.getResponseHeader("Content-Length"))};f.open("GET",b,!0);f.withCredentials=this.withCredentials;f.send(null)};
THREE.JSONLoader.prototype.parse=function(a,b){var c=new THREE.Geometry,d=void 0!==a.scale?1/a.scale:1;(function(b){var d,g,h,k,m,l,n,t,q,u,p,v,x,w=a.faces;l=a.vertices;var y=a.normals,M=a.colors,z=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&z++;for(d=0;d<z;d++)c.faceVertexUvs[d]=[]}k=0;for(m=l.length;k<m;)d=new THREE.Vector3,d.x=l[k++]*b,d.y=l[k++]*b,d.z=l[k++]*b,c.vertices.push(d);k=0;for(m=w.length;k<m;)if(b=w[k++],q=b&1,h=b&2,d=b&8,n=b&16,u=b&32,l=b&64,b&=128,q){q=new THREE.Face3;
q.a=w[k];q.b=w[k+1];q.c=w[k+3];p=new THREE.Face3;p.a=w[k+1];p.b=w[k+2];p.c=w[k+3];k+=4;h&&(h=w[k++],q.materialIndex=h,p.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<z;d++)for(v=a.uvs[d],c.faceVertexUvs[d][h]=[],c.faceVertexUvs[d][h+1]=[],g=0;4>g;g++)t=w[k++],x=v[2*t],t=v[2*t+1],x=new THREE.Vector2(x,t),2!==g&&c.faceVertexUvs[d][h].push(x),0!==g&&c.faceVertexUvs[d][h+1].push(x);n&&(n=3*w[k++],q.normal.set(y[n++],y[n++],y[n]),p.normal.copy(q.normal));if(u)for(d=0;4>d;d++)n=3*w[k++],u=new THREE.Vector3(y[n++],
y[n++],y[n]),2!==d&&q.vertexNormals.push(u),0!==d&&p.vertexNormals.push(u);l&&(l=w[k++],l=M[l],q.color.setHex(l),p.color.setHex(l));if(b)for(d=0;4>d;d++)l=w[k++],l=M[l],2!==d&&q.vertexColors.push(new THREE.Color(l)),0!==d&&p.vertexColors.push(new THREE.Color(l));c.faces.push(q);c.faces.push(p)}else{q=new THREE.Face3;q.a=w[k++];q.b=w[k++];q.c=w[k++];h&&(h=w[k++],q.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<z;d++)for(v=a.uvs[d],c.faceVertexUvs[d][h]=[],g=0;3>g;g++)t=w[k++],x=v[2*t],t=v[2*t+1],
x=new THREE.Vector2(x,t),c.faceVertexUvs[d][h].push(x);n&&(n=3*w[k++],q.normal.set(y[n++],y[n++],y[n]));if(u)for(d=0;3>d;d++)n=3*w[k++],u=new THREE.Vector3(y[n++],y[n++],y[n]),q.vertexNormals.push(u);l&&(l=w[k++],q.color.setHex(M[l]));if(b)for(d=0;3>d;d++)l=w[k++],q.vertexColors.push(new THREE.Color(M[l]));c.faces.push(q)}})(d);(function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var d=0,g=a.skinWeights.length;d<g;d+=b)c.skinWeights.push(new THREE.Vector4(a.skinWeights[d],
1<b?a.skinWeights[d+1]:0,2<b?a.skinWeights[d+2]:0,3<b?a.skinWeights[d+3]:0));if(a.skinIndices)for(d=0,g=a.skinIndices.length;d<g;d+=b)c.skinIndices.push(new THREE.Vector4(a.skinIndices[d],1<b?a.skinIndices[d+1]:0,2<b?a.skinIndices[d+2]:0,3<b?a.skinIndices[d+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+
"), and skinWeights ("+c.skinWeights.length+") should match.");c.animation=a.animation;c.animations=a.animations})();(function(b){if(void 0!==a.morphTargets){var d,g,h,k,m,l;d=0;for(g=a.morphTargets.length;d<g;d++)for(c.morphTargets[d]={},c.morphTargets[d].name=a.morphTargets[d].name,c.morphTargets[d].vertices=[],m=c.morphTargets[d].vertices,l=a.morphTargets[d].vertices,h=0,k=l.length;h<k;h+=3){var n=new THREE.Vector3;n.x=l[h]*b;n.y=l[h+1]*b;n.z=l[h+2]*b;m.push(n)}}if(void 0!==a.morphColors)for(d=
0,g=a.morphColors.length;d<g;d++)for(c.morphColors[d]={},c.morphColors[d].name=a.morphColors[d].name,c.morphColors[d].colors=[],k=c.morphColors[d].colors,m=a.morphColors[d].colors,b=0,h=m.length;b<h;b+=3)l=new THREE.Color(16755200),l.setRGB(m[b],m[b+1],m[b+2]),k.push(l)})(d);c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};d=this.initMaterials(a.materials,b);this.needsTangents(d)&&c.computeTangents();return{geometry:c,materials:d}};
THREE.LoadingManager=function(a,b,c){var d=this,e=0,f=0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){f++};this.itemEnd=function(a){e++;if(void 0!==d.onProgress)d.onProgress(a,e,f);if(e===f&&void 0!==d.onLoad)d.onLoad()}};THREE.DefaultLoadingManager=new THREE.LoadingManager;THREE.BufferGeometryLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(a,b,c,d){var e=this;c=new THREE.XHRLoader;c.setCrossOrigin(this.crossOrigin);c.load(a,function(a){b(e.parse(JSON.parse(a)))})},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){var b=new THREE.BufferGeometry,c=a.attributes,d=a.offsets;a=a.boundingSphere;for(var e in c){var f=c[e];b.attributes[e]={itemSize:f.itemSize,array:new self[f.type](f.array)}}void 0!==d&&(b.offsets=JSON.parse(JSON.stringify(d)));
void 0!==a&&(b.boundingSphere=new THREE.Sphere((new THREE.Vector3).fromArray(void 0!==a.center?a.center:[0,0,0]),a.radius));return b}};THREE.MaterialLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(a,b,c,d){var e=this;c=new THREE.XHRLoader;c.setCrossOrigin(this.crossOrigin);c.load(a,function(a){b(e.parse(JSON.parse(a)))})},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){var b=new THREE[a.type];void 0!==a.color&&b.color.setHex(a.color);void 0!==a.ambient&&b.ambient.setHex(a.ambient);void 0!==a.emissive&&b.emissive.setHex(a.emissive);void 0!==a.specular&&b.specular.setHex(a.specular);void 0!==a.shininess&&
(b.shininess=a.shininess);void 0!==a.vertexColors&&(b.vertexColors=a.vertexColors);void 0!==a.blending&&(b.blending=a.blending);void 0!==a.side&&(b.side=a.side);void 0!==a.opacity&&(b.opacity=a.opacity);void 0!==a.transparent&&(b.transparent=a.transparent);void 0!==a.wireframe&&(b.wireframe=a.wireframe);if(void 0!==a.materials)for(var c=0,d=a.materials.length;c<d;c++)b.materials.push(this.parse(a.materials[c]));return b}};THREE.ObjectLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(a,b,c,d){var e=this;c=new THREE.XHRLoader(e.manager);c.setCrossOrigin(this.crossOrigin);c.load(a,function(a){b(e.parse(JSON.parse(a)))})},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){var b=this.parseGeometries(a.geometries),c=this.parseMaterials(a.materials);return this.parseObject(a.object,b,c)},parseGeometries:function(a){var b={};if(void 0!==a)for(var c=new THREE.JSONLoader,d=new THREE.BufferGeometryLoader,
e=0,f=a.length;e<f;e++){var g,h=a[e];switch(h.type){case "PlaneGeometry":g=new THREE.PlaneGeometry(h.width,h.height,h.widthSegments,h.heightSegments);break;case "BoxGeometry":case "CubeGeometry":g=new THREE.BoxGeometry(h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case "CircleGeometry":g=new THREE.CircleGeometry(h.radius,h.segments);break;case "CylinderGeometry":g=new THREE.CylinderGeometry(h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded);
break;case "SphereGeometry":g=new THREE.SphereGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case "IcosahedronGeometry":g=new THREE.IcosahedronGeometry(h.radius,h.detail);break;case "TorusGeometry":g=new THREE.TorusGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case "TorusKnotGeometry":g=new THREE.TorusKnotGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.p,h.q,h.heightScale);break;case "BufferGeometry":g=
d.parse(h.data);break;case "Geometry":g=c.parse(h.data).geometry}g.uuid=h.uuid;void 0!==h.name&&(g.name=h.name);b[h.uuid]=g}return b},parseMaterials:function(a){var b={};if(void 0!==a)for(var c=new THREE.MaterialLoader,d=0,e=a.length;d<e;d++){var f=a[d],g=c.parse(f);g.uuid=f.uuid;void 0!==f.name&&(g.name=f.name);b[f.uuid]=g}return b},parseObject:function(){var a=new THREE.Matrix4;return function(b,c,d){var e;switch(b.type){case "Scene":e=new THREE.Scene;break;case "PerspectiveCamera":e=new THREE.PerspectiveCamera(b.fov,
b.aspect,b.near,b.far);break;case "OrthographicCamera":e=new THREE.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case "AmbientLight":e=new THREE.AmbientLight(b.color);break;case "DirectionalLight":e=new THREE.DirectionalLight(b.color,b.intensity);break;case "PointLight":e=new THREE.PointLight(b.color,b.intensity,b.distance);break;case "SpotLight":e=new THREE.SpotLight(b.color,b.intensity,b.distance,b.angle,b.exponent);break;case "HemisphereLight":e=new THREE.HemisphereLight(b.color,
b.groundColor,b.intensity);break;case "Mesh":e=c[b.geometry];var f=d[b.material];void 0===e&&console.error("THREE.ObjectLoader: Undefined geometry "+b.geometry);void 0===f&&console.error("THREE.ObjectLoader: Undefined material "+b.material);e=new THREE.Mesh(e,f);break;case "Sprite":f=d[b.material];void 0===f&&console.error("THREE.ObjectLoader: Undefined material "+b.material);e=new THREE.Sprite(f);break;default:e=new THREE.Object3D}e.uuid=b.uuid;void 0!==b.name&&(e.name=b.name);void 0!==b.matrix?
(a.fromArray(b.matrix),a.decompose(e.position,e.quaternion,e.scale)):(void 0!==b.position&&e.position.fromArray(b.position),void 0!==b.rotation&&e.rotation.fromArray(b.rotation),void 0!==b.scale&&e.scale.fromArray(b.scale));void 0!==b.visible&&(e.visible=b.visible);void 0!==b.userData&&(e.userData=b.userData);if(void 0!==b.children)for(var g in b.children)e.add(this.parseObject(b.children[g],c,d));return e}}()};
THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){};this.geometryHandlers={};this.hierarchyHandlers={};this.addGeometryHandler("ascii",THREE.JSONLoader)};
THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(a,b,c,d){var e=this;c=new THREE.XHRLoader(e.manager);c.setCrossOrigin(this.crossOrigin);c.load(a,function(c){e.parse(JSON.parse(c),b,a)})},setCrossOrigin:function(a){this.crossOrigin=a},addGeometryHandler:function(a,b){this.geometryHandlers[a]={loaderClass:b}},addHierarchyHandler:function(a,b){this.hierarchyHandlers[a]={loaderClass:b}},parse:function(a,b,c){function d(a,b){return"relativeToHTML"==b?a:q+a}function e(){f(D.scene,
A.objects)}function f(a,b){var c,e,g,h,l,m;for(m in b){var n=D.objects[m],q=b[m];if(void 0===n){if(q.type&&q.type in t.hierarchyHandlers){if(void 0===q.loading){c={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1};var w={},x;for(x in q)x in c||(w[x]=q[x]);p=D.materials[q.material];q.loading=!0;c=t.hierarchyHandlers[q.type].loaderObject;c.options?c.load(d(q.url,A.urlBaseType),k(m,a,p,q)):c.load(d(q.url,A.urlBaseType),k(m,
a,p,q),w)}}else if(void 0!==q.geometry){if(u=D.geometries[q.geometry]){p=D.materials[q.material];n=p instanceof THREE.ShaderMaterial;e=q.position;g=q.rotation;h=q.scale;c=q.matrix;l=q.quaternion;q.material||(p=new THREE.MeshFaceMaterial(D.face_materials[q.geometry]));p instanceof THREE.MeshFaceMaterial&&0===p.materials.length&&(p=new THREE.MeshFaceMaterial(D.face_materials[q.geometry]));if(p instanceof THREE.MeshFaceMaterial)for(w=0;w<p.materials.length;w++)n=n||p.materials[w]instanceof THREE.ShaderMaterial;
n&&u.computeTangents();q.skin?n=new THREE.SkinnedMesh(u,p):q.morph?(n=new THREE.MorphAnimMesh(u,p),void 0!==q.duration&&(n.duration=q.duration),void 0!==q.time&&(n.time=q.time),void 0!==q.mirroredLoop&&(n.mirroredLoop=q.mirroredLoop),p.morphNormals&&u.computeMorphNormals()):n=new THREE.Mesh(u,p);n.name=m;c?(n.matrixAutoUpdate=!1,n.matrix.set(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15])):(n.position.fromArray(e),l?n.quaternion.fromArray(l):n.rotation.fromArray(g),
n.scale.fromArray(h));n.visible=q.visible;n.castShadow=q.castShadow;n.receiveShadow=q.receiveShadow;a.add(n);D.objects[m]=n}}else if("AmbientLight"===q.type||"PointLight"===q.type||"DirectionalLight"===q.type||"SpotLight"===q.type||"HemisphereLight"===q.type||"AreaLight"===q.type){w=q.color;c=q.intensity;e=q.distance;g=q.position;h=q.rotation;switch(q.type){case "AmbientLight":y=new THREE.AmbientLight(w);break;case "PointLight":y=new THREE.PointLight(w,c,e);y.position.fromArray(g);break;case "DirectionalLight":y=
new THREE.DirectionalLight(w,c);y.position.fromArray(q.direction);break;case "SpotLight":y=new THREE.SpotLight(w,c,e,1);y.angle=q.angle;y.position.fromArray(g);y.target.set(g[0],g[1]-e,g[2]);y.target.applyEuler(new THREE.Euler(h[0],h[1],h[2],"XYZ"));break;case "HemisphereLight":y=new THREE.DirectionalLight(w,c,e);y.target.set(g[0],g[1]-e,g[2]);y.target.applyEuler(new THREE.Euler(h[0],h[1],h[2],"XYZ"));break;case "AreaLight":y=new THREE.AreaLight(w,c),y.position.fromArray(g),y.width=q.size,y.height=
q.size_y}a.add(y);y.name=m;D.lights[m]=y;D.objects[m]=y}else"PerspectiveCamera"===q.type||"OrthographicCamera"===q.type?(e=q.position,g=q.rotation,l=q.quaternion,"PerspectiveCamera"===q.type?v=new THREE.PerspectiveCamera(q.fov,q.aspect,q.near,q.far):"OrthographicCamera"===q.type&&(v=new THREE.OrthographicCamera(q.left,q.right,q.top,q.bottom,q.near,q.far)),v.name=m,v.position.fromArray(e),void 0!==l?v.quaternion.fromArray(l):void 0!==g&&v.rotation.fromArray(g),a.add(v),D.cameras[m]=v,D.objects[m]=
v):(e=q.position,g=q.rotation,h=q.scale,l=q.quaternion,n=new THREE.Object3D,n.name=m,n.position.fromArray(e),l?n.quaternion.fromArray(l):n.rotation.fromArray(g),n.scale.fromArray(h),n.visible=void 0!==q.visible?q.visible:!1,a.add(n),D.objects[m]=n,D.empties[m]=n);if(n){if(void 0!==q.userData)for(var H in q.userData)n.userData[H]=q.userData[H];if(void 0!==q.groups)for(w=0;w<q.groups.length;w++)c=q.groups[w],void 0===D.groups[c]&&(D.groups[c]=[]),D.groups[c].push(m)}}void 0!==n&&void 0!==q.children&&
f(n,q.children)}}function g(a,b,c,d,f){var g=f.rotation,h=f.quaternion,l=f.scale;a.position.fromArray(f.position);h?a.quaternion.fromArray(h):a.rotation.fromArray(g);a.scale.fromArray(l);d&&a.traverse(function(a){a.material=d});var k=void 0!==f.visible?f.visible:!0;a.traverse(function(a){a.visible=k});c.add(a);a.name=b;D.objects[b]=a;e()}function h(a){return function(b,c){b.name=a;D.geometries[a]=b;D.face_materials[a]=c;e();M-=1;t.onLoadComplete();l()}}function k(a,b,c,d){return function(e){g(e.content?
e.content:e.dae?e.scene:e,a,b,c,d);M-=1;t.onLoadComplete();l()}}function m(a){return function(b,c){b.name=a;D.geometries[a]=b;D.face_materials[a]=c}}function l(){t.callbackProgress({totalModels:K,totalTextures:H,loadedModels:K-M,loadedTextures:H-z},D);t.onLoadProgress();if(0===M&&0===z){for(var a=0;a<L.length;a++){var c=L[a],d=D.objects[c.targetName];d?c.object.target=d:(c.object.target=new THREE.Object3D,D.scene.add(c.object.target));c.object.target.userData.targetInverse=c.object}b(D)}}function n(a,
b){b(a);if(void 0!==a.children)for(var c in a.children)n(a.children[c],b)}var t=this,q=THREE.Loader.prototype.extractUrlBase(c),u,p,v,x,w,y,M,z,K,H,D,L=[],A=a,E;for(E in this.geometryHandlers)a=this.geometryHandlers[E].loaderClass,this.geometryHandlers[E].loaderObject=new a;for(E in this.hierarchyHandlers)a=this.hierarchyHandlers[E].loaderClass,this.hierarchyHandlers[E].loaderObject=new a;z=M=0;D={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},
lights:{},fogs:{},empties:{},groups:{}};A.transform&&(E=A.transform.position,a=A.transform.rotation,c=A.transform.scale,E&&D.scene.position.fromArray(E),a&&D.scene.rotation.fromArray(a),c&&D.scene.scale.fromArray(c),E||a||c)&&(D.scene.updateMatrix(),D.scene.updateMatrixWorld());E=function(a){return function(){z-=a;l();t.onLoadComplete()}};for(var F in A.fogs)a=A.fogs[F],"linear"===a.type?x=new THREE.Fog(0,a.near,a.far):"exp2"===a.type&&(x=new THREE.FogExp2(0,a.density)),a=a.color,x.color.setRGB(a[0],
a[1],a[2]),D.fogs[F]=x;for(var J in A.geometries)x=A.geometries[J],x.type in this.geometryHandlers&&(M+=1,t.onLoadStart());for(var N in A.objects)n(A.objects[N],function(a){a.type&&a.type in t.hierarchyHandlers&&(M+=1,t.onLoadStart())});K=M;for(J in A.geometries)if(x=A.geometries[J],"cube"===x.type)u=new THREE.BoxGeometry(x.width,x.height,x.depth,x.widthSegments,x.heightSegments,x.depthSegments),u.name=J,D.geometries[J]=u;else if("plane"===x.type)u=new THREE.PlaneGeometry(x.width,x.height,x.widthSegments,
x.heightSegments),u.name=J,D.geometries[J]=u;else if("sphere"===x.type)u=new THREE.SphereGeometry(x.radius,x.widthSegments,x.heightSegments),u.name=J,D.geometries[J]=u;else if("cylinder"===x.type)u=new THREE.CylinderGeometry(x.topRad,x.botRad,x.height,x.radSegs,x.heightSegs),u.name=J,D.geometries[J]=u;else if("torus"===x.type)u=new THREE.TorusGeometry(x.radius,x.tube,x.segmentsR,x.segmentsT),u.name=J,D.geometries[J]=u;else if("icosahedron"===x.type)u=new THREE.IcosahedronGeometry(x.radius,x.subdivisions),
u.name=J,D.geometries[J]=u;else if(x.type in this.geometryHandlers){N={};for(w in x)"type"!==w&&"url"!==w&&(N[w]=x[w]);this.geometryHandlers[x.type].loaderObject.load(d(x.url,A.urlBaseType),h(J),N)}else"embedded"===x.type&&(N=A.embeds[x.id],N.metadata=A.metadata,N&&(N=this.geometryHandlers.ascii.loaderObject.parse(N,""),m(J)(N.geometry,N.materials)));for(var B in A.textures)if(J=A.textures[B],J.url instanceof Array)for(z+=J.url.length,w=0;w<J.url.length;w++)t.onLoadStart();else z+=1,t.onLoadStart();
H=z;for(B in A.textures){J=A.textures[B];void 0!==J.mapping&&void 0!==THREE[J.mapping]&&(J.mapping=new THREE[J.mapping]);if(J.url instanceof Array){N=J.url.length;x=[];for(w=0;w<N;w++)x[w]=d(J.url[w],A.urlBaseType);w=(w=/\.dds$/i.test(x[0]))?THREE.ImageUtils.loadCompressedTextureCube(x,J.mapping,E(N)):THREE.ImageUtils.loadTextureCube(x,J.mapping,E(N))}else w=/\.dds$/i.test(J.url),N=d(J.url,A.urlBaseType),x=E(1),w=w?THREE.ImageUtils.loadCompressedTexture(N,J.mapping,x):THREE.ImageUtils.loadTexture(N,
J.mapping,x),void 0!==THREE[J.minFilter]&&(w.minFilter=THREE[J.minFilter]),void 0!==THREE[J.magFilter]&&(w.magFilter=THREE[J.magFilter]),J.anisotropy&&(w.anisotropy=J.anisotropy),J.repeat&&(w.repeat.set(J.repeat[0],J.repeat[1]),1!==J.repeat[0]&&(w.wrapS=THREE.RepeatWrapping),1!==J.repeat[1]&&(w.wrapT=THREE.RepeatWrapping)),J.offset&&w.offset.set(J.offset[0],J.offset[1]),J.wrap&&(N={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==N[J.wrap[0]]&&(w.wrapS=N[J.wrap[0]]),void 0!==
N[J.wrap[1]]&&(w.wrapT=N[J.wrap[1]]));D.textures[B]=w}var C,G;for(C in A.materials){B=A.materials[C];for(G in B.parameters)"envMap"===G||"map"===G||"lightMap"===G||"bumpMap"===G?B.parameters[G]=D.textures[B.parameters[G]]:"shading"===G?B.parameters[G]="flat"===B.parameters[G]?THREE.FlatShading:THREE.SmoothShading:"side"===G?B.parameters[G]="double"==B.parameters[G]?THREE.DoubleSide:"back"==B.parameters[G]?THREE.BackSide:THREE.FrontSide:"blending"===G?B.parameters[G]=B.parameters[G]in THREE?THREE[B.parameters[G]]:
THREE.NormalBlending:"combine"===G?B.parameters[G]=B.parameters[G]in THREE?THREE[B.parameters[G]]:THREE.MultiplyOperation:"vertexColors"===G?"face"==B.parameters[G]?B.parameters[G]=THREE.FaceColors:B.parameters[G]&&(B.parameters[G]=THREE.VertexColors):"wrapRGB"===G&&(E=B.parameters[G],B.parameters[G]=new THREE.Vector3(E[0],E[1],E[2]));void 0!==B.parameters.opacity&&1>B.parameters.opacity&&(B.parameters.transparent=!0);B.parameters.normalMap?(E=THREE.ShaderLib.normalmap,J=THREE.UniformsUtils.clone(E.uniforms),
w=B.parameters.color,N=B.parameters.specular,x=B.parameters.ambient,F=B.parameters.shininess,J.tNormal.value=D.textures[B.parameters.normalMap],B.parameters.normalScale&&J.uNormalScale.value.set(B.parameters.normalScale[0],B.parameters.normalScale[1]),B.parameters.map&&(J.tDiffuse.value=B.parameters.map,J.enableDiffuse.value=!0),B.parameters.envMap&&(J.tCube.value=B.parameters.envMap,J.enableReflection.value=!0,J.reflectivity.value=B.parameters.reflectivity),B.parameters.lightMap&&(J.tAO.value=B.parameters.lightMap,
J.enableAO.value=!0),B.parameters.specularMap&&(J.tSpecular.value=D.textures[B.parameters.specularMap],J.enableSpecular.value=!0),B.parameters.displacementMap&&(J.tDisplacement.value=D.textures[B.parameters.displacementMap],J.enableDisplacement.value=!0,J.uDisplacementBias.value=B.parameters.displacementBias,J.uDisplacementScale.value=B.parameters.displacementScale),J.diffuse.value.setHex(w),J.specular.value.setHex(N),J.ambient.value.setHex(x),J.shininess.value=F,B.parameters.opacity&&(J.opacity.value=
B.parameters.opacity),p=new THREE.ShaderMaterial({fragmentShader:E.fragmentShader,vertexShader:E.vertexShader,uniforms:J,lights:!0,fog:!0})):p=new THREE[B.type](B.parameters);p.name=C;D.materials[C]=p}for(C in A.materials)if(B=A.materials[C],B.parameters.materials){G=[];for(w=0;w<B.parameters.materials.length;w++)G.push(D.materials[B.parameters.materials[w]]);D.materials[C].materials=G}e();D.cameras&&A.defaults.camera&&(D.currentCamera=D.cameras[A.defaults.camera]);D.fogs&&A.defaults.fog&&(D.scene.fog=
D.fogs[A.defaults.fog]);t.callbackSync(D);l()}};THREE.TextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(a,b,c,d){c=new THREE.ImageLoader(this.manager);c.setCrossOrigin(this.crossOrigin);c.load(a,function(a){a=new THREE.Texture(a);a.needsUpdate=!0;void 0!==b&&b(a)})},setCrossOrigin:function(a){this.crossOrigin=a}};
THREE.Material=function(){this.id=THREE.MaterialIdCount++;this.uuid=THREE.Math.generateUUID();this.name="";this.side=THREE.FrontSide;this.opacity=1;this.transparent=!1;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.depthWrite=this.depthTest=!0;this.polygonOffset=!1;this.overdraw=this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.needsUpdate=this.visible=!0};
THREE.Material.prototype={constructor:THREE.Material,setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0===c)console.warn("THREE.Material: '"+b+"' parameter is undefined.");else if(b in this){var d=this[b];d instanceof THREE.Color?d.set(c):d instanceof THREE.Vector3&&c instanceof THREE.Vector3?d.copy(c):this[b]="overdraw"==b?Number(c):c}}},clone:function(a){void 0===a&&(a=new THREE.Material);a.name=this.name;a.side=this.side;a.opacity=this.opacity;a.transparent=this.transparent;
a.blending=this.blending;a.blendSrc=this.blendSrc;a.blendDst=this.blendDst;a.blendEquation=this.blendEquation;a.depthTest=this.depthTest;a.depthWrite=this.depthWrite;a.polygonOffset=this.polygonOffset;a.polygonOffsetFactor=this.polygonOffsetFactor;a.polygonOffsetUnits=this.polygonOffsetUnits;a.alphaTest=this.alphaTest;a.overdraw=this.overdraw;a.visible=this.visible;return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);
THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.vertexColors=!1;this.fog=!0;this.setValues(a)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.LineBasicMaterial.prototype.clone=function(){var a=new THREE.LineBasicMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.linewidth=this.linewidth;a.linecap=this.linecap;a.linejoin=this.linejoin;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};THREE.LineDashedMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.vertexColors=!1;this.fog=!0;this.setValues(a)};
THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.clone=function(){var a=new THREE.LineDashedMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.linewidth=this.linewidth;a.scale=this.scale;a.dashSize=this.dashSize;a.gapSize=this.gapSize;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};
THREE.MeshBasicMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.envMap=this.specularMap=this.lightMap=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=THREE.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphTargets=this.skinning=!1;this.setValues(a)};
THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.MeshBasicMaterial.prototype.clone=function(){var a=new THREE.MeshBasicMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.lightMap=this.lightMap;a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=
this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;return a};
THREE.MeshLambertMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=!1;this.wrapRGB=new THREE.Vector3(1,1,1);this.envMap=this.specularMap=this.lightMap=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=THREE.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=
"round";this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.MeshLambertMaterial.prototype.clone=function(){var a=new THREE.MeshLambertMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.ambient.copy(this.ambient);a.emissive.copy(this.emissive);a.wrapAround=this.wrapAround;a.wrapRGB.copy(this.wrapRGB);a.map=this.map;a.lightMap=this.lightMap;a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;
a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};
THREE.MeshPhongMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.wrapAround=this.metal=!1;this.wrapRGB=new THREE.Vector3(1,1,1);this.bumpMap=this.lightMap=this.map=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.envMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=
1;this.refractionRatio=.98;this.fog=!0;this.shading=THREE.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.MeshPhongMaterial.prototype.clone=function(){var a=new THREE.MeshPhongMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.ambient.copy(this.ambient);a.emissive.copy(this.emissive);a.specular.copy(this.specular);a.shininess=this.shininess;a.metal=this.metal;a.wrapAround=this.wrapAround;a.wrapRGB.copy(this.wrapRGB);a.map=this.map;a.lightMap=this.lightMap;a.bumpMap=this.bumpMap;a.bumpScale=this.bumpScale;a.normalMap=this.normalMap;a.normalScale.copy(this.normalScale);
a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};
THREE.MeshDepthMaterial=function(a){THREE.Material.call(this);this.wireframe=this.morphTargets=!1;this.wireframeLinewidth=1;this.setValues(a)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.clone=function(){var a=new THREE.MeshDepthMaterial;THREE.Material.prototype.clone.call(this,a);a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;return a};
THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);this.shading=THREE.FlatShading;this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=!1;this.setValues(a)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.clone=function(){var a=new THREE.MeshNormalMaterial;THREE.Material.prototype.clone.call(this,a);a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;return a};
THREE.MeshFaceMaterial=function(a){this.materials=a instanceof Array?a:[]};THREE.MeshFaceMaterial.prototype.clone=function(){for(var a=new THREE.MeshFaceMaterial,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());return a};THREE.ParticleSystemMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.vertexColors=!1;this.fog=!0;this.setValues(a)};THREE.ParticleSystemMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.ParticleSystemMaterial.prototype.clone=function(){var a=new THREE.ParticleSystemMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.size=this.size;a.sizeAttenuation=this.sizeAttenuation;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};THREE.ParticleBasicMaterial=THREE.ParticleSystemMaterial;
THREE.ShaderMaterial=function(a){THREE.Material.call(this);this.vertexShader=this.fragmentShader="void main() {}";this.uniforms={};this.defines={};this.attributes=null;this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;this.setValues(a)};
THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.ShaderMaterial.prototype.clone=function(){var a=new THREE.ShaderMaterial;THREE.Material.prototype.clone.call(this,a);a.fragmentShader=this.fragmentShader;a.vertexShader=this.vertexShader;a.uniforms=THREE.UniformsUtils.clone(this.uniforms);a.attributes=this.attributes;a.defines=this.defines;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.fog=this.fog;a.lights=this.lights;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=
this.morphTargets;a.morphNormals=this.morphNormals;return a};THREE.RawShaderMaterial=function(a){THREE.ShaderMaterial.call(this,a)};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.clone=function(){var a=new THREE.RawShaderMaterial;THREE.ShaderMaterial.prototype.clone.call(this,a);return a};THREE.SpriteMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.fog=!1;this.setValues(a)};
THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.clone=function(){var a=new THREE.SpriteMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.rotation=this.rotation;a.fog=this.fog;return a};THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.program=function(a,c){};this.setValues(a)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.program=this.program;return a};THREE.ParticleCanvasMaterial=THREE.SpriteCanvasMaterial;
THREE.Texture=function(a,b,c,d,e,f,g,h,k){this.id=THREE.TextureIdCount++;this.uuid=THREE.Math.generateUUID();this.name="";this.image=a;this.mipmaps=[];this.mapping=void 0!==b?b:new THREE.UVMapping;this.wrapS=void 0!==c?c:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==d?d:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==e?e:THREE.LinearFilter;this.minFilter=void 0!==f?f:THREE.LinearMipMapLinearFilter;this.anisotropy=void 0!==k?k:1;this.format=void 0!==g?g:THREE.RGBAFormat;this.type=void 0!==h?h:THREE.UnsignedByteType;
this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this._needsUpdate=!1;this.onUpdate=null};
THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=a},clone:function(a){void 0===a&&(a=new THREE.Texture);a.image=this.image;a.mipmaps=this.mipmaps.slice(0);a.mapping=this.mapping;a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.format=this.format;a.type=this.type;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.generateMipmaps=
this.generateMipmaps;a.premultiplyAlpha=this.premultiplyAlpha;a.flipY=this.flipY;a.unpackAlignment=this.unpackAlignment;return a},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CompressedTexture=function(a,b,c,d,e,f,g,h,k,m,l){THREE.Texture.call(this,null,f,g,h,k,m,d,e,l);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=!1};
THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.clone=function(){var a=new THREE.CompressedTexture;THREE.Texture.prototype.clone.call(this,a);return a};THREE.DataTexture=function(a,b,c,d,e,f,g,h,k,m,l){THREE.Texture.call(this,null,f,g,h,k,m,d,e,l);this.image={data:a,width:b,height:c}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);
THREE.DataTexture.prototype.clone=function(){var a=new THREE.DataTexture;THREE.Texture.prototype.clone.call(this,a);return a};THREE.ParticleSystem=function(a,b){THREE.Object3D.call(this);this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.ParticleSystemMaterial({color:16777215*Math.random()});this.frustumCulled=this.sortParticles=!1};THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype);
THREE.ParticleSystem.prototype.clone=function(a){void 0===a&&(a=new THREE.ParticleSystem(this.geometry,this.material));a.sortParticles=this.sortParticles;THREE.Object3D.prototype.clone.call(this,a);return a};THREE.Line=function(a,b,c){THREE.Object3D.call(this);this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.LineBasicMaterial({color:16777215*Math.random()});this.type=void 0!==c?c:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);
THREE.Line.prototype.clone=function(a){void 0===a&&(a=new THREE.Line(this.geometry,this.material,this.type));THREE.Object3D.prototype.clone.call(this,a);return a};THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.updateMorphTargets()};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);
THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}};
THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.clone=function(a,b){void 0===a&&(a=new THREE.Mesh(this.geometry,this.material));THREE.Object3D.prototype.clone.call(this,a,b);return a};
THREE.Bone=function(a){THREE.Object3D.call(this);this.skin=a;this.skinMatrix=new THREE.Matrix4;this.accumulatedSclWeight=this.accumulatedPosWeight=this.accumulatedRotWeight=0};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);
THREE.Bone.prototype.update=function(a,b){this.matrixAutoUpdate&&(b|=this.updateMatrix());if(b||this.matrixWorldNeedsUpdate)a?this.skinMatrix.multiplyMatrices(a,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,b=!0,this.accumulatedSclWeight=this.accumulatedPosWeight=this.accumulatedRotWeight=0;for(var c=0,d=this.children.length;c<d;c++)this.children[c].update(this.skinMatrix,b)};
THREE.Skeleton=function(a,b){this.useVertexTexture=void 0!==b?b:!0;this.bones=[];this.boneMatrices=[];var c,d,e,f,g;if(void 0!==a){for(var h=0;h<a.length;++h)d=a[h],e=d.pos,f=d.rotq,g=d.scl,c=this.addBone(),c.name=d.name,c.position.set(e[0],e[1],e[2]),c.quaternion.set(f[0],f[1],f[2],f[3]),void 0!==g?c.scale.set(g[0],g[1],g[2]):c.scale.set(1,1,1);for(h=0;h<a.length;++h)d=a[h],-1!==d.parent&&this.bones[d.parent].add(this.bones[h]);c=this.bones.length;this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=
256<c?64:64<c?32:16<c?16:8,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*c)}};THREE.Skeleton.prototype=Object.create(THREE.Mesh.prototype);
THREE.Skeleton.prototype.addBone=function(a){void 0===a&&(a=new THREE.Bone(this));this.bones.push(a);return a};THREE.Skeleton.prototype.calculateInverses=function(a){this.boneInverses=[];a=0;for(var b=this.bones.length;a<b;++a){var c=new THREE.Matrix4;c.getInverse(this.bones[a].skinMatrix);this.boneInverses.push(c)}};
THREE.SkinnedMesh=function(a,b,c){THREE.Mesh.call(this,a,b);this.skeleton=new THREE.Skeleton(this.geometry&&this.geometry.bones,c);for(a=0;a<this.skeleton.bones.length;++a)b=this.skeleton.bones[a],void 0===b.parent&&this.add(b);this.identityMatrix=new THREE.Matrix4;this.pose()};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);
THREE.SkinnedMesh.prototype.updateMatrixWorld=function(){var a=new THREE.Matrix4;return function(b){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||b)this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1;b=0;for(var c=this.children.length;b<c;b++){var d=this.children[b];d instanceof THREE.Bone?d.update(this.identityMatrix,!1):d.updateMatrixWorld(!0)}void 0===this.skeleton.boneInverses&&
this.skeleton.calculateInverses();b=0;for(c=this.skeleton.bones.length;b<c;b++)a.multiplyMatrices(this.skeleton.bones[b].skinMatrix,this.skeleton.boneInverses[b]),a.flattenToArrayOffset(this.skeleton.boneMatrices,16*b);this.skeleton.useVertexTexture&&(this.skeleton.boneTexture.needsUpdate=!0)}}();THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);this.normalizeSkinWeights()};
THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var a=0;a<this.geometry.skinIndices.length;a++){var b=this.geometry.skinWeights[a],c=1/b.lengthManhattan();Infinity!==c?b.multiplyScalar(c):b.set(1)}};THREE.SkinnedMesh.prototype.clone=function(a){void 0===a&&(a=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture));THREE.Mesh.prototype.clone.call(this,a);return a};
THREE.MorphAnimMesh=function(a,b){THREE.Mesh.call(this,a,b);this.duration=1E3;this.mirroredLoop=!1;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=!1;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.setFrameRange=function(a,b){this.startKeyframe=a;this.endKeyframe=b;this.length=this.endKeyframe-this.startKeyframe+1};
THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=!1};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=!0};
THREE.MorphAnimMesh.prototype.parseAnimations=function(){var a=this.geometry;a.animations||(a.animations={});for(var b,c=a.animations,d=/([a-z]+)(\d+)/,e=0,f=a.morphTargets.length;e<f;e++){var g=a.morphTargets[e].name.match(d);if(g&&1<g.length){g=g[1];c[g]||(c[g]={start:Infinity,end:-Infinity});var h=c[g];e<h.start&&(h.start=e);e>h.end&&(h.end=e);b||(b=g)}}a.firstAnimation=b};
THREE.MorphAnimMesh.prototype.setAnimationLabel=function(a,b,c){this.geometry.animations||(this.geometry.animations={});this.geometry.animations[a]={start:b,end:c}};THREE.MorphAnimMesh.prototype.playAnimation=function(a,b){var c=this.geometry.animations[a];c?(this.setFrameRange(c.start,c.end),this.duration=(c.end-c.start)/b*1E3,this.time=0):console.warn("animation["+a+"] undefined")};
THREE.MorphAnimMesh.prototype.updateAnimation=function(a){var b=this.duration/this.length;this.time+=this.direction*a;if(this.mirroredLoop){if(this.time>this.duration||0>this.time)this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)}else this.time%=this.duration,0>this.time&&(this.time+=this.duration);a=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/b),0,this.length-1);a!==this.currentKeyframe&&
(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[a]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=a);b=this.time%b/b;this.directionBackwards&&(b=1-b);this.morphTargetInfluences[this.currentKeyframe]=b;this.morphTargetInfluences[this.lastKeyframe]=1-b};
THREE.MorphAnimMesh.prototype.clone=function(a){void 0===a&&(a=new THREE.MorphAnimMesh(this.geometry,this.material));a.duration=this.duration;a.mirroredLoop=this.mirroredLoop;a.time=this.time;a.lastKeyframe=this.lastKeyframe;a.currentKeyframe=this.currentKeyframe;a.direction=this.direction;a.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,a);return a};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);
THREE.LOD.prototype.addLevel=function(a,b){void 0===b&&(b=0);b=Math.abs(b);for(var c=0;c<this.objects.length&&!(b<this.objects[c].distance);c++);this.objects.splice(c,0,{distance:b,object:a});this.add(a)};THREE.LOD.prototype.getObjectForDistance=function(a){for(var b=1,c=this.objects.length;b<c&&!(a<this.objects[b].distance);b++);return this.objects[b-1].object};
THREE.LOD.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){if(1<this.objects.length){a.setFromMatrixPosition(c.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);c=a.distanceTo(b);this.objects[0].object.visible=!0;for(var d=1,e=this.objects.length;d<e;d++)if(c>=this.objects[d].distance)this.objects[d-1].object.visible=!1,this.objects[d].object.visible=!0;else break;for(;d<e;d++)this.objects[d].object.visible=!1}}}();
THREE.LOD.prototype.clone=function(a){void 0===a&&(a=new THREE.LOD);THREE.Object3D.prototype.clone.call(this,a);for(var b=0,c=this.objects.length;b<c;b++){var d=this.objects[b].object.clone();d.visible=0===b;a.addLevel(d,this.objects[b].distance)}return a};
THREE.Sprite=function(){var a=new THREE.Float32Attribute(3,3);a.set([-.5,-.5,0,.5,-.5,0,.5,.5,0]);var b=new THREE.BufferGeometry;b.addAttribute("position",a);return function(a){THREE.Object3D.call(this);this.geometry=b;this.material=void 0!==a?a:new THREE.SpriteMaterial}}();THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0};
THREE.Sprite.prototype.clone=function(a){void 0===a&&(a=new THREE.Sprite(this.material));THREE.Object3D.prototype.clone.call(this,a);return a};THREE.Particle=THREE.Sprite;THREE.Scene=function(){THREE.Object3D.call(this);this.overrideMaterial=this.fog=null;this.autoUpdate=!0;this.matrixAutoUpdate=!1;this.__lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);
THREE.Scene.prototype.__addObject=function(a){if(a instanceof THREE.Light)-1===this.__lights.indexOf(a)&&this.__lights.push(a),a.target&&void 0===a.target.parent&&this.add(a.target);else if(!(a instanceof THREE.Camera||a instanceof THREE.Bone)){this.__objectsAdded.push(a);var b=this.__objectsRemoved.indexOf(a);-1!==b&&this.__objectsRemoved.splice(b,1)}this.dispatchEvent({type:"objectAdded",object:a});a.dispatchEvent({type:"addedToScene",scene:this});for(b=0;b<a.children.length;b++)this.__addObject(a.children[b])};
THREE.Scene.prototype.__removeObject=function(a){if(a instanceof THREE.Light){var b=this.__lights.indexOf(a);-1!==b&&this.__lights.splice(b,1);if(a.shadowCascadeArray)for(b=0;b<a.shadowCascadeArray.length;b++)this.__removeObject(a.shadowCascadeArray[b])}else a instanceof THREE.Camera||(this.__objectsRemoved.push(a),b=this.__objectsAdded.indexOf(a),-1!==b&&this.__objectsAdded.splice(b,1));this.dispatchEvent({type:"objectRemoved",object:a});a.dispatchEvent({type:"removedFromScene",scene:this});for(b=
0;b<a.children.length;b++)this.__removeObject(a.children[b])};THREE.Scene.prototype.clone=function(a){void 0===a&&(a=new THREE.Scene);THREE.Object3D.prototype.clone.call(this,a);null!==this.fog&&(a.fog=this.fog.clone());null!==this.overrideMaterial&&(a.overrideMaterial=this.overrideMaterial.clone());a.autoUpdate=this.autoUpdate;a.matrixAutoUpdate=this.matrixAutoUpdate;return a};THREE.Fog=function(a,b,c){this.name="";this.color=new THREE.Color(a);this.near=void 0!==b?b:1;this.far=void 0!==c?c:1E3};
THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(a,b){this.name="";this.color=new THREE.Color(a);this.density=void 0!==b?b:2.5E-4};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};
THREE.CanvasRenderer=function(a){function b(a,b,c,d){m(b);l(c);n(d);t(a.getStyle());A.stroke();ka.expandByScalar(2*b)}function c(a){q(a.getStyle());A.fill()}function d(a){e(a.target)}function e(a){var b=a.wrapS===THREE.RepeatWrapping,c=a.wrapT===THREE.RepeatWrapping,d=a.image,e=document.createElement("canvas");e.width=d.width;e.height=d.height;var f=e.getContext("2d");f.setTransform(1,0,0,-1,0,d.height);f.drawImage(d,0,0);Ka[a.id]=A.createPattern(e,!0===b&&!0===c?"repeat":!0===b&&!1===c?"repeat-x":
!1===b&&!0===c?"repeat-y":"no-repeat")}function f(a,b,c,f,g,h,l,k,m,n,t,u,p){if(!(p instanceof THREE.DataTexture)){!1===p.hasEventListener("update",d)&&(void 0!==p.image&&0<p.image.width&&e(p),p.addEventListener("update",d));var r=Ka[p.id];if(void 0!==r){q(r);var r=p.offset.x/p.repeat.x,v=p.offset.y/p.repeat.y,w=p.image.width*p.repeat.x;p=p.image.height*p.repeat.y;l=(l+r)*w;k=(k+v)*p;c-=a;f-=b;g-=a;h-=b;m=(m+r)*w-l;n=(n+v)*p-k;t=(t+r)*w-l;u=(u+v)*p-k;p=m*u-t*n;0!==p&&(r=1/p,p=(u*c-n*g)*r,n=(u*f-n*
h)*r,c=(m*g-t*c)*r,f=(m*h-t*f)*r,a=a-p*l-c*k,b=b-n*l-f*k,A.save(),A.transform(p,n,c,f,a,b),A.fill(),A.restore())}else q("rgba(0,0,0,1)"),A.fill()}}function g(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=d*d+e*e;0!==f&&(c/=Math.sqrt(f),d*=c,e*=c,b.x+=d,b.y+=e,a.x-=d,a.y-=e)}function h(a){J!==a&&(J=A.globalAlpha=a)}function k(a){N!==a&&(a===THREE.NormalBlending?A.globalCompositeOperation="source-over":a===THREE.AdditiveBlending?A.globalCompositeOperation="lighter":a===THREE.SubtractiveBlending&&(A.globalCompositeOperation=
"darker"),N=a)}function m(a){G!==a&&(G=A.lineWidth=a)}function l(a){Q!==a&&(Q=A.lineCap=a)}function n(a){Z!==a&&(Z=A.lineJoin=a)}function t(a){B!==a&&(B=A.strokeStyle=a)}function q(a){C!==a&&(C=A.fillStyle=a)}function u(a,b){if(T!==a||ba!==b)A.setLineDash([a,b]),T=a,ba=b}console.log("THREE.CanvasRenderer",THREE.REVISION);var p=THREE.Math.smoothstep;a=a||{};var v=this,x,w,y,M=new THREE.Projector,z=void 0!==a.canvas?a.canvas:document.createElement("canvas"),K=z.width,H=z.height,D=Math.floor(K/2),L=
Math.floor(H/2),A=z.getContext("2d",{alpha:!0===a.alpha}),E=new THREE.Color(0),F=0,J=1,N=0,B=null,C=null,G=null,Q=null,Z=null,T=null,ba=0,V,S,I,Y;new THREE.RenderableVertex;new THREE.RenderableVertex;var $,ca,P,na,ua,Ca,ea=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var aa=new THREE.Color,Qa=new THREE.Color,xa=new THREE.Color,Ka={},r,Ha,va,Oa,Ra,la,ya,Aa=new THREE.Box2,fa=new THREE.Box2,ka=new THREE.Box2,oa=new THREE.Color,U=new THREE.Color,Pa=new THREE.Color,Da=
new THREE.Vector3,Ea=new THREE.Vector3,ga=new THREE.Vector3,da=new THREE.Matrix3;void 0===A.setLineDash&&(A.setLineDash=function(){});this.domElement=z;this.devicePixelRatio=void 0!==a.devicePixelRatio?a.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.setSize=function(a,b,c){K=a*this.devicePixelRatio;H=b*
this.devicePixelRatio;z.width=K;z.height=H;D=Math.floor(K/2);L=Math.floor(H/2);!1!==c&&(z.style.width=a+"px",z.style.height=b+"px");Aa.min.set(-D,-L);Aa.max.set(D,L);fa.min.set(-D,-L);fa.max.set(D,L);J=1;N=0;Z=Q=G=C=B=null;this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){A.setTransform(c*this.devicePixelRatio/K,0,0,-(d*this.devicePixelRatio)/H,a*this.devicePixelRatio,H-b*this.devicePixelRatio);A.translate(D,L)};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=
function(a,b){E.set(a);F=void 0!==b?b:1;fa.min.set(-D,-L);fa.max.set(D,L)};this.setClearColorHex=function(a,b){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(a,b)};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===fa.empty()&&(fa.intersect(Aa),fa.expandByScalar(2),1>F&&A.clearRect(fa.min.x|0,fa.min.y|0,fa.max.x-fa.min.x|0,fa.max.y-fa.min.y|0),0<F&&(k(THREE.NormalBlending),h(1),q("rgba("+Math.floor(255*E.r)+","+
Math.floor(255*E.g)+","+Math.floor(255*E.b)+","+F+")"),A.fillRect(fa.min.x|0,fa.min.y|0,fa.max.x-fa.min.x|0,fa.max.y-fa.min.y|0)),fa.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(a,H){if(!1===H instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();v.info.render.vertices=0;v.info.render.faces=0;x=M.projectScene(a,H,this.sortObjects,
this.sortElements);w=x.elements;y=x.lights;V=H;da.getNormalMatrix(H.matrixWorldInverse);oa.setRGB(0,0,0);U.setRGB(0,0,0);Pa.setRGB(0,0,0);for(var J=0,E=y.length;J<E;J++){var z=y[J],F=z.color;z instanceof THREE.AmbientLight?oa.add(F):z instanceof THREE.DirectionalLight?U.add(F):z instanceof THREE.PointLight&&Pa.add(F)}J=0;for(E=w.length;J<E;J++){var B=w[J],K=B.material;if(void 0!==K&&0!==K.opacity){ka.makeEmpty();if(B instanceof THREE.RenderableSprite){S=B;S.x*=D;S.y*=L;var z=S,N=B,F=K;h(F.opacity);
k(F.blending);var s=N.scale.x*D,N=N.scale.y*L,B=.5*Math.sqrt(s*s+N*N);ka.min.set(z.x-B,z.y-B);ka.max.set(z.x+B,z.y+B);if(F instanceof THREE.SpriteMaterial||F instanceof THREE.ParticleSystemMaterial){var C=F.map;if(null!==C){!1===C.hasEventListener("update",d)&&(void 0!==C.image&&0<C.image.width&&e(C),C.addEventListener("update",d));B=Ka[C.id];void 0!==B?q(B):q("rgba( 0, 0, 0, 1 )");var G=C.image,B=G.width*C.offset.x,K=G.height*C.offset.y,Q=G.width*C.repeat.x,C=G.height*C.repeat.y,G=s/Q,T=N/C;A.save();
A.translate(z.x,z.y);0!==F.rotation&&A.rotate(F.rotation);A.translate(-s/2,-N/2);A.scale(G,T);A.translate(-B,-K);A.fillRect(B,K,Q,C)}else q(F.color.getStyle()),A.save(),A.translate(z.x,z.y),0!==F.rotation&&A.rotate(F.rotation),A.scale(s,-N),A.fillRect(-.5,-.5,1,1);A.restore()}else F instanceof THREE.SpriteCanvasMaterial&&(t(F.color.getStyle()),q(F.color.getStyle()),A.save(),A.translate(z.x,z.y),0!==F.rotation&&A.rotate(F.rotation),A.scale(s,N),F.program(A),A.restore())}else if(B instanceof THREE.RenderableLine){if(S=
B.v1,I=B.v2,S.positionScreen.x*=D,S.positionScreen.y*=L,I.positionScreen.x*=D,I.positionScreen.y*=L,ka.setFromPoints([S.positionScreen,I.positionScreen]),!0===Aa.isIntersectionBox(ka))if(z=S,F=I,s=B,N=K,h(N.opacity),k(N.blending),A.beginPath(),A.moveTo(z.positionScreen.x,z.positionScreen.y),A.lineTo(F.positionScreen.x,F.positionScreen.y),N instanceof THREE.LineBasicMaterial){m(N.linewidth);l(N.linecap);n(N.linejoin);if(N.vertexColors!==THREE.VertexColors)t(N.color.getStyle());else if(B=s.vertexColors[0].getStyle(),
s=s.vertexColors[1].getStyle(),B===s)t(B);else{try{var Z=A.createLinearGradient(z.positionScreen.x,z.positionScreen.y,F.positionScreen.x,F.positionScreen.y);Z.addColorStop(0,B);Z.addColorStop(1,s)}catch(ba){Z=B}t(Z)}A.stroke();ka.expandByScalar(2*N.linewidth)}else N instanceof THREE.LineDashedMaterial&&(m(N.linewidth),l(N.linecap),n(N.linejoin),t(N.color.getStyle()),u(N.dashSize,N.gapSize),A.stroke(),ka.expandByScalar(2*N.linewidth),u(null,null))}else if(B instanceof THREE.RenderableFace){S=B.v1;
I=B.v2;Y=B.v3;if(-1>S.positionScreen.z||1<S.positionScreen.z)continue;if(-1>I.positionScreen.z||1<I.positionScreen.z)continue;if(-1>Y.positionScreen.z||1<Y.positionScreen.z)continue;S.positionScreen.x*=D;S.positionScreen.y*=L;I.positionScreen.x*=D;I.positionScreen.y*=L;Y.positionScreen.x*=D;Y.positionScreen.y*=L;0<K.overdraw&&(g(S.positionScreen,I.positionScreen,K.overdraw),g(I.positionScreen,Y.positionScreen,K.overdraw),g(Y.positionScreen,S.positionScreen,K.overdraw));ka.setFromPoints([S.positionScreen,
I.positionScreen,Y.positionScreen]);if(!0===Aa.isIntersectionBox(ka)){F=S;s=I;N=Y;z=K;v.info.render.vertices+=3;v.info.render.faces++;h(z.opacity);k(z.blending);$=F.positionScreen.x;ca=F.positionScreen.y;P=s.positionScreen.x;na=s.positionScreen.y;ua=N.positionScreen.x;Ca=N.positionScreen.y;var K=$,Q=ca,C=P,G=na,T=ua,ob=Ca;A.beginPath();A.moveTo(K,Q);A.lineTo(C,G);A.lineTo(T,ob);A.closePath();if((z instanceof THREE.MeshLambertMaterial||z instanceof THREE.MeshPhongMaterial)&&null===z.map){aa.copy(z.color);
Qa.copy(z.emissive);z.vertexColors===THREE.FaceColors&&aa.multiply(B.color);ea.copy(oa);Ea.copy(F.positionWorld).add(s.positionWorld).add(N.positionWorld).divideScalar(3);F=Ea;s=B.normalModel;N=ea;B=0;for(K=y.length;B<K;B++)Q=y[B],xa.copy(Q.color),Q instanceof THREE.DirectionalLight?(C=Da.setFromMatrixPosition(Q.matrixWorld).normalize(),G=s.dot(C),0>=G||(G*=Q.intensity,N.add(xa.multiplyScalar(G)))):Q instanceof THREE.PointLight&&(C=Da.setFromMatrixPosition(Q.matrixWorld),G=s.dot(Da.subVectors(C,F).normalize()),
0>=G||(G*=0==Q.distance?1:1-Math.min(F.distanceTo(C)/Q.distance,1),0!=G&&(G*=Q.intensity,N.add(xa.multiplyScalar(G)))));ea.multiply(aa).add(Qa);!0===z.wireframe?b(ea,z.wireframeLinewidth,z.wireframeLinecap,z.wireframeLinejoin):c(ea)}else z instanceof THREE.MeshBasicMaterial||z instanceof THREE.MeshLambertMaterial||z instanceof THREE.MeshPhongMaterial?null!==z.map?z.map.mapping instanceof THREE.UVMapping&&(r=B.uvs,f($,ca,P,na,ua,Ca,r[0].x,r[0].y,r[1].x,r[1].y,r[2].x,r[2].y,z.map)):null!==z.envMap?
z.envMap.mapping instanceof THREE.SphericalReflectionMapping?(ga.copy(B.vertexNormalsModel[0]).applyMatrix3(da),Ha=.5*ga.x+.5,va=.5*ga.y+.5,ga.copy(B.vertexNormalsModel[1]).applyMatrix3(da),Oa=.5*ga.x+.5,Ra=.5*ga.y+.5,ga.copy(B.vertexNormalsModel[2]).applyMatrix3(da),la=.5*ga.x+.5,ya=.5*ga.y+.5,f($,ca,P,na,ua,Ca,Ha,va,Oa,Ra,la,ya,z.envMap)):z.envMap.mapping instanceof THREE.SphericalRefractionMapping&&(ga.copy(B.vertexNormalsModel[0]).applyMatrix3(da),Ha=-.5*ga.x+.5,va=-.5*ga.y+.5,ga.copy(B.vertexNormalsModel[1]).applyMatrix3(da),
Oa=-.5*ga.x+.5,Ra=-.5*ga.y+.5,ga.copy(B.vertexNormalsModel[2]).applyMatrix3(da),la=-.5*ga.x+.5,ya=-.5*ga.y+.5,f($,ca,P,na,ua,Ca,Ha,va,Oa,Ra,la,ya,z.envMap)):(ea.copy(z.color),z.vertexColors===THREE.FaceColors&&ea.multiply(B.color),!0===z.wireframe?b(ea,z.wireframeLinewidth,z.wireframeLinecap,z.wireframeLinejoin):c(ea)):(z instanceof THREE.MeshDepthMaterial?ea.r=ea.g=ea.b=1-p(F.positionScreen.z*F.positionScreen.w,V.near,V.far):z instanceof THREE.MeshNormalMaterial?(ga.copy(B.normalModel).applyMatrix3(da),
ea.setRGB(ga.x,ga.y,ga.z).multiplyScalar(.5).addScalar(.5)):ea.setRGB(1,1,1),!0===z.wireframe?b(ea,z.wireframeLinewidth,z.wireframeLinecap,z.wireframeLinejoin):c(ea))}}fa.union(ka)}}}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tconst float LOG2 = 1.442695;\n\t\tfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\tuniform samplerCube envMap;\n\tuniform float flipEnvMap;\n\tuniform int combine;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\t\tuniform bool useRefract;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",
envmap_fragment:"#ifdef USE_ENVMAP\n\tvec3 reflectVec;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\t\tif ( useRefract ) {\n\t\t\treflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t} else { \n\t\t\treflectVec = reflect( cameraToVertex, worldNormal );\n\t\t}\n\t#else\n\t\treflectVec = vReflect;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t\tvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#endif\n\t#ifdef GAMMA_INPUT\n\t\tcubeColor.xyz *= cubeColor.xyz;\n\t#endif\n\tif ( combine == 1 ) {\n\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n\t} else if ( combine == 2 ) {\n\t\tgl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n\t} else {\n\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n\t}\n#endif",
envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n\tvarying vec3 vReflect;\n\tuniform float refractionRatio;\n\tuniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#endif\n\t#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\t#endif\n\t#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t#endif\n#endif",
envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n\tvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n\tworldNormal = normalize( worldNormal );\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\tif ( useRefract ) {\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t} else {\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t}\n#endif",
map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tgl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",
map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\t#ifdef GAMMA_INPUT\n\t\ttexelColor.xyz *= texelColor.xyz;\n\t#endif\n\tgl_FragColor = gl_FragColor * texelColor;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\n\tvarying vec2 vUv2;\n#endif",
lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tgl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\n\tvUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",
specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\n\tuniform vec3 wrapRGB;\n#endif",
lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\tvec3 dirVector = normalize( lDirection.xyz );\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\t#ifdef DOUBLE_SIDED\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\t\t#ifdef WRAP_AROUND\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t#endif\n\t#endif\n\t#ifdef WRAP_AROUND\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\t\t#endif\n\t#endif\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\t#ifdef DOUBLE_SIDED\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\t#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\t\tfloat lDistance = 1.0;\n\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\t\t\t#ifdef WRAP_AROUND\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t#endif\n\t\t#endif\n\t\t#ifdef WRAP_AROUND\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\t\t\t#endif\n\t\t#endif\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\t\t#endif\n\t}\n#endif\n#if MAX_SPOT_LIGHTS > 0\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\t\t\tspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n\t\t\tfloat lDistance = 1.0;\n\t\t\tif ( spotLightDistance[ i ] > 0.0 )\n\t\t\t\tlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\t\t\tlVector = normalize( lVector );\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\t\t\t\t#ifdef WRAP_AROUND\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\t#endif\n\t\t\t#endif\n\t\t\t#ifdef WRAP_AROUND\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\t\t\t\t#endif\n\t\t\t#endif\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\t\t\t#endif\n\t\t}\n\t}\n#endif\n#if MAX_HEMI_LIGHTS > 0\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n\t\tvec3 lVector = normalize( lDirection.xyz );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\t\t#endif\n\t}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\n\tvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",
lights_phong_pars_vertex:"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\tvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\tvWorldPosition = worldPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\tvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\n\tuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",
lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\n\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\n\tvec3 pointDiffuse  = vec3( 0.0 );\n\tvec3 pointSpecular = vec3( 0.0 );\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\t\tfloat lDistance = 1.0;\n\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\t#ifdef WRAP_AROUND\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\t\t#else\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\t\t#endif\n\t\tpointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\t\tfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\t}\n#endif\n#if MAX_SPOT_LIGHTS > 0\n\tvec3 spotDiffuse  = vec3( 0.0 );\n\tvec3 spotSpecular = vec3( 0.0 );\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\t\tfloat lDistance = 1.0;\n\t\tif ( spotLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\t\tlVector = normalize( lVector );\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\t\t\tspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\t\t\t#ifdef WRAP_AROUND\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\t\t\t#else\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\t\t\t#endif\n\t\t\tspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\t\t\tfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\tspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\t\t}\n\t}\n#endif\n#if MAX_DIR_LIGHTS > 0\n\tvec3 dirDiffuse  = vec3( 0.0 );\n\tvec3 dirSpecular = vec3( 0.0 );\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\t\tvec3 dirVector = normalize( lDirection.xyz );\n\t\tfloat dotProduct = dot( normal, dirVector );\n\t\t#ifdef WRAP_AROUND\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\t\t#else\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\t\t#endif\n\t\tdirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\t\tfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\t}\n#endif\n#if MAX_HEMI_LIGHTS > 0\n\tvec3 hemiDiffuse  = vec3( 0.0 );\n\tvec3 hemiSpecular = vec3( 0.0 );\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n\t\tvec3 lVector = normalize( lDirection.xyz );\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\t\themiDiffuse += diffuse * hemiColor;\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\n\t\tvec3 lVectorGround = -lVector;\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\t\tfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\themiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\t}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\n\ttotalDiffuse += dirDiffuse;\n\ttotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\n\ttotalDiffuse += hemiDiffuse;\n\ttotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\n\ttotalDiffuse += pointDiffuse;\n\ttotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\n\ttotalDiffuse += spotDiffuse;\n\ttotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\n\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\n\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",
color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tgl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\t#ifdef GAMMA_INPUT\n\t\tvColor = color * color;\n\t#else\n\t\tvColor = color;\n\t#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\t#ifdef USE_MORPHTARGETS\n\tvec4 skinVertex = vec4( morphed, 1.0 );\n\t#else\n\tvec4 skinVertex = vec4( position, 1.0 );\n\t#endif\n\tvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\n\tskinned      += boneMatY * skinVertex * skinWeight.y;\n\tskinned      += boneMatZ * skinVertex * skinWeight.z;\n\tskinned      += boneMatW * skinVertex * skinWeight.w;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n\tmorphed += position;\n#endif",
default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\n\tmvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n\tmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n\tmvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tvec3 morphedNormal = vec3( 0.0 );\n\tmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\tmorphedNormal += normal;\n#endif",
skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = skinWeight.x * boneMatX;\n\tskinMatrix \t+= skinWeight.y * boneMatY;\n\tskinMatrix \t+= skinWeight.z * boneMatZ;\n\tskinMatrix \t+= skinWeight.w * boneMatW;\n\t#ifdef USE_MORPHNORMALS\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\t#else\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\t#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\n\tobjectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n\tobjectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n\tobjectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",
shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\t}\n#endif",
shadowmap_fragment:"#ifdef USE_SHADOWMAP\n\t#ifdef SHADOWMAP_DEBUG\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\t#endif\n\t#ifdef SHADOWMAP_CASCADE\n\t\tint inFrustumCount = 0;\n\t#endif\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\t#ifdef SHADOWMAP_CASCADE\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\t\t#else\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\t#endif\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\t\tfloat shadow = 0.0;\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\t\tfloat shadow = 0.0;\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\t\t\t#else\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\t\t\t#endif\n\t\t}\n\t\t#ifdef SHADOWMAP_DEBUG\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\t\t\t#else\n\t\t\t\tif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\t\t\t#endif\n\t\t#endif\n\t}\n\t#ifdef GAMMA_OUTPUT\n\t\tshadowColor *= shadowColor;\n\t#endif\n\tgl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\t}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\n\tgl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",
logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\t#endif\n#endif",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif"};
THREE.UniformsUtils={merge:function(a){var b,c,d,e={};for(b=0;b<a.length;b++)for(c in d=this.clone(a[b]),d)e[c]=d[c];return e},clone:function(a){var b,c,d,e={};for(b in a)for(c in e[b]={},a[b])d=a[b][c],e[b][c]=d instanceof THREE.Color||d instanceof THREE.Vector2||d instanceof THREE.Vector3||d instanceof THREE.Vector4||d instanceof THREE.Matrix4||d instanceof THREE.Texture?d.clone():d instanceof Array?d.slice():d;return e}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",
value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",
value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",
value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};
THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,
THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"\t#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,
THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},
emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,
THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,
THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,
"void main() {\n\tgl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED\n\t\tif ( gl_FrontFacing )\n\t\t\tgl_FragColor.xyz *= vLightFront;\n\t\telse\n\t\t\tgl_FragColor.xyz *= vLightBack;\n\t#else\n\t\tgl_FragColor.xyz *= vLightFront;\n\t#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,
THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",
value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,
THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"\tvNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,
THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,
THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,
THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\tgl_Position = projectionMatrix * mvPosition;",
THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_particle_fragment,
THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,
"void main() {",THREE.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,
"void main() {\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tgl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.morphtarget_vertex,
THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;\nuniform float mFar;\nuniform float opacity;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\n\tgl_FragColor = vec4( vec3( color ), opacity );\n}"].join("\n")},
normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n\tvNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vNormal;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",
THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},
tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new THREE.Color(16777215)},specular:{type:"c",value:new THREE.Color(1118481)},ambient:{type:"c",value:new THREE.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,
0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float refractionRatio;\nuniform float reflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\n\tuniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",
THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"\tgl_FragColor = vec4( vec3( 1.0 ), opacity );\n\tvec3 specularTex = vec3( 1.0 );\n\tvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\n\tnormalTex.xy *= uNormalScale;\n\tnormalTex = normalize( normalTex );\n\tif( enableDiffuse ) {\n\t\t#ifdef GAMMA_INPUT\n\t\t\tvec4 texelColor = texture2D( tDiffuse, vUv );\n\t\t\ttexelColor.xyz *= texelColor.xyz;\n\t\t\tgl_FragColor = gl_FragColor * texelColor;\n\t\t#else\n\t\t\tgl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n\t\t#endif\n\t}\n\tif( enableAO ) {\n\t\t#ifdef GAMMA_INPUT\n\t\t\tvec4 aoColor = texture2D( tAO, vUv );\n\t\t\taoColor.xyz *= aoColor.xyz;\n\t\t\tgl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n\t\t#else\n\t\t\tgl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n\t\t#endif\n\t}\n\tif( enableSpecular )\n\t\tspecularTex = texture2D( tSpecular, vUv ).xyz;\n\tmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\n\tvec3 finalNormal = tsb * normalTex;\n\t#ifdef FLIP_SIDED\n\t\tfinalNormal = -finalNormal;\n\t#endif\n\tvec3 normal = normalize( finalNormal );\n\tvec3 viewPosition = normalize( vViewPosition );\n\t#if MAX_POINT_LIGHTS > 0\n\t\tvec3 pointDiffuse = vec3( 0.0 );\n\t\tvec3 pointSpecular = vec3( 0.0 );\n\t\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\t\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\t\tvec3 pointVector = lPosition.xyz + vViewPosition.xyz;\n\t\t\tfloat pointDistance = 1.0;\n\t\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\t\tpointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\n\t\t\tpointVector = normalize( pointVector );\n\t\t\t#ifdef WRAP_AROUND\n\t\t\t\tfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\n\t\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\n\t\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\t\t\t#else\n\t\t\t\tfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n\t\t\t#endif\n\t\t\tpointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;\n\t\t\tvec3 pointHalfVector = normalize( pointVector + viewPosition );\n\t\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\t\tfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\t\t\tfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\n\t\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n\t\t}\n\t#endif\n\t#if MAX_SPOT_LIGHTS > 0\n\t\tvec3 spotDiffuse = vec3( 0.0 );\n\t\tvec3 spotSpecular = vec3( 0.0 );\n\t\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\t\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\t\tvec3 spotVector = lPosition.xyz + vViewPosition.xyz;\n\t\t\tfloat spotDistance = 1.0;\n\t\t\tif ( spotLightDistance[ i ] > 0.0 )\n\t\t\t\tspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\n\t\t\tspotVector = normalize( spotVector );\n\t\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\t\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\t\t\t\tspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n\t\t\t\t#ifdef WRAP_AROUND\n\t\t\t\t\tfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\n\t\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\n\t\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\t\t\t\t#else\n\t\t\t\t\tfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n\t\t\t\t#endif\n\t\t\t\tspotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;\n\t\t\t\tvec3 spotHalfVector = normalize( spotVector + viewPosition );\n\t\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\t\tfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\t\t\t\tfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\n\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\n\t\t\t\tspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n\t\t\t}\n\t\t}\n\t#endif\n\t#if MAX_DIR_LIGHTS > 0\n\t\tvec3 dirDiffuse = vec3( 0.0 );\n\t\tvec3 dirSpecular = vec3( 0.0 );\n\t\tfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\n\t\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\t\t\tvec3 dirVector = normalize( lDirection.xyz );\n\t\t\t#ifdef WRAP_AROUND\n\t\t\t\tfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\n\t\t\t\tfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\n\t\t\t\tvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n\t\t\t#else\n\t\t\t\tfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n\t\t\t#endif\n\t\t\tdirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;\n\t\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\t\tfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\t\t\tfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\n\t\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\t\t}\n\t#endif\n\t#if MAX_HEMI_LIGHTS > 0\n\t\tvec3 hemiDiffuse  = vec3( 0.0 );\n\t\tvec3 hemiSpecular = vec3( 0.0 );\n\t\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\t\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n\t\t\tvec3 lVector = normalize( lDirection.xyz );\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\t\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\t\t\themiDiffuse += diffuse * hemiColor;\n\t\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\t\tfloat hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\n\t\t\tvec3 lVectorGround = -lVector;\n\t\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\t\tfloat hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n\t\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\t\t\tfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\n\t\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\n\t\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\n\t\t\themiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\t\t}\n\t#endif\n\tvec3 totalDiffuse = vec3( 0.0 );\n\tvec3 totalSpecular = vec3( 0.0 );\n\t#if MAX_DIR_LIGHTS > 0\n\t\ttotalDiffuse += dirDiffuse;\n\t\ttotalSpecular += dirSpecular;\n\t#endif\n\t#if MAX_HEMI_LIGHTS > 0\n\t\ttotalDiffuse += hemiDiffuse;\n\t\ttotalSpecular += hemiSpecular;\n\t#endif\n\t#if MAX_POINT_LIGHTS > 0\n\t\ttotalDiffuse += pointDiffuse;\n\t\ttotalSpecular += pointSpecular;\n\t#endif\n\t#if MAX_SPOT_LIGHTS > 0\n\t\ttotalDiffuse += spotDiffuse;\n\t\ttotalSpecular += spotSpecular;\n\t#endif\n\t#ifdef METAL\n\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\t#else\n\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\t#endif\n\tif ( enableReflection ) {\n\t\tvec3 vReflect;\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tif ( useRefract ) {\n\t\t\tvReflect = refract( cameraToVertex, normal, refractionRatio );\n\t\t} else {\n\t\t\tvReflect = reflect( cameraToVertex, normal );\n\t\t}\n\t\tvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n\t\t#ifdef GAMMA_INPUT\n\t\t\tcubeColor.xyz *= cubeColor.xyz;\n\t\t#endif\n\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );\n\t}",
THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\n\tuniform sampler2D tDisplacement;\n\tuniform float uDisplacementScale;\n\tuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"\t#ifdef USE_SKINNING\n\t\tvNormal = normalize( normalMatrix * skinnedNormal.xyz );\n\t\tvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\n\t\tvTangent = normalize( normalMatrix * skinnedTangent.xyz );\n\t#else\n\t\tvNormal = normalize( normalMatrix * normal );\n\t\tvTangent = normalize( normalMatrix * tangent.xyz );\n\t#endif\n\tvBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\n\tvUv = uv * uRepeat + uOffset;\n\tvec3 displacedPosition;\n\t#ifdef VERTEX_TEXTURES\n\t\tif ( enableDisplacement ) {\n\t\t\tvec3 dv = texture2D( tDisplacement, uv ).xyz;\n\t\t\tfloat df = uDisplacementScale * dv.x + uDisplacementBias;\n\t\t\tdisplacedPosition = position + normalize( normal ) * df;\n\t\t} else {\n\t\t\t#ifdef USE_SKINNING\n\t\t\t\tvec4 skinVertex = vec4( position, 1.0 );\n\t\t\t\tvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\n\t\t\t\tskinned \t  += boneMatY * skinVertex * skinWeight.y;\n\t\t\t\tskinned \t  += boneMatZ * skinVertex * skinWeight.z;\n\t\t\t\tskinned \t  += boneMatW * skinVertex * skinWeight.w;\n\t\t\t\tdisplacedPosition  = skinned.xyz;\n\t\t\t#else\n\t\t\t\tdisplacedPosition = position;\n\t\t\t#endif\n\t\t}\n\t#else\n\t\t#ifdef USE_SKINNING\n\t\t\tvec4 skinVertex = vec4( position, 1.0 );\n\t\t\tvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\n\t\t\tskinned \t  += boneMatY * skinVertex * skinWeight.y;\n\t\t\tskinned \t  += boneMatZ * skinVertex * skinWeight.z;\n\t\t\tskinned \t  += boneMatW * skinVertex * skinWeight.w;\n\t\t\tdisplacedPosition  = skinned.xyz;\n\t\t#else\n\t\t\tdisplacedPosition = position;\n\t\t#endif\n\t#endif\n\tvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\n\tvec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;",
THREE.ShaderChunk.logdepthbuf_vertex,"\tvWorldPosition = worldPosition.xyz;\n\tvViewPosition = -mvPosition.xyz;\n\t#ifdef USE_SHADOWMAP\n\t\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\t\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\t\t}\n\t#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\tvWorldPosition = worldPosition.xyz;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",
THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,
"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nvoid main() {",
THREE.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\n\t#else\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n\t#endif\n}"].join("\n")}};
THREE.WebGLRenderer=function(a){function b(a,b){var c=a.vertices.length,d=b.material;if(d.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var e in d.attributes){var f=d.attributes[e];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=!0;var g=1;"v2"===f.type?g=2:"v3"===f.type?g=3:"v4"===f.type?g=4:"c"===f.type&&(g=3);f.size=g;f.array=new Float32Array(c*g);f.buffer=s.createBuffer();f.buffer.belongsToAttribute=e;f.needsUpdate=!0}a.__webglCustomAttributesList.push(f)}}}
function c(a,b){var c=b.geometry,g=a.faces3,h=3*g.length,l=1*g.length,k=3*g.length,g=d(b,a),m=f(g),n=e(g),q=g.vertexColors?g.vertexColors:!1;a.__vertexArray=new Float32Array(3*h);n&&(a.__normalArray=new Float32Array(3*h));c.hasTangents&&(a.__tangentArray=new Float32Array(4*h));q&&(a.__colorArray=new Float32Array(3*h));m&&(0<c.faceVertexUvs.length&&(a.__uvArray=new Float32Array(2*h)),1<c.faceVertexUvs.length&&(a.__uv2Array=new Float32Array(2*h)));b.geometry.skinWeights.length&&b.geometry.skinIndices.length&&
(a.__skinIndexArray=new Float32Array(4*h),a.__skinWeightArray=new Float32Array(4*h));c=null!==yb&&21845<l?Uint32Array:Uint16Array;a.__typeArray=c;a.__faceArray=new c(3*l);a.__lineArray=new c(2*k);if(a.numMorphTargets)for(a.__morphTargetsArrays=[],c=0,m=a.numMorphTargets;c<m;c++)a.__morphTargetsArrays.push(new Float32Array(3*h));if(a.numMorphNormals)for(a.__morphNormalsArrays=[],c=0,m=a.numMorphNormals;c<m;c++)a.__morphNormalsArrays.push(new Float32Array(3*h));a.__webglFaceCount=3*l;a.__webglLineCount=
2*k;if(g.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var p in g.attributes){var l=g.attributes[p],k={},t;for(t in l)k[t]=l[t];if(!k.__webglInitialized||k.createUniqueBuffers)k.__webglInitialized=!0,c=1,"v2"===k.type?c=2:"v3"===k.type?c=3:"v4"===k.type?c=4:"c"===k.type&&(c=3),k.size=c,k.array=new Float32Array(h*c),k.buffer=s.createBuffer(),k.buffer.belongsToAttribute=p,l.needsUpdate=!0,k.__original=l;a.__webglCustomAttributesList.push(k)}}a.__inittedArrays=
!0}function d(a,b){return a.material instanceof THREE.MeshFaceMaterial?a.material.materials[b.materialIndex]:a.material}function e(a){return a instanceof THREE.MeshBasicMaterial&&!a.envMap||a instanceof THREE.MeshDepthMaterial?!1:a&&void 0!==a.shading&&a.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function f(a){return a.map||a.lightMap||a.bumpMap||a.normalMap||a.specularMap||a instanceof THREE.ShaderMaterial?!0:!1}function g(a,b,c,d){for(var e in b){var f=b[e],g=c[e];if(0<=
f)if(g){var h=g.itemSize;s.bindBuffer(s.ARRAY_BUFFER,g.buffer);k(f);s.vertexAttribPointer(f,h,s.FLOAT,!1,0,d*h*4)}else a.defaultAttributeValues&&(2===a.defaultAttributeValues[e].length?s.vertexAttrib2fv(f,a.defaultAttributeValues[e]):3===a.defaultAttributeValues[e].length&&s.vertexAttrib3fv(f,a.defaultAttributeValues[e]))}m()}function h(){for(var a=0,b=ta.length;a<b;a++)ta[a]=0}function k(a){ta[a]=1;0===hb[a]&&(s.enableVertexAttribArray(a),hb[a]=1)}function m(){for(var a=0,b=hb.length;a<b;a++)hb[a]!==
ta[a]&&(s.disableVertexAttribArray(a),hb[a]=0)}function l(a,b){return a.z!==b.z?b.z-a.z:a.id-b.id}function n(a,b){return b[0]-a[0]}function t(a,b,c){if(a.length)for(var d=0,e=a.length;d<e;d++)Qa=ua=null,ea=aa=r=Ka=ya=la=Ha=-1,ib=!0,a[d].render(b,c,ga,da),Qa=ua=null,ea=aa=r=Ka=ya=la=Ha=-1,ib=!0}function q(a,b,c,d,e,f,g,h){var l,k,m,n;b?(k=a.length-1,n=b=-1):(k=0,b=a.length,n=1);for(var q=k;q!==b;q+=n)if(l=a[q],l.render){k=l.object;m=l.buffer;if(h)l=h;else{l=l[c];if(!l)continue;g&&P.setBlending(l.blending,
l.blendEquation,l.blendSrc,l.blendDst);P.setDepthTest(l.depthTest);P.setDepthWrite(l.depthWrite);E(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits)}P.setMaterialFaces(l);m instanceof THREE.BufferGeometry?P.renderBufferDirect(d,e,f,l,m,k):P.renderBuffer(d,e,f,l,m,k)}}function u(a,b,c,d,e,f,g){for(var h,l,k=0,m=a.length;k<m;k++)if(h=a[k],l=h.object,l.visible){if(g)h=g;else{h=h[b];if(!h)continue;f&&P.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst);P.setDepthTest(h.depthTest);
P.setDepthWrite(h.depthWrite);E(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}P.renderImmediateObject(c,d,e,h,l)}}function p(a,d){var e,f,g;if(void 0===a.__webglInit&&(a.__webglInit=!0,a._modelViewMatrix=new THREE.Matrix4,a._normalMatrix=new THREE.Matrix3,f=a.geometry,void 0!==f&&void 0===f.__webglInit))if(f.__webglInit=!0,f.addEventListener("dispose",Kb),f instanceof THREE.BufferGeometry)for(g in f.attributes){var h="index"===g?s.ELEMENT_ARRAY_BUFFER:s.ARRAY_BUFFER,l=f.attributes[g];
l.buffer=s.createBuffer();s.bindBuffer(h,l.buffer);s.bufferData(h,l.array,s.STATIC_DRAW)}else if(a instanceof THREE.Mesh)for(e in g=a.material,void 0===f.geometryGroups&&f.makeGroups(g instanceof THREE.MeshFaceMaterial,yb?4294967296:65535),f.geometryGroups){if(g=f.geometryGroups[e],!g.__webglVertexBuffer){h=g;h.__webglVertexBuffer=s.createBuffer();h.__webglNormalBuffer=s.createBuffer();h.__webglTangentBuffer=s.createBuffer();h.__webglColorBuffer=s.createBuffer();h.__webglUVBuffer=s.createBuffer();
h.__webglUV2Buffer=s.createBuffer();h.__webglSkinIndicesBuffer=s.createBuffer();h.__webglSkinWeightsBuffer=s.createBuffer();h.__webglFaceBuffer=s.createBuffer();h.__webglLineBuffer=s.createBuffer();var k=void 0;if(h.numMorphTargets)for(h.__webglMorphTargetsBuffers=[],l=0,k=h.numMorphTargets;l<k;l++)h.__webglMorphTargetsBuffers.push(s.createBuffer());if(h.numMorphNormals)for(h.__webglMorphNormalsBuffers=[],l=0,k=h.numMorphNormals;l<k;l++)h.__webglMorphNormalsBuffers.push(s.createBuffer());P.info.memory.geometries++;
c(g,a);f.verticesNeedUpdate=!0;f.morphTargetsNeedUpdate=!0;f.elementsNeedUpdate=!0;f.uvsNeedUpdate=!0;f.normalsNeedUpdate=!0;f.tangentsNeedUpdate=!0;f.colorsNeedUpdate=!0}}else a instanceof THREE.Line?f.__webglVertexBuffer||(g=f,g.__webglVertexBuffer=s.createBuffer(),g.__webglColorBuffer=s.createBuffer(),g.__webglLineDistanceBuffer=s.createBuffer(),P.info.memory.geometries++,g=f,h=g.vertices.length,g.__vertexArray=new Float32Array(3*h),g.__colorArray=new Float32Array(3*h),g.__lineDistanceArray=new Float32Array(1*
h),g.__webglLineCount=h,b(g,a),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0,f.lineDistancesNeedUpdate=!0):a instanceof THREE.ParticleSystem&&!f.__webglVertexBuffer&&(g=f,g.__webglVertexBuffer=s.createBuffer(),g.__webglColorBuffer=s.createBuffer(),P.info.memory.geometries++,g=f,h=g.vertices.length,g.__vertexArray=new Float32Array(3*h),g.__colorArray=new Float32Array(3*h),g.__sortArray=[],g.__webglParticleCount=h,b(g,a),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0);if(void 0===a.__webglActive){if(a instanceof
THREE.Mesh)if(f=a.geometry,f instanceof THREE.BufferGeometry)v(d.__webglObjects,f,a);else{if(f instanceof THREE.Geometry)for(e in f.geometryGroups)g=f.geometryGroups[e],v(d.__webglObjects,g,a)}else a instanceof THREE.Line||a instanceof THREE.ParticleSystem?(f=a.geometry,v(d.__webglObjects,f,a)):a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback?d.__webglObjectsImmediate.push({id:null,object:a,opaque:null,transparent:null,z:0}):a instanceof THREE.Sprite?d.__webglSprites.push(a):a instanceof
THREE.LensFlare&&d.__webglFlares.push(a);a.__webglActive=!0}}function v(a,b,c){a.push({id:null,buffer:b,object:c,opaque:null,transparent:null,z:0})}function x(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;return!1}function w(a){for(var b in a.attributes)a.attributes[b].needsUpdate=!1}function y(a,b){a instanceof THREE.Mesh||a instanceof THREE.ParticleSystem||a instanceof THREE.Line?M(b.__webglObjects,a):a instanceof THREE.Sprite?z(b.__webglSprites,a):a instanceof THREE.LensFlare?
z(b.__webglFlares,a):(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback)&&M(b.__webglObjectsImmediate,a);delete a.__webglActive}function M(a,b){for(var c=a.length-1;0<=c;c--)a[c].object===b&&a.splice(c,1)}function z(a,b){for(var c=a.length-1;0<=c;c--)a[c]===b&&a.splice(c,1)}function K(a,b,c,d,e){xa=0;d.needsUpdate&&(d.program&&cc(d),P.initMaterial(d,b,c,e),d.needsUpdate=!1);d.morphTargets&&!e.__webglMorphTargetInfluences&&(e.__webglMorphTargetInfluences=new Float32Array(P.maxMorphTargets));
var f=!1,g=d.program,h=g.uniforms,l=d.uniforms;g.id!==ua&&(s.useProgram(g.program),ua=g.id,f=!0);d.id!==ea&&(ea=d.id,f=!0);if(f||a!==Qa)s.uniformMatrix4fv(h.projectionMatrix,!1,a.projectionMatrix.elements),Y&&s.uniform1f(h.logDepthBufFC,2/(Math.log(a.far+1)/Math.LN2)),a!==Qa&&(Qa=a);if(d.skinning)if(kb&&e.skeleton.useVertexTexture){if(null!==h.boneTexture){var k=H();s.uniform1i(h.boneTexture,k);P.setTexture(e.skeleton.boneTexture,k)}null!==h.boneTextureWidth&&s.uniform1i(h.boneTextureWidth,e.skeleton.boneTextureWidth);
null!==h.boneTextureHeight&&s.uniform1i(h.boneTextureHeight,e.skeleton.boneTextureHeight)}else null!==h.boneGlobalMatrices&&s.uniformMatrix4fv(h.boneGlobalMatrices,!1,e.skeleton.boneMatrices);if(f){c&&d.fog&&(l.fogColor.value=c.color,c instanceof THREE.Fog?(l.fogNear.value=c.near,l.fogFar.value=c.far):c instanceof THREE.FogExp2&&(l.fogDensity.value=c.density));if(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d.lights){if(ib){var m,n=k=0,q=0,p,t,u,r=Ib,v=r.directional.colors,
w=r.directional.positions,x=r.point.colors,y=r.point.positions,J=r.point.distances,A=r.spot.colors,z=r.spot.positions,E=r.spot.distances,M=r.spot.directions,N=r.spot.anglesCos,K=r.spot.exponents,G=r.hemi.skyColors,I=r.hemi.groundColors,Q=r.hemi.positions,ra=0,Va=0,cb=0,pb=0,ha=0,ia=0,ja=0,qb=0,Ja=m=0;c=Ja=0;for(f=b.length;c<f;c++)if(m=b[c],!m.onlyShadow)if(p=m.color,t=m.intensity,u=m.distance,m instanceof THREE.AmbientLight)m.visible&&(P.gammaInput?(k+=p.r*p.r,n+=p.g*p.g,q+=p.b*p.b):(k+=p.r,n+=p.g,
q+=p.b));else if(m instanceof THREE.DirectionalLight){if(ha+=1,m.visible&&(qa.setFromMatrixPosition(m.matrixWorld),Fa.setFromMatrixPosition(m.target.matrixWorld),qa.sub(Fa),qa.normalize(),0!==qa.x||0!==qa.y||0!==qa.z))m=3*ra,w[m]=qa.x,w[m+1]=qa.y,w[m+2]=qa.z,P.gammaInput?D(v,m,p,t*t):L(v,m,p,t),ra+=1}else m instanceof THREE.PointLight?(ia+=1,m.visible&&(Ja=3*Va,P.gammaInput?D(x,Ja,p,t*t):L(x,Ja,p,t),Fa.setFromMatrixPosition(m.matrixWorld),y[Ja]=Fa.x,y[Ja+1]=Fa.y,y[Ja+2]=Fa.z,J[Va]=u,Va+=1)):m instanceof
THREE.SpotLight?(ja+=1,m.visible&&(Ja=3*cb,P.gammaInput?D(A,Ja,p,t*t):L(A,Ja,p,t),Fa.setFromMatrixPosition(m.matrixWorld),z[Ja]=Fa.x,z[Ja+1]=Fa.y,z[Ja+2]=Fa.z,E[cb]=u,qa.copy(Fa),Fa.setFromMatrixPosition(m.target.matrixWorld),qa.sub(Fa),qa.normalize(),M[Ja]=qa.x,M[Ja+1]=qa.y,M[Ja+2]=qa.z,N[cb]=Math.cos(m.angle),K[cb]=m.exponent,cb+=1)):m instanceof THREE.HemisphereLight&&(qb+=1,m.visible&&(qa.setFromMatrixPosition(m.matrixWorld),qa.normalize(),0!==qa.x||0!==qa.y||0!==qa.z))&&(u=3*pb,Q[u]=qa.x,Q[u+
1]=qa.y,Q[u+2]=qa.z,p=m.color,m=m.groundColor,P.gammaInput?(t*=t,D(G,u,p,t),D(I,u,m,t)):(L(G,u,p,t),L(I,u,m,t)),pb+=1);c=3*ra;for(f=Math.max(v.length,3*ha);c<f;c++)v[c]=0;c=3*Va;for(f=Math.max(x.length,3*ia);c<f;c++)x[c]=0;c=3*cb;for(f=Math.max(A.length,3*ja);c<f;c++)A[c]=0;c=3*pb;for(f=Math.max(G.length,3*qb);c<f;c++)G[c]=0;c=3*pb;for(f=Math.max(I.length,3*qb);c<f;c++)I[c]=0;r.directional.length=ra;r.point.length=Va;r.spot.length=cb;r.hemi.length=pb;r.ambient[0]=k;r.ambient[1]=n;r.ambient[2]=q;ib=
!1}c=Ib;l.ambientLightColor.value=c.ambient;l.directionalLightColor.value=c.directional.colors;l.directionalLightDirection.value=c.directional.positions;l.pointLightColor.value=c.point.colors;l.pointLightPosition.value=c.point.positions;l.pointLightDistance.value=c.point.distances;l.spotLightColor.value=c.spot.colors;l.spotLightPosition.value=c.spot.positions;l.spotLightDistance.value=c.spot.distances;l.spotLightDirection.value=c.spot.directions;l.spotLightAngleCos.value=c.spot.anglesCos;l.spotLightExponent.value=
c.spot.exponents;l.hemisphereLightSkyColor.value=c.hemi.skyColors;l.hemisphereLightGroundColor.value=c.hemi.groundColors;l.hemisphereLightDirection.value=c.hemi.positions}if(d instanceof THREE.MeshBasicMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshPhongMaterial){l.opacity.value=d.opacity;P.gammaInput?l.diffuse.value.copyGammaToLinear(d.color):l.diffuse.value=d.color;l.map.value=d.map;l.lightMap.value=d.lightMap;l.specularMap.value=d.specularMap;d.bumpMap&&(l.bumpMap.value=
d.bumpMap,l.bumpScale.value=d.bumpScale);d.normalMap&&(l.normalMap.value=d.normalMap,l.normalScale.value.copy(d.normalScale));var Ia;d.map?Ia=d.map:d.specularMap?Ia=d.specularMap:d.normalMap?Ia=d.normalMap:d.bumpMap&&(Ia=d.bumpMap);void 0!==Ia&&(c=Ia.offset,Ia=Ia.repeat,l.offsetRepeat.value.set(c.x,c.y,Ia.x,Ia.y));l.envMap.value=d.envMap;l.flipEnvMap.value=d.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;l.reflectivity.value=d.reflectivity;l.refractionRatio.value=d.refractionRatio;l.combine.value=
d.combine;l.useRefract.value=d.envMap&&d.envMap.mapping instanceof THREE.CubeRefractionMapping}d instanceof THREE.LineBasicMaterial?(l.diffuse.value=d.color,l.opacity.value=d.opacity):d instanceof THREE.LineDashedMaterial?(l.diffuse.value=d.color,l.opacity.value=d.opacity,l.dashSize.value=d.dashSize,l.totalSize.value=d.dashSize+d.gapSize,l.scale.value=d.scale):d instanceof THREE.ParticleSystemMaterial?(l.psColor.value=d.color,l.opacity.value=d.opacity,l.size.value=d.size,l.scale.value=C.height/2,
l.map.value=d.map):d instanceof THREE.MeshPhongMaterial?(l.shininess.value=d.shininess,P.gammaInput?(l.ambient.value.copyGammaToLinear(d.ambient),l.emissive.value.copyGammaToLinear(d.emissive),l.specular.value.copyGammaToLinear(d.specular)):(l.ambient.value=d.ambient,l.emissive.value=d.emissive,l.specular.value=d.specular),d.wrapAround&&l.wrapRGB.value.copy(d.wrapRGB)):d instanceof THREE.MeshLambertMaterial?(P.gammaInput?(l.ambient.value.copyGammaToLinear(d.ambient),l.emissive.value.copyGammaToLinear(d.emissive)):
(l.ambient.value=d.ambient,l.emissive.value=d.emissive),d.wrapAround&&l.wrapRGB.value.copy(d.wrapRGB)):d instanceof THREE.MeshDepthMaterial?(l.mNear.value=a.near,l.mFar.value=a.far,l.opacity.value=d.opacity):d instanceof THREE.MeshNormalMaterial&&(l.opacity.value=d.opacity);if(e.receiveShadow&&!d._shadowPass&&l.shadowMatrix)for(c=Ia=0,f=b.length;c<f;c++)k=b[c],k.castShadow&&(k instanceof THREE.SpotLight||k instanceof THREE.DirectionalLight&&!k.shadowCascade)&&(l.shadowMap.value[Ia]=k.shadowMap,l.shadowMapSize.value[Ia]=
k.shadowMapSize,l.shadowMatrix.value[Ia]=k.shadowMatrix,l.shadowDarkness.value[Ia]=k.shadowDarkness,l.shadowBias.value[Ia]=k.shadowBias,Ia++);b=d.uniformsList;l=0;for(Ia=b.length;l<Ia;l++)if(f=g.uniforms[b[l][1]])if(c=b[l][0],n=c.type,k=c.value,"i"===n)s.uniform1i(f,k);else if("f"===n)s.uniform1f(f,k);else if("v2"===n)s.uniform2f(f,k.x,k.y);else if("v3"===n)s.uniform3f(f,k.x,k.y,k.z);else if("v4"===n)s.uniform4f(f,k.x,k.y,k.z,k.w);else if("c"===n)s.uniform3f(f,k.r,k.g,k.b);else if("iv1"===n)s.uniform1iv(f,
k);else if("iv"===n)s.uniform3iv(f,k);else if("fv1"===n)s.uniform1fv(f,k);else if("fv"===n)s.uniform3fv(f,k);else if("v2v"===n){void 0===c._array&&(c._array=new Float32Array(2*k.length));n=0;for(q=k.length;n<q;n++)r=2*n,c._array[r]=k[n].x,c._array[r+1]=k[n].y;s.uniform2fv(f,c._array)}else if("v3v"===n){void 0===c._array&&(c._array=new Float32Array(3*k.length));n=0;for(q=k.length;n<q;n++)r=3*n,c._array[r]=k[n].x,c._array[r+1]=k[n].y,c._array[r+2]=k[n].z;s.uniform3fv(f,c._array)}else if("v4v"===n){void 0===
c._array&&(c._array=new Float32Array(4*k.length));n=0;for(q=k.length;n<q;n++)r=4*n,c._array[r]=k[n].x,c._array[r+1]=k[n].y,c._array[r+2]=k[n].z,c._array[r+3]=k[n].w;s.uniform4fv(f,c._array)}else if("m3"===n)s.uniformMatrix3fv(f,!1,k.elements);else if("m3v"===n){void 0===c._array&&(c._array=new Float32Array(9*k.length));n=0;for(q=k.length;n<q;n++)k[n].flattenToArrayOffset(c._array,9*n);s.uniformMatrix3fv(f,!1,c._array)}else if("m4"===n)s.uniformMatrix4fv(f,!1,k.elements);else if("m4v"===n){void 0===
c._array&&(c._array=new Float32Array(16*k.length));n=0;for(q=k.length;n<q;n++)k[n].flattenToArrayOffset(c._array,16*n);s.uniformMatrix4fv(f,!1,c._array)}else if("t"===n){if(r=k,k=H(),s.uniform1i(f,k),r)if(r.image instanceof Array&&6===r.image.length){if(c=r,f=k,6===c.image.length)if(c.needsUpdate){c.image.__webglTextureCube||(c.addEventListener("dispose",rb),c.image.__webglTextureCube=s.createTexture(),P.info.memory.textures++);s.activeTexture(s.TEXTURE0+f);s.bindTexture(s.TEXTURE_CUBE_MAP,c.image.__webglTextureCube);
s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,c.flipY);f=c instanceof THREE.CompressedTexture;k=[];for(n=0;6>n;n++)P.autoScaleCubemaps&&!f?(q=k,r=n,v=c.image[n],x=tc,v.width<=x&&v.height<=x||(y=Math.max(v.width,v.height),w=Math.floor(v.width*x/y),x=Math.floor(v.height*x/y),y=document.createElement("canvas"),y.width=w,y.height=x,y.getContext("2d").drawImage(v,0,0,v.width,v.height,0,0,w,x),v=y),q[r]=v):k[n]=c.image[n];n=k[0];q=THREE.Math.isPowerOfTwo(n.width)&&THREE.Math.isPowerOfTwo(n.height);r=B(c.format);
v=B(c.type);F(s.TEXTURE_CUBE_MAP,c,q);for(n=0;6>n;n++)if(f)for(x=k[n].mipmaps,y=0,J=x.length;y<J;y++)w=x[y],c.format!==THREE.RGBAFormat?s.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+n,y,r,w.width,w.height,0,w.data):s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+n,y,r,w.width,w.height,0,r,v,w.data);else s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,r,r,v,k[n]);c.generateMipmaps&&q&&s.generateMipmap(s.TEXTURE_CUBE_MAP);c.needsUpdate=!1;if(c.onUpdate)c.onUpdate()}else s.activeTexture(s.TEXTURE0+
f),s.bindTexture(s.TEXTURE_CUBE_MAP,c.image.__webglTextureCube)}else r instanceof THREE.WebGLRenderTargetCube?(c=r,s.activeTexture(s.TEXTURE0+k),s.bindTexture(s.TEXTURE_CUBE_MAP,c.__webglTexture)):P.setTexture(r,k)}else if("tv"===n){void 0===c._array&&(c._array=[]);n=0;for(q=c.value.length;n<q;n++)c._array[n]=H();s.uniform1iv(f,c._array);n=0;for(q=c.value.length;n<q;n++)r=c.value[n],k=c._array[n],r&&P.setTexture(r,k)}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+n);(d instanceof
THREE.ShaderMaterial||d instanceof THREE.MeshPhongMaterial||d.envMap)&&null!==h.cameraPosition&&(Fa.setFromMatrixPosition(a.matrixWorld),s.uniform3f(h.cameraPosition,Fa.x,Fa.y,Fa.z));(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.ShaderMaterial||d.skinning)&&null!==h.viewMatrix&&s.uniformMatrix4fv(h.viewMatrix,!1,a.matrixWorldInverse.elements)}s.uniformMatrix4fv(h.modelViewMatrix,!1,e._modelViewMatrix.elements);h.normalMatrix&&s.uniformMatrix3fv(h.normalMatrix,
!1,e._normalMatrix.elements);null!==h.modelMatrix&&s.uniformMatrix4fv(h.modelMatrix,!1,e.matrixWorld.elements);return g}function H(){var a=xa;a>=jb&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+jb);xa+=1;return a}function D(a,b,c,d){a[b]=c.r*c.r*d;a[b+1]=c.g*c.g*d;a[b+2]=c.b*c.b*d}function L(a,b,c,d){a[b]=c.r*d;a[b+1]=c.g*d;a[b+2]=c.b*d}function A(a){a!==oa&&(s.lineWidth(a),oa=a)}function E(a,b,c){Aa!==a&&(a?s.enable(s.POLYGON_OFFSET_FILL):s.disable(s.POLYGON_OFFSET_FILL),
Aa=a);!a||fa===b&&ka===c||(s.polygonOffset(b,c),fa=b,ka=c)}function F(a,b,c){c?(s.texParameteri(a,s.TEXTURE_WRAP_S,B(b.wrapS)),s.texParameteri(a,s.TEXTURE_WRAP_T,B(b.wrapT)),s.texParameteri(a,s.TEXTURE_MAG_FILTER,B(b.magFilter)),s.texParameteri(a,s.TEXTURE_MIN_FILTER,B(b.minFilter))):(s.texParameteri(a,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(a,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(a,s.TEXTURE_MAG_FILTER,N(b.magFilter)),s.texParameteri(a,s.TEXTURE_MIN_FILTER,N(b.minFilter)));
nb&&b.type!==THREE.FloatType&&(1<b.anisotropy||b.__oldAnisotropy)&&(s.texParameterf(a,nb.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,La)),b.__oldAnisotropy=b.anisotropy)}function J(a,b){s.bindRenderbuffer(s.RENDERBUFFER,a);b.depthBuffer&&!b.stencilBuffer?(s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,b.width,b.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,b.width,
b.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,a)):s.renderbufferStorage(s.RENDERBUFFER,s.RGBA4,b.width,b.height)}function N(a){return a===THREE.NearestFilter||a===THREE.NearestMipMapNearestFilter||a===THREE.NearestMipMapLinearFilter?s.NEAREST:s.LINEAR}function B(a){if(a===THREE.RepeatWrapping)return s.REPEAT;if(a===THREE.ClampToEdgeWrapping)return s.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return s.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return s.NEAREST;
if(a===THREE.NearestMipMapNearestFilter)return s.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return s.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return s.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return s.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return s.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return s.UNSIGNED_BYTE;if(a===THREE.UnsignedShort4444Type)return s.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return s.UNSIGNED_SHORT_5_5_5_1;
if(a===THREE.UnsignedShort565Type)return s.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return s.BYTE;if(a===THREE.ShortType)return s.SHORT;if(a===THREE.UnsignedShortType)return s.UNSIGNED_SHORT;if(a===THREE.IntType)return s.INT;if(a===THREE.UnsignedIntType)return s.UNSIGNED_INT;if(a===THREE.FloatType)return s.FLOAT;if(a===THREE.AlphaFormat)return s.ALPHA;if(a===THREE.RGBFormat)return s.RGB;if(a===THREE.RGBAFormat)return s.RGBA;if(a===THREE.LuminanceFormat)return s.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return s.LUMINANCE_ALPHA;
if(a===THREE.AddEquation)return s.FUNC_ADD;if(a===THREE.SubtractEquation)return s.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return s.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return s.ZERO;if(a===THREE.OneFactor)return s.ONE;if(a===THREE.SrcColorFactor)return s.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return s.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return s.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return s.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return s.DST_ALPHA;
if(a===THREE.OneMinusDstAlphaFactor)return s.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return s.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return s.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return s.SRC_ALPHA_SATURATE;if(void 0!==Wa){if(a===THREE.RGB_S3TC_DXT1_Format)return Wa.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return Wa.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return Wa.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return Wa.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}
console.log("THREE.WebGLRenderer",THREE.REVISION);a=a||{};var C=void 0!==a.canvas?a.canvas:document.createElement("canvas"),G=void 0!==a.context?a.context:null,Q=void 0!==a.precision?a.precision:"highp",Z=void 0!==a.alpha?a.alpha:!1,T=void 0!==a.depth?a.depth:!0,ba=void 0!==a.stencil?a.stencil:!0,V=void 0!==a.antialias?a.antialias:!1,S=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,I=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,Y=void 0!==a.logarithmicDepthBuffer?a.logarithmicDepthBuffer:
!1,$=new THREE.Color(0),ca=0;this.domElement=C;this.context=null;this.devicePixelRatio=void 0!==a.devicePixelRatio?a.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1;this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.shadowMapEnabled=this.gammaOutput=this.gammaInput=!1;this.shadowMapAutoUpdate=!0;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapCascade=this.shadowMapDebug=
!1;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=!0;this.renderPluginsPre=[];this.renderPluginsPost=[];this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var P=this,na=[],ua=null,Ca=null,ea=-1,aa=null,Qa=null,xa=0,Ka=-1,r=-1,Ha=-1,va=-1,Oa=-1,Ra=-1,la=-1,ya=-1,Aa=null,fa=null,ka=null,oa=null,U=0,Pa=0,Da=C.width,Ea=C.height,ga=0,da=0,ta=new Uint8Array(16),hb=new Uint8Array(16),Db=new THREE.Frustum,Hb=new THREE.Matrix4,Nb=new THREE.Matrix4,
Fa=new THREE.Vector3,qa=new THREE.Vector3,ib=!0,Ib={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},s,mb,xb,nb,Wa,yb;(function(){try{var a={alpha:Z,depth:T,stencil:ba,antialias:V,premultipliedAlpha:S,preserveDrawingBuffer:I};s=G||C.getContext("webgl",a)||C.getContext("experimental-webgl",
a);if(null===s)throw"Error creating WebGL context.";}catch(b){console.error(b)}mb=s.getExtension("OES_texture_float");s.getExtension("OES_texture_float_linear");xb=s.getExtension("OES_standard_derivatives");nb=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");Wa=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");
yb=s.getExtension("OES_element_index_uint");null===mb&&console.log("THREE.WebGLRenderer: Float textures not supported.");null===xb&&console.log("THREE.WebGLRenderer: Standard derivatives not supported.");null===nb&&console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported.");null===Wa&&console.log("THREE.WebGLRenderer: S3TC compressed textures not supported.");null===yb&&console.log("THREE.WebGLRenderer: elementindex as unsigned integer not supported.");void 0===s.getShaderPrecisionFormat&&
(s.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});Y&&s.getExtension("EXT_frag_depth")})();s.clearColor(0,0,0,1);s.clearDepth(1);s.clearStencil(0);s.enable(s.DEPTH_TEST);s.depthFunc(s.LEQUAL);s.frontFace(s.CCW);s.cullFace(s.BACK);s.enable(s.CULL_FACE);s.enable(s.BLEND);s.blendEquation(s.FUNC_ADD);s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA);s.viewport(U,Pa,Da,Ea);s.clearColor($.r,$.g,$.b,ca);this.context=s;var jb=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),ob=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS);
s.getParameter(s.MAX_TEXTURE_SIZE);var tc=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),La=nb?s.getParameter(nb.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Za=0<ob,kb=Za&&mb;Wa&&s.getParameter(s.COMPRESSED_TEXTURE_FORMATS);var uc=s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT),fc=s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT);s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.LOW_FLOAT);var vc=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT),zb=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,
s.MEDIUM_FLOAT);s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.LOW_FLOAT);var wc=0<uc.precision&&0<vc.precision,Ab=0<fc.precision&&0<zb.precision;"highp"!==Q||wc||(Ab?(Q="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(Q="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp")));"mediump"!==Q||Ab||(Q="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp"));this.getContext=function(){return s};this.supportsVertexTextures=function(){return Za};
this.supportsFloatTextures=function(){return mb};this.supportsStandardDerivatives=function(){return xb};this.supportsCompressedTextureS3TC=function(){return Wa};this.getMaxAnisotropy=function(){return La};this.getPrecision=function(){return Q};this.setSize=function(a,b,c){C.width=a*this.devicePixelRatio;C.height=b*this.devicePixelRatio;!1!==c&&(C.style.width=a+"px",C.style.height=b+"px");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){U=a*this.devicePixelRatio;Pa=b*this.devicePixelRatio;
Da=c*this.devicePixelRatio;Ea=d*this.devicePixelRatio;s.viewport(U,Pa,Da,Ea)};this.setScissor=function(a,b,c,d){s.scissor(a*this.devicePixelRatio,b*this.devicePixelRatio,c*this.devicePixelRatio,d*this.devicePixelRatio)};this.enableScissorTest=function(a){a?s.enable(s.SCISSOR_TEST):s.disable(s.SCISSOR_TEST)};this.setClearColor=function(a,b){$.set(a);ca=void 0!==b?b:1;s.clearColor($.r,$.g,$.b,ca)};this.setClearColorHex=function(a,b){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead.");
this.setClearColor(a,b)};this.getClearColor=function(){return $};this.getClearAlpha=function(){return ca};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=s.COLOR_BUFFER_BIT;if(void 0===b||b)d|=s.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=s.STENCIL_BUFFER_BIT;s.clear(d)};this.clearColor=function(){s.clear(s.COLOR_BUFFER_BIT)};this.clearDepth=function(){s.clear(s.DEPTH_BUFFER_BIT)};this.clearStencil=function(){s.clear(s.STENCIL_BUFFER_BIT)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);
this.clear(b,c,d)};this.addPostPlugin=function(a){a.init(this);this.renderPluginsPost.push(a)};this.addPrePlugin=function(a){a.init(this);this.renderPluginsPre.push(a)};this.updateShadowMap=function(a,b){ua=null;ea=aa=ya=la=Ha=-1;ib=!0;r=Ka=-1;this.shadowMapPlugin.update(a,b)};var Kb=function(a){a=a.target;a.removeEventListener("dispose",Kb);a.__webglInit=void 0;if(a instanceof THREE.BufferGeometry){var b=a.attributes,c;for(c in b)void 0!==b[c].buffer&&s.deleteBuffer(b[c].buffer);P.info.memory.geometries--}else if(void 0!==
a.geometryGroups)for(b in a.geometryGroups){c=a.geometryGroups[b];if(void 0!==c.numMorphTargets)for(var d=0,e=c.numMorphTargets;d<e;d++)s.deleteBuffer(c.__webglMorphTargetsBuffers[d]);if(void 0!==c.numMorphNormals)for(d=0,e=c.numMorphNormals;d<e;d++)s.deleteBuffer(c.__webglMorphNormalsBuffers[d]);gc(c)}else gc(a)},rb=function(a){a=a.target;a.removeEventListener("dispose",rb);a.image&&a.image.__webglTextureCube?s.deleteTexture(a.image.__webglTextureCube):a.__webglInit&&(a.__webglInit=!1,s.deleteTexture(a.__webglTexture));
P.info.memory.textures--},db=function(a){a=a.target;a.removeEventListener("dispose",db);if(a&&a.__webglTexture)if(s.deleteTexture(a.__webglTexture),a instanceof THREE.WebGLRenderTargetCube)for(var b=0;6>b;b++)s.deleteFramebuffer(a.__webglFramebuffer[b]),s.deleteRenderbuffer(a.__webglRenderbuffer[b]);else s.deleteFramebuffer(a.__webglFramebuffer),s.deleteRenderbuffer(a.__webglRenderbuffer);P.info.memory.textures--},Fb=function(a){a=a.target;a.removeEventListener("dispose",Fb);cc(a)},gc=function(a){void 0!==
a.__webglVertexBuffer&&s.deleteBuffer(a.__webglVertexBuffer);void 0!==a.__webglNormalBuffer&&s.deleteBuffer(a.__webglNormalBuffer);void 0!==a.__webglTangentBuffer&&s.deleteBuffer(a.__webglTangentBuffer);void 0!==a.__webglColorBuffer&&s.deleteBuffer(a.__webglColorBuffer);void 0!==a.__webglUVBuffer&&s.deleteBuffer(a.__webglUVBuffer);void 0!==a.__webglUV2Buffer&&s.deleteBuffer(a.__webglUV2Buffer);void 0!==a.__webglSkinIndicesBuffer&&s.deleteBuffer(a.__webglSkinIndicesBuffer);void 0!==a.__webglSkinWeightsBuffer&&
s.deleteBuffer(a.__webglSkinWeightsBuffer);void 0!==a.__webglFaceBuffer&&s.deleteBuffer(a.__webglFaceBuffer);void 0!==a.__webglLineBuffer&&s.deleteBuffer(a.__webglLineBuffer);void 0!==a.__webglLineDistanceBuffer&&s.deleteBuffer(a.__webglLineDistanceBuffer);if(void 0!==a.__webglCustomAttributesList)for(var b in a.__webglCustomAttributesList)s.deleteBuffer(a.__webglCustomAttributesList[b].buffer);P.info.memory.geometries--},cc=function(a){var b=a.program;if(void 0!==b){a.program=void 0;var c,d,e=!1;
a=0;for(c=na.length;a<c;a++)if(d=na[a],d.program===b){d.usedTimes--;0===d.usedTimes&&(e=!0);break}if(!0===e){e=[];a=0;for(c=na.length;a<c;a++)d=na[a],d.program!==b&&e.push(d);na=e;s.deleteProgram(b);P.info.memory.programs--}}};this.renderBufferImmediate=function(a,b,c){h();a.hasPositions&&!a.__webglVertexBuffer&&(a.__webglVertexBuffer=s.createBuffer());a.hasNormals&&!a.__webglNormalBuffer&&(a.__webglNormalBuffer=s.createBuffer());a.hasUvs&&!a.__webglUvBuffer&&(a.__webglUvBuffer=s.createBuffer());
a.hasColors&&!a.__webglColorBuffer&&(a.__webglColorBuffer=s.createBuffer());a.hasPositions&&(s.bindBuffer(s.ARRAY_BUFFER,a.__webglVertexBuffer),s.bufferData(s.ARRAY_BUFFER,a.positionArray,s.DYNAMIC_DRAW),k(b.attributes.position),s.vertexAttribPointer(b.attributes.position,3,s.FLOAT,!1,0,0));if(a.hasNormals){s.bindBuffer(s.ARRAY_BUFFER,a.__webglNormalBuffer);if(c.shading===THREE.FlatShading){var d,e,f,g,l,n,q,p,t,u,r,v=3*a.count;for(r=0;r<v;r+=9)u=a.normalArray,d=u[r],e=u[r+1],f=u[r+2],g=u[r+3],n=
u[r+4],p=u[r+5],l=u[r+6],q=u[r+7],t=u[r+8],d=(d+g+l)/3,e=(e+n+q)/3,f=(f+p+t)/3,u[r]=d,u[r+1]=e,u[r+2]=f,u[r+3]=d,u[r+4]=e,u[r+5]=f,u[r+6]=d,u[r+7]=e,u[r+8]=f}s.bufferData(s.ARRAY_BUFFER,a.normalArray,s.DYNAMIC_DRAW);k(b.attributes.normal);s.vertexAttribPointer(b.attributes.normal,3,s.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(s.bindBuffer(s.ARRAY_BUFFER,a.__webglUvBuffer),s.bufferData(s.ARRAY_BUFFER,a.uvArray,s.DYNAMIC_DRAW),k(b.attributes.uv),s.vertexAttribPointer(b.attributes.uv,2,s.FLOAT,!1,0,0));a.hasColors&&
c.vertexColors!==THREE.NoColors&&(s.bindBuffer(s.ARRAY_BUFFER,a.__webglColorBuffer),s.bufferData(s.ARRAY_BUFFER,a.colorArray,s.DYNAMIC_DRAW),k(b.attributes.color),s.vertexAttribPointer(b.attributes.color,3,s.FLOAT,!1,0,0));m();s.drawArrays(s.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,b,c,d,e,f){if(!1!==d.visible){var l=K(a,b,c,d,f);a=l.attributes;b=e.attributes;c=!1;l=16777215*e.id+2*l.id+(d.wireframe?1:0);l!==aa&&(aa=l,c=!0);c&&h();if(f instanceof THREE.Mesh)if(f=b.index){var k;
f.array instanceof Uint32Array?(l=s.UNSIGNED_INT,k=4):(l=s.UNSIGNED_SHORT,k=2);e=e.offsets;if(0===e.length)c&&(g(d,a,b,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,f.buffer)),s.drawElements(s.TRIANGLES,f.array.length,l,0),P.info.render.calls++,P.info.render.vertices+=f.array.length,P.info.render.faces+=f.array.length/3;else{c=!0;for(var m=0,n=e.length;m<n;m++){var q=e[m].index;c&&(g(d,a,b,q),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,f.buffer));s.drawElements(s.TRIANGLES,e[m].count,l,e[m].start*k);P.info.render.calls++;
P.info.render.vertices+=e[m].count;P.info.render.faces+=e[m].count/3}}}else c&&g(d,a,b,0),d=e.attributes.position,s.drawArrays(s.TRIANGLES,0,d.array.length/3),P.info.render.calls++,P.info.render.vertices+=d.array.length/3,P.info.render.faces+=d.array.length/9;else if(f instanceof THREE.ParticleSystem)c&&g(d,a,b,0),d=b.position,s.drawArrays(s.POINTS,0,d.array.length/3),P.info.render.calls++,P.info.render.points+=d.array.length/3;else if(f instanceof THREE.Line)if(l=f.type===THREE.LineStrip?s.LINE_STRIP:
s.LINES,A(d.linewidth),f=b.index)if(f.array instanceof Uint32Array?(l=s.UNSIGNED_INT,k=4):(l=s.UNSIGNED_SHORT,k=2),e=e.offsets,0===e.length)c&&(g(d,a,b,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,f.buffer)),s.drawElements(s.LINES,f.array.length,l,0),P.info.render.calls++,P.info.render.vertices+=f.array.length;else for(1<e.length&&(c=!0),m=0,n=e.length;m<n;m++)q=e[m].index,c&&(g(d,a,b,q),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,f.buffer)),s.drawElements(s.LINES,e[m].count,l,e[m].start*k),P.info.render.calls++,
P.info.render.vertices+=e[m].count;else c&&g(d,a,b,0),d=b.position,s.drawArrays(l,0,d.array.length/3),P.info.render.calls++,P.info.render.points+=d.array.length/3}};this.renderBuffer=function(a,b,c,d,e,f){if(!1!==d.visible){var g,l;c=K(a,b,c,d,f);b=c.attributes;a=!1;c=16777215*e.id+2*c.id+(d.wireframe?1:0);c!==aa&&(aa=c,a=!0);a&&h();if(!d.morphTargets&&0<=b.position)a&&(s.bindBuffer(s.ARRAY_BUFFER,e.__webglVertexBuffer),k(b.position),s.vertexAttribPointer(b.position,3,s.FLOAT,!1,0,0));else if(f.morphTargetBase){c=
d.program.attributes;-1!==f.morphTargetBase&&0<=c.position?(s.bindBuffer(s.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[f.morphTargetBase]),k(c.position),s.vertexAttribPointer(c.position,3,s.FLOAT,!1,0,0)):0<=c.position&&(s.bindBuffer(s.ARRAY_BUFFER,e.__webglVertexBuffer),k(c.position),s.vertexAttribPointer(c.position,3,s.FLOAT,!1,0,0));if(f.morphTargetForcedOrder.length){var q=0;l=f.morphTargetForcedOrder;for(g=f.morphTargetInfluences;q<d.numSupportedMorphTargets&&q<l.length;)0<=c["morphTarget"+q]&&
(s.bindBuffer(s.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[l[q]]),k(c["morphTarget"+q]),s.vertexAttribPointer(c["morphTarget"+q],3,s.FLOAT,!1,0,0)),0<=c["morphNormal"+q]&&d.morphNormals&&(s.bindBuffer(s.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[l[q]]),k(c["morphNormal"+q]),s.vertexAttribPointer(c["morphNormal"+q],3,s.FLOAT,!1,0,0)),f.__webglMorphTargetInfluences[q]=g[l[q]],q++}else{l=[];g=f.morphTargetInfluences;var p,t=g.length;for(p=0;p<t;p++)q=g[p],0<q&&l.push([q,p]);l.length>d.numSupportedMorphTargets?
(l.sort(n),l.length=d.numSupportedMorphTargets):l.length>d.numSupportedMorphNormals?l.sort(n):0===l.length&&l.push([0,0]);for(q=0;q<d.numSupportedMorphTargets;)l[q]?(p=l[q][1],0<=c["morphTarget"+q]&&(s.bindBuffer(s.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[p]),k(c["morphTarget"+q]),s.vertexAttribPointer(c["morphTarget"+q],3,s.FLOAT,!1,0,0)),0<=c["morphNormal"+q]&&d.morphNormals&&(s.bindBuffer(s.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[p]),k(c["morphNormal"+q]),s.vertexAttribPointer(c["morphNormal"+
q],3,s.FLOAT,!1,0,0)),f.__webglMorphTargetInfluences[q]=g[p]):f.__webglMorphTargetInfluences[q]=0,q++}null!==d.program.uniforms.morphTargetInfluences&&s.uniform1fv(d.program.uniforms.morphTargetInfluences,f.__webglMorphTargetInfluences)}if(a){if(e.__webglCustomAttributesList)for(g=0,l=e.__webglCustomAttributesList.length;g<l;g++)c=e.__webglCustomAttributesList[g],0<=b[c.buffer.belongsToAttribute]&&(s.bindBuffer(s.ARRAY_BUFFER,c.buffer),k(b[c.buffer.belongsToAttribute]),s.vertexAttribPointer(b[c.buffer.belongsToAttribute],
c.size,s.FLOAT,!1,0,0));0<=b.color&&(0<f.geometry.colors.length||0<f.geometry.faces.length?(s.bindBuffer(s.ARRAY_BUFFER,e.__webglColorBuffer),k(b.color),s.vertexAttribPointer(b.color,3,s.FLOAT,!1,0,0)):d.defaultAttributeValues&&s.vertexAttrib3fv(b.color,d.defaultAttributeValues.color));0<=b.normal&&(s.bindBuffer(s.ARRAY_BUFFER,e.__webglNormalBuffer),k(b.normal),s.vertexAttribPointer(b.normal,3,s.FLOAT,!1,0,0));0<=b.tangent&&(s.bindBuffer(s.ARRAY_BUFFER,e.__webglTangentBuffer),k(b.tangent),s.vertexAttribPointer(b.tangent,
4,s.FLOAT,!1,0,0));0<=b.uv&&(f.geometry.faceVertexUvs[0]?(s.bindBuffer(s.ARRAY_BUFFER,e.__webglUVBuffer),k(b.uv),s.vertexAttribPointer(b.uv,2,s.FLOAT,!1,0,0)):d.defaultAttributeValues&&s.vertexAttrib2fv(b.uv,d.defaultAttributeValues.uv));0<=b.uv2&&(f.geometry.faceVertexUvs[1]?(s.bindBuffer(s.ARRAY_BUFFER,e.__webglUV2Buffer),k(b.uv2),s.vertexAttribPointer(b.uv2,2,s.FLOAT,!1,0,0)):d.defaultAttributeValues&&s.vertexAttrib2fv(b.uv2,d.defaultAttributeValues.uv2));d.skinning&&0<=b.skinIndex&&0<=b.skinWeight&&
(s.bindBuffer(s.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),k(b.skinIndex),s.vertexAttribPointer(b.skinIndex,4,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),k(b.skinWeight),s.vertexAttribPointer(b.skinWeight,4,s.FLOAT,!1,0,0));0<=b.lineDistance&&(s.bindBuffer(s.ARRAY_BUFFER,e.__webglLineDistanceBuffer),k(b.lineDistance),s.vertexAttribPointer(b.lineDistance,1,s.FLOAT,!1,0,0))}m();f instanceof THREE.Mesh?(f=e.__typeArray===Uint32Array?s.UNSIGNED_INT:s.UNSIGNED_SHORT,d.wireframe?
(A(d.wireframeLinewidth),a&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),s.drawElements(s.LINES,e.__webglLineCount,f,0)):(a&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),s.drawElements(s.TRIANGLES,e.__webglFaceCount,f,0)),P.info.render.calls++,P.info.render.vertices+=e.__webglFaceCount,P.info.render.faces+=e.__webglFaceCount/3):f instanceof THREE.Line?(f=f.type===THREE.LineStrip?s.LINE_STRIP:s.LINES,A(d.linewidth),s.drawArrays(f,0,e.__webglLineCount),P.info.render.calls++):
f instanceof THREE.ParticleSystem&&(s.drawArrays(s.POINTS,0,e.__webglParticleCount),P.info.render.calls++,P.info.render.points+=e.__webglParticleCount)}};this.render=function(a,b,c,d){if(!1===b instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var e,f,g,h,k=a.__lights,m=a.fog;ea=-1;ib=!0;!0===a.autoUpdate&&a.updateMatrixWorld();void 0===b.parent&&b.updateMatrixWorld();b.matrixWorldInverse.getInverse(b.matrixWorld);Hb.multiplyMatrices(b.projectionMatrix,
b.matrixWorldInverse);Db.setFromMatrix(Hb);this.autoUpdateObjects&&this.initWebGLObjects(a);t(this.renderPluginsPre,a,b);P.info.render.calls=0;P.info.render.vertices=0;P.info.render.faces=0;P.info.render.points=0;this.setRenderTarget(c);(this.autoClear||d)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);h=a.__webglObjects;d=0;for(e=h.length;d<e;d++)if(f=h[d],g=f.object,f.id=d,f.render=!1,g.visible&&(!(g instanceof THREE.Mesh||g instanceof THREE.ParticleSystem)||!g.frustumCulled||
Db.intersectsObject(g))){var n=g;n._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,n.matrixWorld);n._normalMatrix.getNormalMatrix(n._modelViewMatrix);var n=f,p=n.object,r=n.buffer,v=p.geometry,p=p.material;p instanceof THREE.MeshFaceMaterial?(p=p.materials[v instanceof THREE.BufferGeometry?0:r.materialIndex],p.transparent?(n.transparent=p,n.opaque=null):(n.opaque=p,n.transparent=null)):p&&(p.transparent?(n.transparent=p,n.opaque=null):(n.opaque=p,n.transparent=null));f.render=!0;!0===this.sortObjects&&
(null!==g.renderDepth?f.z=g.renderDepth:(Fa.setFromMatrixPosition(g.matrixWorld),Fa.applyProjection(Hb),f.z=Fa.z))}this.sortObjects&&h.sort(l);h=a.__webglObjectsImmediate;d=0;for(e=h.length;d<e;d++)f=h[d],g=f.object,g.visible&&(g._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,g.matrixWorld),g._normalMatrix.getNormalMatrix(g._modelViewMatrix),g=f.object.material,g.transparent?(f.transparent=g,f.opaque=null):(f.opaque=g,f.transparent=null));a.overrideMaterial?(d=a.overrideMaterial,this.setBlending(d.blending,
d.blendEquation,d.blendSrc,d.blendDst),this.setDepthTest(d.depthTest),this.setDepthWrite(d.depthWrite),E(d.polygonOffset,d.polygonOffsetFactor,d.polygonOffsetUnits),q(a.__webglObjects,!1,"",b,k,m,!0,d),u(a.__webglObjectsImmediate,"",b,k,m,!1,d)):(d=null,this.setBlending(THREE.NoBlending),q(a.__webglObjects,!0,"opaque",b,k,m,!1,d),u(a.__webglObjectsImmediate,"opaque",b,k,m,!1,d),q(a.__webglObjects,!1,"transparent",b,k,m,!0,d),u(a.__webglObjectsImmediate,"transparent",b,k,m,!0,d));t(this.renderPluginsPost,
a,b);c&&c.generateMipmaps&&c.minFilter!==THREE.NearestFilter&&c.minFilter!==THREE.LinearFilter&&(c instanceof THREE.WebGLRenderTargetCube?(s.bindTexture(s.TEXTURE_CUBE_MAP,c.__webglTexture),s.generateMipmap(s.TEXTURE_CUBE_MAP),s.bindTexture(s.TEXTURE_CUBE_MAP,null)):(s.bindTexture(s.TEXTURE_2D,c.__webglTexture),s.generateMipmap(s.TEXTURE_2D),s.bindTexture(s.TEXTURE_2D,null)));this.setDepthTest(!0);this.setDepthWrite(!0)}};this.renderImmediateObject=function(a,b,c,d,e){var f=K(a,b,c,d,e);aa=-1;P.setMaterialFaces(d);
e.immediateRenderCallback?e.immediateRenderCallback(f,s,Db):e.render(function(a){P.renderBufferImmediate(a,f,d)})};this.initWebGLObjects=function(a){for(a.__webglObjects||(a.__webglObjects=[],a.__webglObjectsImmediate=[],a.__webglSprites=[],a.__webglFlares=[]);a.__objectsAdded.length;)p(a.__objectsAdded[0],a),a.__objectsAdded.splice(0,1);for(;a.__objectsRemoved.length;)y(a.__objectsRemoved[0],a),a.__objectsRemoved.splice(0,1);for(var b=0,g=a.__webglObjects.length;b<g;b++){var h=a.__webglObjects[b].object;
void 0===h.__webglInit&&(void 0!==h.__webglActive&&y(h,a),p(h,a));var l=h,k=l.geometry,m=void 0,q=void 0,t=void 0;if(k instanceof THREE.BufferGeometry){var u=s.DYNAMIC_DRAW,r=k.attributes,v=void 0,H=void 0;for(v in r)H=r[v],H.needsUpdate&&("index"===v?(s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,H.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,H.array,u)):(s.bindBuffer(s.ARRAY_BUFFER,H.buffer),s.bufferData(s.ARRAY_BUFFER,H.array,u)),H.needsUpdate=!1)}else if(l instanceof THREE.Mesh){for(var J=0,A=k.geometryGroupsList.length;J<
A;J++)if(m=k.geometryGroupsList[J],t=d(l,m),k.buffersNeedUpdate&&c(m,l),q=t.attributes&&x(t),k.verticesNeedUpdate||k.morphTargetsNeedUpdate||k.elementsNeedUpdate||k.uvsNeedUpdate||k.normalsNeedUpdate||k.colorsNeedUpdate||k.tangentsNeedUpdate||q){var z=m,D=l,E=s.DYNAMIC_DRAW,B=!k.dynamic,M=t;if(z.__inittedArrays){var F=e(M),N=M.vertexColors?M.vertexColors:!1,L=f(M),K=F===THREE.SmoothShading,C=void 0,G=void 0,P=void 0,I=void 0,Q=void 0,ea=void 0,Ca=void 0,ra=void 0,Va=void 0,cb=void 0,pb=void 0,ha=
void 0,ia=void 0,ja=void 0,qb=void 0,Ja=void 0,Ia=void 0,Ub=void 0,Vb=void 0,Wb=void 0,T=void 0,na=void 0,Z=void 0,U=void 0,S=void 0,ua=void 0,V=void 0,Y=void 0,Xb=void 0,aa=void 0,ca=void 0,$=void 0,xc=void 0,fa=void 0,Xa=void 0,Qa=void 0,xa=void 0,ba=void 0,Ka=void 0,oa=void 0,la=0,lb=0,Yb=0,ga=0,Zb=0,ka=0,Ya=0,qa=0,eb=0,Ga=0,Ma=0,R=0,da=void 0,va=z.__vertexArray,Aa=z.__uvArray,Da=z.__uv2Array,Ha=z.__normalArray,$a=z.__tangentArray,ya=z.__colorArray,ta=z.__skinIndexArray,ab=z.__skinWeightArray,
Pa=z.__morphTargetsArrays,Ea=z.__morphNormalsArrays,La=z.__webglCustomAttributesList,O=void 0,Ra=z.__faceArray,Oa=z.__lineArray,Sa=D.geometry,Wa=Sa.elementsNeedUpdate,Za=Sa.uvsNeedUpdate,db=Sa.normalsNeedUpdate,ib=Sa.tangentsNeedUpdate,kb=Sa.colorsNeedUpdate,nb=Sa.morphTargetsNeedUpdate,hb=Sa.vertices,pa=z.faces3,sb=Sa.faces,mb=Sa.faceVertexUvs[0],yb=Sa.faceVertexUvs[1],rb=Sa.skinIndices,hc=Sa.skinWeights,ic=Sa.morphTargets,Hc=Sa.morphNormals;if(Sa.verticesNeedUpdate){C=0;for(G=pa.length;C<G;C++)I=
sb[pa[C]],ha=hb[I.a],ia=hb[I.b],ja=hb[I.c],va[lb]=ha.x,va[lb+1]=ha.y,va[lb+2]=ha.z,va[lb+3]=ia.x,va[lb+4]=ia.y,va[lb+5]=ia.z,va[lb+6]=ja.x,va[lb+7]=ja.y,va[lb+8]=ja.z,lb+=9;s.bindBuffer(s.ARRAY_BUFFER,z.__webglVertexBuffer);s.bufferData(s.ARRAY_BUFFER,va,E)}if(nb)for(Xa=0,Qa=ic.length;Xa<Qa;Xa++){C=Ma=0;for(G=pa.length;C<G;C++)Ka=pa[C],I=sb[Ka],ha=ic[Xa].vertices[I.a],ia=ic[Xa].vertices[I.b],ja=ic[Xa].vertices[I.c],xa=Pa[Xa],xa[Ma]=ha.x,xa[Ma+1]=ha.y,xa[Ma+2]=ha.z,xa[Ma+3]=ia.x,xa[Ma+4]=ia.y,xa[Ma+
5]=ia.z,xa[Ma+6]=ja.x,xa[Ma+7]=ja.y,xa[Ma+8]=ja.z,M.morphNormals&&(K?(oa=Hc[Xa].vertexNormals[Ka],Ub=oa.a,Vb=oa.b,Wb=oa.c):Wb=Vb=Ub=Hc[Xa].faceNormals[Ka],ba=Ea[Xa],ba[Ma]=Ub.x,ba[Ma+1]=Ub.y,ba[Ma+2]=Ub.z,ba[Ma+3]=Vb.x,ba[Ma+4]=Vb.y,ba[Ma+5]=Vb.z,ba[Ma+6]=Wb.x,ba[Ma+7]=Wb.y,ba[Ma+8]=Wb.z),Ma+=9;s.bindBuffer(s.ARRAY_BUFFER,z.__webglMorphTargetsBuffers[Xa]);s.bufferData(s.ARRAY_BUFFER,Pa[Xa],E);M.morphNormals&&(s.bindBuffer(s.ARRAY_BUFFER,z.__webglMorphNormalsBuffers[Xa]),s.bufferData(s.ARRAY_BUFFER,
Ea[Xa],E))}if(hc.length){C=0;for(G=pa.length;C<G;C++)I=sb[pa[C]],U=hc[I.a],S=hc[I.b],ua=hc[I.c],ab[Ga]=U.x,ab[Ga+1]=U.y,ab[Ga+2]=U.z,ab[Ga+3]=U.w,ab[Ga+4]=S.x,ab[Ga+5]=S.y,ab[Ga+6]=S.z,ab[Ga+7]=S.w,ab[Ga+8]=ua.x,ab[Ga+9]=ua.y,ab[Ga+10]=ua.z,ab[Ga+11]=ua.w,V=rb[I.a],Y=rb[I.b],Xb=rb[I.c],ta[Ga]=V.x,ta[Ga+1]=V.y,ta[Ga+2]=V.z,ta[Ga+3]=V.w,ta[Ga+4]=Y.x,ta[Ga+5]=Y.y,ta[Ga+6]=Y.z,ta[Ga+7]=Y.w,ta[Ga+8]=Xb.x,ta[Ga+9]=Xb.y,ta[Ga+10]=Xb.z,ta[Ga+11]=Xb.w,Ga+=12;0<Ga&&(s.bindBuffer(s.ARRAY_BUFFER,z.__webglSkinIndicesBuffer),
s.bufferData(s.ARRAY_BUFFER,ta,E),s.bindBuffer(s.ARRAY_BUFFER,z.__webglSkinWeightsBuffer),s.bufferData(s.ARRAY_BUFFER,ab,E))}if(kb&&N){C=0;for(G=pa.length;C<G;C++)I=sb[pa[C]],Ca=I.vertexColors,ra=I.color,3===Ca.length&&N===THREE.VertexColors?(T=Ca[0],na=Ca[1],Z=Ca[2]):Z=na=T=ra,ya[eb]=T.r,ya[eb+1]=T.g,ya[eb+2]=T.b,ya[eb+3]=na.r,ya[eb+4]=na.g,ya[eb+5]=na.b,ya[eb+6]=Z.r,ya[eb+7]=Z.g,ya[eb+8]=Z.b,eb+=9;0<eb&&(s.bindBuffer(s.ARRAY_BUFFER,z.__webglColorBuffer),s.bufferData(s.ARRAY_BUFFER,ya,E))}if(ib&&
Sa.hasTangents){C=0;for(G=pa.length;C<G;C++)I=sb[pa[C]],Va=I.vertexTangents,qb=Va[0],Ja=Va[1],Ia=Va[2],$a[Ya]=qb.x,$a[Ya+1]=qb.y,$a[Ya+2]=qb.z,$a[Ya+3]=qb.w,$a[Ya+4]=Ja.x,$a[Ya+5]=Ja.y,$a[Ya+6]=Ja.z,$a[Ya+7]=Ja.w,$a[Ya+8]=Ia.x,$a[Ya+9]=Ia.y,$a[Ya+10]=Ia.z,$a[Ya+11]=Ia.w,Ya+=12;s.bindBuffer(s.ARRAY_BUFFER,z.__webglTangentBuffer);s.bufferData(s.ARRAY_BUFFER,$a,E)}if(db&&F){C=0;for(G=pa.length;C<G;C++)if(I=sb[pa[C]],Q=I.vertexNormals,ea=I.normal,3===Q.length&&K)for(aa=0;3>aa;aa++)$=Q[aa],Ha[ka]=$.x,
Ha[ka+1]=$.y,Ha[ka+2]=$.z,ka+=3;else for(aa=0;3>aa;aa++)Ha[ka]=ea.x,Ha[ka+1]=ea.y,Ha[ka+2]=ea.z,ka+=3;s.bindBuffer(s.ARRAY_BUFFER,z.__webglNormalBuffer);s.bufferData(s.ARRAY_BUFFER,Ha,E)}if(Za&&mb&&L){C=0;for(G=pa.length;C<G;C++)if(P=pa[C],cb=mb[P],void 0!==cb)for(aa=0;3>aa;aa++)xc=cb[aa],Aa[Yb]=xc.x,Aa[Yb+1]=xc.y,Yb+=2;0<Yb&&(s.bindBuffer(s.ARRAY_BUFFER,z.__webglUVBuffer),s.bufferData(s.ARRAY_BUFFER,Aa,E))}if(Za&&yb&&L){C=0;for(G=pa.length;C<G;C++)if(P=pa[C],pb=yb[P],void 0!==pb)for(aa=0;3>aa;aa++)fa=
pb[aa],Da[ga]=fa.x,Da[ga+1]=fa.y,ga+=2;0<ga&&(s.bindBuffer(s.ARRAY_BUFFER,z.__webglUV2Buffer),s.bufferData(s.ARRAY_BUFFER,Da,E))}if(Wa){C=0;for(G=pa.length;C<G;C++)Ra[Zb]=la,Ra[Zb+1]=la+1,Ra[Zb+2]=la+2,Zb+=3,Oa[qa]=la,Oa[qa+1]=la+1,Oa[qa+2]=la,Oa[qa+3]=la+2,Oa[qa+4]=la+1,Oa[qa+5]=la+2,qa+=6,la+=3;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,z.__webglFaceBuffer);s.bufferData(s.ELEMENT_ARRAY_BUFFER,Ra,E);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,z.__webglLineBuffer);s.bufferData(s.ELEMENT_ARRAY_BUFFER,Oa,E)}if(La)for(aa=
0,ca=La.length;aa<ca;aa++)if(O=La[aa],O.__original.needsUpdate){R=0;if(1===O.size)if(void 0===O.boundTo||"vertices"===O.boundTo)for(C=0,G=pa.length;C<G;C++)I=sb[pa[C]],O.array[R]=O.value[I.a],O.array[R+1]=O.value[I.b],O.array[R+2]=O.value[I.c],R+=3;else{if("faces"===O.boundTo)for(C=0,G=pa.length;C<G;C++)da=O.value[pa[C]],O.array[R]=da,O.array[R+1]=da,O.array[R+2]=da,R+=3}else if(2===O.size)if(void 0===O.boundTo||"vertices"===O.boundTo)for(C=0,G=pa.length;C<G;C++)I=sb[pa[C]],ha=O.value[I.a],ia=O.value[I.b],
ja=O.value[I.c],O.array[R]=ha.x,O.array[R+1]=ha.y,O.array[R+2]=ia.x,O.array[R+3]=ia.y,O.array[R+4]=ja.x,O.array[R+5]=ja.y,R+=6;else{if("faces"===O.boundTo)for(C=0,G=pa.length;C<G;C++)ja=ia=ha=da=O.value[pa[C]],O.array[R]=ha.x,O.array[R+1]=ha.y,O.array[R+2]=ia.x,O.array[R+3]=ia.y,O.array[R+4]=ja.x,O.array[R+5]=ja.y,R+=6}else if(3===O.size){var sa;sa="c"===O.type?["r","g","b"]:["x","y","z"];if(void 0===O.boundTo||"vertices"===O.boundTo)for(C=0,G=pa.length;C<G;C++)I=sb[pa[C]],ha=O.value[I.a],ia=O.value[I.b],
ja=O.value[I.c],O.array[R]=ha[sa[0]],O.array[R+1]=ha[sa[1]],O.array[R+2]=ha[sa[2]],O.array[R+3]=ia[sa[0]],O.array[R+4]=ia[sa[1]],O.array[R+5]=ia[sa[2]],O.array[R+6]=ja[sa[0]],O.array[R+7]=ja[sa[1]],O.array[R+8]=ja[sa[2]],R+=9;else if("faces"===O.boundTo)for(C=0,G=pa.length;C<G;C++)ja=ia=ha=da=O.value[pa[C]],O.array[R]=ha[sa[0]],O.array[R+1]=ha[sa[1]],O.array[R+2]=ha[sa[2]],O.array[R+3]=ia[sa[0]],O.array[R+4]=ia[sa[1]],O.array[R+5]=ia[sa[2]],O.array[R+6]=ja[sa[0]],O.array[R+7]=ja[sa[1]],O.array[R+
8]=ja[sa[2]],R+=9;else if("faceVertices"===O.boundTo)for(C=0,G=pa.length;C<G;C++)da=O.value[pa[C]],ha=da[0],ia=da[1],ja=da[2],O.array[R]=ha[sa[0]],O.array[R+1]=ha[sa[1]],O.array[R+2]=ha[sa[2]],O.array[R+3]=ia[sa[0]],O.array[R+4]=ia[sa[1]],O.array[R+5]=ia[sa[2]],O.array[R+6]=ja[sa[0]],O.array[R+7]=ja[sa[1]],O.array[R+8]=ja[sa[2]],R+=9}else if(4===O.size)if(void 0===O.boundTo||"vertices"===O.boundTo)for(C=0,G=pa.length;C<G;C++)I=sb[pa[C]],ha=O.value[I.a],ia=O.value[I.b],ja=O.value[I.c],O.array[R]=ha.x,
O.array[R+1]=ha.y,O.array[R+2]=ha.z,O.array[R+3]=ha.w,O.array[R+4]=ia.x,O.array[R+5]=ia.y,O.array[R+6]=ia.z,O.array[R+7]=ia.w,O.array[R+8]=ja.x,O.array[R+9]=ja.y,O.array[R+10]=ja.z,O.array[R+11]=ja.w,R+=12;else if("faces"===O.boundTo)for(C=0,G=pa.length;C<G;C++)ja=ia=ha=da=O.value[pa[C]],O.array[R]=ha.x,O.array[R+1]=ha.y,O.array[R+2]=ha.z,O.array[R+3]=ha.w,O.array[R+4]=ia.x,O.array[R+5]=ia.y,O.array[R+6]=ia.z,O.array[R+7]=ia.w,O.array[R+8]=ja.x,O.array[R+9]=ja.y,O.array[R+10]=ja.z,O.array[R+11]=ja.w,
R+=12;else if("faceVertices"===O.boundTo)for(C=0,G=pa.length;C<G;C++)da=O.value[pa[C]],ha=da[0],ia=da[1],ja=da[2],O.array[R]=ha.x,O.array[R+1]=ha.y,O.array[R+2]=ha.z,O.array[R+3]=ha.w,O.array[R+4]=ia.x,O.array[R+5]=ia.y,O.array[R+6]=ia.z,O.array[R+7]=ia.w,O.array[R+8]=ja.x,O.array[R+9]=ja.y,O.array[R+10]=ja.z,O.array[R+11]=ja.w,R+=12;s.bindBuffer(s.ARRAY_BUFFER,O.buffer);s.bufferData(s.ARRAY_BUFFER,O.array,E)}B&&(delete z.__inittedArrays,delete z.__colorArray,delete z.__normalArray,delete z.__tangentArray,
delete z.__uvArray,delete z.__uv2Array,delete z.__faceArray,delete z.__vertexArray,delete z.__lineArray,delete z.__skinIndexArray,delete z.__skinWeightArray)}}k.verticesNeedUpdate=!1;k.morphTargetsNeedUpdate=!1;k.elementsNeedUpdate=!1;k.uvsNeedUpdate=!1;k.normalsNeedUpdate=!1;k.colorsNeedUpdate=!1;k.tangentsNeedUpdate=!1;k.buffersNeedUpdate=!1;t.attributes&&w(t)}else if(l instanceof THREE.Line){t=d(l,k);q=t.attributes&&x(t);if(k.verticesNeedUpdate||k.colorsNeedUpdate||k.lineDistancesNeedUpdate||q){var bb=
k,jc=s.DYNAMIC_DRAW,$b=void 0,ac=void 0,bc=void 0,kc=void 0,Ba=void 0,lc=void 0,Ic=bb.vertices,Jc=bb.colors,Kc=bb.lineDistances,Xc=Ic.length,Yc=Jc.length,Zc=Kc.length,mc=bb.__vertexArray,nc=bb.__colorArray,Lc=bb.__lineDistanceArray,$c=bb.colorsNeedUpdate,ad=bb.lineDistancesNeedUpdate,yc=bb.__webglCustomAttributesList,oc=void 0,Db=void 0,Na=void 0,Pb=void 0,Ta=void 0,za=void 0;if(bb.verticesNeedUpdate){for($b=0;$b<Xc;$b++)kc=Ic[$b],Ba=3*$b,mc[Ba]=kc.x,mc[Ba+1]=kc.y,mc[Ba+2]=kc.z;s.bindBuffer(s.ARRAY_BUFFER,
bb.__webglVertexBuffer);s.bufferData(s.ARRAY_BUFFER,mc,jc)}if($c){for(ac=0;ac<Yc;ac++)lc=Jc[ac],Ba=3*ac,nc[Ba]=lc.r,nc[Ba+1]=lc.g,nc[Ba+2]=lc.b;s.bindBuffer(s.ARRAY_BUFFER,bb.__webglColorBuffer);s.bufferData(s.ARRAY_BUFFER,nc,jc)}if(ad){for(bc=0;bc<Zc;bc++)Lc[bc]=Kc[bc];s.bindBuffer(s.ARRAY_BUFFER,bb.__webglLineDistanceBuffer);s.bufferData(s.ARRAY_BUFFER,Lc,jc)}if(yc)for(oc=0,Db=yc.length;oc<Db;oc++)if(za=yc[oc],za.needsUpdate&&(void 0===za.boundTo||"vertices"===za.boundTo)){Ba=0;Pb=za.value.length;
if(1===za.size)for(Na=0;Na<Pb;Na++)za.array[Na]=za.value[Na];else if(2===za.size)for(Na=0;Na<Pb;Na++)Ta=za.value[Na],za.array[Ba]=Ta.x,za.array[Ba+1]=Ta.y,Ba+=2;else if(3===za.size)if("c"===za.type)for(Na=0;Na<Pb;Na++)Ta=za.value[Na],za.array[Ba]=Ta.r,za.array[Ba+1]=Ta.g,za.array[Ba+2]=Ta.b,Ba+=3;else for(Na=0;Na<Pb;Na++)Ta=za.value[Na],za.array[Ba]=Ta.x,za.array[Ba+1]=Ta.y,za.array[Ba+2]=Ta.z,Ba+=3;else if(4===za.size)for(Na=0;Na<Pb;Na++)Ta=za.value[Na],za.array[Ba]=Ta.x,za.array[Ba+1]=Ta.y,za.array[Ba+
2]=Ta.z,za.array[Ba+3]=Ta.w,Ba+=4;s.bindBuffer(s.ARRAY_BUFFER,za.buffer);s.bufferData(s.ARRAY_BUFFER,za.array,jc)}}k.verticesNeedUpdate=!1;k.colorsNeedUpdate=!1;k.lineDistancesNeedUpdate=!1;t.attributes&&w(t)}else if(l instanceof THREE.ParticleSystem){t=d(l,k);q=t.attributes&&x(t);if(k.verticesNeedUpdate||k.colorsNeedUpdate||l.sortParticles||q){var tb=k,xb=s.DYNAMIC_DRAW,jb=l,Ua=void 0,ub=void 0,vb=void 0,X=void 0,wb=void 0,Gb=void 0,ob=tb.vertices,zb=ob.length,Ab=tb.colors,Fb=Ab.length,Lb=tb.__vertexArray,
Mb=tb.__colorArray,Bb=tb.__sortArray,Ib=tb.verticesNeedUpdate,Kb=tb.colorsNeedUpdate,Cb=tb.__webglCustomAttributesList,fb=void 0,Qb=void 0,ma=void 0,gb=void 0,wa=void 0,W=void 0;if(jb.sortParticles){Nb.copy(Hb);Nb.multiply(jb.matrixWorld);for(Ua=0;Ua<zb;Ua++)vb=ob[Ua],Fa.copy(vb),Fa.applyProjection(Nb),Bb[Ua]=[Fa.z,Ua];Bb.sort(n);for(Ua=0;Ua<zb;Ua++)vb=ob[Bb[Ua][1]],X=3*Ua,Lb[X]=vb.x,Lb[X+1]=vb.y,Lb[X+2]=vb.z;for(ub=0;ub<Fb;ub++)X=3*ub,Gb=Ab[Bb[ub][1]],Mb[X]=Gb.r,Mb[X+1]=Gb.g,Mb[X+2]=Gb.b;if(Cb)for(fb=
0,Qb=Cb.length;fb<Qb;fb++)if(W=Cb[fb],void 0===W.boundTo||"vertices"===W.boundTo)if(X=0,gb=W.value.length,1===W.size)for(ma=0;ma<gb;ma++)wb=Bb[ma][1],W.array[ma]=W.value[wb];else if(2===W.size)for(ma=0;ma<gb;ma++)wb=Bb[ma][1],wa=W.value[wb],W.array[X]=wa.x,W.array[X+1]=wa.y,X+=2;else if(3===W.size)if("c"===W.type)for(ma=0;ma<gb;ma++)wb=Bb[ma][1],wa=W.value[wb],W.array[X]=wa.r,W.array[X+1]=wa.g,W.array[X+2]=wa.b,X+=3;else for(ma=0;ma<gb;ma++)wb=Bb[ma][1],wa=W.value[wb],W.array[X]=wa.x,W.array[X+1]=
wa.y,W.array[X+2]=wa.z,X+=3;else if(4===W.size)for(ma=0;ma<gb;ma++)wb=Bb[ma][1],wa=W.value[wb],W.array[X]=wa.x,W.array[X+1]=wa.y,W.array[X+2]=wa.z,W.array[X+3]=wa.w,X+=4}else{if(Ib)for(Ua=0;Ua<zb;Ua++)vb=ob[Ua],X=3*Ua,Lb[X]=vb.x,Lb[X+1]=vb.y,Lb[X+2]=vb.z;if(Kb)for(ub=0;ub<Fb;ub++)Gb=Ab[ub],X=3*ub,Mb[X]=Gb.r,Mb[X+1]=Gb.g,Mb[X+2]=Gb.b;if(Cb)for(fb=0,Qb=Cb.length;fb<Qb;fb++)if(W=Cb[fb],W.needsUpdate&&(void 0===W.boundTo||"vertices"===W.boundTo))if(gb=W.value.length,X=0,1===W.size)for(ma=0;ma<gb;ma++)W.array[ma]=
W.value[ma];else if(2===W.size)for(ma=0;ma<gb;ma++)wa=W.value[ma],W.array[X]=wa.x,W.array[X+1]=wa.y,X+=2;else if(3===W.size)if("c"===W.type)for(ma=0;ma<gb;ma++)wa=W.value[ma],W.array[X]=wa.r,W.array[X+1]=wa.g,W.array[X+2]=wa.b,X+=3;else for(ma=0;ma<gb;ma++)wa=W.value[ma],W.array[X]=wa.x,W.array[X+1]=wa.y,W.array[X+2]=wa.z,X+=3;else if(4===W.size)for(ma=0;ma<gb;ma++)wa=W.value[ma],W.array[X]=wa.x,W.array[X+1]=wa.y,W.array[X+2]=wa.z,W.array[X+3]=wa.w,X+=4}if(Ib||jb.sortParticles)s.bindBuffer(s.ARRAY_BUFFER,
tb.__webglVertexBuffer),s.bufferData(s.ARRAY_BUFFER,Lb,xb);if(Kb||jb.sortParticles)s.bindBuffer(s.ARRAY_BUFFER,tb.__webglColorBuffer),s.bufferData(s.ARRAY_BUFFER,Mb,xb);if(Cb)for(fb=0,Qb=Cb.length;fb<Qb;fb++)if(W=Cb[fb],W.needsUpdate||jb.sortParticles)s.bindBuffer(s.ARRAY_BUFFER,W.buffer),s.bufferData(s.ARRAY_BUFFER,W.array,xb)}k.verticesNeedUpdate=!1;k.colorsNeedUpdate=!1;t.attributes&&w(t)}}};this.initMaterial=function(a,b,c,d){var e,f,g,h;a.addEventListener("dispose",Fb);var l,k,m,n;a instanceof
THREE.MeshDepthMaterial?n="depth":a instanceof THREE.MeshNormalMaterial?n="normal":a instanceof THREE.MeshBasicMaterial?n="basic":a instanceof THREE.MeshLambertMaterial?n="lambert":a instanceof THREE.MeshPhongMaterial?n="phong":a instanceof THREE.LineBasicMaterial?n="basic":a instanceof THREE.LineDashedMaterial?n="dashed":a instanceof THREE.ParticleSystemMaterial&&(n="particle_basic");n&&(e=THREE.ShaderLib[n],a.uniforms=THREE.UniformsUtils.clone(e.uniforms),a.vertexShader=e.vertexShader,a.fragmentShader=
e.fragmentShader);m=h=g=f=e=0;for(var q=b.length;m<q;m++){var p=b[m];p.onlyShadow||!1===p.visible||(p instanceof THREE.DirectionalLight&&e++,p instanceof THREE.PointLight&&f++,p instanceof THREE.SpotLight&&g++,p instanceof THREE.HemisphereLight&&h++)}q=m=0;for(p=b.length;q<p;q++){var t=b[q];t.castShadow&&(t instanceof THREE.SpotLight&&m++,t instanceof THREE.DirectionalLight&&!t.shadowCascade&&m++)}b=m;kb&&d&&d.skeleton&&d.skeleton.useVertexTexture?m=1024:(m=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),
m=Math.floor((m-20)/4),void 0!==d&&d instanceof THREE.SkinnedMesh&&(m=Math.min(d.skeleton.bones.length,m),m<d.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+d.skeleton.bones.length+", this GPU supports just "+m+" (try OpenGL instead of ANGLE)")));c={precision:Q,supportsVertexTextures:Za,map:!!a.map,envMap:!!a.envMap,lightMap:!!a.lightMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,specularMap:!!a.specularMap,vertexColors:a.vertexColors,fog:c,useFog:a.fog,fogExp:c instanceof
THREE.FogExp2,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:Y,skinning:a.skinning,maxBones:m,useVertexTexture:kb&&d&&d.skeleton&&d.skeleton.useVertexTexture,morphTargets:a.morphTargets,morphNormals:a.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:e,maxPointLights:f,maxSpotLights:g,maxHemiLights:h,maxShadows:b,shadowMapEnabled:this.shadowMapEnabled&&d.receiveShadow&&0<b,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,
shadowMapCascade:this.shadowMapCascade,alphaTest:a.alphaTest,metal:a.metal,wrapAround:a.wrapAround,doubleSided:a.side===THREE.DoubleSide,flipSided:a.side===THREE.BackSide};d=[];n?d.push(n):(d.push(a.fragmentShader),d.push(a.vertexShader));for(var u in a.defines)d.push(u),d.push(a.defines[u]);for(k in c)d.push(k),d.push(c[k]);n=d.join();var r;k=0;for(u=na.length;k<u;k++)if(d=na[k],d.code===n){r=d;r.usedTimes++;break}void 0===r&&(r=new THREE.WebGLProgram(this,n,a,c),na.push(r),P.info.memory.programs=
na.length);a.program=r;r=a.program.attributes;if(a.morphTargets)for(a.numSupportedMorphTargets=0,u="morphTarget",k=0;k<this.maxMorphTargets;k++)n=u+k,0<=r[n]&&a.numSupportedMorphTargets++;if(a.morphNormals)for(a.numSupportedMorphNormals=0,u="morphNormal",k=0;k<this.maxMorphNormals;k++)n=u+k,0<=r[n]&&a.numSupportedMorphNormals++;a.uniformsList=[];for(l in a.uniforms)a.uniformsList.push([a.uniforms[l],l])};this.setFaceCulling=function(a,b){a===THREE.CullFaceNone?s.disable(s.CULL_FACE):(b===THREE.FrontFaceDirectionCW?
s.frontFace(s.CW):s.frontFace(s.CCW),a===THREE.CullFaceBack?s.cullFace(s.BACK):a===THREE.CullFaceFront?s.cullFace(s.FRONT):s.cullFace(s.FRONT_AND_BACK),s.enable(s.CULL_FACE))};this.setMaterialFaces=function(a){var b=a.side===THREE.DoubleSide;a=a.side===THREE.BackSide;Ka!==b&&(b?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),Ka=b);r!==a&&(a?s.frontFace(s.CW):s.frontFace(s.CCW),r=a)};this.setDepthTest=function(a){la!==a&&(a?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),la=a)};this.setDepthWrite=function(a){ya!==
a&&(s.depthMask(a),ya=a)};this.setBlending=function(a,b,c,d){a!==Ha&&(a===THREE.NoBlending?s.disable(s.BLEND):a===THREE.AdditiveBlending?(s.enable(s.BLEND),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.SRC_ALPHA,s.ONE)):a===THREE.SubtractiveBlending?(s.enable(s.BLEND),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ZERO,s.ONE_MINUS_SRC_COLOR)):a===THREE.MultiplyBlending?(s.enable(s.BLEND),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ZERO,s.SRC_COLOR)):a===THREE.CustomBlending?s.enable(s.BLEND):(s.enable(s.BLEND),
s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD),s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA)),Ha=a);if(a===THREE.CustomBlending){if(b!==va&&(s.blendEquation(B(b)),va=b),c!==Oa||d!==Ra)s.blendFunc(B(c),B(d)),Oa=c,Ra=d}else Ra=Oa=va=null};this.setTexture=function(a,b){if(a.needsUpdate){a.__webglInit||(a.__webglInit=!0,a.addEventListener("dispose",rb),a.__webglTexture=s.createTexture(),P.info.memory.textures++);s.activeTexture(s.TEXTURE0+b);s.bindTexture(s.TEXTURE_2D,
a.__webglTexture);s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,a.flipY);s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha);s.pixelStorei(s.UNPACK_ALIGNMENT,a.unpackAlignment);var c=a.image,d=THREE.Math.isPowerOfTwo(c.width)&&THREE.Math.isPowerOfTwo(c.height),e=B(a.format),f=B(a.type);F(s.TEXTURE_2D,a,d);var g=a.mipmaps;if(a instanceof THREE.DataTexture)if(0<g.length&&d){for(var h=0,l=g.length;h<l;h++)c=g[h],s.texImage2D(s.TEXTURE_2D,h,e,c.width,c.height,0,e,f,c.data);a.generateMipmaps=!1}else s.texImage2D(s.TEXTURE_2D,
0,e,c.width,c.height,0,e,f,c.data);else if(a instanceof THREE.CompressedTexture)for(h=0,l=g.length;h<l;h++)c=g[h],a.format!==THREE.RGBAFormat?s.compressedTexImage2D(s.TEXTURE_2D,h,e,c.width,c.height,0,c.data):s.texImage2D(s.TEXTURE_2D,h,e,c.width,c.height,0,e,f,c.data);else if(0<g.length&&d){h=0;for(l=g.length;h<l;h++)c=g[h],s.texImage2D(s.TEXTURE_2D,h,e,e,f,c);a.generateMipmaps=!1}else s.texImage2D(s.TEXTURE_2D,0,e,e,f,a.image);a.generateMipmaps&&d&&s.generateMipmap(s.TEXTURE_2D);a.needsUpdate=!1;
if(a.onUpdate)a.onUpdate()}else s.activeTexture(s.TEXTURE0+b),s.bindTexture(s.TEXTURE_2D,a.__webglTexture)};this.setRenderTarget=function(a){var b=a instanceof THREE.WebGLRenderTargetCube;if(a&&!a.__webglFramebuffer){void 0===a.depthBuffer&&(a.depthBuffer=!0);void 0===a.stencilBuffer&&(a.stencilBuffer=!0);a.addEventListener("dispose",db);a.__webglTexture=s.createTexture();P.info.memory.textures++;var c=THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height),d=B(a.format),e=B(a.type);if(b){a.__webglFramebuffer=
[];a.__webglRenderbuffer=[];s.bindTexture(s.TEXTURE_CUBE_MAP,a.__webglTexture);F(s.TEXTURE_CUBE_MAP,a,c);for(var f=0;6>f;f++){a.__webglFramebuffer[f]=s.createFramebuffer();a.__webglRenderbuffer[f]=s.createRenderbuffer();s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,d,a.width,a.height,0,d,e,null);var g=a,h=s.TEXTURE_CUBE_MAP_POSITIVE_X+f;s.bindFramebuffer(s.FRAMEBUFFER,a.__webglFramebuffer[f]);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,h,g.__webglTexture,0);J(a.__webglRenderbuffer[f],
a)}c&&s.generateMipmap(s.TEXTURE_CUBE_MAP)}else a.__webglFramebuffer=s.createFramebuffer(),a.__webglRenderbuffer=a.shareDepthFrom?a.shareDepthFrom.__webglRenderbuffer:s.createRenderbuffer(),s.bindTexture(s.TEXTURE_2D,a.__webglTexture),F(s.TEXTURE_2D,a,c),s.texImage2D(s.TEXTURE_2D,0,d,a.width,a.height,0,d,e,null),d=s.TEXTURE_2D,s.bindFramebuffer(s.FRAMEBUFFER,a.__webglFramebuffer),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,d,a.__webglTexture,0),a.shareDepthFrom?a.depthBuffer&&!a.stencilBuffer?
s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,a.__webglRenderbuffer):a.depthBuffer&&a.stencilBuffer&&s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,a.__webglRenderbuffer):J(a.__webglRenderbuffer,a),c&&s.generateMipmap(s.TEXTURE_2D);b?s.bindTexture(s.TEXTURE_CUBE_MAP,null):s.bindTexture(s.TEXTURE_2D,null);s.bindRenderbuffer(s.RENDERBUFFER,null);s.bindFramebuffer(s.FRAMEBUFFER,null)}a?(b=b?a.__webglFramebuffer[a.activeCubeFace]:a.__webglFramebuffer,
c=a.width,a=a.height,e=d=0):(b=null,c=Da,a=Ea,d=U,e=Pa);b!==Ca&&(s.bindFramebuffer(s.FRAMEBUFFER,b),s.viewport(d,e,c,a),Ca=b);ga=c;da=a};this.shadowMapPlugin=new THREE.ShadowMapPlugin;this.addPrePlugin(this.shadowMapPlugin);this.addPostPlugin(new THREE.SpritePlugin);this.addPostPlugin(new THREE.LensFlarePlugin)};
THREE.WebGLRenderTarget=function(a,b,c){this.width=a;this.height=b;c=c||{};this.wrapS=void 0!==c.wrapS?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==c.wrapT?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==c.magFilter?c.magFilter:THREE.LinearFilter;this.minFilter=void 0!==c.minFilter?c.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=void 0!==c.format?c.format:
THREE.RGBAFormat;this.type=void 0!==c.type?c.type:THREE.UnsignedByteType;this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.generateMipmaps=!0;this.shareDepthFrom=null};
THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(a,b){this.width=a;this.height=b},clone:function(){var a=new THREE.WebGLRenderTarget(this.width,this.height);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.format=this.format;a.type=this.type;a.depthBuffer=this.depthBuffer;a.stencilBuffer=this.stencilBuffer;a.generateMipmaps=this.generateMipmaps;
a.shareDepthFrom=this.shareDepthFrom;return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(a,b,c){THREE.WebGLRenderTarget.call(this,a,b,c);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);
THREE.WebGLProgram=function(){var a=0;return function(b,c,d,e){var f=b.context,g=d.fragmentShader,h=d.vertexShader,k=d.uniforms,m=d.attributes,l=d.defines,n=d.index0AttributeName;void 0===n&&!0===e.morphTargets&&(n="position");var t="SHADOWMAP_TYPE_BASIC";e.shadowMapType===THREE.PCFShadowMap?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===THREE.PCFSoftShadowMap&&(t="SHADOWMAP_TYPE_PCF_SOFT");var q,u;q=[];for(var p in l)u=l[p],!1!==u&&(u="#define "+p+" "+u,q.push(u));q=q.join("\n");l=f.createProgram();d instanceof
THREE.RawShaderMaterial?b=d="":(d=["precision "+e.precision+" float;","precision "+e.precision+" int;",q,e.supportsVertexTextures?"#define VERTEX_TEXTURES":"",b.gammaInput?"#define GAMMA_INPUT":"",b.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+e.maxDirLights,"#define MAX_POINT_LIGHTS "+e.maxPointLights,"#define MAX_SPOT_LIGHTS "+e.maxSpotLights,"#define MAX_HEMI_LIGHTS "+e.maxHemiLights,"#define MAX_SHADOWS "+e.maxShadows,"#define MAX_BONES "+e.maxBones,e.map?"#define USE_MAP":
"",e.envMap?"#define USE_ENVMAP":"",e.lightMap?"#define USE_LIGHTMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.vertexColors?"#define USE_COLOR":"",e.skinning?"#define USE_SKINNING":"",e.useVertexTexture?"#define BONE_TEXTURE":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals?"#define USE_MORPHNORMALS":"",e.wrapAround?"#define WRAP_AROUND":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":
"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+t:"",e.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",e.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\n\tattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\n\tattribute vec3 morphTarget0;\n\tattribute vec3 morphTarget1;\n\tattribute vec3 morphTarget2;\n\tattribute vec3 morphTarget3;\n\t#ifdef USE_MORPHNORMALS\n\t\tattribute vec3 morphNormal0;\n\t\tattribute vec3 morphNormal1;\n\t\tattribute vec3 morphNormal2;\n\t\tattribute vec3 morphNormal3;\n\t#else\n\t\tattribute vec3 morphTarget4;\n\t\tattribute vec3 morphTarget5;\n\t\tattribute vec3 morphTarget6;\n\t\tattribute vec3 morphTarget7;\n\t#endif\n#endif\n#ifdef USE_SKINNING\n\tattribute vec4 skinIndex;\n\tattribute vec4 skinWeight;\n#endif\n"].join("\n"),
b=["precision "+e.precision+" float;","precision "+e.precision+" int;",e.bumpMap||e.normalMap?"#extension GL_OES_standard_derivatives : enable":"",q,"#define MAX_DIR_LIGHTS "+e.maxDirLights,"#define MAX_POINT_LIGHTS "+e.maxPointLights,"#define MAX_SPOT_LIGHTS "+e.maxSpotLights,"#define MAX_HEMI_LIGHTS "+e.maxHemiLights,"#define MAX_SHADOWS "+e.maxShadows,e.alphaTest?"#define ALPHATEST "+e.alphaTest:"",b.gammaInput?"#define GAMMA_INPUT":"",b.gammaOutput?"#define GAMMA_OUTPUT":"",e.useFog&&e.fog?"#define USE_FOG":
"",e.useFog&&e.fogExp?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.lightMap?"#define USE_LIGHTMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.vertexColors?"#define USE_COLOR":"",e.metal?"#define METAL":"",e.wrapAround?"#define WRAP_AROUND":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?
"#define "+t:"",e.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",e.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"));h=new THREE.WebGLShader(f,f.VERTEX_SHADER,d+h);g=new THREE.WebGLShader(f,f.FRAGMENT_SHADER,b+g);f.attachShader(l,h);f.attachShader(l,g);void 0!==n&&f.bindAttribLocation(l,0,n);f.linkProgram(l);!1===f.getProgramParameter(l,f.LINK_STATUS)&&(console.error("Could not initialise shader"),
console.error("gl.VALIDATE_STATUS",f.getProgramParameter(l,f.VALIDATE_STATUS)),console.error("gl.getError()",f.getError()));""!==f.getProgramInfoLog(l)&&console.error("gl.getProgramInfoLog()",f.getProgramInfoLog(l));f.deleteShader(h);f.deleteShader(g);n="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences".split(" ");e.useVertexTexture?(n.push("boneTexture"),n.push("boneTextureWidth"),n.push("boneTextureHeight")):n.push("boneGlobalMatrices");e.logarithmicDepthBuffer&&
n.push("logDepthBufFC");for(var v in k)n.push(v);k=n;v={};n=0;for(b=k.length;n<b;n++)t=k[n],v[t]=f.getUniformLocation(l,t);this.uniforms=v;n="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" ");for(k=0;k<e.maxMorphTargets;k++)n.push("morphTarget"+k);for(k=0;k<e.maxMorphNormals;k++)n.push("morphNormal"+k);for(var x in m)n.push(x);e=n;m={};x=0;for(k=e.length;x<k;x++)v=e[x],m[v]=f.getAttribLocation(l,v);this.attributes=m;this.id=a++;this.code=c;this.usedTimes=1;this.program=
l;this.vertexShader=h;this.fragmentShader=g;return this}}();
THREE.WebGLShader=function(){var a=function(a){a=a.split("\n");for(var c=0;c<a.length;c++)a[c]=c+1+": "+a[c];return a.join("\n")};return function(b,c,d){c=b.createShader(c);b.shaderSource(c,d);b.compileShader(c);!1===b.getShaderParameter(c,b.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==b.getShaderInfoLog(c)&&(console.error("THREE.WebGLShader:","gl.getShaderInfoLog()",b.getShaderInfoLog(c)),console.error(a(d)));return c}}();
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.material=this.color=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0};
THREE.GeometryUtils={merge:function(a,b,c){console.warn("DEPRECATED: GeometryUtils's .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var d;b instanceof THREE.Mesh&&(b.matrixAutoUpdate&&b.updateMatrix(),d=b.matrix,b=b.geometry);a.merge(b,d,c)},randomPointInTriangle:function(){var a=new THREE.Vector3;return function(b,c,d){var e=new THREE.Vector3,f=THREE.Math.random16(),g=THREE.Math.random16();1<f+g&&(f=1-f,g=1-g);var h=1-f-g;e.copy(b);e.multiplyScalar(f);
a.copy(c);a.multiplyScalar(g);e.add(a);a.copy(d);a.multiplyScalar(h);e.add(a);return e}}(),randomPointInFace:function(a,b,c){return THREE.GeometryUtils.randomPointInTriangle(b.vertices[a.a],b.vertices[a.b],b.vertices[a.c])},randomPointsInGeometry:function(a,b){function c(a){function b(c,d){if(d<c)return c;var e=c+Math.floor((d-c)/2);return m[e]>a?b(c,e-1):m[e]<a?b(e+1,d):e}return b(0,m.length-1)}var d,e,f=a.faces,g=a.vertices,h=f.length,k=0,m=[],l,n,t;for(e=0;e<h;e++)d=f[e],l=g[d.a],n=g[d.b],t=g[d.c],
d._area=THREE.GeometryUtils.triangleArea(l,n,t),k+=d._area,m[e]=k;d=[];for(e=0;e<b;e++)g=THREE.Math.random16()*k,g=c(g),d[e]=THREE.GeometryUtils.randomPointInFace(f[g],a,!0);return d},triangleArea:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){a.subVectors(d,c);b.subVectors(e,c);a.cross(b);return.5*a.length()}}(),center:function(a){a.computeBoundingBox();var b=a.boundingBox,c=new THREE.Vector3;c.addVectors(b.min,b.max);c.multiplyScalar(-.5);a.applyMatrix((new THREE.Matrix4).makeTranslation(c.x,
c.y,c.z));a.computeBoundingBox();return c}};
THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,c,d){var e=new THREE.ImageLoader;e.crossOrigin=this.crossOrigin;var f=new THREE.Texture(void 0,b);b=e.load(a,function(){f.needsUpdate=!0;c&&c(f)},void 0,function(a){d&&d(a)});f.image=b;f.sourceFile=a;return f},loadCompressedTexture:function(a,b,c,d){var e=new THREE.CompressedTexture;e.mapping=b;var f=new XMLHttpRequest;f.onload=function(){var a=THREE.ImageUtils.parseDDS(f.response,!0);e.format=a.format;e.mipmaps=a.mipmaps;e.image.width=
a.width;e.image.height=a.height;e.generateMipmaps=!1;e.needsUpdate=!0;c&&c(e)};f.onerror=d;f.open("GET",a,!0);f.responseType="arraybuffer";f.send(null);return e},loadTextureCube:function(a,b,c,d){var e=[];e.loadCount=0;d=new THREE.ImageLoader;d.crossOrigin=this.crossOrigin;var f=new THREE.Texture;f.image=e;void 0!==b&&(f.mapping=b);f.flipY=!1;b=0;for(var g=a.length;b<g;++b){var h=d.load(a[b],function(){e.loadCount+=1;6===e.loadCount&&(f.needsUpdate=!0,c&&c(f))});e[b]=h}return f},loadCompressedTextureCube:function(a,
b,c,d){var e=[];e.loadCount=0;var f=new THREE.CompressedTexture;f.image=e;void 0!==b&&(f.mapping=b);f.flipY=!1;f.generateMipmaps=!1;b=function(a,b){return function(){var d=THREE.ImageUtils.parseDDS(a.response,!0);b.format=d.format;b.mipmaps=d.mipmaps;b.width=d.width;b.height=d.height;e.loadCount+=1;6===e.loadCount&&(f.format=d.format,f.needsUpdate=!0,c&&c(f))}};if(a instanceof Array)for(var g=0,h=a.length;g<h;++g){var k={};e[g]=k;var m=new XMLHttpRequest;m.onload=b(m,k);m.onerror=d;k=a[g];m.open("GET",
k,!0);m.responseType="arraybuffer";m.send(null)}else m=new XMLHttpRequest,m.onload=function(){var a=THREE.ImageUtils.parseDDS(m.response,!0);if(a.isCubemap){for(var b=a.mipmaps.length/a.mipmapCount,d=0;d<b;d++){e[d]={mipmaps:[]};for(var g=0;g<a.mipmapCount;g++)e[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+g]),e[d].format=a.format,e[d].width=a.width,e[d].height=a.height}f.format=a.format;f.needsUpdate=!0;c&&c(f)}},m.onerror=d,m.open("GET",a,!0),m.responseType="arraybuffer",m.send(null);return f},loadDDSTexture:function(a,
b,c,d){var e=[];e.loadCount=0;var f=new THREE.CompressedTexture;f.image=e;void 0!==b&&(f.mapping=b);f.flipY=!1;f.generateMipmaps=!1;var g=new XMLHttpRequest;g.onload=function(){var a=THREE.ImageUtils.parseDDS(g.response,!0);if(a.isCubemap)for(var b=a.mipmaps.length/a.mipmapCount,d=0;d<b;d++){e[d]={mipmaps:[]};for(var l=0;l<a.mipmapCount;l++)e[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+l]),e[d].format=a.format,e[d].width=a.width,e[d].height=a.height}else f.image.width=a.width,f.image.height=a.height,
f.mipmaps=a.mipmaps;f.format=a.format;f.needsUpdate=!0;c&&c(f)};g.onerror=d;g.open("GET",a,!0);g.responseType="arraybuffer";g.send(null);return f},parseDDS:function(a,b){function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function d(a,b,c,d){var e=c*d*4;a=new Uint8Array(a,b,e);for(var e=new Uint8Array(e),f=b=0,g=0;g<d;g++)for(var h=0;h<c;h++){var l=a[f];f++;var k=a[f];f++;var m=a[f];f++;var n=a[f];f++;e[b]=m;b++;e[b]=k;b++;e[b]=l;b++;e[b]=n;b++}return e}
var e={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},f=c("DXT1"),g=c("DXT3"),h=c("DXT5"),k=new Int32Array(a,0,31);if(542327876!==k[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),e;if(!k[20]&4)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),e;var m=k[21],l=!1;switch(m){case f:f=8;e.format=THREE.RGB_S3TC_DXT1_Format;break;case g:f=16;e.format=THREE.RGBA_S3TC_DXT3_Format;break;case h:f=16;e.format=THREE.RGBA_S3TC_DXT5_Format;
break;default:if(32==k[22]&&k[23]&16711680&&k[24]&65280&&k[25]&255&&k[26]&4278190080)l=!0,f=64,e.format=THREE.RGBAFormat;else return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(m&255,m>>8&255,m>>16&255,m>>24&255)),e}e.mipmapCount=1;k[2]&131072&&!1!==b&&(e.mipmapCount=Math.max(1,k[7]));e.isCubemap=k[28]&512?!0:!1;e.width=k[4];e.height=k[3];for(var k=k[1]+4,g=e.width,h=e.height,m=e.isCubemap?6:1,n=0;n<m;n++){for(var t=0;t<e.mipmapCount;t++){if(l)var q=d(a,k,
g,h),u=q.length;else u=Math.max(4,g)/4*Math.max(4,h)/4*f,q=new Uint8Array(a,k,u);e.mipmaps.push({data:q,width:g,height:h});k+=u;g=Math.max(.5*g,1);h=Math.max(.5*h,1)}g=e.width;h=e.height}return e},getNormalMap:function(a,b){var c=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/b,a[1]/b,a[2]/b]};b|=1;var d=a.width,e=a.height,f=document.createElement("canvas");f.width=d;f.height=e;var g=f.getContext("2d");g.drawImage(a,0,0);for(var h=g.getImageData(0,0,d,e).data,k=g.createImageData(d,
e),m=k.data,l=0;l<d;l++)for(var n=0;n<e;n++){var t=0>n-1?0:n-1,q=n+1>e-1?e-1:n+1,u=0>l-1?0:l-1,p=l+1>d-1?d-1:l+1,v=[],x=[0,0,h[4*(n*d+l)]/255*b];v.push([-1,0,h[4*(n*d+u)]/255*b]);v.push([-1,-1,h[4*(t*d+u)]/255*b]);v.push([0,-1,h[4*(t*d+l)]/255*b]);v.push([1,-1,h[4*(t*d+p)]/255*b]);v.push([1,0,h[4*(n*d+p)]/255*b]);v.push([1,1,h[4*(q*d+p)]/255*b]);v.push([0,1,h[4*(q*d+l)]/255*b]);v.push([-1,1,h[4*(q*d+u)]/255*b]);t=[];u=v.length;for(q=0;q<u;q++){var p=v[q],w=v[(q+1)%u],p=[p[0]-x[0],p[1]-x[1],p[2]-x[2]],
w=[w[0]-x[0],w[1]-x[1],w[2]-x[2]];t.push(c([p[1]*w[2]-p[2]*w[1],p[2]*w[0]-p[0]*w[2],p[0]*w[1]-p[1]*w[0]]))}v=[0,0,0];for(q=0;q<t.length;q++)v[0]+=t[q][0],v[1]+=t[q][1],v[2]+=t[q][2];v[0]/=t.length;v[1]/=t.length;v[2]/=t.length;x=4*(n*d+l);m[x]=(v[0]+1)/2*255|0;m[x+1]=(v[1]+1)/2*255|0;m[x+2]=255*v[2]|0;m[x+3]=255}g.putImageData(k,0,0);return f},generateDataTexture:function(a,b,c){var d=a*b,e=new Uint8Array(3*d),f=Math.floor(255*c.r),g=Math.floor(255*c.g);c=Math.floor(255*c.b);for(var h=0;h<d;h++)e[3*
h]=f,e[3*h+1]=g,e[3*h+2]=c;a=new THREE.DataTexture(e,a,b,THREE.RGBFormat);a.needsUpdate=!0;return a}};THREE.SceneUtils={createMultiMaterialObject:function(a,b){for(var c=new THREE.Object3D,d=0,e=b.length;d<e;d++)c.add(new THREE.Mesh(a,b[d]));return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld);b.remove(a);c.add(a)},attach:function(a,b,c){var d=new THREE.Matrix4;d.getInverse(c.matrixWorld);a.applyMatrix(d);b.remove(a);c.add(a)}};
THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(a){var b=a.familyName.toLowerCase();this.faces[b]=this.faces[b]||{};this.faces[b][a.cssFontWeight]=this.faces[b][a.cssFontWeight]||{};this.faces[b][a.cssFontWeight][a.cssFontStyle]=a;return this.faces[b][a.cssFontWeight][a.cssFontStyle]=a},drawText:function(a){var b=this.getFace(),c=this.size/b.resolution,d=0,e=
String(a).split(""),f=e.length,g=[];for(a=0;a<f;a++){var h=new THREE.Path,h=this.extractGlyphPoints(e[a],b,c,d,h),d=d+h.offset;g.push(h.path)}return{paths:g,offset:d/2}},extractGlyphPoints:function(a,b,c,d,e){var f=[],g,h,k,m,l,n,t,q,u,p,v,x=b.glyphs[a]||b.glyphs["?"];if(x){if(x.o)for(b=x._cachedOutline||(x._cachedOutline=x.o.split(" ")),m=b.length,a=0;a<m;)switch(k=b[a++],k){case "m":k=b[a++]*c+d;l=b[a++]*c;e.moveTo(k,l);break;case "l":k=b[a++]*c+d;l=b[a++]*c;e.lineTo(k,l);break;case "q":k=b[a++]*
c+d;l=b[a++]*c;q=b[a++]*c+d;u=b[a++]*c;e.quadraticCurveTo(q,u,k,l);if(g=f[f.length-1])for(n=g.x,t=g.y,g=1,h=this.divisions;g<=h;g++){var w=g/h;THREE.Shape.Utils.b2(w,n,q,k);THREE.Shape.Utils.b2(w,t,u,l)}break;case "b":if(k=b[a++]*c+d,l=b[a++]*c,q=b[a++]*c+d,u=b[a++]*-c,p=b[a++]*c+d,v=b[a++]*-c,e.bezierCurveTo(k,l,q,u,p,v),g=f[f.length-1])for(n=g.x,t=g.y,g=1,h=this.divisions;g<=h;g++)w=g/h,THREE.Shape.Utils.b3(w,n,q,p,k),THREE.Shape.Utils.b3(w,t,u,v,l)}return{offset:x.ha*c,path:e}}}};
THREE.FontUtils.generateShapes=function(a,b){b=b||{};var c=void 0!==b.curveSegments?b.curveSegments:4,d=void 0!==b.font?b.font:"helvetiker",e=void 0!==b.weight?b.weight:"normal",f=void 0!==b.style?b.style:"normal";THREE.FontUtils.size=void 0!==b.size?b.size:100;THREE.FontUtils.divisions=c;THREE.FontUtils.face=d;THREE.FontUtils.weight=e;THREE.FontUtils.style=f;c=THREE.FontUtils.drawText(a).paths;d=[];e=0;for(f=c.length;e<f;e++)Array.prototype.push.apply(d,c[e].toShapes());return d};
(function(a){var b=function(a){for(var b=a.length,e=0,f=b-1,g=0;g<b;f=g++)e+=a[f].x*a[g].y-a[g].x*a[f].y;return.5*e};a.Triangulate=function(a,d){var e=a.length;if(3>e)return null;var f=[],g=[],h=[],k,m,l;if(0<b(a))for(m=0;m<e;m++)g[m]=m;else for(m=0;m<e;m++)g[m]=e-1-m;var n=2*e;for(m=e-1;2<e;){if(0>=n--){console.log("Warning, unable to triangulate polygon!");break}k=m;e<=k&&(k=0);m=k+1;e<=m&&(m=0);l=m+1;e<=l&&(l=0);var t;a:{var q=void 0,u=void 0,p=void 0,v=void 0,x=void 0,w=void 0,y=void 0,M=void 0,
q=a[g[k]].x,u=a[g[k]].y,p=a[g[m]].x,v=a[g[m]].y,x=a[g[l]].x,w=a[g[l]].y;if(1E-10>(p-q)*(w-u)-(v-u)*(x-q))t=!1;else{var z=void 0,K=void 0,H=void 0,D=void 0,L=void 0,A=void 0,E=void 0,F=void 0,J=void 0,N=void 0,J=F=E=M=y=void 0,z=x-p,K=w-v,H=q-x,D=u-w,L=p-q,A=v-u;for(t=0;t<e;t++)if(y=a[g[t]].x,M=a[g[t]].y,!(y===q&&M===u||y===p&&M===v||y===x&&M===w)&&(E=y-q,F=M-u,J=y-p,N=M-v,y-=x,M-=w,J=z*N-K*J,E=L*F-A*E,F=H*M-D*y,-1E-10<=J&&-1E-10<=F&&-1E-10<=E)){t=!1;break a}t=!0}}if(t){f.push([a[g[k]],a[g[m]],a[g[l]]]);
h.push([g[k],g[m],g[l]]);k=m;for(l=m+1;l<e;k++,l++)g[k]=g[l];e--;n=2*e}}return d?h:f};a.Triangulate.area=b;return a})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(a){console.log("Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(a){a=this.getUtoTmapping(a);return this.getPoint(a)};
THREE.Curve.prototype.getPoints=function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPoint(b/a));return c};THREE.Curve.prototype.getSpacedPoints=function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return c};THREE.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]};
THREE.Curve.prototype.getLengths=function(a){a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],c,d=this.getPoint(0),e,f=0;b.push(0);for(e=1;e<=a;e++)c=this.getPoint(e/a),f+=c.distanceTo(d),b.push(f),d=c;return this.cacheArcLengths=b};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0;this.getLengths()};
THREE.Curve.prototype.getUtoTmapping=function(a,b){var c=this.getLengths(),d=0,e=c.length,f;f=b?b:a*c[e-1];for(var g=0,h=e-1,k;g<=h;)if(d=Math.floor(g+(h-g)/2),k=c[d]-f,0>k)g=d+1;else if(0<k)h=d-1;else{h=d;break}d=h;if(c[d]==f)return d/(e-1);g=c[d];return(d+(f-g)/(c[d+1]-g))/(e-1)};THREE.Curve.prototype.getTangent=function(a){var b=a-1E-4;a+=1E-4;0>b&&(b=0);1<a&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().sub(b).normalize()};
THREE.Curve.prototype.getTangentAt=function(a){a=this.getUtoTmapping(a);return this.getTangent(a)};
THREE.Curve.Utils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){a=.5*(c-a);d=.5*(d-b);var f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}};
THREE.Curve.create=function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.getPoint=b;return a};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=!1};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.add=function(a){this.curves.push(a)};THREE.CurvePath.prototype.checkConnection=function(){};
THREE.CurvePath.prototype.closePath=function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new THREE.LineCurve(b,a))};THREE.CurvePath.prototype.getPoint=function(a){var b=a*this.getLength(),c=this.getCurveLengths();for(a=0;a<c.length;){if(c[a]>=b)return b=c[a]-b,a=this.curves[a],b=1-b/a.getLength(),a.getPointAt(b);a++}return null};THREE.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]};
THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var a=[],b=0,c,d=this.curves.length;for(c=0;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a};
THREE.CurvePath.prototype.getBoundingBox=function(){var a=this.getPoints(),b,c,d,e,f,g;b=c=Number.NEGATIVE_INFINITY;e=f=Number.POSITIVE_INFINITY;var h,k,m,l,n=a[0]instanceof THREE.Vector3;l=n?new THREE.Vector3:new THREE.Vector2;k=0;for(m=a.length;k<m;k++)h=a[k],h.x>b?b=h.x:h.x<e&&(e=h.x),h.y>c?c=h.y:h.y<f&&(f=h.y),n&&(h.z>d?d=h.z:h.z<g&&(g=h.z)),l.add(h);a={minX:e,minY:f,maxX:b,maxY:c};n&&(a.maxZ=d,a.minZ=g);return a};
THREE.CurvePath.prototype.createPointsGeometry=function(a){a=this.getPoints(a,!0);return this.createGeometry(a)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(a){a=this.getSpacedPoints(a,!0);return this.createGeometry(a)};THREE.CurvePath.prototype.createGeometry=function(a){for(var b=new THREE.Geometry,c=0;c<a.length;c++)b.vertices.push(new THREE.Vector3(a[c].x,a[c].y,a[c].z||0));return b};THREE.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)};
THREE.CurvePath.prototype.getTransformedPoints=function(a,b){var c=this.getPoints(a),d,e;b||(b=this.bends);d=0;for(e=b.length;d<e;d++)c=this.getWrapPoints(c,b[d]);return c};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(a,b){var c=this.getSpacedPoints(a),d,e;b||(b=this.bends);d=0;for(e=b.length;d<e;d++)c=this.getWrapPoints(c,b[d]);return c};
THREE.CurvePath.prototype.getWrapPoints=function(a,b){var c=this.getBoundingBox(),d,e,f,g,h,k;d=0;for(e=a.length;d<e;d++)f=a[d],g=f.x,h=f.y,k=g/c.maxX,k=b.getUtoTmapping(k,g),g=b.getPoint(k),k=b.getTangent(k),k.set(-k.y,k.x).multiplyScalar(h),f.x=g.x+k.x,f.y=g.y+k.y;return a};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);
THREE.Gyroscope.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),
this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)};THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3;THREE.Gyroscope.prototype.translationObject=new THREE.Vector3;THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion;THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion;THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3;THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3;
THREE.Path=function(a){THREE.CurvePath.call(this);this.actions=[];a&&this.fromPoints(a)};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)};
THREE.Path.prototype.moveTo=function(a,b){var c=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:c})};THREE.Path.prototype.lineTo=function(a,b){var c=Array.prototype.slice.call(arguments),d=this.actions[this.actions.length-1].args,d=new THREE.LineCurve(new THREE.Vector2(d[d.length-2],d[d.length-1]),new THREE.Vector2(a,b));this.curves.push(d);this.actions.push({action:THREE.PathActions.LINE_TO,args:c})};
THREE.Path.prototype.quadraticCurveTo=function(a,b,c,d){var e=Array.prototype.slice.call(arguments),f=this.actions[this.actions.length-1].args,f=new THREE.QuadraticBezierCurve(new THREE.Vector2(f[f.length-2],f[f.length-1]),new THREE.Vector2(a,b),new THREE.Vector2(c,d));this.curves.push(f);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:e})};
THREE.Path.prototype.bezierCurveTo=function(a,b,c,d,e,f){var g=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,h=new THREE.CubicBezierCurve(new THREE.Vector2(h[h.length-2],h[h.length-1]),new THREE.Vector2(a,b),new THREE.Vector2(c,d),new THREE.Vector2(e,f));this.curves.push(h);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:g})};
THREE.Path.prototype.splineThru=function(a){var b=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,c=[new THREE.Vector2(c[c.length-2],c[c.length-1])];Array.prototype.push.apply(c,a);c=new THREE.SplineCurve(c);this.curves.push(c);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:b})};THREE.Path.prototype.arc=function(a,b,c,d,e,f){var g=this.actions[this.actions.length-1].args;this.absarc(a+g[g.length-2],b+g[g.length-1],c,d,e,f)};
THREE.Path.prototype.absarc=function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)};THREE.Path.prototype.ellipse=function(a,b,c,d,e,f,g){var h=this.actions[this.actions.length-1].args;this.absellipse(a+h[h.length-2],b+h[h.length-1],c,d,e,f,g)};THREE.Path.prototype.absellipse=function(a,b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments),k=new THREE.EllipseCurve(a,b,c,d,e,f,g);this.curves.push(k);k=k.getPoint(1);h.push(k.x);h.push(k.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:h})};
THREE.Path.prototype.getSpacedPoints=function(a,b){a||(a=40);for(var c=[],d=0;d<a;d++)c.push(this.getPoint(d/a));return c};
THREE.Path.prototype.getPoints=function(a,b){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(a,b);a=a||12;var c=[],d,e,f,g,h,k,m,l,n,t,q,u,p;d=0;for(e=this.actions.length;d<e;d++)switch(f=this.actions[d],g=f.action,f=f.args,g){case THREE.PathActions.MOVE_TO:c.push(new THREE.Vector2(f[0],f[1]));break;case THREE.PathActions.LINE_TO:c.push(new THREE.Vector2(f[0],f[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:h=f[2];k=f[3];n=f[0];t=f[1];0<c.length?(g=c[c.length-1],q=g.x,
u=g.y):(g=this.actions[d-1].args,q=g[g.length-2],u=g[g.length-1]);for(f=1;f<=a;f++)p=f/a,g=THREE.Shape.Utils.b2(p,q,n,h),p=THREE.Shape.Utils.b2(p,u,t,k),c.push(new THREE.Vector2(g,p));break;case THREE.PathActions.BEZIER_CURVE_TO:h=f[4];k=f[5];n=f[0];t=f[1];m=f[2];l=f[3];0<c.length?(g=c[c.length-1],q=g.x,u=g.y):(g=this.actions[d-1].args,q=g[g.length-2],u=g[g.length-1]);for(f=1;f<=a;f++)p=f/a,g=THREE.Shape.Utils.b3(p,q,n,m,h),p=THREE.Shape.Utils.b3(p,u,t,l,k),c.push(new THREE.Vector2(g,p));break;case THREE.PathActions.CSPLINE_THRU:g=
this.actions[d-1].args;p=[new THREE.Vector2(g[g.length-2],g[g.length-1])];g=a*f[0].length;p=p.concat(f[0]);p=new THREE.SplineCurve(p);for(f=1;f<=g;f++)c.push(p.getPointAt(f/g));break;case THREE.PathActions.ARC:h=f[0];k=f[1];t=f[2];m=f[3];g=f[4];n=!!f[5];q=g-m;u=2*a;for(f=1;f<=u;f++)p=f/u,n||(p=1-p),p=m+p*q,g=h+t*Math.cos(p),p=k+t*Math.sin(p),c.push(new THREE.Vector2(g,p));break;case THREE.PathActions.ELLIPSE:for(h=f[0],k=f[1],t=f[2],l=f[3],m=f[4],g=f[5],n=!!f[6],q=g-m,u=2*a,f=1;f<=u;f++)p=f/u,n||
(p=1-p),p=m+p*q,g=h+t*Math.cos(p),p=k+l*Math.sin(p),c.push(new THREE.Vector2(g,p))}d=c[c.length-1];1E-10>Math.abs(d.x-c[0].x)&&1E-10>Math.abs(d.y-c[0].y)&&c.splice(c.length-1,1);b&&c.push(c[0]);return c};
THREE.Path.prototype.toShapes=function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new THREE.Shape;f.actions=e.actions;f.curves=e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],l=h.x-g.x,k=h.y-g.y;if(1E-10<Math.abs(k)){if(0>k&&(g=b[f],l=-l,h=b[e],k=-k),!(a.y<g.y||a.y>h.y))if(a.y==g.y){if(a.x==g.x)return!0}else{e=k*(a.x-g.x)-l*(a.y-g.y);if(0==e)return!0;0>e||(d=!d)}}else if(a.y==g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=
h.x))return!0}return d}var e=function(a){var b,c,d,e,f=[],g=new THREE.Path;b=0;for(c=a.length;b<c;b++)d=a[b],e=d.args,d=d.action,d==THREE.PathActions.MOVE_TO&&0!=g.actions.length&&(f.push(g),g=new THREE.Path),g[d].apply(g,e);0!=g.actions.length&&f.push(g);return f}(this.actions);if(0==e.length)return[];if(!0===b)return c(e);var f,g,h,k=[];if(1==e.length)return g=e[0],h=new THREE.Shape,h.actions=g.actions,h.curves=g.curves,k.push(h),k;var m=!THREE.Shape.Utils.isClockWise(e[0].getPoints()),m=a?!m:m;
h=[];var l=[],n=[],t=0,q;l[t]=void 0;n[t]=[];var u,p;u=0;for(p=e.length;u<p;u++)g=e[u],q=g.getPoints(),f=THREE.Shape.Utils.isClockWise(q),(f=a?!f:f)?(!m&&l[t]&&t++,l[t]={s:new THREE.Shape,p:q},l[t].s.actions=g.actions,l[t].s.curves=g.curves,m&&t++,n[t]=[]):n[t].push({h:g,p:q[0]});if(!l[0])return c(e);if(1<l.length){u=!1;p=[];g=0;for(e=l.length;g<e;g++)h[g]=[];g=0;for(e=l.length;g<e;g++)for(f=n[g],m=0;m<f.length;m++){t=f[m];q=!0;for(var v=0;v<l.length;v++)d(t.p,l[v].p)&&(g!=v&&p.push({froms:g,tos:v,
hole:m}),q?(q=!1,h[v].push(t)):u=!0);q&&h[g].push(t)}0<p.length&&(u||(n=h))}u=0;for(p=l.length;u<p;u++)for(h=l[u].s,k.push(h),g=n[u],e=0,f=g.length;e<f;e++)h.holes.push(g[e].h);return k};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.extrude=function(a){return new THREE.ExtrudeGeometry(this,a)};THREE.Shape.prototype.makeGeometry=function(a){return new THREE.ShapeGeometry(this,a)};
THREE.Shape.prototype.getPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++)d[b]=this.holes[b].getTransformedPoints(a,this.bends);return d};THREE.Shape.prototype.getSpacedPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++)d[b]=this.holes[b].getTransformedSpacedPoints(a,this.bends);return d};THREE.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}};
THREE.Shape.prototype.extractPoints=function(a){return this.useSpacedPoints?this.extractAllSpacedPoints(a):this.extractAllPoints(a)};THREE.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}};
THREE.Shape.Utils={triangulateShape:function(a,b){function c(a,b,c){return a.x!=b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function d(a,b,d,e,f){var g=b.x-a.x,h=b.y-a.y,l=e.x-d.x,k=e.y-d.y,m=a.x-d.x,n=a.y-d.y,H=h*l-g*k,D=h*m-g*n;if(1E-10<Math.abs(H)){if(0<H){if(0>D||D>H)return[];l=k*m-l*n;if(0>l||l>H)return[]}else{if(0<D||D<H)return[];l=k*m-l*n;if(0<l||l<H)return[]}if(0==l)return!f||0!=D&&D!=H?[a]:[];if(l==H)return!f||0!=D&&D!=H?[b]:[];if(0==D)return[d];
if(D==H)return[e];f=l/H;return[{x:a.x+f*g,y:a.y+f*h}]}if(0!=D||k*m!=l*n)return[];h=0==g&&0==h;l=0==l&&0==k;if(h&&l)return a.x!=d.x||a.y!=d.y?[]:[a];if(h)return c(d,e,a)?[a]:[];if(l)return c(a,b,d)?[d]:[];0!=g?(a.x<b.x?(g=a,l=a.x,h=b,a=b.x):(g=b,l=b.x,h=a,a=a.x),d.x<e.x?(b=d,H=d.x,k=e,d=e.x):(b=e,H=e.x,k=d,d=d.x)):(a.y<b.y?(g=a,l=a.y,h=b,a=b.y):(g=b,l=b.y,h=a,a=a.y),d.y<e.y?(b=d,H=d.y,k=e,d=e.y):(b=e,H=e.y,k=d,d=d.y));return l<=H?a<H?[]:a==H?f?[]:[b]:a<=d?[b,h]:[b,k]:l>d?[]:l==d?f?[]:[g]:a<=d?[g,h]:
[g,k]}function e(a,b,c,d){var e=b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var g=d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return 1E-10<Math.abs(a)?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}var f,g,h,k,m,l={};h=a.concat();f=0;for(g=b.length;f<g;f++)Array.prototype.push.apply(h,b[f]);f=0;for(g=h.length;f<g;f++)m=h[f].x+":"+h[f].y,void 0!==l[m]&&console.log("Duplicate point",m),l[m]=f;f=function(a,b){function c(a,b){var d=h.length-1,f=a-1;0>f&&(f=d);var g=a+1;g>d&&(g=0);d=e(h[a],h[f],h[g],l[b]);if(!d)return!1;
d=l.length-1;f=b-1;0>f&&(f=d);g=b+1;g>d&&(g=0);return e(l[b],l[f],l[g],h[a])?!0:!1}function f(a,b){var c,e;for(c=0;c<h.length;c++)if(e=c+1,e%=h.length,e=d(a,b,h[c],h[e],!0),0<e.length)return!0;return!1}function g(a,c){var e,f,h,l;for(e=0;e<k.length;e++)for(f=b[k[e]],h=0;h<f.length;h++)if(l=h+1,l%=f.length,l=d(a,c,f[h],f[l],!0),0<l.length)return!0;return!1}var h=a.concat(),l,k=[],m,n,K,H,D,L=[],A,E,F,J=0;for(m=b.length;J<m;J++)k.push(J);A=0;for(var N=2*k.length;0<k.length;){N--;if(0>N){console.log("Infinite Loop! Holes left:"+
k.length+", Probably Hole outside Shape!");break}for(n=A;n<h.length;n++){K=h[n];m=-1;for(J=0;J<k.length;J++)if(H=k[J],D=K.x+":"+K.y+":"+H,void 0===L[D]){l=b[H];for(E=0;E<l.length;E++)if(H=l[E],c(n,E)&&!f(K,H)&&!g(K,H)){m=E;k.splice(J,1);A=h.slice(0,n+1);H=h.slice(n);E=l.slice(m);F=l.slice(0,m+1);h=A.concat(E).concat(F).concat(H);A=n;break}if(0<=m)break;L[D]=!0}if(0<=m)break}}return h}(a,b);var n=THREE.FontUtils.Triangulate(f,!1);f=0;for(g=n.length;f<g;f++)for(k=n[f],h=0;3>h;h++)m=k[h].x+":"+k[h].y,
m=l[m],void 0!==m&&(k[h]=m);return n.concat()},isClockWise:function(a){return 0>THREE.FontUtils.Triangulate.area(a)},b2p0:function(a,b){var c=1-a;return c*c*b},b2p1:function(a,b){return 2*(1-a)*a*b},b2p2:function(a,b){return a*a*b},b2:function(a,b,c,d){return this.b2p0(a,b)+this.b2p1(a,c)+this.b2p2(a,d)},b3p0:function(a,b){var c=1-a;return c*c*c*b},b3p1:function(a,b){var c=1-a;return 3*c*c*a*b},b3p2:function(a,b){return 3*(1-a)*a*a*b},b3p3:function(a,b){return a*a*a*b},b3:function(a,b,c,d,e){return this.b3p0(a,
b)+this.b3p1(a,c)+this.b3p2(a,d)+this.b3p3(a,e)}};THREE.LineCurve=function(a,b){this.v1=a;this.v2=b};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().sub(this.v1);b.multiplyScalar(a).add(this.v1);return b};THREE.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};THREE.LineCurve.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()};
THREE.QuadraticBezierCurve=function(a,b,c){this.v0=a;this.v1=b;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.getPoint=function(a){var b;b=THREE.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x);a=THREE.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y);return new THREE.Vector2(b,a)};
THREE.QuadraticBezierCurve.prototype.getTangent=function(a){var b;b=THREE.Curve.Utils.tangentQuadraticBezier(a,this.v0.x,this.v1.x,this.v2.x);a=THREE.Curve.Utils.tangentQuadraticBezier(a,this.v0.y,this.v1.y,this.v2.y);b=new THREE.Vector2(b,a);b.normalize();return b};THREE.CubicBezierCurve=function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);
THREE.CubicBezierCurve.prototype.getPoint=function(a){var b;b=THREE.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=THREE.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(b,a)};THREE.CubicBezierCurve.prototype.getTangent=function(a){var b;b=THREE.Curve.Utils.tangentCubicBezier(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=THREE.Curve.Utils.tangentCubicBezier(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);b=new THREE.Vector2(b,a);b.normalize();return b};
THREE.SplineCurve=function(a){this.points=void 0==a?[]:a};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.getPoint=function(a){var b=new THREE.Vector2,c=[],d=this.points,e;e=(d.length-1)*a;a=Math.floor(e);e-=a;c[0]=0==a?a:a-1;c[1]=a;c[2]=a>d.length-2?d.length-1:a+1;c[3]=a>d.length-3?d.length-1:a+2;b.x=THREE.Curve.Utils.interpolate(d[c[0]].x,d[c[1]].x,d[c[2]].x,d[c[3]].x,e);b.y=THREE.Curve.Utils.interpolate(d[c[0]].y,d[c[1]].y,d[c[2]].y,d[c[3]].y,e);return b};
THREE.EllipseCurve=function(a,b,c,d,e,f,g){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);
THREE.EllipseCurve.prototype.getPoint=function(a){var b;b=this.aEndAngle-this.aStartAngle;0>b&&(b+=2*Math.PI);b>2*Math.PI&&(b-=2*Math.PI);b=!0===this.aClockwise?this.aEndAngle+(1-a)*(2*Math.PI-b):this.aStartAngle+a*b;a=this.aX+this.xRadius*Math.cos(b);b=this.aY+this.yRadius*Math.sin(b);return new THREE.Vector2(a,b)};THREE.ArcCurve=function(a,b,c,d,e,f){THREE.EllipseCurve.call(this,a,b,c,c,d,e,f)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);
THREE.LineCurve3=THREE.Curve.create(function(a,b){this.v1=a;this.v2=b},function(a){var b=new THREE.Vector3;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var b,c;b=THREE.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x);c=THREE.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y);a=THREE.Shape.Utils.b2(a,this.v0.z,this.v1.z,this.v2.z);return new THREE.Vector3(b,c,a)});
THREE.CubicBezierCurve3=THREE.Curve.create(function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d},function(a){var b,c;b=THREE.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);c=THREE.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);a=THREE.Shape.Utils.b3(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new THREE.Vector3(b,c,a)});
THREE.SplineCurve3=THREE.Curve.create(function(a){this.points=void 0==a?[]:a},function(a){var b=new THREE.Vector3,c=[],d=this.points,e;a*=d.length-1;e=Math.floor(a);a-=e;c[0]=0==e?e:e-1;c[1]=e;c[2]=e>d.length-2?d.length-1:e+1;c[3]=e>d.length-3?d.length-1:e+2;e=d[c[0]];var f=d[c[1]],g=d[c[2]],c=d[c[3]];b.x=THREE.Curve.Utils.interpolate(e.x,f.x,g.x,c.x,a);b.y=THREE.Curve.Utils.interpolate(e.y,f.y,g.y,c.y,a);b.z=THREE.Curve.Utils.interpolate(e.z,f.z,g.z,c.z,a);return b});
THREE.ClosedSplineCurve3=THREE.Curve.create(function(a){this.points=void 0==a?[]:a},function(a){var b=new THREE.Vector3,c=[],d=this.points,e;e=(d.length-0)*a;a=Math.floor(e);e-=a;a+=0<a?0:(Math.floor(Math.abs(a)/d.length)+1)*d.length;c[0]=(a-1)%d.length;c[1]=a%d.length;c[2]=(a+1)%d.length;c[3]=(a+2)%d.length;b.x=THREE.Curve.Utils.interpolate(d[c[0]].x,d[c[1]].x,d[c[2]].x,d[c[3]].x,e);b.y=THREE.Curve.Utils.interpolate(d[c[0]].y,d[c[1]].y,d[c[2]].y,d[c[3]].y,e);b.z=THREE.Curve.Utils.interpolate(d[c[0]].z,
d[c[1]].z,d[c[2]].z,d[c[3]].z,e);return b});
THREE.AnimationHandler=function(){var a=[],b={},c={update:function(b){for(var c=0;c<a.length;c++)a[c].update(b)},addToUpdate:function(b){-1===a.indexOf(b)&&a.push(b)},removeFromUpdate:function(b){b=a.indexOf(b);-1!==b&&a.splice(b,1)},add:function(a){void 0!==b[a.name]&&console.log("THREE.AnimationHandler.add: Warning! "+a.name+" already exists in library. Overwriting.");b[a.name]=a;if(!0!==a.initialized){for(var c=0;c<a.hierarchy.length;c++){for(var d=0;d<a.hierarchy[c].keys.length;d++)if(0>a.hierarchy[c].keys[d].time&&
(a.hierarchy[c].keys[d].time=0),void 0!==a.hierarchy[c].keys[d].rot&&!(a.hierarchy[c].keys[d].rot instanceof THREE.Quaternion)){var h=a.hierarchy[c].keys[d].rot;a.hierarchy[c].keys[d].rot=(new THREE.Quaternion).fromArray(h)}if(a.hierarchy[c].keys.length&&void 0!==a.hierarchy[c].keys[0].morphTargets){h={};for(d=0;d<a.hierarchy[c].keys.length;d++)for(var k=0;k<a.hierarchy[c].keys[d].morphTargets.length;k++){var m=a.hierarchy[c].keys[d].morphTargets[k];h[m]=-1}a.hierarchy[c].usedMorphTargets=h;for(d=
0;d<a.hierarchy[c].keys.length;d++){var l={};for(m in h){for(k=0;k<a.hierarchy[c].keys[d].morphTargets.length;k++)if(a.hierarchy[c].keys[d].morphTargets[k]===m){l[m]=a.hierarchy[c].keys[d].morphTargetsInfluences[k];break}k===a.hierarchy[c].keys[d].morphTargets.length&&(l[m]=0)}a.hierarchy[c].keys[d].morphTargetsInfluences=l}}for(d=1;d<a.hierarchy[c].keys.length;d++)a.hierarchy[c].keys[d].time===a.hierarchy[c].keys[d-1].time&&(a.hierarchy[c].keys.splice(d,1),d--);for(d=0;d<a.hierarchy[c].keys.length;d++)a.hierarchy[c].keys[d].index=
d}a.initialized=!0}},remove:function(a){void 0===b[a]&&console.log("THREE.AnimationHandler.add: Warning! "+a+" doesn't exists in library. Doing nothing.");b[a]=void 0},get:function(a){if("string"===typeof a)return b[a]?b[a]:null},parse:function(a){var b=[];if(a instanceof THREE.SkinnedMesh)for(var c=0;c<a.skeleton.bones.length;c++)b.push(a.skeleton.bones[c]);else d(a,b);return b}},d=function(a,b){b.push(a);for(var c=0;c<a.children.length;c++)d(a.children[c],b)};c.LINEAR=0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=
2;return c}();THREE.Animation=function(a,b){this.root=a;this.data=THREE.AnimationHandler.get(b);this.hierarchy=THREE.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=this.isPaused=!0;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};THREE.Animation.prototype.keyTypes=["pos","rot","scl"];THREE.Animation.prototype.play=function(a,b){this.currentTime=void 0!==a?a:0;this.weight=void 0!==b?b:1;this.isPlaying=!0;this.isPaused=!1;this.reset();THREE.AnimationHandler.addToUpdate(this)};
THREE.Animation.prototype.pause=function(){!0===this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.removeFromUpdate(this)};
THREE.Animation.prototype.reset=function(){for(var a=0,b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a];c.matrixAutoUpdate=!0;void 0===c.animationCache&&(c.animationCache={});void 0===c.animationCache[this.data.name]&&(c.animationCache[this.data.name]={},c.animationCache[this.data.name].prevKey={pos:0,rot:0,scl:0},c.animationCache[this.data.name].nextKey={pos:0,rot:0,scl:0},c.animationCache[this.data.name].originalMatrix=c instanceof THREE.Bone?c.skinMatrix:c.matrix);for(var c=c.animationCache[this.data.name],
d=0;3>d;d++){for(var e=this.keyTypes[d],f=this.data.hierarchy[a].keys[0],g=this.getNextKeyWith(e,a,1);g.time<this.currentTime&&g.index>f.index;)f=g,g=this.getNextKeyWith(e,a,g.index+1);c.prevKey[e]=f;c.nextKey[e]=g}}};
THREE.Animation.prototype.update=function(){var a=[],b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Quaternion,e=function(a,b){var c=[],d=[],e,n,t,q,u,p;e=(a.length-1)*b;n=Math.floor(e);e-=n;c[0]=0===n?n:n-1;c[1]=n;c[2]=n>a.length-2?n:n+1;c[3]=n>a.length-3?n:n+2;n=a[c[0]];q=a[c[1]];u=a[c[2]];p=a[c[3]];c=e*e;t=e*c;d[0]=f(n[0],q[0],u[0],p[0],e,c,t);d[1]=f(n[1],q[1],u[1],p[1],e,c,t);d[2]=f(n[2],q[2],u[2],p[2],e,c,t);return d},f=function(a,b,c,d,e,f,t){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*t+
(-3*(b-c)-2*a-d)*f+a*e+b};return function(f){if(!1!==this.isPlaying&&(this.currentTime+=f*this.timeScale,0!==this.weight)){var h;f=this.data.length;if(!0===this.loop&&this.currentTime>f)this.currentTime%=f,this.reset();else if(!1===this.loop&&this.currentTime>f){this.stop();return}f=0;for(var k=this.hierarchy.length;f<k;f++)for(var m=this.hierarchy[f],l=m.animationCache[this.data.name],n=0;3>n;n++){h=this.keyTypes[n];var t=l.prevKey[h],q=l.nextKey[h];if(q.time<=this.currentTime){t=this.data.hierarchy[f].keys[0];
for(q=this.getNextKeyWith(h,f,1);q.time<this.currentTime&&q.index>t.index;)t=q,q=this.getNextKeyWith(h,f,q.index+1);l.prevKey[h]=t;l.nextKey[h]=q}m.matrixAutoUpdate=!0;m.matrixWorldNeedsUpdate=!0;var u=(this.currentTime-t.time)/(q.time-t.time),p=t[h],v=q[h];0>u&&(u=0);1<u&&(u=1);if("pos"===h)if(h=m.position,this.interpolationType===THREE.AnimationHandler.LINEAR)c.x=p[0]+(v[0]-p[0])*u,c.y=p[1]+(v[1]-p[1])*u,c.z=p[2]+(v[2]-p[2])*u,m instanceof THREE.Bone&&(t=this.weight/(this.weight+m.accumulatedPosWeight),
h.lerp(c,t),m.accumulatedPosWeight+=this.weight);else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)a[0]=this.getPrevKeyWith("pos",f,t.index-1).pos,a[1]=p,a[2]=v,a[3]=this.getNextKeyWith("pos",f,q.index+1).pos,u=.33*u+.33,q=e(a,u),m instanceof THREE.Bone?(t=this.weight/(this.weight+m.accumulatedPosWeight),m.accumulatedPosWeight+=this.weight):t=1,h.x+=(q[0]-h.x)*t,h.y+=(q[1]-h.y)*t,h.z+=(q[2]-h.z)*t,this.interpolationType===
THREE.AnimationHandler.CATMULLROM_FORWARD&&(u=e(a,1.01*u),b.set(u[0],u[1],u[2]),b.sub(h),b.y=0,b.normalize(),h=Math.atan2(b.x,b.z),m.rotation.set(0,h,0))}else"rot"===h?(THREE.Quaternion.slerp(p,v,d,u),m instanceof THREE.Bone?0===m.accumulatedRotWeight?(m.quaternion.copy(d),m.accumulatedRotWeight=this.weight):(t=this.weight/(this.weight+m.accumulatedRotWeight),THREE.Quaternion.slerp(m.quaternion,d,m.quaternion,t),m.accumulatedRotWeight+=this.weight):m.quaternion.copy(d)):"scl"===h&&(h=m.scale,c.x=
p[0]+(v[0]-p[0])*u,c.y=p[1]+(v[1]-p[1])*u,c.z=p[2]+(v[2]-p[2])*u,m instanceof THREE.Bone&&(t=this.weight/(this.weight+m.accumulatedSclWeight),h.lerp(c,t),m.accumulatedSclWeight+=this.weight))}return!0}}}();
THREE.Animation.prototype.getNextKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c<d.length-1?c:d.length-1:c%d.length;c<d.length;c++)if(void 0!==d[c][a])return d[c];return this.data.hierarchy[b].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<c?c:0:0<=c?c:c+d.length;0<=c;c--)if(void 0!==d[c][a])return d[c];return this.data.hierarchy[b].keys[d.length-1]};
THREE.KeyFrameAnimation=function(a,b){this.root=a;this.data=THREE.AnimationHandler.get(b);this.hierarchy=THREE.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=.001;this.isPlaying=!1;this.loop=this.isPaused=!0;for(var c=0,d=this.hierarchy.length;c<d;c++){var e=this.data.hierarchy[c].sids,f=this.hierarchy[c];if(this.data.hierarchy[c].keys.length&&e){for(var g=0;g<e.length;g++){var h=e[g],k=this.getNextKeyWith(h,c,0);k&&k.apply(h)}f.matrixAutoUpdate=!1;this.data.hierarchy[c].node.updateMatrix();
f.matrixWorldNeedsUpdate=!0}}};
THREE.KeyFrameAnimation.prototype.play=function(a){this.currentTime=void 0!==a?a:0;if(!1===this.isPlaying){this.isPlaying=!0;var b=this.hierarchy.length,c,d;for(a=0;a<b;a++)c=this.hierarchy[a],d=this.data.hierarchy[a],void 0===d.animationCache&&(d.animationCache={},d.animationCache.prevKey=null,d.animationCache.nextKey=null,d.animationCache.originalMatrix=c instanceof THREE.Bone?c.skinMatrix:c.matrix),c=this.data.hierarchy[a].keys,c.length&&(d.animationCache.prevKey=c[0],d.animationCache.nextKey=
c[1],this.startTime=Math.min(c[0].time,this.startTime),this.endTime=Math.max(c[c.length-1].time,this.endTime));this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var a=0;a<this.data.hierarchy.length;a++){var b=this.hierarchy[a],c=this.data.hierarchy[a];if(void 0!==c.animationCache){var d=c.animationCache.originalMatrix;b instanceof THREE.Bone?(d.copy(b.skinMatrix),b.skinMatrix=d):(d.copy(b.matrix),b.matrix=d);delete c.animationCache}}};
THREE.KeyFrameAnimation.prototype.update=function(a){if(!1!==this.isPlaying){this.currentTime+=a*this.timeScale;a=this.data.length;!0===this.loop&&this.currentTime>a&&(this.currentTime%=a);this.currentTime=Math.min(this.currentTime,a);a=0;for(var b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a],d=this.data.hierarchy[a],e=d.keys,d=d.animationCache;if(e.length){var f=d.prevKey,g=d.nextKey;if(g.time<=this.currentTime){for(;g.time<this.currentTime&&g.index>f.index;)f=g,g=e[f.index+1];d.prevKey=
f;d.nextKey=g}g.time>=this.currentTime?f.interpolate(g,this.currentTime):f.interpolate(g,g.time);this.data.hierarchy[a].node.updateMatrix();c.matrixWorldNeedsUpdate=!0}}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(a,b,c){b=this.data.hierarchy[b].keys;for(c%=b.length;c<b.length;c++)if(b[c].hasTarget(a))return b[c];return b[0]};
THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(a,b,c){b=this.data.hierarchy[b].keys;for(c=0<=c?c:c+b.length;0<=c;c--)if(b[c].hasTarget(a))return b[c];return b[b.length-1]};THREE.MorphAnimation=function(a){this.mesh=a;this.frames=a.morphTargetInfluences.length;this.currentTime=0;this.duration=1E3;this.loop=!0;this.isPlaying=!1};
THREE.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(){var a=0,b=0;return function(c){if(!1!==this.isPlaying){this.currentTime+=c;!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration);this.currentTime=Math.min(this.currentTime,this.duration);c=this.duration/this.frames;var d=Math.floor(this.currentTime/c);d!=b&&(this.mesh.morphTargetInfluences[a]=0,this.mesh.morphTargetInfluences[b]=1,this.mesh.morphTargetInfluences[d]=
0,a=b,b=d);this.mesh.morphTargetInfluences[d]=this.currentTime%c/c;this.mesh.morphTargetInfluences[a]=1-this.mesh.morphTargetInfluences[d]}}}()};
THREE.CubeCamera=function(a,b,c){THREE.Object3D.call(this);var d=new THREE.PerspectiveCamera(90,1,a,b);d.up.set(0,-1,0);d.lookAt(new THREE.Vector3(1,0,0));this.add(d);var e=new THREE.PerspectiveCamera(90,1,a,b);e.up.set(0,-1,0);e.lookAt(new THREE.Vector3(-1,0,0));this.add(e);var f=new THREE.PerspectiveCamera(90,1,a,b);f.up.set(0,0,1);f.lookAt(new THREE.Vector3(0,1,0));this.add(f);var g=new THREE.PerspectiveCamera(90,1,a,b);g.up.set(0,0,-1);g.lookAt(new THREE.Vector3(0,-1,0));this.add(g);var h=new THREE.PerspectiveCamera(90,
1,a,b);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,1));this.add(h);var k=new THREE.PerspectiveCamera(90,1,a,b);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,-1));this.add(k);this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(a,b){var c=this.renderTarget,t=c.generateMipmaps;c.generateMipmaps=!1;c.activeCubeFace=0;a.render(b,d,c);c.activeCubeFace=1;a.render(b,e,c);c.activeCubeFace=
2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.generateMipmaps=t;c.activeCubeFace=5;a.render(b,k,c)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CombinedCamera=function(a,b,c,d,e,f,g){THREE.Camera.call(this);this.fov=c;this.left=-a/2;this.right=a/2;this.top=b/2;this.bottom=-b/2;this.cameraO=new THREE.OrthographicCamera(a/-2,a/2,b/2,b/-2,f,g);this.cameraP=new THREE.PerspectiveCamera(c,a/b,d,e);this.zoom=1;this.toPerspective()};
THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype);THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPerspectiveMode=!0;this.inOrthographicMode=!1};
THREE.CombinedCamera.prototype.toOrthographic=function(){var a=this.cameraP.aspect,b=(this.cameraP.near+this.cameraP.far)/2,b=Math.tan(this.fov/2)*b,a=2*b*a/2,b=b/this.zoom,a=a/this.zoom;this.cameraO.left=-a;this.cameraO.right=a;this.cameraO.top=b;this.cameraO.bottom=-b;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPerspectiveMode=!1;this.inOrthographicMode=!0};
THREE.CombinedCamera.prototype.setSize=function(a,b){this.cameraP.aspect=a/b;this.left=-a/2;this.right=a/2;this.top=b/2;this.bottom=-b/2};THREE.CombinedCamera.prototype.setFov=function(a){this.fov=a;this.inPerspectiveMode?this.toPerspective():this.toOrthographic()};THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())};
THREE.CombinedCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);var c=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));this.setFov(c);return c};THREE.CombinedCamera.prototype.setZoom=function(a){this.zoom=a;this.inPerspectiveMode?this.toPerspective():this.toOrthographic()};THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};
THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=!1};THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};
THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};
THREE.BoxGeometry=function(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,p){var v,x=h.widthSegments,w=h.heightSegments,y=e/2,M=f/2,z=h.vertices.length;if("x"===a&&"y"===b||"y"===a&&"x"===b)v="z";else if("x"===a&&"z"===b||"z"===a&&"x"===b)v="y",w=h.depthSegments;else if("z"===a&&"y"===b||"y"===a&&"z"===b)v="x",x=h.depthSegments;var K=x+1,H=w+1,D=e/x,L=f/w,A=new THREE.Vector3;A[v]=0<g?1:-1;for(e=0;e<H;e++)for(f=0;f<K;f++){var E=new THREE.Vector3;E[a]=(f*D-y)*c;E[b]=(e*L-M)*d;E[v]=g;h.vertices.push(E)}for(e=
0;e<w;e++)for(f=0;f<x;f++)M=f+K*e,a=f+K*(e+1),b=f+1+K*(e+1),c=f+1+K*e,d=new THREE.Vector2(f/x,1-e/w),g=new THREE.Vector2(f/x,1-(e+1)/w),v=new THREE.Vector2((f+1)/x,1-(e+1)/w),y=new THREE.Vector2((f+1)/x,1-e/w),M=new THREE.Face3(M+z,a+z,c+z),M.normal.copy(A),M.vertexNormals.push(A.clone(),A.clone(),A.clone()),M.materialIndex=p,h.faces.push(M),h.faceVertexUvs[0].push([d,g,y]),M=new THREE.Face3(a+z,b+z,c+z),M.normal.copy(A),M.vertexNormals.push(A.clone(),A.clone(),A.clone()),M.materialIndex=p,h.faces.push(M),
h.faceVertexUvs[0].push([g.clone(),v,y.clone()])}THREE.Geometry.call(this);this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.widthSegments=d||1;this.heightSegments=e||1;this.depthSegments=f||1;var h=this;d=a/2;e=b/2;f=c/2;g("z","y",-1,-1,c,b,d,0);g("z","y",1,-1,c,b,-d,1);g("x","z",1,1,a,c,e,2);g("x","z",1,-1,a,c,-e,3);g("x","y",1,-1,a,b,f,4);g("x","y",-1,-1,a,b,-f,5);this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.CircleGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};a=a||50;b=void 0!==b?Math.max(3,b):8;c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;var e,f=[];e=new THREE.Vector3;var g=new THREE.Vector2(.5,.5);this.vertices.push(e);f.push(g);for(e=0;e<=b;e++){var h=new THREE.Vector3,k=c+e/b*d;h.x=a*Math.cos(k);h.y=a*Math.sin(k);this.vertices.push(h);f.push(new THREE.Vector2((h.x/a+1)/2,(h.y/a+1)/2))}c=new THREE.Vector3(0,0,1);for(e=1;e<=
b;e++)this.faces.push(new THREE.Face3(e,e+1,0,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([f[e].clone(),f[e+1].clone(),g.clone()]);this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CubeGeometry=function(a,b,c,d,e,f){console.warn("DEPRECATED: THREE.CubeGeometry is deprecated. Use THREE.BoxGeometry instead.");return new THREE.BoxGeometry(a,b,c,d,e,f)};
THREE.CylinderGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f};a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=d||8;e=e||1;f=void 0!==f?f:!1;var g=c/2,h,k,m=[],l=[];for(k=0;k<=e;k++){var n=[],t=[],q=k/e,u=q*(b-a)+a;for(h=0;h<=d;h++){var p=h/d,v=new THREE.Vector3;v.x=u*Math.sin(p*Math.PI*2);v.y=-q*c+g;v.z=u*Math.cos(p*Math.PI*2);this.vertices.push(v);n.push(this.vertices.length-1);t.push(new THREE.Vector2(p,
1-q))}m.push(n);l.push(t)}c=(b-a)/c;for(h=0;h<d;h++)for(0!==a?(n=this.vertices[m[0][h]].clone(),t=this.vertices[m[0][h+1]].clone()):(n=this.vertices[m[1][h]].clone(),t=this.vertices[m[1][h+1]].clone()),n.setY(Math.sqrt(n.x*n.x+n.z*n.z)*c).normalize(),t.setY(Math.sqrt(t.x*t.x+t.z*t.z)*c).normalize(),k=0;k<e;k++){var q=m[k][h],u=m[k+1][h],p=m[k+1][h+1],v=m[k][h+1],x=n.clone(),w=n.clone(),y=t.clone(),M=t.clone(),z=l[k][h].clone(),K=l[k+1][h].clone(),H=l[k+1][h+1].clone(),D=l[k][h+1].clone();this.faces.push(new THREE.Face3(q,
u,v,[x,w,M]));this.faceVertexUvs[0].push([z,K,D]);this.faces.push(new THREE.Face3(u,p,v,[w.clone(),y,M.clone()]));this.faceVertexUvs[0].push([K.clone(),H,D.clone()])}if(!1===f&&0<a)for(this.vertices.push(new THREE.Vector3(0,g,0)),h=0;h<d;h++)q=m[0][h],u=m[0][h+1],p=this.vertices.length-1,x=new THREE.Vector3(0,1,0),w=new THREE.Vector3(0,1,0),y=new THREE.Vector3(0,1,0),z=l[0][h].clone(),K=l[0][h+1].clone(),H=new THREE.Vector2(K.x,0),this.faces.push(new THREE.Face3(q,u,p,[x,w,y])),this.faceVertexUvs[0].push([z,
K,H]);if(!1===f&&0<b)for(this.vertices.push(new THREE.Vector3(0,-g,0)),h=0;h<d;h++)q=m[k][h+1],u=m[k][h],p=this.vertices.length-1,x=new THREE.Vector3(0,-1,0),w=new THREE.Vector3(0,-1,0),y=new THREE.Vector3(0,-1,0),z=l[k][h+1].clone(),K=l[k][h].clone(),H=new THREE.Vector2(K.x,1),this.faces.push(new THREE.Face3(q,u,p,[x,w,y])),this.faceVertexUvs[0].push([z,K,H]);this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.ExtrudeGeometry=function(a,b){"undefined"!==typeof a&&(THREE.Geometry.call(this),a=a instanceof Array?a:[a],this.shapebb=a[a.length-1].getBoundingBox(),this.addShapeList(a,b),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,d=0;d<c;d++)this.addShape(a[d],b)};
THREE.ExtrudeGeometry.prototype.addShape=function(a,b){function c(a,b,c){b||console.log("die");return b.clone().multiplyScalar(c).add(a)}function d(a,b,c){var d=THREE.Math.sign,e=1,e=a.x-b.x,f=a.y-b.y,g=c.x-a.x,h=c.y-a.y,l=e*e+f*f;if(1E-10<Math.abs(e*h-f*g)){var k=Math.sqrt(l),d=Math.sqrt(g*g+h*h),l=b.x-f/k;b=b.y+e/k;g=((c.x-h/d-l)*h-(c.y+g/d-b)*g)/(e*h-f*g);c=l+e*g-a.x;a=b+f*g-a.y;e=c*c+a*a;if(2>=e)return new THREE.Vector2(c,a);e=Math.sqrt(e/2)}else a=!1,1E-10<e?1E-10<g&&(a=!0):-1E-10>e?-1E-10>g&&
(a=!0):d(f)==d(h)&&(a=!0),a?(c=-f,a=e,e=Math.sqrt(l)):(c=e,a=f,e=Math.sqrt(l/2));return new THREE.Vector2(c/e,a/e)}function e(c,d){var e,f;for(I=c.length;0<=--I;){e=I;f=I-1;0>f&&(f=c.length-1);for(var g=0,h=q+2*l,g=0;g<h;g++){var k=ba*g,m=ba*(g+1),n=d+e+k,k=d+f+k,p=d+f+m,m=d+e+m,u=c,t=g,v=h,x=e,J=f,n=n+F,k=k+F,p=p+F,m=m+F;E.faces.push(new THREE.Face3(n,k,m,null,null,w));E.faces.push(new THREE.Face3(k,p,m,null,null,w));n=y.generateSideWallUV(E,a,u,b,n,k,p,m,t,v,x,J);E.faceVertexUvs[0].push([n[0],n[1],
n[3]]);E.faceVertexUvs[0].push([n[1],n[2],n[3]])}}}function f(a,b,c){E.vertices.push(new THREE.Vector3(a,b,c))}function g(c,d,e,f){c+=F;d+=F;e+=F;E.faces.push(new THREE.Face3(c,d,e,null,null,x));c=f?y.generateBottomUV(E,a,b,c,d,e):y.generateTopUV(E,a,b,c,d,e);E.faceVertexUvs[0].push(c)}var h=void 0!==b.amount?b.amount:100,k=void 0!==b.bevelThickness?b.bevelThickness:6,m=void 0!==b.bevelSize?b.bevelSize:k-2,l=void 0!==b.bevelSegments?b.bevelSegments:3,n=void 0!==b.bevelEnabled?b.bevelEnabled:!0,t=
void 0!==b.curveSegments?b.curveSegments:12,q=void 0!==b.steps?b.steps:1,u=b.extrudePath,p,v=!1,x=b.material,w=b.extrudeMaterial,y=void 0!==b.UVGenerator?b.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,M,z,K,H;u&&(p=u.getSpacedPoints(q),v=!0,n=!1,M=void 0!==b.frames?b.frames:new THREE.TubeGeometry.FrenetFrames(u,q,!1),z=new THREE.Vector3,K=new THREE.Vector3,H=new THREE.Vector3);n||(m=k=l=0);var D,L,A,E=this,F=this.vertices.length,u=a.extractPoints(t),t=u.shape,J=u.holes;if(u=!THREE.Shape.Utils.isClockWise(t)){t=
t.reverse();L=0;for(A=J.length;L<A;L++)D=J[L],THREE.Shape.Utils.isClockWise(D)&&(J[L]=D.reverse());u=!1}var N=THREE.Shape.Utils.triangulateShape(t,J),B=t;L=0;for(A=J.length;L<A;L++)D=J[L],t=t.concat(D);var C,G,Q,Z,T,ba=t.length,V,S=N.length,u=[],I=0;Q=B.length;C=Q-1;for(G=I+1;I<Q;I++,C++,G++)C===Q&&(C=0),G===Q&&(G=0),u[I]=d(B[I],B[C],B[G]);var Y=[],$,ca=u.concat();L=0;for(A=J.length;L<A;L++){D=J[L];$=[];I=0;Q=D.length;C=Q-1;for(G=I+1;I<Q;I++,C++,G++)C===Q&&(C=0),G===Q&&(G=0),$[I]=d(D[I],D[C],D[G]);
Y.push($);ca=ca.concat($)}for(C=0;C<l;C++){Q=C/l;Z=k*(1-Q);G=m*Math.sin(Q*Math.PI/2);I=0;for(Q=B.length;I<Q;I++)T=c(B[I],u[I],G),f(T.x,T.y,-Z);L=0;for(A=J.length;L<A;L++)for(D=J[L],$=Y[L],I=0,Q=D.length;I<Q;I++)T=c(D[I],$[I],G),f(T.x,T.y,-Z)}G=m;for(I=0;I<ba;I++)T=n?c(t[I],ca[I],G):t[I],v?(K.copy(M.normals[0]).multiplyScalar(T.x),z.copy(M.binormals[0]).multiplyScalar(T.y),H.copy(p[0]).add(K).add(z),f(H.x,H.y,H.z)):f(T.x,T.y,0);for(Q=1;Q<=q;Q++)for(I=0;I<ba;I++)T=n?c(t[I],ca[I],G):t[I],v?(K.copy(M.normals[Q]).multiplyScalar(T.x),
z.copy(M.binormals[Q]).multiplyScalar(T.y),H.copy(p[Q]).add(K).add(z),f(H.x,H.y,H.z)):f(T.x,T.y,h/q*Q);for(C=l-1;0<=C;C--){Q=C/l;Z=k*(1-Q);G=m*Math.sin(Q*Math.PI/2);I=0;for(Q=B.length;I<Q;I++)T=c(B[I],u[I],G),f(T.x,T.y,h+Z);L=0;for(A=J.length;L<A;L++)for(D=J[L],$=Y[L],I=0,Q=D.length;I<Q;I++)T=c(D[I],$[I],G),v?f(T.x,T.y+p[q-1].y,p[q-1].x+Z):f(T.x,T.y,h+Z)}(function(){if(n){var a;a=0*ba;for(I=0;I<S;I++)V=N[I],g(V[2]+a,V[1]+a,V[0]+a,!0);a=q+2*l;a*=ba;for(I=0;I<S;I++)V=N[I],g(V[0]+a,V[1]+a,V[2]+a,!1)}else{for(I=
0;I<S;I++)V=N[I],g(V[2],V[1],V[0],!0);for(I=0;I<S;I++)V=N[I],g(V[0]+ba*q,V[1]+ba*q,V[2]+ba*q,!1)}})();(function(){var a=0;e(B,a);a+=B.length;L=0;for(A=J.length;L<A;L++)D=J[L],e(D,a),a+=D.length})()};
THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,c,d,e,f){b=a.vertices[e].x;e=a.vertices[e].y;c=a.vertices[f].x;f=a.vertices[f].y;return[new THREE.Vector2(a.vertices[d].x,a.vertices[d].y),new THREE.Vector2(b,e),new THREE.Vector2(c,f)]},generateBottomUV:function(a,b,c,d,e,f){return this.generateTopUV(a,b,c,d,e,f)},generateSideWallUV:function(a,b,c,d,e,f,g,h,k,m,l,n){b=a.vertices[e].x;c=a.vertices[e].y;e=a.vertices[e].z;d=a.vertices[f].x;k=a.vertices[f].y;f=a.vertices[f].z;m=a.vertices[g].x;
l=a.vertices[g].y;g=a.vertices[g].z;n=a.vertices[h].x;var t=a.vertices[h].y;a=a.vertices[h].z;return.01>Math.abs(c-k)?[new THREE.Vector2(b,1-e),new THREE.Vector2(d,1-f),new THREE.Vector2(m,1-g),new THREE.Vector2(n,1-a)]:[new THREE.Vector2(c,1-e),new THREE.Vector2(k,1-f),new THREE.Vector2(l,1-g),new THREE.Vector2(t,1-a)]}};THREE.ExtrudeGeometry.__v1=new THREE.Vector2;THREE.ExtrudeGeometry.__v2=new THREE.Vector2;THREE.ExtrudeGeometry.__v3=new THREE.Vector2;THREE.ExtrudeGeometry.__v4=new THREE.Vector2;
THREE.ExtrudeGeometry.__v5=new THREE.Vector2;THREE.ExtrudeGeometry.__v6=new THREE.Vector2;THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);!1===a instanceof Array&&(a=[a]);this.shapebb=a[a.length-1].getBoundingBox();this.addShapeList(a,b);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++)this.addShape(a[c],b);return this};
THREE.ShapeGeometry.prototype.addShape=function(a,b){void 0===b&&(b={});var c=b.material,d=void 0===b.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator,e,f,g,h=this.vertices.length;e=a.extractPoints(void 0!==b.curveSegments?b.curveSegments:12);var k=e.shape,m=e.holes;if(!THREE.Shape.Utils.isClockWise(k))for(k=k.reverse(),e=0,f=m.length;e<f;e++)g=m[e],THREE.Shape.Utils.isClockWise(g)&&(m[e]=g.reverse());var l=THREE.Shape.Utils.triangulateShape(k,m);e=0;for(f=m.length;e<f;e++)g=m[e],
k=k.concat(g);m=k.length;f=l.length;for(e=0;e<m;e++)g=k[e],this.vertices.push(new THREE.Vector3(g.x,g.y,0));for(e=0;e<f;e++)m=l[e],k=m[0]+h,g=m[1]+h,m=m[2]+h,this.faces.push(new THREE.Face3(k,g,m,null,null,c)),this.faceVertexUvs[0].push(d.generateBottomUV(this,a,b,k,g,m))};
THREE.LatheGeometry=function(a,b,c,d){THREE.Geometry.call(this);b=b||12;c=c||0;d=d||2*Math.PI;for(var e=1/(a.length-1),f=1/b,g=0,h=b;g<=h;g++)for(var k=c+g*f*d,m=Math.cos(k),l=Math.sin(k),k=0,n=a.length;k<n;k++){var t=a[k],q=new THREE.Vector3;q.x=m*t.x-l*t.y;q.y=l*t.x+m*t.y;q.z=t.z;this.vertices.push(q)}c=a.length;g=0;for(h=b;g<h;g++)for(k=0,n=a.length-1;k<n;k++){b=l=k+c*g;d=l+c;var m=l+1+c,l=l+1,t=g*f,q=k*e,u=t+f,p=q+e;this.faces.push(new THREE.Face3(b,d,l));this.faceVertexUvs[0].push([new THREE.Vector2(t,
q),new THREE.Vector2(u,q),new THREE.Vector2(t,p)]);this.faces.push(new THREE.Face3(d,m,l));this.faceVertexUvs[0].push([new THREE.Vector2(u,q),new THREE.Vector2(u,p),new THREE.Vector2(t,p)])}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.PlaneGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,f=b/2;c=c||1;d=d||1;var g=c+1,h=d+1,k=a/c,m=b/d,l=new THREE.Vector3(0,0,1);for(a=0;a<h;a++){var n=a*m-f;for(b=0;b<g;b++)this.vertices.push(new THREE.Vector3(b*k-e,-n,0))}for(a=0;a<d;a++)for(b=0;b<c;b++){var t=b+g*a,e=b+g*(a+1),f=b+1+g*(a+1),h=b+1+g*a,k=new THREE.Vector2(b/c,1-a/d),m=new THREE.Vector2(b/c,1-(a+1)/d),n=new THREE.Vector2((b+1)/c,1-(a+1)/d),q=new THREE.Vector2((b+
1)/c,1-a/d),t=new THREE.Face3(t,e,h);t.normal.copy(l);t.vertexNormals.push(l.clone(),l.clone(),l.clone());this.faces.push(t);this.faceVertexUvs[0].push([k,m,q]);t=new THREE.Face3(e,f,h);t.normal.copy(l);t.vertexNormals.push(l.clone(),l.clone(),l.clone());this.faces.push(t);this.faceVertexUvs[0].push([m.clone(),n,q.clone()])}};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.RingGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);a=a||0;b=b||50;e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?Math.max(3,d):8;var g,h=[],k=a,m=(b-a)/d;for(a=0;a<=d;a++){for(g=0;g<=c;g++){var l=new THREE.Vector3,n=e+g/c*f;l.x=k*Math.cos(n);l.y=k*Math.sin(n);this.vertices.push(l);h.push(new THREE.Vector2((l.x/b+1)/2,(l.y/b+1)/2))}k+=m}b=new THREE.Vector3(0,0,1);for(a=0;a<d;a++)for(e=a*c,g=0;g<=c;g++)n=g+e,f=n+a,m=n+c+a,l=n+c+1+a,this.faces.push(new THREE.Face3(f,
m,l,[b.clone(),b.clone(),b.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[m].clone(),h[l].clone()]),f=n+a,m=n+c+1+a,l=n+1+a,this.faces.push(new THREE.Face3(f,m,l,[b.clone(),b.clone(),b.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[m].clone(),h[l].clone()]);this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,k)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.SphereGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;var h,k,m=[],l=[];for(k=0;k<=c;k++){var n=[],t=[];for(h=0;h<=b;h++){var q=h/b,u=k/c,p=new THREE.Vector3;p.x=-a*Math.cos(d+q*e)*Math.sin(f+u*g);p.y=a*Math.cos(f+u*g);p.z=
a*Math.sin(d+q*e)*Math.sin(f+u*g);this.vertices.push(p);n.push(this.vertices.length-1);t.push(new THREE.Vector2(q,1-u))}m.push(n);l.push(t)}for(k=0;k<c;k++)for(h=0;h<b;h++){d=m[k][h+1];e=m[k][h];f=m[k+1][h];g=m[k+1][h+1];var n=this.vertices[d].clone().normalize(),t=this.vertices[e].clone().normalize(),q=this.vertices[f].clone().normalize(),u=this.vertices[g].clone().normalize(),p=l[k][h+1].clone(),v=l[k][h].clone(),x=l[k+1][h].clone(),w=l[k+1][h+1].clone();Math.abs(this.vertices[d].y)===a?(p.x=(p.x+
v.x)/2,this.faces.push(new THREE.Face3(d,f,g,[n,q,u])),this.faceVertexUvs[0].push([p,x,w])):Math.abs(this.vertices[f].y)===a?(x.x=(x.x+w.x)/2,this.faces.push(new THREE.Face3(d,e,f,[n,t,q])),this.faceVertexUvs[0].push([p,v,x])):(this.faces.push(new THREE.Face3(d,e,g,[n,t,u])),this.faceVertexUvs[0].push([p,v,w]),this.faces.push(new THREE.Face3(e,f,g,[t.clone(),q,u.clone()])),this.faceVertexUvs[0].push([v.clone(),x,w.clone()]))}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,
a)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TextGeometry=function(a,b){b=b||{};var c=THREE.FontUtils.generateShapes(a,b);b.amount=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===b.bevelEnabled&&(b.bevelEnabled=!1);THREE.ExtrudeGeometry.call(this,c,b)};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);
THREE.TorusGeometry=function(a,b,c,d,e){THREE.Geometry.call(this);this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||100;b=b||40;c=c||8;d=d||6;e=e||2*Math.PI;for(var f=new THREE.Vector3,g=[],h=[],k=0;k<=c;k++)for(var m=0;m<=d;m++){var l=m/d*e,n=k/c*Math.PI*2;f.x=a*Math.cos(l);f.y=a*Math.sin(l);var t=new THREE.Vector3;t.x=(a+b*Math.cos(n))*Math.cos(l);t.y=(a+b*Math.cos(n))*Math.sin(l);t.z=b*Math.sin(n);this.vertices.push(t);g.push(new THREE.Vector2(m/d,k/c));h.push(t.clone().sub(f).normalize())}for(k=
1;k<=c;k++)for(m=1;m<=d;m++)a=(d+1)*k+m-1,b=(d+1)*(k-1)+m-1,e=(d+1)*(k-1)+m,f=(d+1)*k+m,l=new THREE.Face3(a,b,f,[h[a].clone(),h[b].clone(),h[f].clone()]),this.faces.push(l),this.faceVertexUvs[0].push([g[a].clone(),g[b].clone(),g[f].clone()]),l=new THREE.Face3(b,e,f,[h[b].clone(),h[e].clone(),h[f].clone()]),this.faces.push(l),this.faceVertexUvs[0].push([g[b].clone(),g[e].clone(),g[f].clone()]);this.computeFaceNormals()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.TorusKnotGeometry=function(a,b,c,d,e,f,g){function h(a,b,c,d,e){var f=Math.cos(a),g=Math.sin(a);a*=b/c;b=Math.cos(a);f=f*d*(2+b)*.5;g=d*(2+b)*g*.5;d=e*d*Math.sin(a)*.5;return new THREE.Vector3(f,g,d)}THREE.Geometry.call(this);this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,p:e,q:f,heightScale:g};a=a||100;b=b||40;c=c||64;d=d||8;e=e||2;f=f||3;g=g||1;for(var k=Array(c),m=new THREE.Vector3,l=new THREE.Vector3,n=new THREE.Vector3,t=0;t<c;++t){k[t]=Array(d);var q=t/c*2*e*Math.PI,
u=h(q,f,e,a,g),q=h(q+.01,f,e,a,g);m.subVectors(q,u);l.addVectors(q,u);n.crossVectors(m,l);l.crossVectors(n,m);n.normalize();l.normalize();for(q=0;q<d;++q){var p=q/d*2*Math.PI,v=-b*Math.cos(p),p=b*Math.sin(p),x=new THREE.Vector3;x.x=u.x+v*l.x+p*n.x;x.y=u.y+v*l.y+p*n.y;x.z=u.z+v*l.z+p*n.z;k[t][q]=this.vertices.push(x)-1}}for(t=0;t<c;++t)for(q=0;q<d;++q)e=(t+1)%c,f=(q+1)%d,a=k[t][q],b=k[e][q],e=k[e][f],f=k[t][f],g=new THREE.Vector2(t/c,q/d),m=new THREE.Vector2((t+1)/c,q/d),l=new THREE.Vector2((t+1)/
c,(q+1)/d),n=new THREE.Vector2(t/c,(q+1)/d),this.faces.push(new THREE.Face3(a,b,f)),this.faceVertexUvs[0].push([g,m,n]),this.faces.push(new THREE.Face3(b,e,f)),this.faceVertexUvs[0].push([m.clone(),l,n.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.TubeGeometry=function(a,b,c,d,e){THREE.Geometry.call(this);this.parameters={path:a,segments:b,radius:c,radialSegments:d,closed:e};b=b||64;c=c||1;d=d||8;e=e||!1;var f=[],g,h,k=b+1,m,l,n,t,q=new THREE.Vector3,u,p,v;u=new THREE.TubeGeometry.FrenetFrames(a,b,e);p=u.normals;v=u.binormals;this.tangents=u.tangents;this.normals=p;this.binormals=v;for(u=0;u<k;u++)for(f[u]=[],m=u/(k-1),t=a.getPointAt(m),g=p[u],h=v[u],m=0;m<d;m++)l=m/d*2*Math.PI,n=-c*Math.cos(l),l=c*Math.sin(l),q.copy(t),q.x+=n*g.x+l*
h.x,q.y+=n*g.y+l*h.y,q.z+=n*g.z+l*h.z,f[u][m]=this.vertices.push(new THREE.Vector3(q.x,q.y,q.z))-1;for(u=0;u<b;u++)for(m=0;m<d;m++)k=e?(u+1)%b:u+1,q=(m+1)%d,a=f[u][m],c=f[k][m],k=f[k][q],q=f[u][q],p=new THREE.Vector2(u/b,m/d),v=new THREE.Vector2((u+1)/b,m/d),g=new THREE.Vector2((u+1)/b,(m+1)/d),h=new THREE.Vector2(u/b,(m+1)/d),this.faces.push(new THREE.Face3(a,c,q)),this.faceVertexUvs[0].push([p,v,h]),this.faces.push(new THREE.Face3(c,k,q)),this.faceVertexUvs[0].push([v.clone(),g,h.clone()]);this.computeFaceNormals();
this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.TubeGeometry.FrenetFrames=function(a,b,c){new THREE.Vector3;var d=new THREE.Vector3;new THREE.Vector3;var e=[],f=[],g=[],h=new THREE.Vector3,k=new THREE.Matrix4;b+=1;var m,l,n;this.tangents=e;this.normals=f;this.binormals=g;for(m=0;m<b;m++)l=m/(b-1),e[m]=a.getTangentAt(l),e[m].normalize();f[0]=new THREE.Vector3;g[0]=new THREE.Vector3;a=Number.MAX_VALUE;m=Math.abs(e[0].x);l=Math.abs(e[0].y);n=Math.abs(e[0].z);m<=a&&(a=m,d.set(1,0,0));l<=a&&(a=l,d.set(0,1,0));n<=a&&d.set(0,0,1);h.crossVectors(e[0],
d).normalize();f[0].crossVectors(e[0],h);g[0].crossVectors(e[0],f[0]);for(m=1;m<b;m++)f[m]=f[m-1].clone(),g[m]=g[m-1].clone(),h.crossVectors(e[m-1],e[m]),1E-4<h.length()&&(h.normalize(),d=Math.acos(THREE.Math.clamp(e[m-1].dot(e[m]),-1,1)),f[m].applyMatrix4(k.makeRotationAxis(h,d))),g[m].crossVectors(e[m],f[m]);if(c)for(d=Math.acos(THREE.Math.clamp(f[0].dot(f[b-1]),-1,1)),d/=b-1,0<e[0].dot(h.crossVectors(f[0],f[b-1]))&&(d=-d),m=1;m<b;m++)f[m].applyMatrix4(k.makeRotationAxis(e[m],d*m)),g[m].crossVectors(e[m],
f[m])};
THREE.PolyhedronGeometry=function(a,b,c,d){function e(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5;b.uv=new THREE.Vector2(c,1-a);return b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);k.faces.push(d);v.copy(a).add(b).add(c).divideScalar(3);d=Math.atan2(v.z,-v.x);k.faceVertexUvs[0].push([h(a.uv,a,d),h(b.uv,b,d),h(c.uv,c,d)])}function g(a,b){var c=
Math.pow(2,b);Math.pow(4,b);for(var d=e(k.vertices[a.a]),g=e(k.vertices[a.b]),h=e(k.vertices[a.c]),l=[],m=0;m<=c;m++){l[m]=[];for(var n=e(d.clone().lerp(h,m/c)),q=e(g.clone().lerp(h,m/c)),p=c-m,u=0;u<=p;u++)l[m][u]=0==u&&m==c?n:e(n.clone().lerp(q,u/p))}for(m=0;m<c;m++)for(u=0;u<2*(c-m)-1;u++)d=Math.floor(u/2),0==u%2?f(l[m][d+1],l[m+1][d],l[m][d]):f(l[m][d+1],l[m+1][d+1],l[m+1][d])}function h(a,b,c){0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,
a.y));return a.clone()}THREE.Geometry.call(this);c=c||1;d=d||0;for(var k=this,m=0,l=a.length;m<l;m+=3)e(new THREE.Vector3(a[m],a[m+1],a[m+2]));a=this.vertices;for(var n=[],t=m=0,l=b.length;m<l;m+=3,t++){var q=a[b[m]],u=a[b[m+1]],p=a[b[m+2]];n[t]=new THREE.Face3(q.index,u.index,p.index,[q.clone(),u.clone(),p.clone()])}for(var v=new THREE.Vector3,m=0,l=n.length;m<l;m++)g(n[m],d);m=0;for(l=this.faceVertexUvs[0].length;m<l;m++)b=this.faceVertexUvs[0][m],d=b[0].x,a=b[1].x,n=b[2].x,t=Math.max(d,Math.max(a,
n)),q=Math.min(d,Math.min(a,n)),.9<t&&.1>q&&(.2>d&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>n&&(b[2].x+=1));m=0;for(l=this.vertices.length;m<l;m++)this.vertices[m].multiplyScalar(c);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.IcosahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};var c=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b)};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.OctahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b)};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b)};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.ParametricGeometry=function(a,b,c){THREE.Geometry.call(this);var d=this.vertices,e=this.faces,f=this.faceVertexUvs[0],g,h,k,m,l=b+1;for(g=0;g<=c;g++)for(m=g/c,h=0;h<=b;h++)k=h/b,k=a(k,m),d.push(k);var n,t,q,u;for(g=0;g<c;g++)for(h=0;h<b;h++)a=g*l+h,d=g*l+h+1,m=(g+1)*l+h+1,k=(g+1)*l+h,n=new THREE.Vector2(h/b,g/c),t=new THREE.Vector2((h+1)/b,g/c),q=new THREE.Vector2((h+1)/b,(g+1)/c),u=new THREE.Vector2(h/b,(g+1)/c),e.push(new THREE.Face3(a,d,k)),f.push([n,t,u]),e.push(new THREE.Face3(d,m,k)),
f.push([t.clone(),q,u.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.AxisHelper=function(a){a=a||1;var b=new THREE.Geometry;b.vertices.push(new THREE.Vector3,new THREE.Vector3(a,0,0),new THREE.Vector3,new THREE.Vector3(0,a,0),new THREE.Vector3,new THREE.Vector3(0,0,a));b.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775));a=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,b,a,THREE.LinePieces)};
THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);
THREE.ArrowHelper=function(a,b,c,d,e,f){THREE.Object3D.call(this);void 0===d&&(d=16776960);void 0===c&&(c=1);void 0===e&&(e=.2*c);void 0===f&&(f=.2*e);this.position=b;b=new THREE.Geometry;b.vertices.push(new THREE.Vector3(0,0,0));b.vertices.push(new THREE.Vector3(0,1,0));this.line=new THREE.Line(b,new THREE.LineBasicMaterial({color:d}));this.line.matrixAutoUpdate=!1;this.add(this.line);b=new THREE.CylinderGeometry(0,.5,1,5,1);b.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));this.cone=new THREE.Mesh(b,
new THREE.MeshBasicMaterial({color:d}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(a);this.setLength(c,e,f)};THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.setDirection=function(){var a=new THREE.Vector3,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();
THREE.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,a,1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.set(a);this.cone.material.color.set(a)};
THREE.BoxHelper=function(a){var b=[new THREE.Vector3(1,1,1),new THREE.Vector3(-1,1,1),new THREE.Vector3(-1,-1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,-1,-1)];this.vertices=b;var c=new THREE.Geometry;c.vertices.push(b[0],b[1],b[1],b[2],b[2],b[3],b[3],b[0],b[4],b[5],b[5],b[6],b[6],b[7],b[7],b[4],b[0],b[4],b[1],b[5],b[2],b[6],b[3],b[7]);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces);
void 0!==a&&this.update(a)};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);
THREE.BoxHelper.prototype.update=function(a){var b=a.geometry;null===b.boundingBox&&b.computeBoundingBox();var c=b.boundingBox.min,b=b.boundingBox.max,d=this.vertices;d[0].set(b.x,b.y,b.z);d[1].set(c.x,b.y,b.z);d[2].set(c.x,c.y,b.z);d[3].set(b.x,c.y,b.z);d[4].set(b.x,b.y,c.z);d[5].set(c.x,b.y,c.z);d[6].set(c.x,c.y,c.z);d[7].set(b.x,c.y,c.z);this.geometry.computeBoundingSphere();this.geometry.verticesNeedUpdate=!0;this.matrixAutoUpdate=!1;this.matrixWorld=a.matrixWorld};
THREE.BoundingBoxHelper=function(a,b){var c=void 0!==b?b:8947848;this.object=a;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};
THREE.CameraHelper=function(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){d.vertices.push(new THREE.Vector3);d.colors.push(new THREE.Color(b));void 0===f[a]&&(f[a]=[]);f[a].push(d.vertices.length-1)}var d=new THREE.Geometry,e=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),f={};b("n1","n2",16755200);b("n2","n4",16755200);b("n4","n3",16755200);b("n3","n1",16755200);b("f1","f2",16755200);b("f2","f4",16755200);b("f4","f3",16755200);b("f3","f1",16755200);b("n1","f1",16755200);
b("n2","f2",16755200);b("n3","f3",16755200);b("n4","f4",16755200);b("p","n1",16711680);b("p","n2",16711680);b("p","n3",16711680);b("p","n4",16711680);b("u1","u2",43775);b("u2","u3",43775);b("u3","u1",43775);b("c","t",16777215);b("p","c",3355443);b("cn1","cn2",3355443);b("cn3","cn4",3355443);b("cf1","cf2",3355443);b("cf3","cf4",3355443);THREE.Line.call(this,d,e,THREE.LinePieces);this.camera=a;this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=f;this.update()};
THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);
THREE.CameraHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Camera,c=new THREE.Projector;return function(){function d(d,g,h,k){a.set(g,h,k);c.unprojectVector(a,b);d=e.pointMap[d];if(void 0!==d)for(g=0,h=d.length;g<h;g++)e.geometry.vertices[d[g]].copy(a)}var e=this;b.projectionMatrix.copy(this.camera.projectionMatrix);d("c",0,0,-1);d("t",0,0,1);d("n1",-1,-1,-1);d("n2",1,-1,-1);d("n3",-1,1,-1);d("n4",1,1,-1);d("f1",-1,-1,1);d("f2",1,-1,1);d("f3",-1,1,1);d("f4",1,1,1);d("u1",.7,
1.1,-1);d("u2",-.7,1.1,-1);d("u3",0,2,-1);d("cf1",-1,0,1);d("cf2",1,0,1);d("cf3",0,-1,1);d("cf4",0,1,1);d("cn1",-1,0,-1);d("cn2",1,0,-1);d("cn3",0,-1,-1);d("cn4",0,1,-1);this.geometry.verticesNeedUpdate=!0}}();
THREE.DirectionalLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=!1;b=b||1;var c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(-b,b,0),new THREE.Vector3(b,b,0),new THREE.Vector3(b,-b,0),new THREE.Vector3(-b,-b,0),new THREE.Vector3(-b,b,0));var d=new THREE.LineBasicMaterial({fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Line(c,d);this.add(this.lightPlane);
c=new THREE.Geometry;c.vertices.push(new THREE.Vector3,new THREE.Vector3);d=new THREE.LineBasicMaterial({fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(c,d);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);
THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};
THREE.DirectionalLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(b,a);this.lightPlane.lookAt(c);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(c);this.targetLine.geometry.verticesNeedUpdate=!0;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();
THREE.EdgesHelper=function(a,b){var c=void 0!==b?b:16777215,d=[0,0],e={},f=function(a,b){return a-b},g=["a","b","c"],h=new THREE.BufferGeometry,k=a.geometry.clone();k.mergeVertices();k.computeFaceNormals();for(var m=k.vertices,k=k.faces,l=0,n=0,t=k.length;n<t;n++)for(var q=k[n],u=0;3>u;u++){d[0]=q[g[u]];d[1]=q[g[(u+1)%3]];d.sort(f);var p=d.toString();void 0===e[p]?(e[p]={vert1:d[0],vert2:d[1],face1:n,face2:void 0},l++):e[p].face2=n}h.addAttribute("position",new THREE.Float32Attribute(2*l,3));d=h.attributes.position.array;
f=0;for(p in e)if(g=e[p],void 0===g.face2||.9999>k[g.face1].normal.dot(k[g.face2].normal))l=m[g.vert1],d[f++]=l.x,d[f++]=l.y,d[f++]=l.z,l=m[g.vert2],d[f++]=l.x,d[f++]=l.y,d[f++]=l.z;THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.matrixWorld=a.matrixWorld};THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype);
THREE.FaceNormalsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16776960;d=void 0!==d?d:1;b=new THREE.Geometry;c=0;for(var e=this.object.geometry.faces.length;c<e;c++)b.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,b,new THREE.LineBasicMaterial({color:a,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.FaceNormalsHelper.prototype.update=function(){var a=this.geometry.vertices,b=this.object,c=b.geometry.vertices,d=b.geometry.faces,e=b.matrixWorld;b.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(e);for(var f=b=0,g=d.length;b<g;b++,f+=2){var h=d[b];a[f].copy(c[h.a]).add(c[h.b]).add(c[h.c]).divideScalar(3).applyMatrix4(e);a[f+1].copy(h.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(a[f])}this.geometry.verticesNeedUpdate=!0;return this};
THREE.GridHelper=function(a,b){var c=new THREE.Geometry,d=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var e=-a;e<=a;e+=b){c.vertices.push(new THREE.Vector3(-a,0,e),new THREE.Vector3(a,0,e),new THREE.Vector3(e,0,-a),new THREE.Vector3(e,0,a));var f=0===e?this.color1:this.color2;c.colors.push(f,f,f,f)}THREE.Line.call(this,c,d,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);
THREE.GridHelper.prototype.setColors=function(a,b){this.color1.set(a);this.color2.set(b);this.geometry.colorsNeedUpdate=!0};
THREE.HemisphereLightHelper=function(a,b,c,d){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new THREE.Color,new THREE.Color];a=new THREE.SphereGeometry(b,4,2);a.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(b=0;8>b;b++)a.faces[b].color=this.colors[4>b?0:1];b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(a,b);this.add(this.lightSphere);
this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};
THREE.HemisphereLightHelper.prototype.update=function(){var a=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();
THREE.PointLightHelper=function(a,b){this.light=a;this.light.updateMatrixWorld();var c=new THREE.SphereGeometry(b,4,2),d=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,d);this.matrixWorld=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};
THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};
THREE.SkeletonHelper=function(a){for(var b=a.skeleton,c=new THREE.Geometry,d=0;d<b.bones.length;d++)b.bones[d].parent instanceof THREE.Bone&&(c.vertices.push(new THREE.Vector3),c.vertices.push(new THREE.Vector3),c.colors.push(new THREE.Color(0,0,1)),c.colors.push(new THREE.Color(0,1,0)));d=new THREE.LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,transparent:!0});THREE.Line.call(this,c,d,THREE.LinePieces);this.skeleton=b;this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=!1;this.update()};
THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype);THREE.SkeletonHelper.prototype.update=function(){for(var a=this.geometry,b=0,c=0;c<this.skeleton.bones.length;c++){var d=this.skeleton.bones[c];d.parent instanceof THREE.Bone&&(a.vertices[b].setFromMatrixPosition(d.skinMatrix),a.vertices[b+1].setFromMatrixPosition(d.parent.skinMatrix),b+=2)}a.verticesNeedUpdate=!0;a.computeBoundingSphere()};
THREE.SpotLightHelper=function(a){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=!1;a=new THREE.CylinderGeometry(0,1,1,8,1,!0);a.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));a.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var b=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(a,b);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);
THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1E4,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();
THREE.VertexNormalsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;b=void 0!==c?c:16711680;d=void 0!==d?d:1;c=new THREE.Geometry;a=a.geometry.faces;for(var e=0,f=a.length;e<f;e++)for(var g=0,h=a[e].vertexNormals.length;g<h;g++)c.vertices.push(new THREE.Vector3),c.vertices.push(new THREE.Vector3);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:b,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new THREE.Matrix3;this.update()};
THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.VertexNormalsHelper.prototype.update=function(a){var b=new THREE.Vector3;return function(a){a=["a","b","c","d"];this.object.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var d=this.geometry.vertices,e=this.object.geometry.vertices,f=this.object.geometry.faces,g=this.object.matrixWorld,h=0,k=0,m=f.length;k<m;k++)for(var l=f[k],n=0,t=l.vertexNormals.length;n<t;n++){var q=l.vertexNormals[n];d[h].copy(e[l[a[n]]]).applyMatrix4(g);b.copy(q).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);
b.add(d[h]);h+=1;d[h].copy(b);h+=1}this.geometry.verticesNeedUpdate=!0;return this}}();
THREE.VertexTangentsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;b=void 0!==c?c:255;d=void 0!==d?d:1;c=new THREE.Geometry;a=a.geometry.faces;for(var e=0,f=a.length;e<f;e++)for(var g=0,h=a[e].vertexTangents.length;g<h;g++)c.vertices.push(new THREE.Vector3),c.vertices.push(new THREE.Vector3);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:b,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.update()};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.VertexTangentsHelper.prototype.update=function(a){var b=new THREE.Vector3;return function(a){a=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var d=this.geometry.vertices,e=this.object.geometry.vertices,f=this.object.geometry.faces,g=this.object.matrixWorld,h=0,k=0,m=f.length;k<m;k++)for(var l=f[k],n=0,t=l.vertexTangents.length;n<t;n++){var q=l.vertexTangents[n];d[h].copy(e[l[a[n]]]).applyMatrix4(g);b.copy(q).transformDirection(g).multiplyScalar(this.size);b.add(d[h]);h+=1;d[h].copy(b);
h+=1}this.geometry.verticesNeedUpdate=!0;return this}}();
THREE.WireframeHelper=function(a,b){var c=void 0!==b?b:16777215,d=[0,0],e={},f=function(a,b){return a-b},g=["a","b","c"],h=new THREE.BufferGeometry;if(a.geometry instanceof THREE.Geometry){for(var k=a.geometry.vertices,m=a.geometry.faces,l=0,n=new Uint32Array(6*m.length),t=0,q=m.length;t<q;t++)for(var u=m[t],p=0;3>p;p++){d[0]=u[g[p]];d[1]=u[g[(p+1)%3]];d.sort(f);var v=d.toString();void 0===e[v]&&(n[2*l]=d[0],n[2*l+1]=d[1],e[v]=!0,l++)}h.addAttribute("position",new THREE.Float32Attribute(2*l,3));d=
h.attributes.position.array;t=0;for(q=l;t<q;t++)for(p=0;2>p;p++)l=k[n[2*t+p]],g=6*t+3*p,d[g+0]=l.x,d[g+1]=l.y,d[g+2]=l.z}else if(a.geometry instanceof THREE.BufferGeometry&&void 0!==a.geometry.attributes.index){for(var k=a.geometry.attributes.position.array,q=a.geometry.attributes.index.array,m=a.geometry.offsets,l=0,n=new Uint32Array(2*q.length),u=0,x=m.length;u<x;++u)for(var p=m[u].start,v=m[u].count,g=m[u].index,t=p,w=p+v;t<w;t+=3)for(p=0;3>p;p++)d[0]=g+q[t+p],d[1]=g+q[t+(p+1)%3],d.sort(f),v=d.toString(),
void 0===e[v]&&(n[2*l]=d[0],n[2*l+1]=d[1],e[v]=!0,l++);h.addAttribute("position",new THREE.Float32Attribute(2*l,3));d=h.attributes.position.array;t=0;for(q=l;t<q;t++)for(p=0;2>p;p++)g=6*t+3*p,l=3*n[2*t+p],d[g+0]=k[l],d[g+1]=k[l+1],d[g+2]=k[l+2]}else if(a.geometry instanceof THREE.BufferGeometry)for(k=a.geometry.attributes.position.array,l=k.length/3,n=l/3,h.addAttribute("position",new THREE.Float32Attribute(2*l,3)),d=h.attributes.position.array,t=0,q=n;t<q;t++)for(p=0;3>p;p++)g=18*t+6*p,n=9*t+3*p,
d[g+0]=k[n],d[g+1]=k[n+1],d[g+2]=k[n+2],l=9*t+(p+1)%3*3,d[g+3]=k[l],d[g+4]=k[l+1],d[g+5]=k[l+2];THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.matrixWorld=a.matrixWorld};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(a){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);
THREE.LensFlare=function(a,b,c,d,e){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,b,c,d,e)};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);
THREE.LensFlare.prototype.add=function(a,b,c,d,e,f){void 0===b&&(b=-1);void 0===c&&(c=0);void 0===f&&(f=1);void 0===e&&(e=new THREE.Color(16777215));void 0===d&&(d=THREE.NormalBlending);c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:f,color:e,blending:d})};
THREE.LensFlare.prototype.updateLensFlares=function(){var a,b=this.lensFlares.length,c,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)};
THREE.MorphBlendMesh=function(a,b){THREE.Mesh.call(this,a,b);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation("__default",0,c-1,c/1);this.setAnimationWeight("__default",1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);
THREE.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){b={startFrame:b,endFrame:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};
THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b=/([a-z]+)(\d+)/,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f].name.match(b);if(h&&1<h.length){var k=h[1];d[k]||(d[k]={start:Infinity,end:-Infinity});h=d[k];f<h.start&&(h.start=f);f>h.end&&(h.end=f);c||(c=k)}}for(k in d)h=d[k],this.createAnimation(k,h.start,h.end,a);this.firstAnimation=c};
THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)};
THREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};
THREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("animation["+a+"] undefined")};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};
THREE.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var d=this.animationsList[b];if(d.active){var e=d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time>d.duration||0>d.time)d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.startFrame+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;
f!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);this.morphTargetInfluences[d.currentFrame]=e*g;this.morphTargetInfluences[d.lastFrame]=(1-e)*g}}};
THREE.LensFlarePlugin=function(){function a(a,c){var d=b.createProgram(),e=b.createShader(b.FRAGMENT_SHADER),f=b.createShader(b.VERTEX_SHADER),g="precision "+c+" float;\n";b.shaderSource(e,g+a.fragmentShader);b.shaderSource(f,g+a.vertexShader);b.compileShader(e);b.compileShader(f);b.attachShader(d,e);b.attachShader(d,f);b.linkProgram(d);return d}var b,c,d,e,f,g,h,k,m,l,n,t,q;this.init=function(u){b=u.context;c=u;d=u.getPrecision();e=new Float32Array(16);f=new Uint16Array(6);u=0;e[u++]=-1;e[u++]=-1;
e[u++]=0;e[u++]=0;e[u++]=1;e[u++]=-1;e[u++]=1;e[u++]=0;e[u++]=1;e[u++]=1;e[u++]=1;e[u++]=1;e[u++]=-1;e[u++]=1;e[u++]=0;e[u++]=1;u=0;f[u++]=0;f[u++]=1;f[u++]=2;f[u++]=0;f[u++]=2;f[u++]=3;g=b.createBuffer();h=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,g);b.bufferData(b.ARRAY_BUFFER,e,b.STATIC_DRAW);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,h);b.bufferData(b.ELEMENT_ARRAY_BUFFER,f,b.STATIC_DRAW);k=b.createTexture();m=b.createTexture();b.bindTexture(b.TEXTURE_2D,k);b.texImage2D(b.TEXTURE_2D,0,b.RGB,16,16,
0,b.RGB,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.bindTexture(b.TEXTURE_2D,m);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,16,16,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);
b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);0>=b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(l=!1,n=a(THREE.ShaderFlares.lensFlare,d)):(l=!0,n=a(THREE.ShaderFlares.lensFlareVertexTexture,d));t={};q={};t.vertex=b.getAttribLocation(n,"position");t.uv=b.getAttribLocation(n,"uv");q.renderType=b.getUniformLocation(n,"renderType");q.map=b.getUniformLocation(n,"map");q.occlusionMap=b.getUniformLocation(n,"occlusionMap");q.opacity=
b.getUniformLocation(n,"opacity");q.color=b.getUniformLocation(n,"color");q.scale=b.getUniformLocation(n,"scale");q.rotation=b.getUniformLocation(n,"rotation");q.screenPosition=b.getUniformLocation(n,"screenPosition")};this.render=function(a,d,e,f){a=a.__webglFlares;var w=a.length;if(w){var y=new THREE.Vector3,M=f/e,z=.5*e,K=.5*f,H=16/f,D=new THREE.Vector2(H*M,H),L=new THREE.Vector3(1,1,0),A=new THREE.Vector2(1,1),E=q,H=t;b.useProgram(n);b.enableVertexAttribArray(t.vertex);b.enableVertexAttribArray(t.uv);
b.uniform1i(E.occlusionMap,0);b.uniform1i(E.map,1);b.bindBuffer(b.ARRAY_BUFFER,g);b.vertexAttribPointer(H.vertex,2,b.FLOAT,!1,16,0);b.vertexAttribPointer(H.uv,2,b.FLOAT,!1,16,8);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,h);b.disable(b.CULL_FACE);b.depthMask(!1);var F,J,N,B,C;for(F=0;F<w;F++)if(H=16/f,D.set(H*M,H),B=a[F],y.set(B.matrixWorld.elements[12],B.matrixWorld.elements[13],B.matrixWorld.elements[14]),y.applyMatrix4(d.matrixWorldInverse),y.applyProjection(d.projectionMatrix),L.copy(y),A.x=L.x*z+z,
A.y=L.y*K+K,l||0<A.x&&A.x<e&&0<A.y&&A.y<f)for(b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,k),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGB,A.x-8,A.y-8,16,16,0),b.uniform1i(E.renderType,0),b.uniform2f(E.scale,D.x,D.y),b.uniform3f(E.screenPosition,L.x,L.y,L.z),b.disable(b.BLEND),b.enable(b.DEPTH_TEST),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,m),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,A.x-8,A.y-8,16,16,0),b.uniform1i(E.renderType,1),b.disable(b.DEPTH_TEST),
b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,k),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0),B.positionScreen.copy(L),B.customUpdateCallback?B.customUpdateCallback(B):B.updateLensFlares(),b.uniform1i(E.renderType,2),b.enable(b.BLEND),J=0,N=B.lensFlares.length;J<N;J++)C=B.lensFlares[J],.001<C.opacity&&.001<C.scale&&(L.x=C.x,L.y=C.y,L.z=C.z,H=C.size*C.scale/f,D.x=H*M,D.y=H,b.uniform3f(E.screenPosition,L.x,L.y,L.z),b.uniform2f(E.scale,D.x,D.y),b.uniform1f(E.rotation,C.rotation),b.uniform1f(E.opacity,
C.opacity),b.uniform3f(E.color,C.color.r,C.color.g,C.color.b),c.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst),c.setTexture(C.texture,1),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0));b.enable(b.CULL_FACE);b.enable(b.DEPTH_TEST);b.depthMask(!0)}}};
THREE.ShadowMapPlugin=function(){var a,b,c,d,e,f,g=new THREE.Frustum,h=new THREE.Matrix4,k=new THREE.Vector3,m=new THREE.Vector3,l=new THREE.Vector3;this.init=function(g){a=g.context;b=g;g=THREE.ShaderLib.depthRGBA;var h=THREE.UniformsUtils.clone(g.uniforms);c=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h});d=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0});e=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,
vertexShader:g.vertexShader,uniforms:h,skinning:!0});f=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0,skinning:!0});c._shadowPass=!0;d._shadowPass=!0;e._shadowPass=!0;f._shadowPass=!0};this.render=function(a,c){b.shadowMapEnabled&&b.shadowMapAutoUpdate&&this.update(a,c)};this.update=function(n,t){var q,u,p,v,x,w,y,M,z,K=[];v=0;a.clearColor(1,1,1,1);a.disable(a.BLEND);a.enable(a.CULL_FACE);a.frontFace(a.CCW);b.shadowMapCullFace===THREE.CullFaceFront?
a.cullFace(a.FRONT):a.cullFace(a.BACK);b.setDepthTest(!0);q=0;for(u=n.__lights.length;q<u;q++)if(p=n.__lights[q],p.castShadow)if(p instanceof THREE.DirectionalLight&&p.shadowCascade)for(x=0;x<p.shadowCascadeCount;x++){var H;if(p.shadowCascadeArray[x])H=p.shadowCascadeArray[x];else{z=p;y=x;H=new THREE.DirectionalLight;H.isVirtual=!0;H.onlyShadow=!0;H.castShadow=!0;H.shadowCameraNear=z.shadowCameraNear;H.shadowCameraFar=z.shadowCameraFar;H.shadowCameraLeft=z.shadowCameraLeft;H.shadowCameraRight=z.shadowCameraRight;
H.shadowCameraBottom=z.shadowCameraBottom;H.shadowCameraTop=z.shadowCameraTop;H.shadowCameraVisible=z.shadowCameraVisible;H.shadowDarkness=z.shadowDarkness;H.shadowBias=z.shadowCascadeBias[y];H.shadowMapWidth=z.shadowCascadeWidth[y];H.shadowMapHeight=z.shadowCascadeHeight[y];H.pointsWorld=[];H.pointsFrustum=[];var D=H.pointsWorld;w=H.pointsFrustum;for(M=0;8>M;M++)D[M]=new THREE.Vector3,w[M]=new THREE.Vector3;D=z.shadowCascadeNearZ[y];z=z.shadowCascadeFarZ[y];w[0].set(-1,-1,D);w[1].set(1,-1,D);w[2].set(-1,
1,D);w[3].set(1,1,D);w[4].set(-1,-1,z);w[5].set(1,-1,z);w[6].set(-1,1,z);w[7].set(1,1,z);H.originalCamera=t;w=new THREE.Gyroscope;w.position.copy(p.shadowCascadeOffset);w.add(H);w.add(H.target);t.add(w);p.shadowCascadeArray[x]=H;console.log("Created virtualLight",H)}y=p;D=x;z=y.shadowCascadeArray[D];z.position.copy(y.position);z.target.position.copy(y.target.position);z.lookAt(z.target);z.shadowCameraVisible=y.shadowCameraVisible;z.shadowDarkness=y.shadowDarkness;z.shadowBias=y.shadowCascadeBias[D];
w=y.shadowCascadeNearZ[D];y=y.shadowCascadeFarZ[D];z=z.pointsFrustum;z[0].z=w;z[1].z=w;z[2].z=w;z[3].z=w;z[4].z=y;z[5].z=y;z[6].z=y;z[7].z=y;K[v]=H;v++}else K[v]=p,v++;q=0;for(u=K.length;q<u;q++){p=K[q];p.shadowMap||(x=THREE.LinearFilter,b.shadowMapType===THREE.PCFSoftShadowMap&&(x=THREE.NearestFilter),p.shadowMap=new THREE.WebGLRenderTarget(p.shadowMapWidth,p.shadowMapHeight,{minFilter:x,magFilter:x,format:THREE.RGBAFormat}),p.shadowMapSize=new THREE.Vector2(p.shadowMapWidth,p.shadowMapHeight),p.shadowMatrix=
new THREE.Matrix4);if(!p.shadowCamera){if(p instanceof THREE.SpotLight)p.shadowCamera=new THREE.PerspectiveCamera(p.shadowCameraFov,p.shadowMapWidth/p.shadowMapHeight,p.shadowCameraNear,p.shadowCameraFar);else if(p instanceof THREE.DirectionalLight)p.shadowCamera=new THREE.OrthographicCamera(p.shadowCameraLeft,p.shadowCameraRight,p.shadowCameraTop,p.shadowCameraBottom,p.shadowCameraNear,p.shadowCameraFar);else{console.error("Unsupported light type for shadow");continue}n.add(p.shadowCamera);!0===
n.autoUpdate&&n.updateMatrixWorld()}p.shadowCameraVisible&&!p.cameraHelper&&(p.cameraHelper=new THREE.CameraHelper(p.shadowCamera),p.shadowCamera.add(p.cameraHelper));if(p.isVirtual&&H.originalCamera==t){x=t;v=p.shadowCamera;w=p.pointsFrustum;z=p.pointsWorld;k.set(Infinity,Infinity,Infinity);m.set(-Infinity,-Infinity,-Infinity);for(y=0;8>y;y++)D=z[y],D.copy(w[y]),THREE.ShadowMapPlugin.__projector.unprojectVector(D,x),D.applyMatrix4(v.matrixWorldInverse),D.x<k.x&&(k.x=D.x),D.x>m.x&&(m.x=D.x),D.y<k.y&&
(k.y=D.y),D.y>m.y&&(m.y=D.y),D.z<k.z&&(k.z=D.z),D.z>m.z&&(m.z=D.z);v.left=k.x;v.right=m.x;v.top=m.y;v.bottom=k.y;v.updateProjectionMatrix()}v=p.shadowMap;w=p.shadowMatrix;x=p.shadowCamera;x.position.setFromMatrixPosition(p.matrixWorld);l.setFromMatrixPosition(p.target.matrixWorld);x.lookAt(l);x.updateMatrixWorld();x.matrixWorldInverse.getInverse(x.matrixWorld);p.cameraHelper&&(p.cameraHelper.visible=p.shadowCameraVisible);p.shadowCameraVisible&&p.cameraHelper.update();w.set(.5,0,0,.5,0,.5,0,.5,0,
0,.5,.5,0,0,0,1);w.multiply(x.projectionMatrix);w.multiply(x.matrixWorldInverse);h.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse);g.setFromMatrix(h);b.setRenderTarget(v);b.clear();z=n.__webglObjects;p=0;for(v=z.length;p<v;p++)y=z[p],w=y.object,y.render=!1,!w.visible||!w.castShadow||(w instanceof THREE.Mesh||w instanceof THREE.ParticleSystem)&&w.frustumCulled&&!g.intersectsObject(w)||(w._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,w.matrixWorld),y.render=!0);var L;p=0;for(v=z.length;p<
v;p++)y=z[p],y.render&&(w=y.object,y=y.buffer,D=w.material instanceof THREE.MeshFaceMaterial?w.material.materials[0]:w.material,M=void 0!==w.geometry.morphTargets&&0<w.geometry.morphTargets.length&&D.morphTargets,L=w instanceof THREE.SkinnedMesh&&D.skinning,M=w.customDepthMaterial?w.customDepthMaterial:L?M?f:e:M?d:c,b.setMaterialFaces(D),y instanceof THREE.BufferGeometry?b.renderBufferDirect(x,n.__lights,null,M,y,w):b.renderBuffer(x,n.__lights,null,M,y,w));z=n.__webglObjectsImmediate;p=0;for(v=z.length;p<
v;p++)y=z[p],w=y.object,w.visible&&w.castShadow&&(w._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,w.matrixWorld),b.renderImmediateObject(x,n.__lights,null,c,w))}q=b.getClearColor();u=b.getClearAlpha();a.clearColor(q.r,q.g,q.b,u);a.enable(a.BLEND);b.shadowMapCullFace===THREE.CullFaceFront&&a.cullFace(a.BACK)}};THREE.ShadowMapPlugin.__projector=new THREE.Projector;
THREE.SpritePlugin=function(){function a(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}var b,c,d,e,f,g,h,k,m,l,n,t,q,u,p,v,x,w,y,M,z,K,H,D,L;this.init=function(a){w=a.context;y=a;z=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);K=new Uint16Array([0,1,2,0,2,3]);H=w.createBuffer();D=w.createBuffer();w.bindBuffer(w.ARRAY_BUFFER,H);w.bufferData(w.ARRAY_BUFFER,z,w.STATIC_DRAW);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,D);w.bufferData(w.ELEMENT_ARRAY_BUFFER,K,w.STATIC_DRAW);a=w.createProgram();var E=
w.createShader(w.VERTEX_SHADER),F=w.createShader(w.FRAGMENT_SHADER);w.shaderSource(E,["precision "+y.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
w.shaderSource(F,["precision "+y.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
w.compileShader(E);w.compileShader(F);w.attachShader(a,E);w.attachShader(a,F);w.linkProgram(a);L=a;v=w.getAttribLocation(L,"position");x=w.getAttribLocation(L,"uv");b=w.getUniformLocation(L,"uvOffset");c=w.getUniformLocation(L,"uvScale");d=w.getUniformLocation(L,"rotation");e=w.getUniformLocation(L,"scale");f=w.getUniformLocation(L,"color");g=w.getUniformLocation(L,"map");h=w.getUniformLocation(L,"opacity");k=w.getUniformLocation(L,"modelViewMatrix");m=w.getUniformLocation(L,"projectionMatrix");l=
w.getUniformLocation(L,"fogType");n=w.getUniformLocation(L,"fogDensity");t=w.getUniformLocation(L,"fogNear");q=w.getUniformLocation(L,"fogFar");u=w.getUniformLocation(L,"fogColor");p=w.getUniformLocation(L,"alphaTest");a=document.createElement("canvas");a.width=8;a.height=8;E=a.getContext("2d");E.fillStyle="#ffffff";E.fillRect(0,0,a.width,a.height);M=new THREE.Texture(a);M.needsUpdate=!0};this.render=function(z,E,F,J){F=z.__webglSprites;if(J=F.length){w.useProgram(L);w.enableVertexAttribArray(v);
w.enableVertexAttribArray(x);w.disable(w.CULL_FACE);w.enable(w.BLEND);w.bindBuffer(w.ARRAY_BUFFER,H);w.vertexAttribPointer(v,2,w.FLOAT,!1,16,0);w.vertexAttribPointer(x,2,w.FLOAT,!1,16,8);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,D);w.uniformMatrix4fv(m,!1,E.projectionMatrix.elements);w.activeTexture(w.TEXTURE0);w.uniform1i(g,0);var N=0,B=0,C=z.fog;C?(w.uniform3f(u,C.color.r,C.color.g,C.color.b),C instanceof THREE.Fog?(w.uniform1f(t,C.near),w.uniform1f(q,C.far),w.uniform1i(l,1),B=N=1):C instanceof THREE.FogExp2&&
(w.uniform1f(n,C.density),w.uniform1i(l,2),B=N=2)):(w.uniform1i(l,0),B=N=0);for(var G,K=[],C=0;C<J;C++)G=F[C],!1!==G.visible&&(G._modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,G.matrixWorld),G.z=-G._modelViewMatrix.elements[14]);F.sort(a);for(C=0;C<J;C++)G=F[C],!1!==G.visible&&(E=G.material,w.uniform1f(p,E.alphaTest),w.uniformMatrix4fv(k,!1,G._modelViewMatrix.elements),K[0]=G.scale.x,K[1]=G.scale.y,G=z.fog&&E.fog?B:0,N!==G&&(w.uniform1i(l,G),N=G),null!==E.map?(w.uniform2f(b,E.map.offset.x,
E.map.offset.y),w.uniform2f(c,E.map.repeat.x,E.map.repeat.y)):(w.uniform2f(b,0,0),w.uniform2f(c,1,1)),w.uniform1f(h,E.opacity),w.uniform3f(f,E.color.r,E.color.g,E.color.b),w.uniform1f(d,E.rotation),w.uniform2fv(e,K),y.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst),y.setDepthTest(E.depthTest),y.setDepthWrite(E.depthWrite),E.map&&E.map.image&&E.map.image.width?y.setTexture(E.map,0):y.setTexture(M,0),w.drawElements(w.TRIANGLES,6,w.UNSIGNED_SHORT,0));w.enable(w.CULL_FACE)}}};
THREE.DepthPassPlugin=function(){this.enabled=!1;this.renderTarget=null;var a,b,c,d,e,f,g=new THREE.Frustum,h=new THREE.Matrix4;this.init=function(g){a=g.context;b=g;g=THREE.ShaderLib.depthRGBA;var h=THREE.UniformsUtils.clone(g.uniforms);c=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h});d=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0});e=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,
vertexShader:g.vertexShader,uniforms:h,skinning:!0});f=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0,skinning:!0});c._shadowPass=!0;d._shadowPass=!0;e._shadowPass=!0;f._shadowPass=!0};this.render=function(a,b){this.enabled&&this.update(a,b)};this.update=function(k,m){var l,n,t,q,u,p;a.clearColor(1,1,1,1);a.disable(a.BLEND);b.setDepthTest(!0);!0===k.autoUpdate&&k.updateMatrixWorld();m.matrixWorldInverse.getInverse(m.matrixWorld);h.multiplyMatrices(m.projectionMatrix,
m.matrixWorldInverse);g.setFromMatrix(h);b.setRenderTarget(this.renderTarget);b.clear();p=k.__webglObjects;l=0;for(n=p.length;l<n;l++)t=p[l],u=t.object,t.render=!1,!u.visible||(u instanceof THREE.Mesh||u instanceof THREE.ParticleSystem)&&u.frustumCulled&&!g.intersectsObject(u)||(u._modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,u.matrixWorld),t.render=!0);var v;l=0;for(n=p.length;l<n;l++)t=p[l],t.render&&(u=t.object,t=t.buffer,u instanceof THREE.ParticleSystem&&!u.customDepthMaterial||((v=
u.material instanceof THREE.MeshFaceMaterial?u.material.materials[0]:u.material)&&b.setMaterialFaces(u.material),q=void 0!==u.geometry.morphTargets&&0<u.geometry.morphTargets.length&&v.morphTargets,v=u instanceof THREE.SkinnedMesh&&v.skinning,q=u.customDepthMaterial?u.customDepthMaterial:v?q?f:e:q?d:c,t instanceof THREE.BufferGeometry?b.renderBufferDirect(m,k.__lights,null,q,t,u):b.renderBuffer(m,k.__lights,null,q,t,u)));p=k.__webglObjectsImmediate;l=0;for(n=p.length;l<n;l++)t=p[l],u=t.object,u.visible&&
(u._modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,u.matrixWorld),b.renderImmediateObject(m,k.__lights,null,c,u));l=b.getClearColor();n=b.getClearAlpha();a.clearColor(l.r,l.g,l.b,n);a.enable(a.BLEND)}};
THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},
lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}};THREE.BufferGeometryUtils={fromGeometry:function(a,b){if(a instanceof THREE.BufferGeometry)return a;b=b||{vertexColors:THREE.NoColors};var c=a.vertices,d=a.faces,e=a.faceVertexUvs,f=b.vertexColors,g=0<e[0].length,h=3==d[0].vertexNormals.length,k=new THREE.BufferGeometry;k.attributes={position:{itemSize:3,array:new Float32Array(9*d.length)},normal:{itemSize:3,array:new Float32Array(9*d.length)}};var m=k.attributes.position.array,l=k.attributes.normal.array;if(f!==THREE.NoColors){k.attributes.color=
{itemSize:3,array:new Float32Array(9*d.length)};var n=k.attributes.color.array}if(!0===g){k.attributes.uv={itemSize:2,array:new Float32Array(6*d.length)};var t=k.attributes.uv.array}for(var q=0,u=0,p=0;q<d.length;q++,u+=6,p+=9){var v=d[q],x=c[v.a],w=c[v.b],y=c[v.c];m[p]=x.x;m[p+1]=x.y;m[p+2]=x.z;m[p+3]=w.x;m[p+4]=w.y;m[p+5]=w.z;m[p+6]=y.x;m[p+7]=y.y;m[p+8]=y.z;!0===h?(x=v.vertexNormals[0],w=v.vertexNormals[1],y=v.vertexNormals[2],l[p]=x.x,l[p+1]=x.y,l[p+2]=x.z,l[p+3]=w.x,l[p+4]=w.y,l[p+5]=w.z,l[p+
6]=y.x,l[p+7]=y.y,l[p+8]=y.z):(x=v.normal,l[p]=x.x,l[p+1]=x.y,l[p+2]=x.z,l[p+3]=x.x,l[p+4]=x.y,l[p+5]=x.z,l[p+6]=x.x,l[p+7]=x.y,l[p+8]=x.z);f===THREE.FaceColors?(v=v.color,n[p]=v.r,n[p+1]=v.g,n[p+2]=v.b,n[p+3]=v.r,n[p+4]=v.g,n[p+5]=v.b,n[p+6]=v.r,n[p+7]=v.g,n[p+8]=v.b):f===THREE.VertexColors&&(x=v.vertexColors[0],w=v.vertexColors[1],v=v.vertexColors[2],n[p]=x.r,n[p+1]=x.g,n[p+2]=x.b,n[p+3]=w.r,n[p+4]=w.g,n[p+5]=w.b,n[p+6]=v.r,n[p+7]=v.g,n[p+8]=v.b);!0===g&&(v=e[0][q][0],x=e[0][q][1],w=e[0][q][2],
t[u]=v.x,t[u+1]=v.y,t[u+2]=x.x,t[u+3]=x.y,t[u+4]=w.x,t[u+5]=w.y)}k.computeBoundingSphere();return k}};THREE.OBJLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(a,b,c,d){var e=this;c=new THREE.XHRLoader(e.manager);c.setCrossOrigin(this.crossOrigin);c.load(a,function(a){b(e.parse(a))})},parse:function(a){function b(a,b,c){return new THREE.Vector3(parseFloat(a),parseFloat(b),parseFloat(c))}function c(a,b){return new THREE.Vector2(parseFloat(a),parseFloat(b))}function d(a,b,c,d){return new THREE.Face3(a,b,c,d)}function e(a){a=parseInt(a);return 0<=a?a-1:a+u.length}function f(a){a=parseInt(a);
return 0<=a?a-1:a+p.length}function g(a){a=parseInt(a);return 0<=a?a-1:a+v.length}function h(a,b,c,g){void 0===g?n.faces.push(d(u[e(a)]-1,u[e(b)]-1,u[e(c)]-1)):n.faces.push(d(u[e(a)]-1,u[e(b)]-1,u[e(c)]-1,[p[f(g[0])].clone(),p[f(g[1])].clone(),p[f(g[2])].clone()]))}function k(a,b,c){n.faceVertexUvs[0].push([v[g(a)].clone(),v[g(b)].clone(),v[g(c)].clone()])}function m(a,b,c){void 0===a[3]?(h(a[0],a[1],a[2],c),void 0!==b&&0<b.length&&k(b[0],b[1],b[2])):(void 0!==c&&0<c.length?(h(a[0],a[1],a[3],[c[0],
c[1],c[3]]),h(a[1],a[2],a[3],[c[1],c[2],c[3]])):(h(a[0],a[1],a[3]),h(a[1],a[2],a[3])),void 0!==b&&0<b.length&&(k(b[0],b[1],b[3]),k(b[1],b[2],b[3])))}var l=new THREE.Object3D,n,t,q;!1===/^o /gm.test(a)&&(n=new THREE.Geometry,t=new THREE.MeshLambertMaterial,q=new THREE.Mesh(n,t),l.add(q));var u=[],p=[],v=[],x=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,w=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,y=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,M=/f( +-?\d+)( +-?\d+)( +-?\d+)( +-?\d+)?/,
z=/f( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))?/,K=/f( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))?/,H=/f( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))?/,D=a.split("\n");for(a=0;a<D.length;a++){var L=D[a],L=L.trim();0!==L.length&&"#"!==L.charAt(0)&&(null!==(q=x.exec(L))?u.push(n.vertices.push(b(q[1],q[2],q[3]))):null!==(q=w.exec(L))?p.push(b(q[1],q[2],
q[3])):null!==(q=y.exec(L))?v.push(c(q[1],q[2])):null!==(q=M.exec(L))?m([q[1],q[2],q[3],q[4]]):null!==(q=z.exec(L))?m([q[2],q[5],q[8],q[11]],[q[3],q[6],q[9],q[12]]):null!==(q=K.exec(L))?m([q[2],q[6],q[10],q[14]],[q[3],q[7],q[11],q[15]],[q[4],q[8],q[12],q[16]]):null!==(q=H.exec(L))?m([q[2],q[5],q[8],q[11]],[],[q[3],q[6],q[9],q[12]]):/^o /.test(L)?(n=new THREE.Geometry,t=new THREE.MeshLambertMaterial,q=new THREE.Mesh(n,t),q.name=L.substring(2).trim(),l.add(q)):/^g /.test(L)||(/^usemtl /.test(L)?t.name=
L.substring(7).trim():/^mtllib /.test(L)||/^s /.test(L)))}t=l.children;a=0;for(x=t.length;a<x;a++)n=t[a].geometry,n.computeFaceNormals(),n.computeBoundingSphere();return l}};THREE.MTLLoader=function(a,b,c){this.baseUrl=a;this.options=b;this.crossOrigin=c};
THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(a,b,c,d){var e=this;c=new THREE.XHRLoader;c.setCrossOrigin(this.crossOrigin);c.load(a,function(a){b(e.parse(a))})},parse:function(a){var b=a.split("\n"),c={},d=/\s+/;a={};for(var e=0;e<b.length;e++){var f=b[e],f=f.trim();if(0!==f.length&&"#"!==f.charAt(0)){var g=f.indexOf(" "),h=0<=g?f.substring(0,g):f,h=h.toLowerCase(),f=0<=g?f.substring(g+1):"",f=f.trim();"newmtl"===h?(c={name:f},a[f]=c):c&&("ka"===h||"kd"===h||"ks"===h?(f=f.split(d,
3),c[h]=[parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2])]):c[h]=f)}}b=new THREE.MTLLoader.MaterialCreator(this.baseUrl,this.options);b.setMaterials(a);return b}};THREE.MTLLoader.MaterialCreator=function(a,b){this.baseUrl=a;this.options=b;this.materialsInfo={};this.materials={};this.materialsArray=[];this.nameLookup={};this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide;this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping};
THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,setMaterials:function(a){this.materialsInfo=this.convert(a);this.materials={};this.materialsArray=[];this.nameLookup={}},convert:function(a){if(!this.options)return a;var b={},c;for(c in a){var d=a[c],e={};b[c]=e;for(var f in d){var g=!0,h=d[f],k=f.toLowerCase();switch(k){case "kd":case "ka":case "ks":this.options&&this.options.normalizeRGB&&(h=[h[0]/255,h[1]/255,h[2]/255]);this.options&&this.options.ignoreZeroRGBs&&
0===h[0]&&0===h[1]&&0===h[1]&&(g=!1);break;case "d":this.options&&this.options.invertTransparency&&(h=1-h)}g&&(e[k]=h)}}return b},preload:function(){for(var a in this.materialsInfo)this.create(a)},getIndex:function(a){return this.nameLookup[a]},getAsArray:function(){var a=0,b;for(b in this.materialsInfo)this.materialsArray[a]=this.create(b),this.nameLookup[b]=a,a++;return this.materialsArray},create:function(a){void 0===this.materials[a]&&this.createMaterial_(a);return this.materials[a]},createMaterial_:function(a){var b=
this.materialsInfo[a],c={name:a,side:this.side},d;for(d in b){var e=b[d];switch(d.toLowerCase()){case "kd":c.diffuse=(new THREE.Color).fromArray(e);break;case "ka":c.ambient=(new THREE.Color).fromArray(e);break;case "ks":c.specular=(new THREE.Color).fromArray(e);break;case "map_kd":c.map=this.loadTexture(this.baseUrl+e);c.map.wrapS=this.wrap;c.map.wrapT=this.wrap;break;case "ns":c.shininess=e;break;case "d":1>e&&(c.transparent=!0,c.opacity=e)}}c.diffuse&&(c.ambient||(c.ambient=c.diffuse),c.color=
c.diffuse);this.materials[a]=new THREE.MeshPhongMaterial(c);return this.materials[a]},loadTexture:function(a,b,c,d){if(/\.dds$/i.test(a))var e=THREE.ImageUtils.loadCompressedTexture(a,b,c,d);else d=new Image,e=new THREE.Texture(d,b),b=new THREE.ImageLoader,b.crossOrigin=this.crossOrigin,b.load(a,function(a){e.image=THREE.MTLLoader.ensurePowerOfTwo_(a);e.needsUpdate=!0;c&&c(e)});return e}};
THREE.MTLLoader.ensurePowerOfTwo_=function(a){if(!THREE.Math.isPowerOfTwo(a.width)||!THREE.Math.isPowerOfTwo(a.height)){var b=document.createElement("canvas");b.width=THREE.MTLLoader.nextHighestPowerOfTwo_(a.width);b.height=THREE.MTLLoader.nextHighestPowerOfTwo_(a.height);b.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,b.width,b.height);return b}return a};THREE.MTLLoader.nextHighestPowerOfTwo_=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1};THREE.EventDispatcher.prototype.apply(THREE.MTLLoader.prototype);THREE.OBJMTLLoader=function(){};
THREE.OBJMTLLoader.prototype={constructor:THREE.OBJMTLLoader,load:function(a,b,c,d,e){var f=this;(new THREE.MTLLoader(a.substr(0,a.lastIndexOf("/")+1))).load(b,function(b){b.preload();var d=new THREE.XHRLoader(f.manager);d.setCrossOrigin(this.crossOrigin);d.load(a,function(a){a=f.parse(a);a.traverse(function(a){if(a instanceof THREE.Mesh&&a.material.name){var c=b.create(a.material.name);c&&(a.material=c)}});c(a)})})},parse:function(a,b){function c(a,b,c){return new THREE.Vector3(a,b,c)}function d(a,
b){return new THREE.Vector2(a,b)}function e(a,b,c,d){return new THREE.Face3(a,b,c,d)}function f(a,b){0<p.length&&(t.vertices=p,t.mergeVertices(),t.computeFaceNormals(),t.computeBoundingSphere(),n.add(u),t=new THREE.Geometry,u=new THREE.Mesh(t,q));void 0!==a&&(u.name=a);void 0!==b&&(q=new THREE.MeshLambertMaterial,q.name=b,u.material=q)}function g(a,b,c,d){void 0===d?t.faces.push(e(parseInt(a)-(m+1),parseInt(b)-(m+1),parseInt(c)-(m+1))):t.faces.push(e(parseInt(a)-(m+1),parseInt(b)-(m+1),parseInt(c)-
(m+1),[v[parseInt(d[0])-1].clone(),v[parseInt(d[1])-1].clone(),v[parseInt(d[2])-1].clone()]))}function h(a,b,c){t.faceVertexUvs[0].push([x[parseInt(a)-1].clone(),x[parseInt(b)-1].clone(),x[parseInt(c)-1].clone()])}function k(a,b,c){void 0===a[3]?(g(a[0],a[1],a[2],c),void 0!==b&&0<b.length&&h(b[0],b[1],b[2])):(void 0!==c&&0<c.length?(g(a[0],a[1],a[3],[c[0],c[1],c[3]]),g(a[1],a[2],a[3],[c[1],c[2],c[3]])):(g(a[0],a[1],a[3]),g(a[1],a[2],a[3])),void 0!==b&&0<b.length&&(h(b[0],b[1],b[3]),h(b[1],b[2],b[3])))}
for(var m=0,l=new THREE.Object3D,n=l,t=new THREE.Geometry,q=new THREE.MeshLambertMaterial,u=new THREE.Mesh(t,q),p=[],v=[],x=[],w=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,y=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,M=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,z=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,K=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,H=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,
D=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,L=a.split("\n"),A=0;A<L.length;A++){var E=L[A],E=E.trim(),F;0!==E.length&&"#"!==E.charAt(0)&&(null!==(F=w.exec(E))?p.push(c(parseFloat(F[1]),parseFloat(F[2]),parseFloat(F[3]))):null!==(F=y.exec(E))?v.push(c(parseFloat(F[1]),parseFloat(F[2]),parseFloat(F[3]))):null!==(F=M.exec(E))?x.push(d(parseFloat(F[1]),parseFloat(F[2]))):null!==(F=z.exec(E))?k([F[1],F[2],F[3],F[4]]):null!==(F=K.exec(E))?k([F[2],F[5],F[8],F[11]],[F[3],
F[6],F[9],F[12]]):null!==(F=H.exec(E))?k([F[2],F[6],F[10],F[14]],[F[3],F[7],F[11],F[15]],[F[4],F[8],F[12],F[16]]):null!==(F=D.exec(E))?k([F[2],F[5],F[8],F[11]],[],[F[3],F[6],F[9],F[12]]):/^o /.test(E)?(f(),m+=p.length,p=[],n=new THREE.Object3D,n.name=E.substring(2).trim(),l.add(n)):/^g /.test(E)?f(E.substring(2).trim(),void 0):/^usemtl /.test(E)?f(void 0,E.substring(7).trim()):/^mtllib /.test(E)?b&&(E=E.substring(7),E=E.trim(),b(E)):/^s /.test(E)||console.log("THREE.OBJMTLLoader: Unhandled line "+
E))}f(void 0,void 0);return l}};THREE.EventDispatcher.prototype.apply(THREE.OBJMTLLoader.prototype);THREE.TrackballControls=function(a,b){function c(a){!1!==g.enabled&&(window.removeEventListener("keydown",c),l=m,m===h.NONE)&&(a.keyCode!==g.keys[h.ROTATE]||g.noRotate?a.keyCode!==g.keys[h.ZOOM]||g.noZoom?a.keyCode!==g.keys[h.PAN]||g.noPan||(m=h.PAN):m=h.ZOOM:m=h.ROTATE)}function d(a){!1!==g.enabled&&(a.preventDefault(),a.stopPropagation(),m!==h.ROTATE||g.noRotate?m!==h.ZOOM||g.noZoom?m!==h.PAN||g.noPan||g.getMouseOnScreen(a.pageX,a.pageY,y):g.getMouseOnScreen(a.pageX,a.pageY,p):g.getMouseProjectionOnBall(a.pageX,
a.pageY,q))}function e(a){!1!==g.enabled&&(a.preventDefault(),a.stopPropagation(),m=h.NONE,document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",e),g.dispatchEvent(K))}function f(a){if(!1!==g.enabled){a.preventDefault();a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3);u.y+=.01*b;g.dispatchEvent(z);g.dispatchEvent(K)}}var g=this,h={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=a;this.domElement=void 0!==
b?b:document;this.enabled=!0;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noRoll=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var k=new THREE.Vector3,m=h.NONE,l=h.NONE,n=new THREE.Vector3,t=new THREE.Vector3,q=new THREE.Vector3,u=new THREE.Vector2,p=new THREE.Vector2,v=0,x=0,w=new THREE.Vector2,y=new THREE.Vector2;
this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var M={type:"change"},z={type:"start"},K={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft;this.screen.top=
a.top+window.pageYOffset-b.clientTop;this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=function(a){if("function"==typeof this[a.type])this[a.type](a)};this.getMouseOnScreen=function(a,b,c){return c.set((a-g.screen.left)/g.screen.width,(b-g.screen.top)/g.screen.height)};this.getMouseProjectionOnBall=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){b.set((c-.5*g.screen.width-g.screen.left)/(.5*g.screen.width),(.5*g.screen.height+g.screen.top-d)/(.5*
g.screen.height),0);c=b.length();g.noRoll?b.z=c<Math.SQRT1_2?Math.sqrt(1-c*c):.5/c:1<c?b.normalize():b.z=Math.sqrt(1-c*c);n.copy(g.object.position).sub(g.target);e.copy(g.object.up).setLength(b.y);e.add(a.copy(g.object.up).cross(n).setLength(b.x));e.add(n.setLength(b.z));return e}}();this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(){var c=Math.acos(t.dot(q)/t.length()/q.length());c&&(a.crossVectors(t,q).normalize(),c*=g.rotateSpeed,b.setFromAxisAngle(a,
-c),n.applyQuaternion(b),g.object.up.applyQuaternion(b),q.applyQuaternion(b),g.staticMoving?t.copy(q):(b.setFromAxisAngle(a,c*(g.dynamicDampingFactor-1)),t.applyQuaternion(b)))}}();this.zoomCamera=function(){if(m===h.TOUCH_ZOOM){var a=v/x;v=x;n.multiplyScalar(a)}else a=1+(p.y-u.y)*g.zoomSpeed,1!==a&&0<a&&(n.multiplyScalar(a),g.staticMoving?u.copy(p):u.y+=(p.y-u.y)*this.dynamicDampingFactor)};this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(y).sub(w);
a.lengthSq()&&(a.multiplyScalar(n.length()*g.panSpeed),c.copy(n).cross(g.object.up).setLength(a.x),c.add(b.copy(g.object.up).setLength(a.y)),g.object.position.add(c),g.target.add(c),g.staticMoving?w.copy(y):w.add(a.subVectors(y,w).multiplyScalar(g.dynamicDampingFactor)))}}();this.checkDistances=function(){g.noZoom&&g.noPan||(n.lengthSq()>g.maxDistance*g.maxDistance&&g.object.position.addVectors(g.target,n.setLength(g.maxDistance)),n.lengthSq()<g.minDistance*g.minDistance&&g.object.position.addVectors(g.target,
n.setLength(g.minDistance)))};this.update=function(){n.subVectors(g.object.position,g.target);g.noRotate||g.rotateCamera();g.noZoom||g.zoomCamera();g.noPan||g.panCamera();g.object.position.addVectors(g.target,n);g.checkDistances();g.object.lookAt(g.target);1E-6<k.distanceToSquared(g.object.position)&&(g.dispatchEvent(M),k.copy(g.object.position))};this.reset=function(){l=m=h.NONE;g.target.copy(g.target0);g.object.position.copy(g.position0);g.object.up.copy(g.up0);n.subVectors(g.object.position,g.target);
g.object.lookAt(g.target);g.dispatchEvent(M);k.copy(g.object.position)};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(a){!1!==g.enabled&&(a.preventDefault(),a.stopPropagation(),m===h.NONE&&(m=a.button),m!==h.ROTATE||g.noRotate?m!==h.ZOOM||g.noZoom?m!==h.PAN||g.noPan||(g.getMouseOnScreen(a.pageX,a.pageY,w),y.copy(w)):(g.getMouseOnScreen(a.pageX,a.pageY,u),p.copy(u)):(g.getMouseProjectionOnBall(a.pageX,a.pageY,
t),q.copy(t)),document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",e,!1),g.dispatchEvent(z))},!1);this.domElement.addEventListener("mousewheel",f,!1);this.domElement.addEventListener("DOMMouseScroll",f,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==g.enabled){switch(a.touches.length){case 1:m=h.TOUCH_ROTATE;q.copy(g.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,t));break;case 2:m=h.TOUCH_ZOOM;var b=a.touches[0].pageX-a.touches[1].pageX;
a=a.touches[0].pageY-a.touches[1].pageY;x=v=Math.sqrt(b*b+a*a);break;case 3:m=h.TOUCH_PAN;y.copy(g.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,w));break;default:m=h.NONE}g.dispatchEvent(z)}},!1);this.domElement.addEventListener("touchend",function(a){if(!1!==g.enabled){switch(a.touches.length){case 1:t.copy(g.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,q));break;case 2:v=x=0;break;case 3:w.copy(g.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,y))}m=h.NONE;g.dispatchEvent(K)}},
!1);this.domElement.addEventListener("touchmove",function(a){if(!1!==g.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:g.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,q);break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;x=Math.sqrt(b*b+a*a);break;case 3:g.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,y);break;default:m=h.NONE}},!1);window.addEventListener("keydown",c,!1);window.addEventListener("keyup",
function(a){!1!==g.enabled&&(m=l,window.addEventListener("keydown",c,!1))},!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls=function(a,b){function c(a){if(!1!==f.enabled){a.preventDefault();var b=f.domElement===document?f.domElement.body:f.domElement;if(H===K.ROTATE){if(!0===f.noRotate)return;h.set(a.clientX,a.clientY);k.subVectors(h,g);f.rotateLeft(2*Math.PI*k.x/b.clientWidth*f.rotateSpeed);f.rotateUp(2*Math.PI*k.y/b.clientHeight*f.rotateSpeed);g.copy(h)}else if(H===K.DOLLY){if(!0===f.noZoom)return;p.set(a.clientX,a.clientY);v.subVectors(p,u);0<v.y?f.dollyIn():f.dollyOut();u.copy(p)}else if(H===K.PAN){if(!0===
f.noPan)return;l.set(a.clientX,a.clientY);n.subVectors(l,m);f.pan(n.x,n.y);m.copy(l)}f.update()}}function d(){!1!==f.enabled&&(f.domElement.removeEventListener("mousemove",c,!1),f.domElement.removeEventListener("mouseup",d,!1),f.dispatchEvent(F),H=K.NONE)}function e(a){if(!1!==f.enabled&&!0!==f.noZoom){a.preventDefault();a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);0<b?f.dollyOut():f.dollyIn();f.update();f.dispatchEvent(E);f.dispatchEvent(F)}}this.object=
a;this.domElement=void 0!==b?b:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var f=this,g=new THREE.Vector2,h=new THREE.Vector2,k=new THREE.Vector2,m=new THREE.Vector2,l=new THREE.Vector2,
n=new THREE.Vector2,t=new THREE.Vector3,q=new THREE.Vector3,u=new THREE.Vector2,p=new THREE.Vector2,v=new THREE.Vector2,x=0,w=0,y=1,M=new THREE.Vector3,z=new THREE.Vector3,K={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},H=K.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();var D=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),L=D.clone().inverse(),A={type:"change"},E={type:"start"},F={type:"end"};this.rotateLeft=
function(a){void 0===a&&(a=2*Math.PI/60/60*f.autoRotateSpeed);w-=a};this.rotateUp=function(a){void 0===a&&(a=2*Math.PI/60/60*f.autoRotateSpeed);x-=a};this.panLeft=function(a){var b=this.object.matrix.elements;t.set(b[0],b[1],b[2]);t.multiplyScalar(-a);M.add(t)};this.panUp=function(a){var b=this.object.matrix.elements;t.set(b[4],b[5],b[6]);t.multiplyScalar(a);M.add(t)};this.pan=function(a,b){var c=f.domElement===document?f.domElement.body:f.domElement;if(void 0!==f.object.fov){var d=f.object.position.clone().sub(f.target).length(),
d=d*Math.tan(f.object.fov/2*Math.PI/180);f.panLeft(2*a*d/c.clientHeight);f.panUp(2*b*d/c.clientHeight)}else void 0!==f.object.top?(f.panLeft(a*(f.object.right-f.object.left)/c.clientWidth),f.panUp(b*(f.object.top-f.object.bottom)/c.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,f.zoomSpeed));y/=a};this.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,f.zoomSpeed));y*=a};this.update=function(){var a=
this.object.position;q.copy(a).sub(this.target);q.applyQuaternion(D);var b=Math.atan2(q.x,q.z),c=Math.atan2(Math.sqrt(q.x*q.x+q.z*q.z),q.y);this.autoRotate&&this.rotateLeft(2*Math.PI/60/60*f.autoRotateSpeed);var b=b+w,c=c+x,c=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,c)),c=Math.max(1E-6,Math.min(Math.PI-1E-6,c)),d=q.length()*y,d=Math.max(this.minDistance,Math.min(this.maxDistance,d));this.target.add(M);q.x=d*Math.sin(c)*Math.sin(b);q.y=d*Math.cos(c);q.z=d*Math.sin(c)*Math.cos(b);q.applyQuaternion(L);
a.copy(this.target).add(q);this.object.lookAt(this.target);x=w=0;y=1;M.set(0,0,0);1E-6<z.distanceToSquared(this.object.position)&&(this.dispatchEvent(A),z.copy(this.object.position))};this.reset=function(){H=K.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(a){if(!1!==f.enabled){a.preventDefault();if(0===a.button){if(!0===
f.noRotate)return;H=K.ROTATE;g.set(a.clientX,a.clientY)}else if(1===a.button){if(!0===f.noZoom)return;H=K.DOLLY;u.set(a.clientX,a.clientY)}else if(2===a.button){if(!0===f.noPan)return;H=K.PAN;m.set(a.clientX,a.clientY)}f.domElement.addEventListener("mousemove",c,!1);f.domElement.addEventListener("mouseup",d,!1);f.dispatchEvent(E)}},!1);this.domElement.addEventListener("mousewheel",e,!1);this.domElement.addEventListener("DOMMouseScroll",e,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==
f.enabled){switch(a.touches.length){case 1:if(!0===f.noRotate)return;H=K.TOUCH_ROTATE;g.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(!0===f.noZoom)return;H=K.TOUCH_DOLLY;var b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;b=Math.sqrt(b*b+a*a);u.set(0,b);break;case 3:if(!0===f.noPan)return;H=K.TOUCH_PAN;m.set(a.touches[0].pageX,a.touches[0].pageY);break;default:H=K.NONE}f.dispatchEvent(E)}},!1);this.domElement.addEventListener("touchend",function(){!1!==
f.enabled&&(f.dispatchEvent(F),H=K.NONE)},!1);this.domElement.addEventListener("touchmove",function(a){if(!1!==f.enabled){a.preventDefault();a.stopPropagation();var b=f.domElement===document?f.domElement.body:f.domElement;switch(a.touches.length){case 1:if(!0===f.noRotate)break;if(H!==K.TOUCH_ROTATE)break;h.set(a.touches[0].pageX,a.touches[0].pageY);k.subVectors(h,g);f.rotateLeft(2*Math.PI*k.x/b.clientWidth*f.rotateSpeed);f.rotateUp(2*Math.PI*k.y/b.clientHeight*f.rotateSpeed);g.copy(h);f.update();
break;case 2:if(!0===f.noZoom)break;if(H!==K.TOUCH_DOLLY)break;b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;a=Math.sqrt(b*b+a*a);p.set(0,a);v.subVectors(p,u);0<v.y?f.dollyOut():f.dollyIn();u.copy(p);f.update();break;case 3:if(!0===f.noPan)break;if(H!==K.TOUCH_PAN)break;l.set(a.touches[0].pageX,a.touches[0].pageY);n.subVectors(l,m);f.pan(n.x,n.y);m.copy(l);f.update();break;default:H=K.NONE}}},!1);window.addEventListener("keydown",function(a){if(!1!==f.enabled&&!0!==
f.noKeys&&!0!==f.noPan)switch(a.keyCode){case f.keys.UP:f.pan(0,f.keyPanSpeed);f.update();break;case f.keys.BOTTOM:f.pan(0,-f.keyPanSpeed);f.update();break;case f.keys.LEFT:f.pan(f.keyPanSpeed,0);f.update();break;case f.keys.RIGHT:f.pan(-f.keyPanSpeed,0),f.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.ShaderLib.mirror={uniforms:{mirrorColor:{type:"c",value:new THREE.Color(8355711)},mirrorSampler:{type:"t",value:null},textureMatrix:{type:"m4",value:new THREE.Matrix4}},vertexShader:"uniform mat4 textureMatrix;\nvarying vec4 mirrorCoord;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nmirrorCoord = textureMatrix * worldPosition;\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform vec3 mirrorColor;\nuniform sampler2D mirrorSampler;\nvarying vec4 mirrorCoord;\nfloat blendOverlay(float base, float blend) {\nreturn( base < 0.5 ? ( 2.0 * base * blend ) : (1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n}\nvoid main() {\nvec4 color = texture2DProj(mirrorSampler, mirrorCoord);\ncolor = vec4(blendOverlay(mirrorColor.r, color.r), blendOverlay(mirrorColor.g, color.g), blendOverlay(mirrorColor.b, color.b), 1.0);\ngl_FragColor = color;\n}"};
THREE.Mirror=function(a,b,c){THREE.Object3D.call(this);this.name="mirror_"+this.id;c=c||{};this.matrixNeedsUpdate=!0;var d=void 0!==c.textureWidth?c.textureWidth:512,e=void 0!==c.textureHeight?c.textureHeight:512;this.clipBias=void 0!==c.clipBias?c.clipBias:0;var f=void 0!==c.color?new THREE.Color(c.color):new THREE.Color(8355711);this.renderer=a;this.mirrorPlane=new THREE.Plane;this.normal=new THREE.Vector3(0,0,1);this.mirrorWorldPosition=new THREE.Vector3;this.cameraWorldPosition=new THREE.Vector3;
this.rotationMatrix=new THREE.Matrix4;this.lookAtPosition=new THREE.Vector3(0,0,-1);this.clipPlane=new THREE.Vector4;void 0!==c.debugMode&&c.debugMode&&(a=new THREE.ArrowHelper(new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,0),10,16777088),c=new THREE.Geometry,c.vertices.push(new THREE.Vector3(-10,-10,0)),c.vertices.push(new THREE.Vector3(10,-10,0)),c.vertices.push(new THREE.Vector3(10,10,0)),c.vertices.push(new THREE.Vector3(-10,10,0)),c.vertices.push(c.vertices[0]),c=new THREE.Line(c,new THREE.LineBasicMaterial({color:16777088})),
this.add(a),this.add(c));b instanceof THREE.PerspectiveCamera?this.camera=b:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!"));this.textureMatrix=new THREE.Matrix4;this.mirrorCamera=this.camera.clone();this.texture=new THREE.WebGLRenderTarget(d,e);this.tempTexture=new THREE.WebGLRenderTarget(d,e);b=THREE.ShaderLib.mirror;a=THREE.UniformsUtils.clone(b.uniforms);this.material=new THREE.ShaderMaterial({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,
uniforms:a});this.material.uniforms.mirrorSampler.value=this.texture;this.material.uniforms.mirrorColor.value=f;this.material.uniforms.textureMatrix.value=this.textureMatrix;THREE.Math.isPowerOfTwo(d)&&THREE.Math.isPowerOfTwo(e)||(this.texture.generateMipmaps=!1,this.tempTexture.generateMipmaps=!1);this.updateTextureMatrix();this.render()};THREE.Mirror.prototype=Object.create(THREE.Object3D.prototype);
THREE.Mirror.prototype.renderWithMirror=function(a){this.updateTextureMatrix();this.matrixNeedsUpdate=!1;var b=a.camera;a.camera=this.mirrorCamera;a.renderTemp();a.material.uniforms.mirrorSampler.value=a.tempTexture;this.render();this.matrixNeedsUpdate=!0;a.material.uniforms.mirrorSampler.value=a.texture;a.camera=b;a.updateTextureMatrix()};
THREE.Mirror.prototype.updateTextureMatrix=function(){var a=THREE.Math.sign;this.updateMatrixWorld();this.camera.updateMatrixWorld();this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld);this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld);this.rotationMatrix.extractRotation(this.matrixWorld);this.normal.set(0,0,1);this.normal.applyMatrix4(this.rotationMatrix);var b=this.mirrorWorldPosition.clone().sub(this.cameraWorldPosition);b.reflect(this.normal).negate();b.add(this.mirrorWorldPosition);
this.rotationMatrix.extractRotation(this.camera.matrixWorld);this.lookAtPosition.set(0,0,-1);this.lookAtPosition.applyMatrix4(this.rotationMatrix);this.lookAtPosition.add(this.cameraWorldPosition);var c=this.mirrorWorldPosition.clone().sub(this.lookAtPosition);c.reflect(this.normal).negate();c.add(this.mirrorWorldPosition);this.up.set(0,-1,0);this.up.applyMatrix4(this.rotationMatrix);this.up.reflect(this.normal).negate();this.mirrorCamera.position.copy(b);this.mirrorCamera.up=this.up;this.mirrorCamera.lookAt(c);
this.mirrorCamera.updateProjectionMatrix();this.mirrorCamera.updateMatrixWorld();this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld);this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix);this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse);this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mirrorWorldPosition);this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse);
this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);b=new THREE.Vector4;c=this.mirrorCamera.projectionMatrix;b.x=(a(this.clipPlane.x)+c.elements[8])/c.elements[0];b.y=(a(this.clipPlane.y)+c.elements[9])/c.elements[5];b.z=-1;b.w=(1+c.elements[10])/c.elements[14];a=new THREE.Vector4;a=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(b));c.elements[2]=a.x;c.elements[6]=a.y;c.elements[10]=a.z+1-this.clipBias;c.elements[14]=a.w};
THREE.Mirror.prototype.render=function(){this.matrixNeedsUpdate&&this.updateTextureMatrix();this.matrixNeedsUpdate=!0;for(var a=this;void 0!==a.parent;)a=a.parent;void 0!==a&&a instanceof THREE.Scene&&this.renderer.render(a,this.mirrorCamera,this.texture,!0)};
THREE.Mirror.prototype.renderTemp=function(){this.matrixNeedsUpdate&&this.updateTextureMatrix();this.matrixNeedsUpdate=!0;for(var a=this;void 0!==a.parent;)a=a.parent;void 0!==a&&a instanceof THREE.Scene&&this.renderer.render(a,this.mirrorCamera,this.tempTexture,!0)};var MooTools={version:"1.2.4",build:"0d9113241a90b9cd5643b926795852a2026710d4"},Native=function(a){a=a||{};var b=a.name,c=a.legacy,d=a.protect,e=a.implement,f=a.generics,g=a.initialize,h=a.afterImplement||function(){};a=g||c;f=!1!==f;a.constructor=Native;a.$family={name:"native"};c&&g&&(a.prototype=c.prototype);a.prototype.constructor=a;b&&(b=b.toLowerCase(),a.prototype.$family={name:b},Native.typize(a,b));var k=function(a,b,c,e){d&&!e&&a.prototype[b]||(a.prototype[b]=c);f&&Native.genericize(a,b,
d);h.call(a,b,c);return a};a.alias=function(a,b,c){if("string"==typeof a&&(a=this.prototype[a]))return k(this,b,a,c);for(var d in a)this.alias(d,a[d],b);return this};a.implement=function(a,b,c){if("string"==typeof a)return k(this,a,b,c);for(var d in a)k(this,d,a[d],b);return this};e&&a.implement(e);return a};Native.genericize=function(a,b,c){c&&a[b]||"function"!=typeof a.prototype[b]||(a[b]=function(){var c=Array.prototype.slice.call(arguments);return a.prototype[b].apply(c.shift(),c)})};
Native.implement=function(a,b){for(var c=0,d=a.length;c<d;c++)a[c].implement(b)};Native.typize=function(a,b){a.type||(a.type=function(a){return $type(a)===b})};
(function(){var a={Array:Array,Date:Date,Function:Function,Number:Number,RegExp:RegExp,String:String},b;for(b in a)new Native({name:b,initialize:a[b],protect:!0});b={"boolean":Boolean,"native":Native,object:Object};for(var c in b)Native.typize(b[c],c);c={Array:"concat indexOf join lastIndexOf pop push reverse shift slice sort splice toString unshift valueOf".split(" "),String:"charAt charCodeAt concat indexOf lastIndexOf match replace search slice split substr substring toLowerCase toUpperCase valueOf".split(" ")};
for(var d in c)for(b=c[d].length;b--;)Native.genericize(a[d],c[d][b],!0)})();var Hash=new Native({name:"Hash",initialize:function(a){"hash"==$type(a)&&(a=$unlink(a.getClean()));for(var b in a)this[b]=a[b];return this}});Hash.implement({forEach:function(a,b){for(var c in this)this.hasOwnProperty(c)&&a.call(b,this[c],c,this)},getClean:function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&(a[b]=this[b]);return a},getLength:function(){var a=0,b;for(b in this)this.hasOwnProperty(b)&&a++;return a}});
Hash.alias("forEach","each");Array.implement({forEach:function(a,b){for(var c=0,d=this.length;c<d;c++)a.call(b,this[c],c,this)}});Array.alias("forEach","each");function $A(a){if(a.item){for(var b=a.length,c=Array(b);b--;)c[b]=a[b];return c}return Array.prototype.slice.call(a)}function $arguments(a){return function(){return arguments[a]}}function $chk(a){return!(!a&&0!==a)}function $clear(a){clearTimeout(a);clearInterval(a);return null}function $defined(a){return void 0!=a}
function $each(a,b,c){var d=$type(a);("arguments"==d||"collection"==d||"array"==d?Array:Hash).each(a,b,c)}function $empty(){}function $extend(a,b){for(var c in b||{})a[c]=b[c];return a}function $H(a){return new Hash(a)}function $lambda(a){return"function"==$type(a)?a:function(){return a}}function $merge(){var a=Array.slice(arguments);a.unshift({});return $mixin.apply(null,a)}
function $mixin(a){for(var b=1,c=arguments.length;b<c;b++){var d=arguments[b];if("object"==$type(d))for(var e in d){var f=d[e],g=a[e];a[e]=g&&"object"==$type(f)&&"object"==$type(g)?$mixin(g,f):$unlink(f)}}return a}function $pick(){for(var a=0,b=arguments.length;a<b;a++)if(void 0!=arguments[a])return arguments[a];return null}function $random(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function $splat(a){var b=$type(a);return b?"array"!=b&&"arguments"!=b?[a]:a:[]}var $time=Date.now||function(){return+new Date};
function $try(){for(var a=0,b=arguments.length;a<b;a++)try{return arguments[a]()}catch(c){}return null}function $type(a){if(void 0==a)return!1;if(a.$family)return"number"!=a.$family.name||isFinite(a)?a.$family.name:!1;if(a.nodeName)switch(a.nodeType){case 1:return"element";case 3:return/\S/.test(a.nodeValue)?"textnode":"whitespace"}else if("number"==typeof a.length){if(a.callee)return"arguments";if(a.item)return"collection"}return typeof a}
function $unlink(a){var b;switch($type(a)){case "object":b={};for(var c in a)b[c]=$unlink(a[c]);break;case "hash":b=new Hash(a);break;case "array":b=[];c=0;for(var d=a.length;c<d;c++)b[c]=$unlink(a[c]);break;default:return a}return b}
var Browser=$merge({Engine:{name:"unknown",version:0},Platform:{name:void 0!=window.orientation?"ipod":(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase()},Features:{xpath:!!document.evaluate,air:!!window.runtime,query:!!document.querySelector},Plugins:{},Engines:{presto:function(){return window.opera?arguments.callee.caller?960:document.getElementsByClassName?950:925:!1},trident:function(){return window.ActiveXObject?window.XMLHttpRequest?document.querySelectorAll?6:5:4:!1},
webkit:function(){return navigator.taintEnabled?!1:Browser.Features.xpath?Browser.Features.query?525:420:419},gecko:function(){return document.getBoxObjectFor||null!=window.mozInnerScreenX?document.getElementsByClassName?19:18:!1}}},Browser||{});Browser.Platform[Browser.Platform.name]=!0;Browser.detect=function(){for(var a in this.Engines){var b=this.Engines[a]();if(b){this.Engine={name:a,version:b};this.Engine[a]=this.Engine[a+b]=!0;break}}return{name:a,version:b}};Browser.detect();
Browser.Request=function(){return $try(function(){return new XMLHttpRequest},function(){return new ActiveXObject("MSXML2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})};Browser.Features.xhr=!!Browser.Request();
Browser.Plugins.Flash=function(){var a=($try(function(){return navigator.plugins["Shockwave Flash"].description},function(){return(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")})||"0 r0").match(/\d+/g);return{version:parseInt(a[0]||"0."+a[1],10)||0,build:parseInt(a[2],10)||0}}();
function $exec(a){if(!a)return a;if(window.execScript)window.execScript(a);else{var b=document.createElement("script");b.setAttribute("type","text/javascript");b[Browser.Engine.webkit&&420>Browser.Engine.version?"innerText":"text"]=a;document.head.appendChild(b);document.head.removeChild(b)}return a}Native.UID=1;
var $uid=Browser.Engine.trident?function(a){return(a.uid||(a.uid=[Native.UID++]))[0]}:function(a){return a.uid||(a.uid=Native.UID++)},Window=new Native({name:"Window",legacy:Browser.Engine.trident?null:window.Window,initialize:function(a){$uid(a);a.Element||(a.Element=$empty,Browser.Engine.webkit&&a.document.createElement("iframe"),a.Element.prototype=Browser.Engine.webkit?window["[[DOMElement.prototype]]"]:{});a.document.window=a;return $extend(a,Window.Prototype)},afterImplement:function(a,b){window[a]=
Window.Prototype[a]=b}});Window.Prototype={$family:{name:"window"}};new Window(window);
var Document=new Native({name:"Document",legacy:Browser.Engine.trident?null:window.Document,initialize:function(a){$uid(a);a.head=a.getElementsByTagName("head")[0];a.html=a.getElementsByTagName("html")[0];Browser.Engine.trident&&4>=Browser.Engine.version&&$try(function(){a.execCommand("BackgroundImageCache",!1,!0)});Browser.Engine.trident&&a.window.attachEvent("onunload",function(){a.window.detachEvent("onunload",arguments.callee);a.head=a.html=a.window=null});return $extend(a,Document.Prototype)},
afterImplement:function(a,b){document[a]=Document.Prototype[a]=b}});Document.Prototype={$family:{name:"document"}};new Document(document);
Array.implement({every:function(a,b){for(var c=0,d=this.length;c<d;c++)if(!a.call(b,this[c],c,this))return!1;return!0},filter:function(a,b){for(var c=[],d=0,e=this.length;d<e;d++)a.call(b,this[d],d,this)&&c.push(this[d]);return c},clean:function(){return this.filter($defined)},indexOf:function(a,b){for(var c=this.length,d=0>b?Math.max(0,c+b):b||0;d<c;d++)if(this[d]===a)return d;return-1},map:function(a,b){for(var c=[],d=0,e=this.length;d<e;d++)c[d]=a.call(b,this[d],d,this);return c},some:function(a,
b){for(var c=0,d=this.length;c<d;c++)if(a.call(b,this[c],c,this))return!0;return!1},associate:function(a){for(var b={},c=Math.min(this.length,a.length),d=0;d<c;d++)b[a[d]]=this[d];return b},link:function(a){for(var b={},c=0,d=this.length;c<d;c++)for(var e in a)if(a[e](this[c])){b[e]=this[c];delete a[e];break}return b},contains:function(a,b){return-1!=this.indexOf(a,b)},extend:function(a){for(var b=0,c=a.length;b<c;b++)this.push(a[b]);return this},getLast:function(){return this.length?this[this.length-
1]:null},getRandom:function(){return this.length?this[$random(0,this.length-1)]:null},include:function(a){this.contains(a)||this.push(a);return this},combine:function(a){for(var b=0,c=a.length;b<c;b++)this.include(a[b]);return this},erase:function(a){for(var b=this.length;b--;b)this[b]===a&&this.splice(b,1);return this},empty:function(){this.length=0;return this},flatten:function(){for(var a=[],b=0,c=this.length;b<c;b++){var d=$type(this[b]);d&&(a=a.concat("array"==d||"collection"==d||"arguments"==
d?Array.flatten(this[b]):this[b]))}return a},hexToRgb:function(a){if(3!=this.length)return null;var b=this.map(function(a){1==a.length&&(a+=a);return a.toInt(16)});return a?b:"rgb("+b+")"},rgbToHex:function(a){if(3>this.length)return null;if(4==this.length&&0==this[3]&&!a)return"transparent";for(var b=[],c=0;3>c;c++){var d=(this[c]-0).toString(16);b.push(1==d.length?"0"+d:d)}return a?b:"#"+b.join("")}});
Function.implement({extend:function(a){for(var b in a)this[b]=a[b];return this},create:function(a){var b=this;a=a||{};return function(c){var d=a.arguments,d=void 0!=d?$splat(d):Array.slice(arguments,a.event?1:0);a.event&&(d=[c||window.event].extend(d));var e=function(){return b.apply(a.bind||null,d)};return a.delay?setTimeout(e,a.delay):a.periodical?setInterval(e,a.periodical):a.attempt?$try(e):e()}},run:function(a,b){return this.apply(b,$splat(a))},pass:function(a,b){return this.create({bind:b,arguments:a})},
bind:function(a,b){return this.create({bind:a,arguments:b})},bindWithEvent:function(a,b){return this.create({bind:a,arguments:b,event:!0})},attempt:function(a,b){return this.create({bind:b,arguments:a,attempt:!0})()},delay:function(a,b,c){return this.create({bind:b,arguments:c,delay:a})()},periodical:function(a,b,c){return this.create({bind:b,arguments:c,periodical:a})()}});
Number.implement({limit:function(a,b){return Math.min(b,Math.max(a,this))},round:function(a){a=Math.pow(10,a||0);return Math.round(this*a)/a},times:function(a,b){for(var c=0;c<this;c++)a.call(b,c,this)},toFloat:function(){return parseFloat(this)},toInt:function(a){return parseInt(this,a||10)}});Number.alias("times","each");(function(a){var b={};a.each(function(a){Number[a]||(b[a]=function(){return Math[a].apply(null,[this].concat($A(arguments)))})});Number.implement(b)})("abs acos asin atan atan2 ceil cos exp floor log max min pow sin sqrt tan".split(" "));
String.implement({test:function(a,b){return("string"==typeof a?new RegExp(a,b):a).test(this)},contains:function(a,b){return b?-1<(b+this+b).indexOf(b+a+b):-1<this.indexOf(a)},trim:function(){return this.replace(/^\s+|\s+$/g,"")},clean:function(){return this.replace(/\s+/g," ").trim()},camelCase:function(){return this.replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/[A-Z]/g,function(a){return"-"+a.charAt(0).toLowerCase()})},capitalize:function(){return this.replace(/\b[a-z]/g,
function(a){return a.toUpperCase()})},escapeRegExp:function(){return this.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(a){return parseInt(this,a||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(a){var b=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return b?b.slice(1).hexToRgb(a):null},rgbToHex:function(a){var b=this.match(/\d{1,3}/g);return b?b.rgbToHex(a):null},stripScripts:function(a){var b="",c=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(a,c){b+=
c+"\n";return""});!0===a?$exec(b):"function"==$type(a)&&a(b,c);return c},substitute:function(a,b){return this.replace(b||/\\?\{([^{}]+)\}/g,function(b,d){return"\\"==b.charAt(0)?b.slice(1):void 0!=a[d]?a[d]:""})}});
Hash.implement({has:Object.prototype.hasOwnProperty,keyOf:function(a){for(var b in this)if(this.hasOwnProperty(b)&&this[b]===a)return b;return null},hasValue:function(a){return null!==Hash.keyOf(this,a)},extend:function(a){Hash.each(a||{},function(a,c){Hash.set(this,c,a)},this);return this},combine:function(a){Hash.each(a||{},function(a,c){Hash.include(this,c,a)},this);return this},erase:function(a){this.hasOwnProperty(a)&&delete this[a];return this},get:function(a){return this.hasOwnProperty(a)?
this[a]:null},set:function(a,b){if(!this[a]||this.hasOwnProperty(a))this[a]=b;return this},empty:function(){Hash.each(this,function(a,b){delete this[b]},this);return this},include:function(a,b){void 0==this[a]&&(this[a]=b);return this},map:function(a,b){var c=new Hash;Hash.each(this,function(d,e){c.set(e,a.call(b,d,e,this))},this);return c},filter:function(a,b){var c=new Hash;Hash.each(this,function(d,e){a.call(b,d,e,this)&&c.set(e,d)},this);return c},every:function(a,b){for(var c in this)if(this.hasOwnProperty(c)&&
!a.call(b,this[c],c))return!1;return!0},some:function(a,b){for(var c in this)if(this.hasOwnProperty(c)&&a.call(b,this[c],c))return!0;return!1},getKeys:function(){var a=[];Hash.each(this,function(b,c){a.push(c)});return a},getValues:function(){var a=[];Hash.each(this,function(b){a.push(b)});return a},toQueryString:function(a){var b=[];Hash.each(this,function(c,d){a&&(d=a+"["+d+"]");var e;switch($type(c)){case "object":e=Hash.toQueryString(c,d);break;case "array":var f={};c.each(function(a,b){f[b]=
a});e=Hash.toQueryString(f,d);break;default:e=d+"="+encodeURIComponent(c)}void 0!=c&&b.push(e)});return b.join("&")}});Hash.alias({keyOf:"indexOf",hasValue:"contains"});
var Event=new Native({name:"Event",initialize:function(a,b){b=b||window;var c=b.document;a=a||b.event;if(a.$extended)return a;this.$extended=!0;for(var d=a.type,e=a.target||a.srcElement;e&&3==e.nodeType;)e=e.parentNode;if(d.test(/key/)){var f=a.which||a.keyCode,g=Event.Keys.keyOf(f);"keydown"==d&&(c=f-111,0<c&&13>c&&(g="f"+c));g=g||String.fromCharCode(f).toLowerCase()}else if(d.match(/(click|mouse|menu)/i)){var c=c.compatMode&&"CSS1Compat"!=c.compatMode?c.body:c.html,h={x:a.pageX||a.clientX+c.scrollLeft,
y:a.pageY||a.clientY+c.scrollTop},k={x:a.pageX?a.pageX-b.pageXOffset:a.clientX,y:a.pageY?a.pageY-b.pageYOffset:a.clientY};if(d.match(/DOMMouseScroll|mousewheel/))var m=a.wheelDelta?a.wheelDelta/120:-(a.detail||0)/3;var l=3==a.which||2==a.button,n=null;if(d.match(/over|out/)){switch(d){case "mouseover":n=a.relatedTarget||a.fromElement;break;case "mouseout":n=a.relatedTarget||a.toElement}(function(){for(;n&&3==n.nodeType;)n=n.parentNode;return!0}).create({attempt:Browser.Engine.gecko})()||(n=!1)}}return $extend(this,
{event:a,type:d,page:h,client:k,rightClick:l,wheel:m,relatedTarget:n,target:e,code:f,key:g,shift:a.shiftKey,control:a.ctrlKey,alt:a.altKey,meta:a.metaKey})}});Event.Keys=new Hash({enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46});
Event.implement({stop:function(){return this.stopPropagation().preventDefault()},stopPropagation:function(){this.event.stopPropagation?this.event.stopPropagation():this.event.cancelBubble=!0;return this},preventDefault:function(){this.event.preventDefault?this.event.preventDefault():this.event.returnValue=!1;return this}});
function Class(a){a instanceof Function&&(a={initialize:a});var b=function(){Object.reset(this);if(b._prototyping)return this;this._current=$empty;var a=this.initialize?this.initialize.apply(this,arguments):this;delete this._current;delete this.caller;return a}.extend(this);b.implement(a);b.constructor=Class;return b.prototype.constructor=b}Function.prototype.protect=function(){this._protected=!0;return this};
Object.reset=function(a,b){if(null==b){for(var c in a)Object.reset(a,c);return a}delete a[b];switch($type(a[b])){case "object":c=function(){};c.prototype=a[b];c=new c;a[b]=Object.reset(c);break;case "array":a[b]=$unlink(a[b])}return a};
(new Native({name:"Class",initialize:Class})).extend({instantiate:function(a){a._prototyping=!0;var b=new a;delete a._prototyping;return b},wrap:function(a,b,c){c._origin&&(c=c._origin);return function(){if(c._protected&&null==this._current)throw Error('The method "'+b+'" cannot be called.');var a=this.caller,e=this._current;this.caller=e;this._current=arguments.callee;var f=c.apply(this,arguments);this._current=e;this.caller=a;return f}.extend({_owner:a,_origin:c,_name:b})}});
Class.implement({implement:function(a,b){if("object"==$type(a)){for(var c in a)this.implement(c,a[c]);return this}if(c=Class.Mutators[a])if(b=c.call(this,b),null==b)return this;c=this.prototype;switch($type(b)){case "function":if(b._hidden)break;c[a]=Class.wrap(this,a,b);break;case "object":var d=c[a];"object"==$type(d)?$mixin(d,b):c[a]=$unlink(b);break;case "array":c[a]=$unlink(b);break;default:c[a]=b}return this}});
Class.Mutators={Extends:function(a){this.parent=a;this.prototype=Class.instantiate(a);this.implement("parent",function(){var a=this.caller._name,c=this.caller._owner.parent.prototype[a];if(!c)throw Error('The method "'+a+'" has no parent.');return c.apply(this,arguments)}.protect())},Implements:function(a){$splat(a).each(function(a){a instanceof Function&&(a=Class.instantiate(a));this.implement(a)},this)}};
var Chain=new Class({$chain:[],chain:function(){this.$chain.extend(Array.flatten(arguments));return this},callChain:function(){return this.$chain.length?this.$chain.shift().apply(this,arguments):!1},clearChain:function(){this.$chain.empty();return this}}),Events=new Class({$events:{},addEvent:function(a,b,c){a=Events.removeOn(a);b!=$empty&&(this.$events[a]=this.$events[a]||[],this.$events[a].include(b),c&&(b.internal=!0));return this},addEvents:function(a){for(var b in a)this.addEvent(b,a[b]);return this},
fireEvent:function(a,b,c){a=Events.removeOn(a);if(!this.$events||!this.$events[a])return this;this.$events[a].each(function(a){a.create({bind:this,delay:c,arguments:b})()},this);return this},removeEvent:function(a,b){a=Events.removeOn(a);if(!this.$events[a])return this;b.internal||this.$events[a].erase(b);return this},removeEvents:function(a){var b;if("object"==$type(a)){for(b in a)this.removeEvent(b,a[b]);return this}a&&(a=Events.removeOn(a));for(b in this.$events)if(!a||a==b)for(var c=this.$events[b],
d=c.length;d--;d)this.removeEvent(b,c[d]);return this}});Events.removeOn=function(a){return a.replace(/^on([A-Z])/,function(a,c){return c.toLowerCase()})};
var Options=new Class({setOptions:function(){this.options=$merge.run([this.options].extend(arguments));if(!this.addEvent)return this;for(var a in this.options)"function"==$type(this.options[a])&&/^on[A-Z]/.test(a)&&(this.addEvent(a,this.options[a]),delete this.options[a]);return this}}),Element=new Native({name:"Element",legacy:window.Element,initialize:function(a,b){var c=Element.Constructors.get(a);return c?c(b):"string"==typeof a?document.newElement(a,b):document.id(a).set(b)},afterImplement:function(a,
b){Element.Prototype[a]=b;Array[a]||Elements.implement(a,function(){for(var b=[],d=!0,e=0,f=this.length;e<f;e++){var g=this[e][a].apply(this[e],arguments);b.push(g);d&&(d="element"==$type(g))}return d?new Elements(b):b})}});Element.Prototype={$family:{name:"element"}};Element.Constructors=new Hash;
var IFrame=new Native({name:"IFrame",generics:!1,initialize:function(){var a=Array.link(arguments,{properties:Object.type,iframe:$defined}),b=a.properties||{},c=document.id(a.iframe),d=b.onload||$empty;delete b.onload;b.id=b.name=$pick(b.id,b.name,c?c.id||c.name:"IFrame_"+$time());var c=new Element(c||"iframe",b),a=function(){var a=$try(function(){return c.contentWindow.location.host});a&&a!=window.location.host||(a=new Window(c.contentWindow),new Document(c.contentWindow.document),$extend(a.Element.prototype,
Element.Prototype));d.call(c.contentWindow,c.contentWindow.document)},e=$try(function(){return c.contentWindow});e&&e.document.body||window.frames[b.id]?a():c.addListener("load",a);return c}}),Elements=new Native({initialize:function(a,b){b=$extend({ddup:!0,cash:!0},b);a=a||[];if(b.ddup||b.cash){for(var c={},d=[],e=0,f=a.length;e<f;e++){var g=document.id(a[e],!b.cash);if(b.ddup){if(c[g.uid])continue;c[g.uid]=!0}g&&d.push(g)}a=d}return b.cash?$extend(a,this):a}});
Elements.implement({filter:function(a,b){return a?new Elements(Array.filter(this,"string"==typeof a?function(b){return b.match(a)}:a,b)):this}});
Document.implement({newElement:function(a,b){Browser.Engine.trident&&b&&(["name","type","checked"].each(function(c){b[c]&&(a+=" "+c+'="'+b[c]+'"',"checked"!=c&&delete b[c])}),a="<"+a+">");return document.id(this.createElement(a)).set(b)},newTextNode:function(a){return this.createTextNode(a)},getDocument:function(){return this},getWindow:function(){return this.window},id:function(){var a={string:function(b,c,d){return(b=d.getElementById(b))?a.element(b,c):null},element:function(a,c){$uid(a);if(!c&&
!a.$family&&!/^object|embed$/i.test(a.tagName)){var d=Element.Prototype,e;for(e in d)a[e]=d[e]}return a},object:function(b,c,d){return b.toElement?a.element(b.toElement(d),c):null}};a.textnode=a.whitespace=a.window=a.document=$arguments(0);return function(b,c,d){if(b&&b.$family&&b.uid)return b;var e=$type(b);return a[e]?a[e](b,c,d||document):null}}()});null==window.$&&Window.implement({$:function(a,b){return document.id(a,b,this.document)}});
Window.implement({$$:function(a){if(1==arguments.length&&"string"==typeof a)return this.document.getElements(a);for(var b=[],c=Array.flatten(arguments),d=0,e=c.length;d<e;d++){var f=c[d];switch($type(f)){case "element":b.push(f);break;case "string":b.extend(this.document.getElements(f,!0))}}return new Elements(b)},getDocument:function(){return this.document},getWindow:function(){return this}});
Native.implement([Element,Document],{getElement:function(a,b){return document.id(this.getElements(a,!0)[0]||null,b)},getElements:function(a,b){a=a.split(",");var c=[],d=1<a.length;a.each(function(a){a=this.getElementsByTagName(a.trim());d?c.extend(a):c=a},this);return new Elements(c,{ddup:d,cash:!b})}});
(function(){var a={},b={},c={input:"checked",option:"selected",textarea:Browser.Engine.webkit&&420>Browser.Engine.version?"innerHTML":"value"},d=function(a){return b[a]||(b[a]={})},e=function(c,d){if(c){var e=c.uid;if(Browser.Engine.trident){if(c.clearAttributes){var f=d&&c.cloneNode(!1);c.clearAttributes();f&&c.mergeAttributes(f)}else c.removeEvents&&c.removeEvents();if(/object/i.test(c.tagName)){for(var g in c)"function"==typeof c[g]&&(c[g]=$empty);Element.dispose(c)}}e&&(a[e]=b[e]=null)}},f=function(a,
b,c,d,e,f){a=a[c||b];for(c=[];a;){if(1==a.nodeType&&(!d||Element.match(a,d))){if(!e)return document.id(a,f);c.push(a)}a=a[b]}return e?new Elements(c,{ddup:!1,cash:!f}):null},g={html:"innerHTML","class":"className","for":"htmlFor",defaultValue:"defaultValue",text:Browser.Engine.trident||Browser.Engine.webkit&&420>Browser.Engine.version?"innerText":"textContent"},h="compact nowrap ismap declare noshade checked disabled readonly multiple selected noresize defer".split(" "),k="value type defaultValue accessKey cellPadding cellSpacing colSpan frameBorder maxLength readOnly rowSpan tabIndex useMap".split(" "),
h=h.associate(h);Hash.extend(g,h);Hash.extend(g,k.associate(k.map(String.toLowerCase)));var m={before:function(a,b){b.parentNode&&b.parentNode.insertBefore(a,b)},after:function(a,b){if(b.parentNode){var c=b.nextSibling;c?b.parentNode.insertBefore(a,c):b.parentNode.appendChild(a)}},bottom:function(a,b){b.appendChild(a)},top:function(a,b){var c=b.firstChild;c?b.insertBefore(a,c):b.appendChild(a)}};m.inside=m.bottom;Hash.each(m,function(a,b){b=b.capitalize();Element.implement("inject"+b,function(b){a(this,
document.id(b,!0));return this});Element.implement("grab"+b,function(b){a(document.id(b,!0),this);return this})});Element.implement({set:function(a,b){switch($type(a)){case "object":for(var c in a)this.set(c,a[c]);break;case "string":(c=Element.Properties.get(a))&&c.set?c.set.apply(this,Array.slice(arguments,1)):this.setProperty(a,b)}return this},get:function(a){var b=Element.Properties.get(a);return b&&b.get?b.get.apply(this,Array.slice(arguments,1)):this.getProperty(a)},erase:function(a){var b=
Element.Properties.get(a);b&&b.erase?b.erase.apply(this):this.removeProperty(a);return this},setProperty:function(a,b){var c=g[a];if(void 0==b)return this.removeProperty(a);c&&h[a]&&(b=!!b);c?this[c]=b:this.setAttribute(a,""+b);return this},setProperties:function(a){for(var b in a)this.setProperty(b,a[b]);return this},getProperty:function(a){var b=g[a],c=b?this[b]:this.getAttribute(a,2);return h[a]?!!c:b?c:c||null},getProperties:function(){var a=$A(arguments);return a.map(this.getProperty,this).associate(a)},
removeProperty:function(a){var b=g[a];b?this[b]=b&&h[a]?!1:"":this.removeAttribute(a);return this},removeProperties:function(){Array.each(arguments,this.removeProperty,this);return this},hasClass:function(a){return this.className.contains(a," ")},addClass:function(a){this.hasClass(a)||(this.className=(this.className+" "+a).clean());return this},removeClass:function(a){this.className=this.className.replace(new RegExp("(^|\\s)"+a+"(?:\\s|$)"),"$1");return this},toggleClass:function(a){return this.hasClass(a)?
this.removeClass(a):this.addClass(a)},adopt:function(){Array.flatten(arguments).each(function(a){(a=document.id(a,!0))&&this.appendChild(a)},this);return this},appendText:function(a,b){return this.grab(this.getDocument().newTextNode(a),b)},grab:function(a,b){m[b||"bottom"](document.id(a,!0),this);return this},inject:function(a,b){m[b||"bottom"](this,document.id(a,!0));return this},replaces:function(a){a=document.id(a,!0);a.parentNode.replaceChild(this,a);return this},wraps:function(a,b){a=document.id(a,
!0);return this.replaces(a).grab(a,b)},getPrevious:function(a,b){return f(this,"previousSibling",null,a,!1,b)},getAllPrevious:function(a,b){return f(this,"previousSibling",null,a,!0,b)},getNext:function(a,b){return f(this,"nextSibling",null,a,!1,b)},getAllNext:function(a,b){return f(this,"nextSibling",null,a,!0,b)},getFirst:function(a,b){return f(this,"nextSibling","firstChild",a,!1,b)},getLast:function(a,b){return f(this,"previousSibling","lastChild",a,!1,b)},getParent:function(a,b){return f(this,
"parentNode",null,a,!1,b)},getParents:function(a,b){return f(this,"parentNode",null,a,!0,b)},getSiblings:function(a,b){return this.getParent().getChildren(a,b).erase(this)},getChildren:function(a,b){return f(this,"nextSibling","firstChild",a,!0,b)},getWindow:function(){return this.ownerDocument.window},getDocument:function(){return this.ownerDocument},getElementById:function(a,b){var c=this.ownerDocument.getElementById(a);if(!c)return null;for(var d=c.parentNode;d!=this;d=d.parentNode)if(!d)return null;
return document.id(c,b)},getSelected:function(){return new Elements($A(this.options).filter(function(a){return a.selected}))},getComputedStyle:function(a){if(this.currentStyle)return this.currentStyle[a.camelCase()];var b=this.getDocument().defaultView.getComputedStyle(this,null);return b?b.getPropertyValue([a.hyphenate()]):null},toQueryString:function(){var a=[];this.getElements("input, select, textarea",!0).each(function(b){if(b.name&&!b.disabled&&"submit"!=b.type&&"reset"!=b.type&&"file"!=b.type){var c=
"select"==b.tagName.toLowerCase()?Element.getSelected(b).map(function(a){return a.value}):"radio"!=b.type&&"checkbox"!=b.type||b.checked?b.value:null;$splat(c).each(function(c){"undefined"!=typeof c&&a.push(b.name+"="+encodeURIComponent(c))})}});return a.join("&")},clone:function(a,b){a=!1!==a;var d=this.cloneNode(a),e=function(a,d){b||a.removeAttribute("id");if(Browser.Engine.trident&&(a.clearAttributes(),a.mergeAttributes(d),a.removeAttribute("uid"),a.options))for(var e=a.options,f=d.options,g=
e.length;g--;)e[g].selected=f[g].selected;(e=c[d.tagName.toLowerCase()])&&d[e]&&(a[e]=d[e])};if(a)for(var f=d.getElementsByTagName("*"),g=this.getElementsByTagName("*"),h=f.length;h--;)e(f[h],g[h]);e(d,this);return document.id(d)},destroy:function(){Element.empty(this);Element.dispose(this);e(this,!0);return null},empty:function(){$A(this.childNodes).each(function(a){Element.destroy(a)});return this},dispose:function(){return this.parentNode?this.parentNode.removeChild(this):this},hasChild:function(a){return(a=
document.id(a,!0))?Browser.Engine.webkit&&420>Browser.Engine.version?$A(this.getElementsByTagName(a.tagName)).contains(a):this.contains?this!=a&&this.contains(a):!!(this.compareDocumentPosition(a)&16):!1},match:function(a){return!a||a==this||Element.get(this,"tag")==a}});Native.implement([Element,Window,Document],{addListener:function(b,c){if("unload"==b){var d=c,e=this;c=function(){e.removeListener("unload",c);d()}}else a[this.uid]=this;this.addEventListener?this.addEventListener(b,c,!1):this.attachEvent("on"+
b,c);return this},removeListener:function(a,b){this.removeEventListener?this.removeEventListener(a,b,!1):this.detachEvent("on"+a,b);return this},retrieve:function(a,b){var c=d(this.uid),e=c[a];void 0!=b&&void 0==e&&(e=c[a]=b);return $pick(e)},store:function(a,b){d(this.uid)[a]=b;return this},eliminate:function(a){delete d(this.uid)[a];return this}});window.addListener("unload",function(){Hash.each(a,e);Browser.Engine.trident&&$A(document.getElementsByTagName("object")).each(e);window.CollectGarbage&&
CollectGarbage();a=b=null})})();Element.Properties=new Hash;Element.Properties.style={set:function(a){this.style.cssText=a},get:function(){return this.style.cssText},erase:function(){this.style.cssText=""}};Element.Properties.tag={get:function(){return this.tagName.toLowerCase()}};
Element.Properties.html=function(){var a=document.createElement("div"),b={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};b.thead=b.tfoot=b.tbody;var c={set:function(){var c=Array.flatten(arguments).join(""),e=Browser.Engine.trident&&b[this.get("tag")];if(e){var f=a;f.innerHTML=e[1]+c+e[2];for(c=e[0];c--;)f=f.firstChild;this.empty().adopt(f.childNodes)}else this.innerHTML=c}};c.erase=
c.set;return c}();Browser.Engine.webkit&&420>Browser.Engine.version&&(Element.Properties.text={get:function(){if(this.innerText)return this.innerText;var a=this.ownerDocument.newElement("div",{html:this.innerHTML}).inject(this.ownerDocument.body),b=a.innerText;a.destroy();return b}});Element.Properties.events={set:function(a){this.addEvents(a)}};
Native.implement([Element,Window,Document],{addEvent:function(a,b){var c=this.retrieve("events",{});c[a]=c[a]||{keys:[],values:[]};if(c[a].keys.contains(b))return this;c[a].keys.push(b);var d=a,e=Element.Events.get(a),f=b,g=this;e&&(e.onAdd&&e.onAdd.call(this,b),e.condition&&(f=function(a){return e.condition.call(this,a)?b.call(this,a):!0}),d=e.base||d);var h=function(){return b.call(g)},k=Element.NativeEvents[d];k&&(2==k&&(h=function(a){a=new Event(a,g.getWindow());!1===f.call(g,a)&&a.stop()}),this.addListener(d,
h));c[a].values.push(h);return this},removeEvent:function(a,b){var c=this.retrieve("events");if(!c||!c[a])return this;var d=c[a].keys.indexOf(b);if(-1==d)return this;c[a].keys.splice(d,1);c=c[a].values.splice(d,1)[0];if(d=Element.Events.get(a))d.onRemove&&d.onRemove.call(this,b),a=d.base||a;return Element.NativeEvents[a]?this.removeListener(a,c):this},addEvents:function(a){for(var b in a)this.addEvent(b,a[b]);return this},removeEvents:function(a){var b;if("object"==$type(a)){for(b in a)this.removeEvent(b,
a[b]);return this}var c=this.retrieve("events");if(!c)return this;if(!a){for(b in c)this.removeEvents(b);this.eliminate("events")}else if(c[a]){for(;c[a].keys[0];)this.removeEvent(a,c[a].keys[0]);c[a]=null}return this},fireEvent:function(a,b,c){var d=this.retrieve("events");if(!d||!d[a])return this;d[a].keys.each(function(a){a.create({bind:this,delay:c,arguments:b})()},this);return this},cloneEvents:function(a,b){a=document.id(a);var c=a.retrieve("events");if(!c)return this;if(b)c[b]&&c[b].keys.each(function(a){this.addEvent(b,
a)},this);else for(var d in c)this.cloneEvents(a,d);return this}});Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,load:1,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1};
(function(){var a=function(a){a=a.relatedTarget;return void 0==a?!0:!1===a?!1:"document"!=$type(this)&&a!=this&&"xul"!=a.prefix&&!this.hasChild(a)};Element.Events=new Hash({mouseenter:{base:"mouseover",condition:a},mouseleave:{base:"mouseout",condition:a},mousewheel:{base:Browser.Engine.gecko?"DOMMouseScroll":"mousewheel"}})})();Element.Properties.styles={set:function(a){this.setStyles(a)}};
Element.Properties.opacity={set:function(a,b){b||(0==a?"hidden"!=this.style.visibility&&(this.style.visibility="hidden"):"visible"!=this.style.visibility&&(this.style.visibility="visible"));this.currentStyle&&this.currentStyle.hasLayout||(this.style.zoom=1);Browser.Engine.trident&&(this.style.filter=1==a?"":"alpha(opacity="+100*a+")");this.style.opacity=a;this.store("opacity",a)},get:function(){return this.retrieve("opacity",1)}};
Element.implement({setOpacity:function(a){return this.set("opacity",a,!0)},getOpacity:function(){return this.get("opacity")},setStyle:function(a,b){switch(a){case "opacity":return this.set("opacity",parseFloat(b));case "float":a=Browser.Engine.trident?"styleFloat":"cssFloat"}a=a.camelCase();if("string"!=$type(b)){var c=(Element.Styles.get(a)||"@").split(" ");b=$splat(b).map(function(a,b){return c[b]?"number"==$type(a)?c[b].replace("@",Math.round(a)):a:""}).join(" ")}else b==String(Number(b))&&(b=
Math.round(b));this.style[a]=b;return this},getStyle:function(a){switch(a){case "opacity":return this.get("opacity");case "float":a=Browser.Engine.trident?"styleFloat":"cssFloat"}a=a.camelCase();var b=this.style[a];if(!$chk(b)){var b=[],c;for(c in Element.ShortStyles)if(a==c){for(var d in Element.ShortStyles[c])b.push(this.getStyle(d));return b.join(" ")}b=this.getComputedStyle(a)}b&&(b=String(b),(c=b.match(/rgba?\([\d\s,]+\)/))&&(b=b.replace(c[0],c[0].rgbToHex())));if(Browser.Engine.presto||Browser.Engine.trident&&
!$chk(parseInt(b,10))){if(a.test(/^(height|width)$/)){var e=0;("width"==a?["left","right"]:["top","bottom"]).each(function(a){e+=this.getStyle("border-"+a+"-width").toInt()+this.getStyle("padding-"+a).toInt()},this);return this["offset"+a.capitalize()]-e+"px"}if(Browser.Engine.presto&&String(b).test("px"))return b;if(a.test(/(border(.+)Width|margin|padding)/))return"0px"}return b},setStyles:function(a){for(var b in a)this.setStyle(b,a[b]);return this},getStyles:function(){var a={};Array.flatten(arguments).each(function(b){a[b]=
this.getStyle(b)},this);return a}});
Element.Styles=new Hash({left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",
zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@"});Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}};
["Top","Right","Bottom","Left"].each(function(a){var b=Element.ShortStyles,c=Element.Styles;["margin","padding"].each(function(d){var e=d+a;b[d][e]=c[e]="@px"});var d="border"+a;b.border[d]=c[d]="@px @ rgb(@, @, @)";var e=d+"Width",f=d+"Style",g=d+"Color";b[d]={};b.borderWidth[e]=b[d][e]=c[e]="@px";b.borderStyle[f]=b[d][f]=c[f]="@";b.borderColor[g]=b[d][g]=c[g]="rgb(@, @, @)"});
(function(){function a(a){return"border-box"==f(a,"-moz-box-sizing")}function b(a){return f(a,"border-top-width").toInt()||0}function c(a){return f(a,"border-left-width").toInt()||0}function d(a){return/^(?:body|html)$/i.test(a.tagName)}function e(a){a=a.getDocument();return a.compatMode&&"CSS1Compat"!=a.compatMode?a.body:a.html}Element.implement({scrollTo:function(a,b){d(this)?this.getWindow().scrollTo(a,b):(this.scrollLeft=a,this.scrollTop=b);return this},getSize:function(){return d(this)?this.getWindow().getSize():
{x:this.offsetWidth,y:this.offsetHeight}},getScrollSize:function(){return d(this)?this.getWindow().getScrollSize():{x:this.scrollWidth,y:this.scrollHeight}},getScroll:function(){return d(this)?this.getWindow().getScroll():{x:this.scrollLeft,y:this.scrollTop}},getScrolls:function(){for(var a=this,b={x:0,y:0};a&&!d(a);)b.x+=a.scrollLeft,b.y+=a.scrollTop,a=a.parentNode;return b},getOffsetParent:function(){var a=this;if(d(a))return null;if(!Browser.Engine.trident)return a.offsetParent;for(;(a=a.parentNode)&&
!d(a);)if("static"!=f(a,"position"))return a;return null},getOffsets:function(){if(this.getBoundingClientRect){var e=this.getBoundingClientRect(),h=document.id(this.getDocument().documentElement),k=h.getScroll(),m=this.getScrolls(),l=this.getScroll(),n="fixed"==f(this,"position");return{x:e.left.toInt()+m.x-l.x+(n?0:k.x)-h.clientLeft,y:e.top.toInt()+m.y-l.y+(n?0:k.y)-h.clientTop}}e=this;h={x:0,y:0};if(d(this))return h;for(;e&&!d(e);)h.x+=e.offsetLeft,h.y+=e.offsetTop,Browser.Engine.gecko?(a(e)||(h.x+=
c(e),h.y+=b(e)),(k=e.parentNode)&&"visible"!=f(k,"overflow")&&(h.x+=c(k),h.y+=b(k))):e!=this&&Browser.Engine.webkit&&(h.x+=c(e),h.y+=b(e)),e=e.offsetParent;Browser.Engine.gecko&&!a(this)&&(h.x-=c(this),h.y-=b(this));return h},getPosition:function(a){if(d(this))return{x:0,y:0};var b=this.getOffsets(),c=this.getScrolls(),e=b.x-c.x,b=b.y-c.y,c=a&&(a=document.id(a))?a.getPosition():{x:0,y:0};return{x:e-c.x,y:b-c.y}},getCoordinates:function(a){if(d(this))return this.getWindow().getCoordinates();a=this.getPosition(a);
var b=this.getSize();a={left:a.x,top:a.y,width:b.x,height:b.y};a.right=a.left+a.width;a.bottom=a.top+a.height;return a},computePosition:function(a){return{left:a.x-(f(this,"margin-left").toInt()||0),top:a.y-(f(this,"margin-top").toInt()||0)}},setPosition:function(a){return this.setStyles(this.computePosition(a))}});Native.implement([Document,Window],{getSize:function(){if(Browser.Engine.presto||Browser.Engine.webkit){var a=this.getWindow();return{x:a.innerWidth,y:a.innerHeight}}a=e(this);return{x:a.clientWidth,
y:a.clientHeight}},getScroll:function(){var a=this.getWindow(),b=e(this);return{x:a.pageXOffset||b.scrollLeft,y:a.pageYOffset||b.scrollTop}},getScrollSize:function(){var a=e(this),b=this.getSize();return{x:Math.max(a.scrollWidth,b.x),y:Math.max(a.scrollHeight,b.y)}},getPosition:function(){return{x:0,y:0}},getCoordinates:function(){var a=this.getSize();return{top:0,left:0,bottom:a.y,right:a.x,height:a.y,width:a.x}}});var f=Element.getComputedStyle})();Element.alias("setPosition","position");
Native.implement([Window,Document,Element],{getHeight:function(){return this.getSize().y},getWidth:function(){return this.getSize().x},getScrollTop:function(){return this.getScroll().y},getScrollLeft:function(){return this.getScroll().x},getScrollHeight:function(){return this.getScrollSize().y},getScrollWidth:function(){return this.getScrollSize().x},getTop:function(){return this.getPosition().y},getLeft:function(){return this.getPosition().x}});
Native.implement([Document,Element],{getElements:function(a,b){a=a.split(",");for(var c,d={},e=0,f=a.length;e<f;e++){var g=Selectors.Utils.search(this,a[e],d);0!=e&&g.item&&(g=$A(g));c=0==e?g:c.item?$A(c).concat(g):c.concat(g)}return new Elements(c,{ddup:1<a.length,cash:!b})}});
Element.implement({match:function(a){if(!a||a==this)return!0;var b=Selectors.Utils.parseTagAndID(a),c=b[0];return Selectors.Filters.byID(this,b[1])&&Selectors.Filters.byTag(this,c)?(a=Selectors.Utils.parseSelector(a))?Selectors.Utils.filter(this,a,{}):!0:!1}});
var Selectors={Cache:{nth:{},parsed:{}},RegExps:{id:/#([\w-]+)/,tag:/^(\w+|\*)/,quick:/^(\w+|\*)$/,splitter:/\s*([+>~\s])\s*([a-zA-Z#.*:\[])/g,combined:/\.([\w-]+)|\[(\w+)(?:([!*^$~|]?=)(["']?)([^\4]*?)\4)?\]|:([\w-]+)(?:\(["']?(.*?)?["']?\)|$)/g},Utils:{chk:function(a,b){if(!b)return!0;var c=$uid(a);return b[c]?!1:b[c]=!0},parseNthArgument:function(a){if(Selectors.Cache.nth[a])return Selectors.Cache.nth[a];var b=a.match(/^([+-]?\d*)?([a-z]+)?([+-]?\d*)?$/);if(!b)return!1;var c=parseInt(b[1],10),
c=c||0===c?c:1,d=b[2]||!1,b=parseInt(b[3],10)||0;if(0!=c){for(b--;1>b;)b+=c;for(;b>=c;)b-=c}else c=b,d="index";switch(d){case "n":b={a:c,b:b,special:"n"};break;case "odd":b={a:2,b:0,special:"n"};break;case "even":b={a:2,b:1,special:"n"};break;case "first":b={a:0,special:"index"};break;case "last":b={special:"last-child"};break;case "only":b={special:"only-child"};break;default:b={a:c-1,special:"index"}}return Selectors.Cache.nth[a]=b},parseSelector:function(a){if(Selectors.Cache.parsed[a])return Selectors.Cache.parsed[a];
for(var b,c={classes:[],pseudos:[],attributes:[]};b=Selectors.RegExps.combined.exec(a);){var d=b[1],e=b[2],f=b[3],g=b[5],h=b[6];b=b[7];d?c.classes.push(d):h?(d=Selectors.Pseudo.get(h))?c.pseudos.push({parser:d,argument:b}):c.attributes.push({name:h,operator:"=",value:b}):e&&c.attributes.push({name:e,operator:f,value:g})}c.classes.length||delete c.classes;c.attributes.length||delete c.attributes;c.pseudos.length||delete c.pseudos;c.classes||c.attributes||c.pseudos||(c=null);return Selectors.Cache.parsed[a]=
c},parseTagAndID:function(a){var b=a.match(Selectors.RegExps.tag);a=a.match(Selectors.RegExps.id);return[b?b[1]:"*",a?a[1]:!1]},filter:function(a,b,c){var d;if(b.classes)for(d=b.classes.length;d--;d)if(!Selectors.Filters.byClass(a,b.classes[d]))return!1;if(b.attributes)for(d=b.attributes.length;d--;d){var e=b.attributes[d];if(!Selectors.Filters.byAttribute(a,e.name,e.operator,e.value))return!1}if(b.pseudos)for(d=b.pseudos.length;d--;d)if(e=b.pseudos[d],!Selectors.Filters.byPseudo(a,e.parser,e.argument,
c))return!1;return!0},getByTagAndID:function(a,b,c){return c?(a=a.getElementById?a.getElementById(c,!0):Element.getElementById(a,c,!0))&&Selectors.Filters.byTag(a,b)?[a]:[]:a.getElementsByTagName(b)},search:function(a,b,c){var d=[];b=b.trim().replace(Selectors.RegExps.splitter,function(a,b,c){d.push(b);return":)"+c}).split(":)");for(var e,f,g,h=0,k=b.length;h<k;h++)if(f=b[h],0==h&&Selectors.RegExps.quick.test(f))e=a.getElementsByTagName(f);else{g=d[h-1];var m=Selectors.Utils.parseTagAndID(f),l=m[0],
m=m[1];if(0==h)e=Selectors.Utils.getByTagAndID(a,l,m);else{for(var n={},t=[],q=0,u=e.length;q<u;q++)t=Selectors.Getters[g](t,e[q],l,m,n);e=t}if(l=Selectors.Utils.parseSelector(f)){f=[];m=0;for(n=e.length;m<n;m++)g=e[m],Selectors.Utils.filter(g,l,c)&&f.push(g);e=f}}return e}},Getters:{" ":function(a,b,c,d,e){b=Selectors.Utils.getByTagAndID(b,c,d);c=0;for(d=b.length;c<d;c++){var f=b[c];Selectors.Utils.chk(f,e)&&a.push(f)}return a},">":function(a,b,c,d,e){c=Selectors.Utils.getByTagAndID(b,c,d);d=0;for(var f=
c.length;d<f;d++){var g=c[d];g.parentNode==b&&Selectors.Utils.chk(g,e)&&a.push(g)}return a},"+":function(a,b,c,d,e){for(;b=b.nextSibling;)if(1==b.nodeType){Selectors.Utils.chk(b,e)&&Selectors.Filters.byTag(b,c)&&Selectors.Filters.byID(b,d)&&a.push(b);break}return a},"~":function(a,b,c,d,e){for(;b=b.nextSibling;)if(1==b.nodeType){if(!Selectors.Utils.chk(b,e))break;Selectors.Filters.byTag(b,c)&&Selectors.Filters.byID(b,d)&&a.push(b)}return a}},Filters:{byTag:function(a,b){return"*"==b||a.tagName&&a.tagName.toLowerCase()==
b},byID:function(a,b){return!b||a.id&&a.id==b},byClass:function(a,b){return a.className&&a.className.contains&&a.className.contains(b," ")},byPseudo:function(a,b,c,d){return b.call(a,c,d)},byAttribute:function(a,b,c,d){a=Element.prototype.getProperty.call(a,b);if(!a)return"!="==c;if(!c||void 0==d)return!0;switch(c){case "=":return a==d;case "*=":return a.contains(d);case "^=":return a.substr(0,d.length)==d;case "$=":return a.substr(a.length-d.length)==d;case "!=":return a!=d;case "~=":return a.contains(d,
" ");case "|=":return a.contains(d,"-")}return!1}}};
Selectors.Pseudo=new Hash({checked:function(){return this.checked},empty:function(){return!(this.innerText||this.textContent||"").length},not:function(a){return!Element.match(this,a)},contains:function(a){return(this.innerText||this.textContent||"").contains(a)},"first-child":function(){return Selectors.Pseudo.index.call(this,0)},"last-child":function(){for(var a=this;a=a.nextSibling;)if(1==a.nodeType)return!1;return!0},"only-child":function(){for(var a=this;a=a.previousSibling;)if(1==a.nodeType)return!1;
for(a=this;a=a.nextSibling;)if(1==a.nodeType)return!1;return!0},"nth-child":function(a,b){var c=Selectors.Utils.parseNthArgument(void 0==a?"n":a);if("n"!=c.special)return Selectors.Pseudo[c.special].call(this,c.a,b);var d=0;b.positions=b.positions||{};var e=$uid(this);if(!b.positions[e]){for(var f=this;f=f.previousSibling;)if(1==f.nodeType){d++;var g=b.positions[$uid(f)];if(void 0!=g){d=g+d;break}}b.positions[e]=d}return b.positions[e]%c.a==c.b},index:function(a){for(var b=this,c=0;b=b.previousSibling;)if(1==
b.nodeType&&++c>a)return!1;return c==a},even:function(a,b){return Selectors.Pseudo["nth-child"].call(this,"2n+1",b)},odd:function(a,b){return Selectors.Pseudo["nth-child"].call(this,"2n",b)},selected:function(){return this.selected},enabled:function(){return!1===this.disabled}});Element.Events.domready={onAdd:function(a){Browser.loaded&&a.call(this)}};
(function(){var a=function(){Browser.loaded||(Browser.loaded=!0,window.fireEvent("domready"),document.fireEvent("domready"))};window.addEvent("load",a);if(Browser.Engine.trident){var b=document.createElement("div");(function(){$try(function(){b.doScroll();return document.id(b).inject(document.body).set("html","temp").dispose()})?a():arguments.callee.delay(50)})()}else Browser.Engine.webkit&&525>Browser.Engine.version?function(){["loaded","complete"].contains(document.readyState)?a():arguments.callee.delay(50)}():
document.addEvent("DOMContentLoaded",a)})();
var JSON=(new Hash(this.JSON&&{stringify:JSON.stringify,parse:JSON.parse})).extend({$specialChars:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},$replaceChars:function(a){return JSON.$specialChars[a]||"\\u00"+Math.floor(a.charCodeAt()/16).toString(16)+(a.charCodeAt()%16).toString(16)},encode:function(a){switch($type(a)){case "string":return'"'+a.replace(/[\x00-\x1f\\"]/g,JSON.$replaceChars)+'"';case "array":return"["+String(a.map(JSON.encode).clean())+"]";case "object":case "hash":var b=
[];Hash.each(a,function(a,d){var e=JSON.encode(a);e&&b.push(JSON.encode(d)+":"+e)});return"{"+b+"}";case "number":case "boolean":return String(a);case !1:return"null"}return null},decode:function(a,b){return"string"!=$type(a)||!a.length||b&&!/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(a.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""))?null:eval("("+a+")")}});Native.implement([Hash,Array,String,Number],{toJSON:function(){return JSON.encode(this)}});
var Cookie=new Class({Implements:Options,options:{path:!1,domain:!1,duration:!1,secure:!1,document:document},initialize:function(a,b){this.key=a;this.setOptions(b)},write:function(a){a=encodeURIComponent(a);this.options.domain&&(a+="; domain="+this.options.domain);this.options.path&&(a+="; path="+this.options.path);if(this.options.duration){var b=new Date;b.setTime(b.getTime()+864E5*this.options.duration);a+="; expires="+b.toGMTString()}this.options.secure&&(a+="; secure");this.options.document.cookie=
this.key+"="+a;return this},read:function(){var a=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return a?decodeURIComponent(a[1]):null},dispose:function(){(new Cookie(this.key,$merge(this.options,{duration:-1}))).write("");return this}});Cookie.write=function(a,b,c){return(new Cookie(a,c)).write(b)};Cookie.read=function(a){return(new Cookie(a)).read()};Cookie.dispose=function(a,b){return(new Cookie(a,b)).dispose()};
var Swiff=new Class({Implements:[Options],options:{id:null,height:1,width:1,container:null,properties:{},params:{quality:"high",allowScriptAccess:"always",wMode:"transparent",swLiveConnect:!0},callBacks:{},vars:{}},toElement:function(){return this.object},initialize:function(a,b){this.instance="Swiff_"+$time();this.setOptions(b);b=this.options;var c=this.id=b.id||this.instance,d=document.id(b.container);Swiff.CallBacks[this.instance]={};var e=b.params,f=b.vars,g=b.callBacks,h=$extend({height:b.height,
width:b.width},b.properties),k=this,m;for(m in g)Swiff.CallBacks[this.instance][m]=function(a){return function(){return a.apply(k.object,arguments)}}(g[m]),f[m]="Swiff.CallBacks."+this.instance+"."+m;e.flashVars=Hash.toQueryString(f);Browser.Engine.trident?(h.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",e.movie=a):(h.type="application/x-shockwave-flash",h.data=a);var c='<object id="'+c+'"',l;for(l in h)c+=" "+l+'="'+h[l]+'"';var c=c+">",n;for(n in e)e[n]&&(c+='<param name="'+n+'" value="'+
e[n]+'" />');c+="</object>";this.object=(d?d.empty():new Element("div")).set("html",c).firstChild},replaces:function(a){a=document.id(a,!0);a.parentNode.replaceChild(this.toElement(),a);return this},inject:function(a){document.id(a,!0).appendChild(this.toElement());return this},remote:function(){return Swiff.remote.apply(Swiff,[this.toElement()].extend(arguments))}});Swiff.CallBacks={};
Swiff.remote=function(a,b){var c=a.CallFunction('<invoke name="'+b+'" returntype="javascript">'+__flash__argumentsToXML(arguments,2)+"</invoke>");return eval(c)};
var Fx=new Class({Implements:[Chain,Events,Options],options:{fps:50,unit:!1,duration:500,link:"ignore"},initialize:function(a){this.subject=this.subject||this;this.setOptions(a);this.options.duration=Fx.Durations[this.options.duration]||this.options.duration.toInt();!1===this.options.wait&&(this.options.link="cancel")},getTransition:function(){return function(a){return-(Math.cos(Math.PI*a)-1)/2}},step:function(){var a=$time();a<this.time+this.options.duration?(a=this.transition((a-this.time)/this.options.duration),
this.set(this.compute(this.from,this.to,a))):(this.set(this.compute(this.from,this.to,1)),this.complete())},set:function(a){return a},compute:function(a,b,c){return Fx.compute(a,b,c)},check:function(){if(!this.timer)return!0;switch(this.options.link){case "cancel":return this.cancel(),!0;case "chain":this.chain(this.caller.bind(this,arguments))}return!1},start:function(a,b){if(!this.check(a,b))return this;this.from=a;this.to=b;this.time=0;this.transition=this.getTransition();this.startTimer();this.onStart();
return this},complete:function(){if(this.stopTimer())this.onComplete();return this},cancel:function(){if(this.stopTimer())this.onCancel();return this},onStart:function(){this.fireEvent("start",this.subject)},onComplete:function(){this.fireEvent("complete",this.subject);this.callChain()||this.fireEvent("chainComplete",this.subject)},onCancel:function(){this.fireEvent("cancel",this.subject).clearChain()},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},
stopTimer:function(){if(!this.timer)return!1;this.time=$time()-this.time;this.timer=$clear(this.timer);return!0},startTimer:function(){if(this.timer)return!1;this.time=$time()-this.time;this.timer=this.step.periodical(Math.round(1E3/this.options.fps),this);return!0}});Fx.compute=function(a,b,c){return(b-a)*c+a};Fx.Durations={"short":250,normal:500,"long":1E3};
Fx.CSS=new Class({Extends:Fx,prepare:function(a,b,c){c=$splat(c);$chk(c[1])||(c[1]=c[0],c[0]=a.getStyle(b));a=c.map(this.parse);return{from:a[0],to:a[1]}},parse:function(a){a=$lambda(a)();a="string"==typeof a?a.split(" "):$splat(a);return a.map(function(a){a=String(a);var c=!1;Fx.CSS.Parsers.each(function(d,e){if(!c){var f=d.parse(a);$chk(f)&&(c={value:f,parser:d})}});return c=c||{value:a,parser:Fx.CSS.Parsers.String}})},compute:function(a,b,c){var d=[];Math.min(a.length,b.length).times(function(e){d.push({value:a[e].parser.compute(a[e].value,
b[e].value,c),parser:a[e].parser})});d.$family={name:"fx:css:value"};return d},serve:function(a,b){"fx:css:value"!=$type(a)&&(a=this.parse(a));var c=[];a.each(function(a){c=c.concat(a.parser.serve(a.value,b))});return c},render:function(a,b,c,d){a.setStyle(b,this.serve(c,d))},search:function(a){if(Fx.CSS.Cache[a])return Fx.CSS.Cache[a];var b={};Array.each(document.styleSheets,function(c,d){var e=c.href;e&&e.contains("://")&&!e.contains(document.domain)||Array.each(c.rules||c.cssRules,function(c,d){if(c.style){var e=
c.selectorText?c.selectorText.replace(/^\w+/,function(a){return a.toLowerCase()}):null;e&&e.test("^"+a+"$")&&Element.Styles.each(function(a,d){c.style[d]&&!Element.ShortStyles[d]&&(a=String(c.style[d]),b[d]=a.test(/^rgb/)?a.rgbToHex():a)})}})});return Fx.CSS.Cache[a]=b}});Fx.CSS.Cache={};
Fx.CSS.Parsers=new Hash({Color:{parse:function(a){return a.match(/^#[0-9a-f]{3,6}$/i)?a.hexToRgb(!0):(a=a.match(/(\d+),\s*(\d+),\s*(\d+)/))?[a[1],a[2],a[3]]:!1},compute:function(a,b,c){return a.map(function(d,e){return Math.round(Fx.compute(a[e],b[e],c))})},serve:function(a){return a.map(Number)}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(a,b){return b?a+b:a}},String:{parse:$lambda(!1),compute:$arguments(1),serve:$arguments(0)}});
Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(a,b){this.element=this.subject=document.id(a);this.parent(b)},set:function(a,b){1==arguments.length&&(b=a,a=this.property||this.options.property);this.render(this.element,a,b,this.options.unit);return this},start:function(a,b,c){if(!this.check(a,b,c))return this;var d=Array.flatten(arguments);this.property=this.options.property||d.shift();d=this.prepare(this.element,this.property,d);return this.parent(d.from,d.to)}});
Element.Properties.tween={set:function(a){var b=this.retrieve("tween");b&&b.cancel();return this.eliminate("tween").store("tween:options",$extend({link:"cancel"},a))},get:function(a){if(a||!this.retrieve("tween"))!a&&this.retrieve("tween:options")||this.set("tween",a),this.store("tween",new Fx.Tween(this,this.retrieve("tween:options")));return this.retrieve("tween")}};
Element.implement({tween:function(a,b,c){this.get("tween").start(arguments);return this},fade:function(a){var b=this.get("tween"),c;a=$pick(a,"toggle");switch(a){case "in":b.start("opacity",1);break;case "out":b.start("opacity",0);break;case "show":b.set("opacity",1);break;case "hide":b.set("opacity",0);break;case "toggle":c=this.retrieve("fade:flag",1==this.get("opacity"));b.start("opacity",c?0:1);this.store("fade:flag",!c);c=!0;break;default:b.start("opacity",arguments)}c||this.eliminate("fade:flag");
return this},highlight:function(a,b){b||(b=this.retrieve("highlight:original",this.getStyle("background-color")),b="transparent"==b?"#fff":b);var c=this.get("tween");c.start("background-color",a||"#ffff88",b).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original"));c.callChain()}.bind(this));return this}});
Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(a,b){this.element=this.subject=document.id(a);this.parent(b)},set:function(a){"string"==typeof a&&(a=this.search(a));for(var b in a)this.render(this.element,b,a[b],this.options.unit);return this},compute:function(a,b,c){var d={},e;for(e in a)d[e]=this.parent(a[e],b[e],c);return d},start:function(a){if(!this.check(a))return this;"string"==typeof a&&(a=this.search(a));var b={},c={},d;for(d in a){var e=this.prepare(this.element,d,a[d]);b[d]=e.from;
c[d]=e.to}return this.parent(b,c)}});Element.Properties.morph={set:function(a){var b=this.retrieve("morph");b&&b.cancel();return this.eliminate("morph").store("morph:options",$extend({link:"cancel"},a))},get:function(a){if(a||!this.retrieve("morph"))!a&&this.retrieve("morph:options")||this.set("morph",a),this.store("morph",new Fx.Morph(this,this.retrieve("morph:options")));return this.retrieve("morph")}};Element.implement({morph:function(a){this.get("morph").start(a);return this}});
Fx.implement({getTransition:function(){var a=this.options.transition||Fx.Transitions.Sine.easeInOut;if("string"==typeof a){var b=a.split(":"),a=Fx.Transitions,a=a[b[0]]||a[b[0].capitalize()];b[1]&&(a=a["ease"+b[1].capitalize()+(b[2]?b[2].capitalize():"")])}return a}});Fx.Transition=function(a,b){b=$splat(b);return $extend(a,{easeIn:function(c){return a(c,b)},easeOut:function(c){return 1-a(1-c,b)},easeInOut:function(c){return.5>=c?a(2*c,b)/2:(2-a(2*(1-c),b))/2}})};Fx.Transitions=new Hash({linear:$arguments(0)});
Fx.Transitions.extend=function(a){for(var b in a)Fx.Transitions[b]=new Fx.Transition(a[b])};
Fx.Transitions.extend({Pow:function(a,b){return Math.pow(a,b[0]||6)},Expo:function(a){return Math.pow(2,8*(a-1))},Circ:function(a){return 1-Math.sin(Math.acos(a))},Sine:function(a){return 1-Math.sin((1-a)*Math.PI/2)},Back:function(a,b){b=b[0]||1.618;return Math.pow(a,2)*((b+1)*a-b)},Bounce:function(a){for(var b,c=0,d=1;;c+=d,d/=2)if(a>=(7-4*c)/11){b=d*d-Math.pow((11-6*c-11*a)/4,2);break}return b},Elastic:function(a,b){return Math.pow(2,10*--a)*Math.cos(20*a*Math.PI*(b[0]||1)/3)}});
["Quad","Cubic","Quart","Quint"].each(function(a,b){Fx.Transitions[a]=new Fx.Transition(function(a){return Math.pow(a,[b+2])})});
var Request=new Class({Implements:[Chain,Events,Options],options:{url:"",data:"",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},async:!0,format:!1,method:"post",link:"ignore",isSuccess:null,emulation:!0,urlEncoded:!0,encoding:"utf-8",evalScripts:!1,evalResponse:!1,noCache:!1},initialize:function(a){this.xhr=new Browser.Request;this.setOptions(a);this.options.isSuccess=this.options.isSuccess||this.isSuccess;this.headers=new Hash(this.options.headers)},
onStateChange:function(){4==this.xhr.readyState&&this.running&&(this.running=!1,this.status=0,$try(function(){this.status=this.xhr.status}.bind(this)),this.xhr.onreadystatechange=$empty,this.options.isSuccess.call(this,this.status)?(this.response={text:this.xhr.responseText,xml:this.xhr.responseXML},this.success(this.response.text,this.response.xml)):(this.response={text:null,xml:null},this.failure()))},isSuccess:function(){return 200<=this.status&&300>this.status},processScripts:function(a){return this.options.evalResponse||
/(ecma|java)script/.test(this.getHeader("Content-type"))?$exec(a):a.stripScripts(this.options.evalScripts)},success:function(a,b){this.onSuccess(this.processScripts(a),b)},onSuccess:function(){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain()},failure:function(){this.onFailure()},onFailure:function(){this.fireEvent("complete").fireEvent("failure",this.xhr)},setHeader:function(a,b){this.headers.set(a,b);return this},getHeader:function(a){return $try(function(){return this.xhr.getResponseHeader(a)}.bind(this))},
check:function(){if(!this.running)return!0;switch(this.options.link){case "cancel":return this.cancel(),!0;case "chain":this.chain(this.caller.bind(this,arguments))}return!1},send:function(a){if(!this.check(a))return this;this.running=!0;var b=$type(a);if("string"==b||"element"==b)a={data:a};b=this.options;a=$extend({data:b.data,url:b.url,method:b.method},a);var b=a.data,c=String(a.url);a=a.method.toLowerCase();switch($type(b)){case "element":b=document.id(b).toQueryString();break;case "object":case "hash":b=
Hash.toQueryString(b)}if(this.options.format)var d="format="+this.options.format,b=b?d+"&"+b:d;this.options.emulation&&!["get","post"].contains(a)&&(a="_method="+a,b=b?a+"&"+b:a,a="post");this.options.urlEncoded&&"post"==a&&this.headers.set("Content-type","application/x-www-form-urlencoded"+(this.options.encoding?"; charset="+this.options.encoding:""));this.options.noCache&&(d="noCache="+(new Date).getTime(),b=b?d+"&"+b:d);d=c.lastIndexOf("/");-1<d&&-1<(d=c.indexOf("#"))&&(c=c.substr(0,d));b&&"get"==
a&&(c=c+(c.contains("?")?"&":"?")+b,b=null);this.xhr.open(a.toUpperCase(),c,this.options.async);this.xhr.onreadystatechange=this.onStateChange.bind(this);this.headers.each(function(a,b){try{this.xhr.setRequestHeader(b,a)}catch(c){this.fireEvent("exception",[b,a])}},this);this.fireEvent("request");this.xhr.send(b);if(!this.options.async)this.onStateChange();return this},cancel:function(){if(!this.running)return this;this.running=!1;this.xhr.abort();this.xhr.onreadystatechange=$empty;this.xhr=new Browser.Request;
this.fireEvent("cancel");return this}});(function(){var a={};"get post put delete GET POST PUT DELETE".split(" ").each(function(b){a[b]=function(){var a=Array.link(arguments,{url:String.type,data:$defined});return this.send($extend(a,{method:b}))}});Request.implement(a)})();
Element.Properties.send={set:function(a){var b=this.retrieve("send");b&&b.cancel();return this.eliminate("send").store("send:options",$extend({data:this,link:"cancel",method:this.get("method")||"post",url:this.get("action")},a))},get:function(a){if(a||!this.retrieve("send"))!a&&this.retrieve("send:options")||this.set("send",a),this.store("send",new Request(this.retrieve("send:options")));return this.retrieve("send")}};
Element.implement({send:function(a){var b=this.get("send");b.send({data:this,url:a||b.options.url});return this}});
Request.HTML=new Class({Extends:Request,options:{update:!1,append:!1,evalScripts:!0,filter:!1},processHTML:function(a){var b=a.match(/<body[^>]*>([\s\S]*?)<\/body>/i);a=b?b[1]:a;var c=new Element("div");return $try(function(){var b="<root>"+a+"</root>",e;Browser.Engine.trident?(e=new ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.loadXML(b)):e=(new DOMParser).parseFromString(b,"text/xml");b=e.getElementsByTagName("root")[0];if(!b)return null;e=0;for(var f=b.childNodes.length;e<f;e++){var g=Element.clone(b.childNodes[e],
!0,!0);g&&c.grab(g)}return c})||c.set("html",a)},success:function(a){var b=this.options,c=this.response;c.html=a.stripScripts(function(a){c.javascript=a});a=this.processHTML(c.html);c.tree=a.childNodes;c.elements=a.getElements("*");b.filter&&(c.tree=c.elements.filter(b.filter));b.update?document.id(b.update).empty().set("html",c.html):b.append&&document.id(b.append).adopt(a.getChildren());b.evalScripts&&$exec(c.javascript);this.onSuccess(c.tree,c.elements,c.html,c.javascript)}});
Element.Properties.load={set:function(a){var b=this.retrieve("load");b&&b.cancel();return this.eliminate("load").store("load:options",$extend({data:this,link:"cancel",update:this,method:"get"},a))},get:function(a){if(a||!this.retrieve("load"))!a&&this.retrieve("load:options")||this.set("load",a),this.store("load",new Request.HTML(this.retrieve("load:options")));return this.retrieve("load")}};
Element.implement({load:function(){this.get("load").send(Array.link(arguments,{data:Object.type,url:String.type}));return this}});Request.JSON=new Class({Extends:Request,options:{secure:!0},initialize:function(a){this.parent(a);this.headers.extend({Accept:"application/json","X-Request":"JSON"})},success:function(a){this.response.json=JSON.decode(a,this.options.secure);this.onSuccess(this.response.json,a)}});(function(a,b){function c(a){var b=a.length,c=r.type(a);return r.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||"function"!==c&&(0===b||"number"===typeof b&&0<b&&b-1 in a)}function d(a){var b=ka[a]={};r.each(a.match(va)||[],function(a,c){b[c]=!0});return b}function e(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=r.expando+Math.random()}function f(a,c,d){if(d===b&&1===a.nodeType)if(d="data-"+c.replace(Da,"-$1").toLowerCase(),d=a.getAttribute(d),"string"===typeof d){try{d=
"true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:Pa.test(d)?JSON.parse(d):d}catch(e){}oa.set(a,c,d)}else d=b;return d}function g(){return!0}function h(){return!1}function k(){try{return I.activeElement}catch(a){}}function m(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function l(a,b,c){if(r.isFunction(b))return r.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return r.grep(a,function(a){return a===b!==c});if("string"===typeof b){if(Fa.test(b))return r.filter(b,a,c);b=r.filter(b,
a)}return r.grep(a,function(a){return 0<=aa.call(b,a)!==c})}function n(a,b){return r.nodeName(a,"table")&&r.nodeName(1===b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function t(a){a.type=(null!==a.getAttribute("type"))+"/"+a.type;return a}function q(a){var b=ob.exec(a.type);b?a.type=b[1]:a.removeAttribute("type");return a}function u(a,b){for(var c=a.length,d=0;d<c;d++)U.set(a[d],"globalEval",!b||U.get(b[d],"globalEval"))}
function p(a,b){var c,d,e,f;if(1===b.nodeType){if(U.hasData(a)&&(f=U.access(a),c=U.set(b,f),f=f.events))for(e in delete c.handle,c.events={},f)for(c=0,d=f[e].length;c<d;c++)r.event.add(b,e,f[e][c]);oa.hasData(a)&&(e=oa.access(a),e=r.extend({},e),oa.set(b,e))}}function v(a,c){var d=a.getElementsByTagName?a.getElementsByTagName(c||"*"):a.querySelectorAll?a.querySelectorAll(c||"*"):[];return c===b||c&&r.nodeName(a,c)?r.merge([a],d):d}function x(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+
b.slice(1),d=b,e=Fb.length;e--;)if(b=Fb[e]+c,b in a)return b;return d}function w(a,b){a=b||a;return"none"===r.css(a,"display")||!r.contains(a.ownerDocument,a)}function y(a,b){for(var c,d,e,f=[],g=0,h=a.length;g<h;g++)d=a[g],d.style&&(f[g]=U.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&w(d)&&(f[g]=U.access(d,"olddisplay",H(d.nodeName)))):f[g]||(e=w(d),(c&&"none"!==c||!e)&&U.set(d,"olddisplay",e?c:r.css(d,"display"))));for(g=0;g<h;g++)d=a[g],
!d.style||b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none");return a}function M(a,b,c){return(a=vc.exec(b))?Math.max(0,a[1]-(c||0))+(a[2]||"px"):b}function z(a,b,c,d,e){b=c===(d?"border":"content")?4:"width"===b?1:0;for(var f=0;4>b;b+=2)"margin"===c&&(f+=r.css(a,c+db[b],!0,e)),d?("content"===c&&(f-=r.css(a,"padding"+db[b],!0,e)),"margin"!==c&&(f-=r.css(a,"border"+db[b]+"Width",!0,e))):(f+=r.css(a,"padding"+db[b],!0,e),"padding"!==c&&(f+=r.css(a,"border"+db[b]+
"Width",!0,e)));return f}function K(b,c,d){var e=!0,f="width"===c?b.offsetWidth:b.offsetHeight,g=a.getComputedStyle(b,null),h=r.support.boxSizing&&"border-box"===r.css(b,"boxSizing",!1,g);if(0>=f||null==f){f=Za(b,c,g);if(0>f||null==f)f=b.style[c];if(zb.test(f))return f;e=h&&(r.support.boxSizingReliable||f===b.style[c]);f=parseFloat(f)||0}return f+z(b,c,d||(h?"border":"content"),e,g)+"px"}function H(a){var b=I,c=Ab[a];c||(c=D(a,b),"none"!==c&&c||(kb=(kb||r("<iframe frameborder='0' width='0' height='0'/>").css("cssText",
"display:block !important")).appendTo(b.documentElement),b=(kb[0].contentWindow||kb[0].contentDocument).document,b.write("<!doctype html><html><body>"),b.close(),c=D(a,b),kb.detach()),Ab[a]=c);return c}function D(a,b){var c=r(b.createElement(a)).appendTo(b.body),d=r.css(c[0],"display");c.remove();return d}function L(a,b,c,d){var e;if(r.isArray(b))r.each(b,function(b,e){c||cc.test(a)?d(a,e):L(a+"["+("object"===typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==r.type(b))d(a,b);else for(e in b)L(a+"["+
e+"]",b[e],c,d)}function A(a){return function(b,c){"string"!==typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(va)||[];if(r.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function E(a,b,c,d){function e(h){var k;f[h]=!0;r.each(a[h]||[],function(a,h){var l=h(b,c,d);if("string"===typeof l&&!g&&!f[l])return b.dataTypes.unshift(l),e(l),!1;if(g)return!(k=l)});return k}var f={},g=a===rc;return e(b.dataTypes[0])||!f["*"]&&e("*")}function F(a,
c){var d,e,f=r.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&r.extend(!0,a,e);return a}function J(){setTimeout(function(){Ob=b});return Ob=r.now()}function N(a,b,c){for(var d,e=(Tb[b]||[]).concat(Tb["*"]),f=0,g=e.length;f<g;f++)if(d=e[f].call(c,b,a))return d}function B(a,b,c){var d,e=0,f=ec.length,g=r.Deferred().always(function(){delete h.elem}),h=function(){if(d)return!1;for(var b=Ob||J(),b=Math.max(0,k.startTime+k.duration-b),c=1-(b/k.duration||0),e=0,f=k.tweens.length;e<
f;e++)k.tweens[e].run(c);g.notifyWith(a,[k,c,b]);if(1>c&&f)return b;g.resolveWith(a,[k]);return!1},k=g.promise({elem:a,props:r.extend({},b),opts:r.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Ob||J(),duration:c.duration,tweens:[],createTween:function(b,c){var d=r.Tween(a,k.opts,b,c,k.opts.specialEasing[b]||k.opts.easing);k.tweens.push(d);return d},stop:function(b){var c=0,e=b?k.tweens.length:0;if(d)return this;for(d=!0;c<e;c++)k.tweens[c].run(1);b?g.resolveWith(a,
[k,b]):g.rejectWith(a,[k,b]);return this}});c=k.props;for(C(c,k.opts.specialEasing);e<f;e++)if(b=ec[e].call(k,a,c,k.opts))return b;r.map(c,N,k);r.isFunction(k.opts.start)&&k.opts.start.call(a,k);r.fx.timer(r.extend(h,{elem:a,anim:k,queue:k.opts.queue}));return k.progress(k.opts.progress).done(k.opts.done,k.opts.complete).fail(k.opts.fail).always(k.opts.always)}function C(a,b){var c,d,e,f,g;for(c in a)if(d=r.camelCase(c),e=b[d],f=a[c],r.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),
(g=r.cssHooks[d])&&"expand"in g)for(c in f=g.expand(f),delete a[d],f)c in a||(a[c]=f[c],b[c]=e);else b[d]=e}function G(a,b,c,d,e){return new G.prototype.init(a,b,c,d,e)}function Q(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=db[e],d["margin"+c]=d["padding"+c]=a;b&&(d.opacity=d.width=a);return d}function Z(a){return r.isWindow(a)?a:9===a.nodeType&&a.defaultView}var T,ba,V=typeof b,S=a.location,I=a.document,Y=I.documentElement,$=a.jQuery,ca=a.$,P={},na=[],ua=na.concat,Ca=na.push,ea=na.slice,
aa=na.indexOf,Qa=P.toString,xa=P.hasOwnProperty,Ka="2.0.1".trim,r=function(a,b){return new r.fn.init(a,b,T)},Ha=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,va=/\S+/g,Oa=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,Ra=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,la=/^-ms-/,ya=/-([\da-z])/gi,Aa=function(a,b){return b.toUpperCase()},fa=function(){I.removeEventListener("DOMContentLoaded",fa,!1);a.removeEventListener("load",fa,!1);r.ready()};r.fn=r.prototype={jquery:"2.0.1",constructor:r,init:function(a,c,d){var e;if(!a)return this;
if("string"===typeof a){e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&3<=a.length?[null,a,null]:Oa.exec(a);if(!e||!e[1]&&c)return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a);if(e[1]){if(c=c instanceof r?c[0]:c,r.merge(this,r.parseHTML(e[1],c&&c.nodeType?c.ownerDocument||c:I,!0)),Ra.test(e[1])&&r.isPlainObject(c))for(e in c)if(r.isFunction(this[e]))this[e](c[e]);else this.attr(e,c[e])}else(c=I.getElementById(e[2]))&&c.parentNode&&(this.length=1,this[0]=c),this.context=I,this.selector=
a;return this}if(a.nodeType)return this.context=this[0]=a,this.length=1,this;if(r.isFunction(a))return d.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return r.makeArray(a,this)},selector:"",length:0,toArray:function(){return ea.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a){a=r.merge(this.constructor(),a);a.prevObject=this;a.context=this.context;return a},each:function(a,b){return r.each(this,a,b)},ready:function(a){r.ready.promise().done(a);
return this},slice:function(){return this.pushStack(ea.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length;a=+a+(0>a?b:0);return this.pushStack(0<=a&&a<b?[this[a]]:[])},map:function(a){return this.pushStack(r.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:Ca,sort:[].sort,splice:[].splice};r.fn.init.prototype=r.fn;r.extend=r.fn.extend=function(){var a,c,
d,e,f,g=arguments[0]||{},h=1,k=arguments.length,l=!1;"boolean"===typeof g&&(l=g,g=arguments[1]||{},h=2);"object"===typeof g||r.isFunction(g)||(g={});k===h&&(g=this,--h);for(;h<k;h++)if(null!=(a=arguments[h]))for(c in a)d=g[c],e=a[c],g!==e&&(l&&e&&(r.isPlainObject(e)||(f=r.isArray(e)))?(f?(f=!1,d=d&&r.isArray(d)?d:[]):d=d&&r.isPlainObject(d)?d:{},g[c]=r.extend(l,d,e)):e!==b&&(g[c]=e));return g};r.extend({expando:"jQuery"+("2.0.1"+Math.random()).replace(/\D/g,""),noConflict:function(b){a.$===r&&(a.$=
ca);b&&a.jQuery===r&&(a.jQuery=$);return r},isReady:!1,readyWait:1,holdReady:function(a){a?r.readyWait++:r.ready(!0)},ready:function(a){(!0===a?--r.readyWait:r.isReady)||(r.isReady=!0,!0!==a&&0<--r.readyWait||(ba.resolveWith(I,[r]),r.fn.trigger&&r(I).trigger("ready").off("ready")))},isFunction:function(a){return"function"===r.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==
a?String(a):"object"===typeof a||"function"===typeof a?P[Qa.call(a)]||"object":typeof a},isPlainObject:function(a){if("object"!==r.type(a)||a.nodeType||r.isWindow(a))return!1;try{if(a.constructor&&!xa.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw Error(a);},parseHTML:function(a,b,c){if(!a||"string"!==typeof a)return null;"boolean"===typeof b&&(c=b,b=!1);b=b||I;var d=Ra.exec(a);
c=!c&&[];if(d)return[b.createElement(d[1])];d=r.buildFragment([a],b,c);c&&r(c).remove();return r.merge([],d.childNodes)},parseJSON:JSON.parse,parseXML:function(a){var c,d;if(!a||"string"!==typeof a)return null;try{d=new DOMParser,c=d.parseFromString(a,"text/xml")}catch(e){c=b}c&&!c.getElementsByTagName("parsererror").length||r.error("Invalid XML: "+a);return c},noop:function(){},globalEval:function(a){var b;b=eval;if(a=r.trim(a))1===a.indexOf("use strict")?(b=I.createElement("script"),b.text=a,I.head.appendChild(b).parentNode.removeChild(b)):
b(a)},camelCase:function(a){return a.replace(la,"ms-").replace(ya,Aa)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length;e=c(a);if(d)if(e)for(;f<g&&(e=b.apply(a[f],d),!1!==e);f++);else for(f in a){if(e=b.apply(a[f],d),!1===e)break}else if(e)for(;f<g&&(e=b.call(a[f],f,a[f]),!1!==e);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),!1===e)break;return a},trim:function(a){return null==a?"":Ka.call(a)},makeArray:function(a,b){var d=
b||[];null!=a&&(c(Object(a))?r.merge(d,"string"===typeof a?[a]:a):Ca.call(d,a));return d},inArray:function(a,b,c){return null==b?-1:aa.call(b,a,c)},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"===typeof d)for(;f<d;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];a.length=e;return a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;for(c=!!c;f<g;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=[];if(c(a))for(;f<g;f++)e=b(a[f],f,d),null!=e&&(h[h.length]=
e);else for(f in a)e=b(a[f],f,d),null!=e&&(h[h.length]=e);return ua.apply([],h)},guid:1,proxy:function(a,c){var d,e;"string"===typeof c&&(d=a[c],c=a,a=d);if(!r.isFunction(a))return b;e=ea.call(arguments,2);d=function(){return a.apply(c||this,e.concat(ea.call(arguments)))};d.guid=a.guid=a.guid||r.guid++;return d},access:function(a,c,d,e,f,g,h){var k=0,l=a.length,m=null==d;if("object"===r.type(d))for(k in f=!0,d)r.access(a,c,k,d[k],!0,g,h);else if(e!==b&&(f=!0,r.isFunction(e)||(h=!0),m&&(h?(c.call(a,
e),c=null):(m=c,c=function(a,b,c){return m.call(r(a),c)})),c))for(;k<l;k++)c(a[k],d,h?e:e.call(a[k],k,c(a[k],d)));return f?a:m?c.call(a):l?c(a[0],d):g},now:Date.now,swap:function(a,b,c,d){var e,f={};for(e in b)f[e]=a.style[e],a.style[e]=b[e];c=c.apply(a,d||[]);for(e in b)a.style[e]=f[e];return c}});r.ready.promise=function(b){ba||(ba=r.Deferred(),"complete"===I.readyState?setTimeout(r.ready):(I.addEventListener("DOMContentLoaded",fa,!1),a.addEventListener("load",fa,!1)));return ba.promise(b)};r.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),
function(a,b){P["[object "+b+"]"]=b.toLowerCase()});T=r(I);(function(a,b){function c(a,b,d,e){var f,g,h,k,l;(b?b.ownerDocument||b:aa)!==K&&L(b);b=b||K;d=d||[];if(!a||"string"!==typeof a)return d;if(1!==(k=b.nodeType)&&9!==k)return[];if(P&&!e){if(f=Ka.exec(a))if(h=f[1])if(9===k)if((g=b.getElementById(h))&&g.parentNode){if(g.id===h)return d.push(g),d}else return d;else{if(b.ownerDocument&&(g=b.ownerDocument.getElementById(h))&&Ca(b,g)&&g.id===h)return d.push(g),d}else{if(f[2])return ga.apply(d,b.getElementsByTagName(a)),
d;if((h=f[3])&&A.getElementsByClassName&&b.getElementsByClassName)return ga.apply(d,b.getElementsByClassName(h)),d}if(A.qsa&&(!Q||!Q.test(a))){g=f=S;h=b;l=9===k&&a;if(1===k&&"object"!==b.nodeName.toLowerCase()){k=s(a);(f=b.getAttribute("id"))?g=f.replace(Pa,"\\$&"):b.setAttribute("id",g);g="[id='"+g+"'] ";for(h=k.length;h--;)k[h]=g+t(k[h]);h=Aa.test(a)&&b.parentNode||b;l=k.join(",")}if(l)try{return ga.apply(d,h.querySelectorAll(l)),d}catch(m){}finally{f||b.removeAttribute("id")}}}var n;a:{a=a.replace(ua,
"$1");g=s(a);if(!e&&1===g.length){f=g[0]=g[0].slice(0);if(2<f.length&&"ID"===(n=f[0]).type&&A.getById&&9===b.nodeType&&P&&B.relative[f[1].type]){b=(B.find.ID(n.matches[0].replace(Ea,sa),b)||[])[0];if(!b){n=d;break a}a=a.slice(f.shift().value.length)}for(k=Da.needsContext.test(a)?0:f.length;k--;){n=f[k];if(B.relative[h=n.type])break;if(h=B.find[h])if(e=h(n.matches[0].replace(Ea,sa),Aa.test(f[0].type)&&b.parentNode||b)){f.splice(k,1);a=e.length&&t(f);if(!a){ga.apply(d,e);n=d;break a}break}}}H(a,g)(e,
b,!P,d,Aa.test(a));n=d}return n}function d(a){return Qa.test(a+"")}function e(){function a(c,d){b.push(c+=" ")>B.cacheLength&&delete a[b.shift()];return a[c]=d}var b=[];return a}function f(a){a[S]=!0;return a}function g(a){var b=K.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b)}}function h(a,b,c){a=a.split("|");var d,e=a.length;for(c=c?null:b;e--;)(d=B.attrHandle[a[e]])&&d!==b||(B.attrHandle[a[e]]=c)}function k(a,b){var c=a.getAttributeNode(b);
return c&&c.specified?c.value:!0===a[b]?b.toLowerCase():null}function l(a,b){return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}function m(a){if("input"===a.nodeName.toLowerCase())return a.defaultValue}function n(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||fa)-(~a.sourceIndex||fa);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function q(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}}function p(a){return function(b){var c=
b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function u(a){return f(function(b){b=+b;return f(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function s(a,b){var d,e,f,g,h,k,l;if(h=Z[a+" "])return b?0:h.slice(0);h=a;k=[];for(l=B.preFilter;h;){if(!d||(e=xa.exec(h)))e&&(h=h.slice(e[0].length)||h),k.push(f=[]);d=!1;if(e=ya.exec(h))d=e.shift(),f.push({value:d,type:e[0].replace(ua," ")}),h=h.slice(d.length);for(g in B.filter)!(e=
Da[g].exec(h))||l[g]&&!(e=l[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return b?h.length:h?c.error(a):Z(a,k).slice(0)}function t(a){for(var b=0,c=a.length,d="";b<c;b++)d+=a[b].value;return d}function v(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=R++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,k,l,m=V+" "+f;if(g)for(;b=b[d];){if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||
e)if(l=b[S]||(b[S]={}),(k=l[d])&&k[0]===m){if(!0===(h=k[1])||h===F)return!0===h}else if(k=l[d]=[m],k[1]=a(b,c,g)||F,!0===k[1])return!0}}function w(a){return 1<a.length?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function x(a,b,c,d,e){for(var f,g=[],h=0,k=a.length,l=null!=b;h<k;h++)if(f=a[h])if(!c||c(f,d,e))g.push(f),l&&b.push(h);return g}function y(a,b,d,e,g,h){e&&!e[S]&&(e=y(e));g&&!g[S]&&(g=y(g,h));return f(function(f,h,k,l){var m,n,ra=[],q=[],p=h.length,u;if(!(u=
f)){u=b||"*";for(var r=k.nodeType?[k]:k,s=[],t=0,Va=r.length;t<Va;t++)c(u,r[t],s);u=s}u=!a||!f&&b?u:x(u,ra,a,k,l);r=d?g||(f?a:p||e)?[]:h:u;d&&d(u,r,k,l);if(e)for(m=x(r,q),e(m,[],k,l),k=m.length;k--;)if(n=m[k])r[q[k]]=!(u[q[k]]=n);if(f){if(g||a){if(g){m=[];for(k=r.length;k--;)(n=r[k])&&m.push(u[k]=n);g(null,r=[],m,l)}for(k=r.length;k--;)(n=r[k])&&-1<(m=g?ka.call(f,n):ra[k])&&(f[m]=!(h[m]=n))}}else r=x(r===h?r.splice(p,r.length):r),g?g(null,h,r,l):ga.apply(h,r)})}function z(a){var b,c,d,e=a.length,
f=B.relative[a[0].type];c=f||B.relative[" "];for(var g=f?1:0,h=v(function(a){return a===b},c,!0),k=v(function(a){return-1<ka.call(b,a)},c,!0),l=[function(a,c,d){return!f&&(d||c!==J)||((b=c).nodeType?h(a,c,d):k(a,c,d))}];g<e;g++)if(c=B.relative[a[g].type])l=[v(w(l),c)];else{c=B.filter[a[g].type].apply(null,a[g].matches);if(c[S]){for(d=++g;d<e&&!B.relative[a[d].type];d++);return y(1<g&&w(l),1<g&&t(a.slice(0,g-1).concat({value:" "===a[g-2].type?"*":""})).replace(ua,"$1"),c,g<d&&z(a.slice(g,d)),d<e&&
z(a=a.slice(d)),d<e&&t(a))}l.push(c)}return w(l)}function C(a,b){var d=0,e=0<b.length,g=0<a.length,h=function(f,h,k,l,m){var n,ra,q=[],p=0,r="0",u=f&&[],s=null!=m,t=J,Va=f||g&&B.find.TAG("*",m&&h.parentNode||h),v=V+=null==t?1:Math.random()||.1;s&&(J=h!==K&&h,F=d);for(;null!=(m=Va[r]);r++){if(g&&m){for(n=0;ra=a[n++];)if(ra(m,h,k)){l.push(m);break}s&&(V=v,F=++d)}e&&((m=!ra&&m)&&p--,f&&u.push(m))}p+=r;if(e&&r!==p){for(n=0;ra=b[n++];)ra(u,q,h,k);if(f){if(0<p)for(;r--;)u[r]||q[r]||(q[r]=na.call(l));q=
x(q)}ga.apply(l,q);s&&!f&&0<q.length&&1<p+b.length&&c.uniqueSort(l)}s&&(V=v,J=t);return u};return e?f(h):h}function E(){}var D,A,F,B,G,I,H,J,M,L,K,N,P,Q,T,U,Ca,S="sizzle"+-new Date,aa=a.document,V=0,R=0,Y=e(),Z=e(),ea=e(),$=!1,ca=function(){return 0},ba=typeof b,fa=-2147483648,la={}.hasOwnProperty,da=[],na=da.pop,oa=da.push,ga=da.push,O=da.slice,ka=da.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1},qa="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+".replace("w","w#"),va=
"\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[\\w-]|[^\\x00-\\xa0])+)[\\x20\\t\\r\\n\\f]*(?:([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+qa+")|)|)[\\x20\\t\\r\\n\\f]*\\]",ta=":((?:\\\\.|[\\w-]|[^\\x00-\\xa0])+)(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+va.replace(3,8)+")*)|.*)\\)|)",ua=/^[\x20\t\r\n\f]+|((?:^|[^\\])(?:\\.)*)[\x20\t\r\n\f]+$/g,xa=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,ya=/^[\x20\t\r\n\f]*([>+~]|[\x20\t\r\n\f])[\x20\t\r\n\f]*/,Aa=/[\x20\t\r\n\f]*[+~]/,
Fa=/=[\x20\t\r\n\f]*([^\]'"]*)[\x20\t\r\n\f]*\]/g,Ha=new RegExp(ta),pa=new RegExp("^"+qa+"$"),Da={ID:/^#((?:\\.|[\w-]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[\w-]|[^\x00-\xa0])+)/,TAG:new RegExp("^("+"(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+".replace("w","w*")+")"),ATTR:new RegExp("^"+va),PSEUDO:new RegExp("^"+ta),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)",
"i"),bool:RegExp("^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$","i"),needsContext:RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},Qa=/^[^{]+\{\s*\[native \w/,Ka=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,La=/^(?:input|select|textarea|button)$/i,Oa=/^h\d$/i,Pa=/'|\\/g,Ea=/\\([\da-f]{1,6}[\x20\t\r\n\f]?|([\x20\t\r\n\f])|.)/ig,
sa=function(a,b,c){a="0x"+b-65536;return a!==a||c?b:0>a?String.fromCharCode(a+65536):String.fromCharCode(a>>10|55296,a&1023|56320)};try{ga.apply(da=O.call(aa.childNodes),aa.childNodes),da[aa.childNodes.length].nodeType}catch(Ra){ga={apply:da.length?function(a,b){oa.apply(a,O.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}I=c.isXML=function(a){return(a=a&&(a.ownerDocument||a).documentElement)?"HTML"!==a.nodeName:!1};A=c.support={};L=c.setDocument=function(a){var b=a?
a.ownerDocument||a:aa;if(b===K||9!==b.nodeType||!b.documentElement)return K;K=b;N=b.documentElement;P=!I(b);A.attributes=g(function(a){a.innerHTML="<a href='#'></a>";h("type|href|height|width",l,"#"===a.firstChild.getAttribute("href"));h("checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",k,null==a.getAttribute("disabled"));a.className="i";return!a.getAttribute("className")});A.input=g(function(a){a.innerHTML="<input>";a.firstChild.setAttribute("value",
"");return""===a.firstChild.getAttribute("value")});h("value",m,A.attributes&&A.input);A.getElementsByTagName=g(function(a){a.appendChild(b.createComment(""));return!a.getElementsByTagName("*").length});A.getElementsByClassName=g(function(a){a.innerHTML="<div class='a'></div><div class='a i'></div>";a.firstChild.className="i";return 2===a.getElementsByClassName("i").length});A.getById=g(function(a){N.appendChild(a).id=S;return!b.getElementsByName||!b.getElementsByName(S).length});A.getById?(B.find.ID=
function(a,b){if(typeof b.getElementById!==ba&&P){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},B.filter.ID=function(a){var b=a.replace(Ea,sa);return function(a){return a.getAttribute("id")===b}}):(delete B.find.ID,B.filter.ID=function(a){var b=a.replace(Ea,sa);return function(a){return(a=typeof a.getAttributeNode!==ba&&a.getAttributeNode("id"))&&a.value===b}});B.find.TAG=A.getElementsByTagName?function(a,b){if(typeof b.getElementsByTagName!==ba)return b.getElementsByTagName(a)}:function(a,
b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f};B.find.CLASS=A.getElementsByClassName&&function(a,b){if(typeof b.getElementsByClassName!==ba&&P)return b.getElementsByClassName(a)};T=[];Q=[];if(A.qsa=d(b.querySelectorAll))g(function(a){a.innerHTML="<select><option selected=''></option></select>";a.querySelectorAll("[selected]").length||Q.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)");
a.querySelectorAll(":checked").length||Q.push(":checked")}),g(function(a){var c=b.createElement("input");c.setAttribute("type","hidden");a.appendChild(c).setAttribute("t","");a.querySelectorAll("[t^='']").length&&Q.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")");a.querySelectorAll(":enabled").length||Q.push(":enabled",":disabled");a.querySelectorAll("*,:x");Q.push(",.*:")});(A.matchesSelector=d(U=N.webkitMatchesSelector||N.mozMatchesSelector||N.oMatchesSelector||N.msMatchesSelector))&&g(function(a){A.disconnectedMatch=
U.call(a,"div");U.call(a,"[s!='']:x");T.push("!=",ta)});Q=Q.length&&new RegExp(Q.join("|"));T=T.length&&new RegExp(T.join("|"));Ca=d(N.contains)||N.compareDocumentPosition?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!!(d&&1===d.nodeType&&(c.contains?c.contains(d):a.compareDocumentPosition&&a.compareDocumentPosition(d)&16))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1};A.sortDetached=g(function(a){return a.compareDocumentPosition(b.createElement("div"))&
1});ca=N.compareDocumentPosition?function(a,c){if(a===c)return $=!0,0;var d=c.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(c);return d?d&1||!A.sortDetached&&c.compareDocumentPosition(a)===d?a===b||Ca(aa,a)?-1:c===b||Ca(aa,c)?1:M?ka.call(M,a)-ka.call(M,c):0:d&4?-1:1:a.compareDocumentPosition?-1:1}:function(a,c){var d,e=0;d=a.parentNode;var f=c.parentNode,g=[a],h=[c];if(a===c)return $=!0,0;if(!d||!f)return a===b?-1:c===b?1:d?-1:f?1:M?ka.call(M,a)-ka.call(M,c):0;if(d===
f)return n(a,c);for(d=a;d=d.parentNode;)g.unshift(d);for(d=c;d=d.parentNode;)h.unshift(d);for(;g[e]===h[e];)e++;return e?n(g[e],h[e]):g[e]===aa?-1:h[e]===aa?1:0};return b};c.matches=function(a,b){return c(a,null,null,b)};c.matchesSelector=function(a,b){(a.ownerDocument||a)!==K&&L(a);b=b.replace(Fa,"='$1']");if(!(!A.matchesSelector||!P||T&&T.test(b)||Q&&Q.test(b)))try{var d=U.call(a,b);if(d||A.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return 0<c(b,K,null,[a]).length};
c.contains=function(a,b){(a.ownerDocument||a)!==K&&L(a);return Ca(a,b)};c.attr=function(a,c){(a.ownerDocument||a)!==K&&L(a);var d=B.attrHandle[c.toLowerCase()],d=d&&la.call(B.attrHandle,c.toLowerCase())?d(a,c,!P):b;return d===b?A.attributes||!P?a.getAttribute(c):(d=a.getAttributeNode(c))&&d.specified?d.value:null:d};c.error=function(a){throw Error("Syntax error, unrecognized expression: "+a);};c.uniqueSort=function(a){var b,c=[],d=0,e=0;$=!A.detectDuplicates;M=!A.sortStable&&a.slice(0);a.sort(ca);
if($){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return a};G=c.getText=function(a){var b,c="",d=0;b=a.nodeType;if(!b)for(;b=a[d];d++)c+=G(b);else if(1===b||9===b||11===b){if("string"===typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=G(a)}else if(3===b||4===b)return a.nodeValue;return c};B=c.selectors={cacheLength:50,createPseudo:f,match:Da,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",
first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){a[1]=a[1].replace(Ea,sa);a[3]=(a[4]||a[5]||"").replace(Ea,sa);"~="===a[2]&&(a[3]=" "+a[3]+" ");return a.slice(0,4)},CHILD:function(a){a[1]=a[1].toLowerCase();"nth"===a[1].slice(0,3)?(a[3]||c.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&c.error(a[0]);return a},PSEUDO:function(a){var c,d=!a[5]&&a[2];if(Da.CHILD.test(a[0]))return null;a[3]&&a[4]!==b?a[2]=a[4]:d&&Ha.test(d)&&
(c=s(d,!0))&&(c=d.indexOf(")",d.length-c)-d.length)&&(a[0]=a[0].slice(0,c),a[2]=d.slice(0,c));return a.slice(0,3)}},filter:{TAG:function(a){var b=a.replace(Ea,sa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=Y[a+" "];return b||(b=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+a+"([\\x20\\t\\r\\n\\f]|$)"))&&Y(a,function(a){return b.test("string"===typeof a.className&&a.className||typeof a.getAttribute!==ba&&a.getAttribute("class")||
"")})},ATTR:function(a,b,d){return function(e){e=c.attr(e,a);if(null==e)return"!="===b;if(!b)return!0;e+="";return"="===b?e===d:"!="===b?e!==d:"^="===b?d&&0===e.indexOf(d):"*="===b?d&&-1<e.indexOf(d):"$="===b?d&&e.slice(-d.length)===d:"~="===b?-1<(" "+e+" ").indexOf(d):"|="===b?e===d||e.slice(0,d.length+1)===d+"-":!1}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,k){var l,m,n,ra,q;c=f!==
g?"nextSibling":"previousSibling";var p=b.parentNode,r=h&&b.nodeName.toLowerCase();k=!k&&!h;if(p){if(f){for(;c;){for(m=b;m=m[c];)if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;q=c="only"===a&&!q&&"nextSibling"}return!0}q=[g?p.firstChild:p.lastChild];if(g&&k)for(k=p[S]||(p[S]={}),l=k[a]||[],ra=l[0]===V&&l[1],n=l[0]===V&&l[2],m=ra&&p.childNodes[ra];m=++ra&&m&&m[c]||(n=ra=0)||q.pop();){if(1===m.nodeType&&++n&&m===b){k[a]=[V,ra,n];break}}else if(k&&(l=(b[S]||(b[S]={}))[a])&&l[0]===V)n=l[1];
else for(;(m=++ra&&m&&m[c]||(n=ra=0)||q.pop())&&((h?m.nodeName.toLowerCase()!==r:1!==m.nodeType)||!++n||(k&&((m[S]||(m[S]={}))[a]=[V,n]),m!==b)););n-=e;return n===d||0===n%d&&0<=n/d}}},PSEUDO:function(a,b){var d,e=B.pseudos[a]||B.setFilters[a.toLowerCase()]||c.error("unsupported pseudo: "+a);return e[S]?e(b):1<e.length?(d=[a,a,"",b],B.setFilters.hasOwnProperty(a.toLowerCase())?f(function(a,c){for(var d,f=e(a,b),g=f.length;g--;)d=ka.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,d)}):e}},
pseudos:{not:f(function(a){var b=[],c=[],d=H(a.replace(ua,"$1"));return d[S]?f(function(a,b,c,e){e=d(a,null,e,[]);for(var f=a.length;f--;)if(c=e[f])a[f]=!(b[f]=c)}):function(a,e,f){b[0]=a;d(b,null,f,c);return!c.pop()}}),has:f(function(a){return function(b){return 0<c(a,b).length}}),contains:f(function(a){return function(b){return-1<(b.textContent||b.innerText||G(b)).indexOf(a)}}),lang:f(function(a){pa.test(a||"")||c.error("unsupported lang: "+a);a=a.replace(Ea,sa).toLowerCase();return function(b){var c;
do if(c=P?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===N},focus:function(a){return a===K.activeElement&&(!K.hasFocus||K.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return!1===a.disabled},disabled:function(a){return!0===a.disabled},checked:function(a){var b=
a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return!0===a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if("@"<a.nodeName||3===a.nodeType||4===a.nodeType)return!1;return!0},parent:function(a){return!B.pseudos.empty(a)},header:function(a){return Oa.test(a.nodeName)},input:function(a){return La.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&
"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||b.toLowerCase()===a.type)},first:u(function(){return[0]}),last:u(function(a,b){return[b-1]}),eq:u(function(a,b,c){return[0>c?c+b:c]}),even:u(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:u(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:u(function(a,b,c){for(b=0>c?c+b:c;0<=--b;)a.push(b);return a}),gt:u(function(a,b,c){for(c=
0>c?c+b:c;++c<b;)a.push(c);return a})}};for(D in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})B.pseudos[D]=q(D);for(D in{submit:!0,reset:!0})B.pseudos[D]=p(D);H=c.compile=function(a,b){var c,d=[],e=[],f=ea[a+" "];if(!f){b||(b=s(a));for(c=b.length;c--;)f=z(b[c]),f[S]?d.push(f):e.push(f);f=ea(a,C(e,d))}return f};B.pseudos.nth=B.pseudos.eq;E.prototype=B.filters=B.pseudos;B.setFilters=new E;A.sortStable=S.split("").sort(ca).join("")===S;L();[0,0].sort(ca);A.detectDuplicates=$;r.find=c;r.expr=c.selectors;
r.expr[":"]=r.expr.pseudos;r.unique=c.uniqueSort;r.text=c.getText;r.isXMLDoc=c.isXML;r.contains=c.contains})(a);var ka={};r.Callbacks=function(a){a="string"===typeof a?ka[a]||d(a):r.extend({},a);var c,e,f,g,h,k,l=[],m=!a.once&&[],n=function(b){c=a.memory&&b;e=!0;k=g||0;g=0;h=l.length;for(f=!0;l&&k<h;k++)if(!1===l[k].apply(b[0],b[1])&&a.stopOnFalse){c=!1;break}f=!1;l&&(m?m.length&&n(m.shift()):c?l=[]:q.disable())},q={add:function(){if(l){var b=l.length;(function Wc(b){r.each(b,function(b,c){var d=
r.type(c);"function"===d?a.unique&&q.has(c)||l.push(c):c&&c.length&&"string"!==d&&Wc(c)})})(arguments);f?h=l.length:c&&(g=b,n(c))}return this},remove:function(){l&&r.each(arguments,function(a,b){for(var c;-1<(c=r.inArray(b,l,c));)l.splice(c,1),f&&(c<=h&&h--,c<=k&&k--)});return this},has:function(a){return a?-1<r.inArray(a,l):!(!l||!l.length)},empty:function(){l=[];h=0;return this},disable:function(){l=m=c=b;return this},disabled:function(){return!l},lock:function(){m=b;c||q.disable();return this},
locked:function(){return!m},fireWith:function(a,b){b=b||[];b=[a,b.slice?b.slice():b];!l||e&&!m||(f?m.push(b):n(b));return this},fire:function(){q.fireWith(this,arguments);return this},fired:function(){return!!e}};return q};r.extend({Deferred:function(a){var b=[["resolve","done",r.Callbacks("once memory"),"resolved"],["reject","fail",r.Callbacks("once memory"),"rejected"],["notify","progress",r.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){e.done(arguments).fail(arguments);
return this},then:function(){var a=arguments;return r.Deferred(function(c){r.each(b,function(b,f){var g=f[0],h=r.isFunction(a[b])&&a[b];e[f[1]](function(){var a=h&&h.apply(this,arguments);if(a&&r.isFunction(a.promise))a.promise().done(c.resolve).fail(c.reject).progress(c.notify);else c[g+"With"](this===d?c.promise():this,h?[a]:arguments)})});a=null}).promise()},promise:function(a){return null!=a?r.extend(a,d):d}},e={};d.pipe=d.then;r.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add;h&&g.add(function(){c=
h},b[a^1][2].disable,b[2][2].lock);e[f[0]]=function(){e[f[0]+"With"](this===e?d:this,arguments);return this};e[f[0]+"With"]=g.fireWith});d.promise(e);a&&a.call(e,e);return e},when:function(a){var b=0,c=ea.call(arguments),d=c.length,e=1!==d||a&&r.isFunction(a.promise)?d:0,f=1===e?a:r.Deferred(),g=function(a,b,c){return function(d){b[a]=this;c[a]=1<arguments.length?ea.call(arguments):d;c===h?f.notifyWith(b,c):--e||f.resolveWith(b,c)}},h,k,l;if(1<d)for(h=Array(d),k=Array(d),l=Array(d);b<d;b++)c[b]&&
r.isFunction(c[b].promise)?c[b].promise().done(g(b,l,c)).fail(f.reject).progress(g(b,k,h)):--e;e||f.resolveWith(l,c);return f.promise()}});r.support=function(b){var c=I.createElement("input"),d=I.createDocumentFragment(),e=I.createElement("div"),f=I.createElement("select"),g=f.appendChild(I.createElement("option"));if(!c.type)return b;c.type="checkbox";b.checkOn=""!==c.value;b.optSelected=g.selected;b.reliableMarginRight=!0;b.boxSizingReliable=!0;b.pixelPosition=!1;c.checked=!0;b.noCloneChecked=c.cloneNode(!0).checked;
f.disabled=!0;b.optDisabled=!g.disabled;c=I.createElement("input");c.value="t";c.type="radio";b.radioValue="t"===c.value;c.setAttribute("checked","t");c.setAttribute("name","t");d.appendChild(c);b.checkClone=d.cloneNode(!0).cloneNode(!0).lastChild.checked;b.focusinBubbles="onfocusin"in a;e.style.backgroundClip="content-box";e.cloneNode(!0).style.backgroundClip="";b.clearCloneStyle="content-box"===e.style.backgroundClip;r(function(){var c,d,f=I.getElementsByTagName("body")[0];f&&(c=I.createElement("div"),
c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",f.appendChild(c).appendChild(e),e.innerHTML="",e.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",r.swap(f,null!=f.style.zoom?{zoom:1}:{},function(){b.boxSizing=4===e.offsetWidth}),a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(e,null)||{}).top,b.boxSizingReliable=
"4px"===(a.getComputedStyle(e,null)||{width:"4px"}).width,d=e.appendChild(I.createElement("div")),d.style.cssText=e.style.cssText="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",d.style.marginRight=d.style.width="0",e.style.width="1px",b.reliableMarginRight=!parseFloat((a.getComputedStyle(d,null)||{}).marginRight)),f.removeChild(c))});return b}({});var oa,U,Pa=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Da=/([A-Z])/g;e.uid=1;e.accepts=
function(a){return a.nodeType?1===a.nodeType||9===a.nodeType:!0};e.prototype={key:function(a){if(!e.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=e.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,r.extend(a,b)}}this.cache[c]||(this.cache[c]={});return c},set:function(a,b,c){var d;a=this.key(a);var e=this.cache[a];if("string"===typeof b)e[b]=c;else if(r.isEmptyObject(e))r.extend(this.cache[a],b);else for(d in b)e[d]=b[d];return e},get:function(a,
c){var d=this.cache[this.key(a)];return c===b?d:d[c]},access:function(a,c,d){if(c===b||c&&"string"===typeof c&&d===b)return this.get(a,c);this.set(a,c,d);return d!==b?d:c},remove:function(a,c){var d,e;d=this.key(a);var f=this.cache[d];if(c===b)this.cache[d]={};else for(r.isArray(c)?e=c.concat(c.map(r.camelCase)):(d=r.camelCase(c),c in f?e=[c,d]:(e=d,e=e in f?[e]:e.match(va)||[])),d=e.length;d--;)delete f[e[d]]},hasData:function(a){return!r.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&
delete this.cache[a[this.expando]]}};oa=new e;U=new e;r.extend({acceptData:e.accepts,hasData:function(a){return oa.hasData(a)||U.hasData(a)},data:function(a,b,c){return oa.access(a,b,c)},removeData:function(a,b){oa.remove(a,b)},_data:function(a,b,c){return U.access(a,b,c)},_removeData:function(a,b){U.remove(a,b)}});r.fn.extend({data:function(a,c){var d,e,g=this[0],h=0,k=null;if(a===b){if(this.length&&(k=oa.get(g),1===g.nodeType&&!U.get(g,"hasDataAttrs"))){for(d=g.attributes;h<d.length;h++)e=d[h].name,
0===e.indexOf("data-")&&(e=r.camelCase(e.slice(5)),f(g,e,k[e]));U.set(g,"hasDataAttrs",!0)}return k}return"object"===typeof a?this.each(function(){oa.set(this,a)}):r.access(this,function(c){var d,e=r.camelCase(a);if(g&&c===b){d=oa.get(g,a);if(d!==b)return d;d=oa.get(g,e);if(d!==b)return d;d=f(g,e,b);if(d!==b)return d}else this.each(function(){var d=oa.get(this,e);oa.set(this,e,c);-1!==a.indexOf("-")&&d!==b&&oa.set(this,a,c)})},null,c,1<arguments.length,null,!0)},removeData:function(a){return this.each(function(){oa.remove(this,
a)})}});r.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=U.get(a,b),c&&(!d||r.isArray(c)?d=U.access(a,b,r.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=r.queue(a,b),d=c.length,e=c.shift(),f=r._queueHooks(a,b),g=function(){r.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--);if(f.cur=e)"fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f);!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return U.get(a,c)||U.access(a,c,{empty:r.Callbacks("once memory").add(function(){U.remove(a,
[b+"queue",c])})})}});r.fn.extend({queue:function(a,c){var d=2;"string"!==typeof a&&(c=a,a="fx",d--);return arguments.length<d?r.queue(this[0],a):c===b?this:this.each(function(){var b=r.queue(this,a,c);r._queueHooks(this,a);"fx"===a&&"inprogress"!==b[0]&&r.dequeue(this,a)})},dequeue:function(a){return this.each(function(){r.dequeue(this,a)})},delay:function(a,b){a=r.fx?r.fx.speeds[a]||a:a;return this.queue(b||"fx",function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||
"fx",[])},promise:function(a,c){var d,e=1,f=r.Deferred(),g=this,h=this.length,k=function(){--e||f.resolveWith(g,[g])};"string"!==typeof a&&(c=a,a=b);for(a=a||"fx";h--;)(d=U.get(g[h],a+"queueHooks"))&&d.empty&&(e++,d.empty.add(k));k();return f.promise(c)}});var Ea,ga=/[\t\r\n\f]/g,da=/\r/g,ta=/^(?:input|select|textarea|button)$/i;r.fn.extend({attr:function(a,b){return r.access(this,r.attr,a,b,1<arguments.length)},removeAttr:function(a){return this.each(function(){r.removeAttr(this,a)})},prop:function(a,
b){return r.access(this,r.prop,a,b,1<arguments.length)},removeProp:function(a){return this.each(function(){delete this[r.propFix[a]||a]})},addClass:function(a){var b,c,d,e,f,g=0,h=this.length;b="string"===typeof a&&a;if(r.isFunction(a))return this.each(function(b){r(this).addClass(a.call(this,b,this.className))});if(b)for(b=(a||"").match(va)||[];g<h;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ga," "):" ")){for(f=0;e=b[f++];)0>d.indexOf(" "+e+" ")&&(d+=e+" ");c.className=
r.trim(d)}return this},removeClass:function(a){var b,c,d,e,f,g=0,h=this.length;b=0===arguments.length||"string"===typeof a&&a;if(r.isFunction(a))return this.each(function(b){r(this).removeClass(a.call(this,b,this.className))});if(b)for(b=(a||"").match(va)||[];g<h;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ga," "):"")){for(f=0;e=b[f++];)for(;0<=d.indexOf(" "+e+" ");)d=d.replace(" "+e+" "," ");c.className=a?r.trim(d):""}return this},toggleClass:function(a,b){var c=
typeof a,d="boolean"===typeof b;return r.isFunction(a)?this.each(function(c){r(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if("string"===c)for(var e,f=0,g=r(this),h=b,k=a.match(va)||[];e=k[f++];)h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e);else if(c===V||"boolean"===c)this.className&&U.set(this,"__className__",this.className),this.className=this.className||!1===a?"":U.get(this,"__className__")||""})},hasClass:function(a){a=" "+a+" ";for(var b=0,c=this.length;b<
c;b++)if(1===this[b].nodeType&&0<=(" "+this[b].className+" ").replace(ga," ").indexOf(a))return!0;return!1},val:function(a){var c,d,e,f=this[0];if(arguments.length)return e=r.isFunction(a),this.each(function(d){1===this.nodeType&&(d=e?a.call(this,d,r(this).val()):a,null==d?d="":"number"===typeof d?d+="":r.isArray(d)&&(d=r.map(d,function(a){return null==a?"":a+""})),c=r.valHooks[this.type]||r.valHooks[this.nodeName.toLowerCase()],c&&"set"in c&&c.set(this,d,"value")!==b||(this.value=d))});if(f){if((c=
r.valHooks[f.type]||r.valHooks[f.nodeName.toLowerCase()])&&"get"in c&&(d=c.get(f,"value"))!==b)return d;d=f.value;return"string"===typeof d?d.replace(da,""):null==d?"":d}}});r.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){for(var b,c=a.options,d=a.selectedIndex,e=(a="select-one"===a.type||0>d)?null:[],f=a?d+1:c.length,g=0>d?f:a?d:0;g<f;g++)if(b=c[g],!(!b.selected&&g!==d||(r.support.optDisabled?b.disabled:null!==b.getAttribute("disabled"))||
b.parentNode.disabled&&r.nodeName(b.parentNode,"optgroup"))){b=r(b).val();if(a)return b;e.push(b)}return e},set:function(a,b){for(var c,d,e=a.options,f=r.makeArray(b),g=e.length;g--;)if(d=e[g],d.selected=0<=r.inArray(r(d).val(),f))c=!0;c||(a.selectedIndex=-1);return f}}},attr:function(a,c,d){var e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g){if(typeof a.getAttribute===V)return r.prop(a,c,d);1===g&&r.isXMLDoc(a)||(c=c.toLowerCase(),e=r.attrHooks[c]||(r.expr.match.bool.test(c)?Ea:void 0));if(d!==b)if(null===
d)r.removeAttr(a,c);else{if(e&&"set"in e&&(f=e.set(a,d,c))!==b)return f;a.setAttribute(c,d+"");return d}else{if(e&&"get"in e&&null!==(f=e.get(a,c)))return f;f=r.find.attr(a,c);return null==f?b:f}}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(va);if(f&&1===a.nodeType)for(;c=f[e++];)d=r.propFix[c]||c,r.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!r.support.radioValue&&"radio"===b&&r.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b);
c&&(a.value=c);return b}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(a,c,d){var e,f,g;g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g){if(g=1!==g||!r.isXMLDoc(a))c=r.propFix[c]||c,f=r.propHooks[c];return d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c]}},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||ta.test(a.nodeName)||a.href?a.tabIndex:-1}}}});Ea={set:function(a,b,c){!1===b?r.removeAttr(a,c):a.setAttribute(c,c);return c}};
r.each(r.expr.match.bool.source.match(/\w+/g),function(a,c){var d=r.expr.attrHandle[c]||r.find.attr;r.expr.attrHandle[c]=function(a,c,e){var f=r.expr.attrHandle[c];a=e?b:(r.expr.attrHandle[c]=b)!=d(a,c,e)?c.toLowerCase():null;r.expr.attrHandle[c]=f;return a}});r.support.optSelected||(r.propHooks.selected={get:function(a){(a=a.parentNode)&&a.parentNode&&a.parentNode.selectedIndex;return null}});r.each("tabIndex readOnly maxLength cellSpacing cellPadding rowSpan colSpan useMap frameBorder contentEditable".split(" "),
function(){r.propFix[this.toLowerCase()]=this});r.each(["radio","checkbox"],function(){r.valHooks[this]={set:function(a,b){if(r.isArray(b))return a.checked=0<=r.inArray(r(a).val(),b)}};r.support.checkOn||(r.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var hb=/^key/,Db=/^(?:mouse|contextmenu)|click/,Hb=/^(?:focusinfocus|focusoutblur)$/,Nb=/^([^.]*)(?:\.(.+)|)$/;r.event={global:{},add:function(a,c,d,e,f){var g,h,k,l,m,n,q,p,u;if(m=U.get(a)){d.handler&&(g=d,d=
g.handler,f=g.selector);d.guid||(d.guid=r.guid++);(l=m.events)||(l=m.events={});(h=m.handle)||(h=m.handle=function(a){return typeof r===V||a&&r.event.triggered===a.type?b:r.event.dispatch.apply(h.elem,arguments)},h.elem=a);c=(c||"").match(va)||[""];for(m=c.length;m--;)k=Nb.exec(c[m])||[],p=n=k[1],u=(k[2]||"").split(".").sort(),p&&(k=r.event.special[p]||{},p=(f?k.delegateType:k.bindType)||p,k=r.event.special[p]||{},n=r.extend({type:p,origType:n,data:e,handler:d,guid:d.guid,selector:f,needsContext:f&&
r.expr.match.needsContext.test(f),namespace:u.join(".")},g),(q=l[p])||(q=l[p]=[],q.delegateCount=0,k.setup&&!1!==k.setup.call(a,e,u,h)||a.addEventListener&&a.addEventListener(p,h,!1)),k.add&&(k.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),f?q.splice(q.delegateCount++,0,n):q.push(n),r.event.global[p]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,k,l,m,n,q,p,u,s,t=U.hasData(a)&&U.get(a);if(t&&(k=t.events)){b=(b||"").match(va)||[""];for(l=b.length;l--;)if(h=Nb.exec(b[l])||[],p=s=h[1],u=
(h[2]||"").split(".").sort(),p){n=r.event.special[p]||{};p=(d?n.delegateType:n.bindType)||p;q=k[p]||[];h=h[2]&&new RegExp("(^|\\.)"+u.join("\\.(?:.*\\.|)")+"(\\.|$)");for(g=f=q.length;f--;)m=q[f],!e&&s!==m.origType||c&&c.guid!==m.guid||h&&!h.test(m.namespace)||d&&d!==m.selector&&("**"!==d||!m.selector)||(q.splice(f,1),m.selector&&q.delegateCount--,n.remove&&n.remove.call(a,m));g&&!q.length&&(n.teardown&&!1!==n.teardown.call(a,u,t.handle)||r.removeEvent(a,p,t.handle),delete k[p])}else for(p in k)r.event.remove(a,
p+b[l],c,d,!0);r.isEmptyObject(k)&&(delete t.handle,U.remove(a,"events"))}},trigger:function(c,d,e,f){var g,h,k,l,m,n,q=[e||I],p=xa.call(c,"type")?c.type:c;n=xa.call(c,"namespace")?c.namespace.split("."):[];h=g=e=e||I;if(3!==e.nodeType&&8!==e.nodeType&&!Hb.test(p+r.event.triggered)&&(0<=p.indexOf(".")&&(n=p.split("."),p=n.shift(),n.sort()),l=0>p.indexOf(":")&&"on"+p,c=c[r.expando]?c:new r.Event(p,"object"===typeof c&&c),c.isTrigger=f?2:3,c.namespace=n.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+
n.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c.result=b,c.target||(c.target=e),d=null==d?[c]:r.makeArray(d,[c]),n=r.event.special[p]||{},f||!n.trigger||!1!==n.trigger.apply(e,d))){if(!f&&!n.noBubble&&!r.isWindow(e)){k=n.delegateType||p;Hb.test(k+p)||(h=h.parentNode);for(;h;h=h.parentNode)q.push(h),g=h;g===(e.ownerDocument||I)&&q.push(g.defaultView||g.parentWindow||a)}for(g=0;(h=q[g++])&&!c.isPropagationStopped();)c.type=1<g?k:n.bindType||p,(m=(U.get(h,"events")||{})[c.type]&&U.get(h,"handle"))&&m.apply(h,
d),(m=l&&h[l])&&r.acceptData(h)&&m.apply&&!1===m.apply(h,d)&&c.preventDefault();c.type=p;f||c.isDefaultPrevented()||n._default&&!1!==n._default.apply(q.pop(),d)||!r.acceptData(e)||!l||!r.isFunction(e[p])||r.isWindow(e)||((g=e[l])&&(e[l]=null),r.event.triggered=p,e[p](),r.event.triggered=b,g&&(e[l]=g));return c.result}},dispatch:function(a){a=r.event.fix(a);var c,d,e,f,g=[],h=ea.call(arguments);c=(U.get(this,"events")||{})[a.type]||[];var k=r.event.special[a.type]||{};h[0]=a;a.delegateTarget=this;
if(!k.preDispatch||!1!==k.preDispatch.call(this,a)){g=r.event.handlers.call(this,a,c);for(c=0;(f=g[c++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,d=0;(e=f.handlers[d++])&&!a.isImmediatePropagationStopped();)if(!a.namespace_re||a.namespace_re.test(e.namespace))a.handleObj=e,a.data=e.data,e=((r.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,h),e!==b&&!1===(a.result=e)&&(a.preventDefault(),a.stopPropagation());k.postDispatch&&k.postDispatch.call(this,a);return a.result}},
handlers:function(a,c){var d,e,f,g,h=[],k=c.delegateCount,l=a.target;if(k&&l.nodeType&&(!a.button||"click"!==a.type))for(;l!==this;l=l.parentNode||this)if(!0!==l.disabled||"click"!==a.type){e=[];for(d=0;d<k;d++)g=c[d],f=g.selector+" ",e[f]===b&&(e[f]=g.needsContext?0<=r(f,this).index(l):r.find(f,this,null,[l]).length),e[f]&&e.push(g);e.length&&h.push({elem:l,handlers:e})}k<c.length&&h.push({elem:this,handlers:c.slice(k)});return h},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),
fixHooks:{},keyHooks:{props:["char","charCode","key","keyCode"],filter:function(a,b){null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f=c.button;null==a.pageX&&null!=c.clientX&&(d=a.target.ownerDocument||I,e=d.documentElement,d=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||d&&d.scrollLeft||0)-(e&&e.clientLeft||d&&d.clientLeft||0),a.pageY=
c.clientY+(e&&e.scrollTop||d&&d.scrollTop||0)-(e&&e.clientTop||d&&d.clientTop||0));a.which||f===b||(a.which=f&1?1:f&2?3:f&4?2:0);return a}},fix:function(a){if(a[r.expando])return a;var b,c,d;b=a.type;var e=a,f=this.fixHooks[b];f||(this.fixHooks[b]=f=Db.test(b)?this.mouseHooks:hb.test(b)?this.keyHooks:{});d=f.props?this.props.concat(f.props):this.props;a=new r.Event(e);for(b=d.length;b--;)c=d[b],a[c]=e[c];a.target||(a.target=I);3===a.target.nodeType&&(a.target=a.target.parentNode);return f.filter?
f.filter(a,e):a},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==k()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===k()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&r.nodeName(this,"input"))return this.click(),!1},_default:function(a){return r.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){a.result!==b&&(a.originalEvent.returnValue=a.result)}}},
simulate:function(a,b,c,d){a=r.extend(new r.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?r.event.trigger(a,null,b):r.event.dispatch.call(b,a);a.isDefaultPrevented()&&c.preventDefault()}};r.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)};r.Event=function(a,b){if(!(this instanceof r.Event))return new r.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.getPreventDefault&&a.getPreventDefault()?g:h):this.type=
a;b&&r.extend(this,b);this.timeStamp=a&&a.timeStamp||r.now();this[r.expando]=!0};r.Event.prototype={isDefaultPrevented:h,isPropagationStopped:h,isImmediatePropagationStopped:h,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=g;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=g;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g;this.stopPropagation()}};
r.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){r.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=a.relatedTarget,e=a.handleObj;if(!d||d!==this&&!r.contains(this,d))a.type=e.origType,c=e.handler.apply(this,arguments),a.type=b;return c}}});r.support.focusinBubbles||r.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){r.event.simulate(b,a.target,r.event.fix(a),!0)};r.event.special[b]={setup:function(){0===c++&&I.addEventListener(a,d,
!0)},teardown:function(){0===--c&&I.removeEventListener(a,d,!0)}}});r.fn.extend({on:function(a,c,d,e,f){var g,k;if("object"===typeof a){"string"!==typeof c&&(d=d||c,c=b);for(k in a)this.on(k,c,d,a[k],f);return this}null==d&&null==e?(e=c,d=c=b):null==e&&("string"===typeof c?(e=d,d=b):(e=d,d=c,c=b));if(!1===e)e=h;else if(!e)return this;1===f&&(g=e,e=function(a){r().off(a);return g.apply(this,arguments)},e.guid=g.guid||(g.guid=r.guid++));return this.each(function(){r.event.add(this,a,e,d,c)})},one:function(a,
b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,r(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"===typeof a){for(e in a)this.off(e,c,a[e]);return this}if(!1===c||"function"===typeof c)d=c,c=b;!1===d&&(d=h);return this.each(function(){r.event.remove(this,a,d,c)})},trigger:function(a,b){return this.each(function(){r.event.trigger(a,b,this)})},triggerHandler:function(a,
b){var c=this[0];if(c)return r.event.trigger(a,b,c,!0)}});var Fa=/^.[^:#\[\.,]*$/,qa=/^(?:parents|prev(?:Until|All))/,ib=r.expr.match.needsContext,Ib={children:!0,contents:!0,next:!0,prev:!0};r.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!==typeof a)return this.pushStack(r(a).filter(function(){for(b=0;b<e;b++)if(r.contains(d[b],this))return!0}));for(b=0;b<e;b++)r.find(a,d[b],c);c=this.pushStack(1<e?r.unique(c):c);c.selector=this.selector?this.selector+" "+a:a;return c},has:function(a){var b=
r(a,this),c=b.length;return this.filter(function(){for(var a=0;a<c;a++)if(r.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(l(this,a||[],!0))},filter:function(a){return this.pushStack(l(this,a||[],!1))},is:function(a){return!!l(this,"string"===typeof a&&ib.test(a)?r(a):a||[],!1).length},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=ib.test(a)||"string"!==typeof a?r(a,b||this.context):0;d<e;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(11>c.nodeType&&(g?-1<g.index(c):
1===c.nodeType&&r.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(1<f.length?r.unique(f):f)},index:function(a){return a?"string"===typeof a?aa.call(r(a),this[0]):aa.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){var c="string"===typeof a?r(a,b):r.makeArray(a&&a.nodeType?[a]:a),c=r.merge(this.get(),c);return this.pushStack(r.unique(c))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});
r.each({parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},parents:function(a){return r.dir(a,"parentNode")},parentsUntil:function(a,b,c){return r.dir(a,"parentNode",c)},next:function(a){return m(a,"nextSibling")},prev:function(a){return m(a,"previousSibling")},nextAll:function(a){return r.dir(a,"nextSibling")},prevAll:function(a){return r.dir(a,"previousSibling")},nextUntil:function(a,b,c){return r.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return r.dir(a,"previousSibling",
c)},siblings:function(a){return r.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return r.sibling(a.firstChild)},contents:function(a){return r.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:r.merge([],a.childNodes)}},function(a,b){r.fn[a]=function(c,d){var e=r.map(this,b,c);"Until"!==a.slice(-5)&&(d=c);d&&"string"===typeof d&&(e=r.filter(d,e));1<this.length&&(Ib[a]||r.unique(e),qa.test(a)&&e.reverse());return this.pushStack(e)}});r.extend({filter:function(a,b,c){var d=
b[0];c&&(a=":not("+a+")");return 1===b.length&&1===d.nodeType?r.find.matchesSelector(d,a)?[d]:[]:r.find.matches(a,r.grep(b,function(a){return 1===a.nodeType}))},dir:function(a,c,d){for(var e=[],f=d!==b;(a=a[c])&&9!==a.nodeType;)if(1===a.nodeType){if(f&&r(a).is(d))break;e.push(a)}return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var s=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,mb=/<([\w:]+)/,xb=/<|&#?\w+;/,nb=
/<(?:script|style|link)/i,Wa=/^(?:checkbox|radio)$/i,yb=/checked\s*(?:[^=]|=\s*.checked.)/i,jb=/^$|\/(?:java|ecma)script/i,ob=/^true\/(.*)/,tc=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,La={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};La.optgroup=La.option;La.tbody=La.tfoot=La.colgroup=La.caption=
La.thead;La.th=La.td;r.fn.extend({text:function(a){return r.access(this,function(a){return a===b?r.text(this):this.empty().append((this[0]&&this[0].ownerDocument||I).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||n(this,a).appendChild(a)})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=n(this,a);b.insertBefore(a,
b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?r.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||r.cleanData(v(c)),c.parentNode&&(b&&r.contains(c.ownerDocument,c)&&u(v(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,
b=0;null!=(a=this[b]);b++)1===a.nodeType&&(r.cleanData(v(a,!1)),a.textContent="");return this},clone:function(a,b){a=null==a?!1:a;b=null==b?a:b;return this.map(function(){return r.clone(this,a,b)})},html:function(a){return r.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b&&1===c.nodeType)return c.innerHTML;if("string"===typeof a&&!nb.test(a)&&!La[(mb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(s,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},1===c.nodeType&&(r.cleanData(v(c,
!1)),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=r.map(this,function(a){return[a.nextSibling,a.parentNode]}),b=0;this.domManip(arguments,function(c){var d=a[b++],e=a[b++];e&&(d&&d.parentNode!==e&&(d=this.nextSibling),r(this).remove(),e.insertBefore(c,d))},!0);return b?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b,c){a=ua.apply([],a);var d,e,f,g,h=0,k=this.length,l=this,m=k-1,n=a[0],p=r.isFunction(n);
if(p||!(1>=k||"string"!==typeof n||r.support.checkClone)&&yb.test(n))return this.each(function(d){var e=l.eq(d);p&&(a[0]=n.call(this,d,e.html()));e.domManip(a,b,c)});if(k&&(d=r.buildFragment(a,this[0].ownerDocument,!1,!c&&this),e=d.firstChild,1===d.childNodes.length&&(d=e),e)){e=r.map(v(d,"script"),t);for(f=e.length;h<k;h++)g=d,h!==m&&(g=r.clone(g,!0,!0),f&&r.merge(e,v(g,"script"))),b.call(this[h],g,h);if(f)for(d=e[e.length-1].ownerDocument,r.map(e,q),h=0;h<f;h++)g=e[h],jb.test(g.type||"")&&!U.access(g,
"globalEval")&&r.contains(d,g)&&(g.src?r._evalUrl(g.src):r.globalEval(g.textContent.replace(tc,"")))}return this}});r.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){r.fn[a]=function(a){for(var c=[],d=r(a),e=d.length-1,f=0;f<=e;f++)a=f===e?this:this.clone(!0),r(d[f])[b](a),Ca.apply(c,a.get());return this.pushStack(c)}});r.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),k=r.contains(a.ownerDocument,a);if(!(r.support.noCloneChecked||
1!==a.nodeType&&11!==a.nodeType||r.isXMLDoc(a)))for(g=v(h),f=v(a),d=0,e=f.length;d<e;d++){var l=f[d],m=g[d],n=m.nodeName.toLowerCase();if("input"===n&&Wa.test(l.type))m.checked=l.checked;else if("input"===n||"textarea"===n)m.defaultValue=l.defaultValue}if(b)if(c)for(f=f||v(a),g=g||v(h),d=0,e=f.length;d<e;d++)p(f[d],g[d]);else p(a,h);g=v(h,"script");0<g.length&&u(g,!k&&v(a,"script"));return h},buildFragment:function(a,b,c,d){for(var e,f,g,h=0,k=a.length,l=b.createDocumentFragment(),m=[];h<k;h++)if((e=
a[h])||0===e)if("object"===r.type(e))r.merge(m,e.nodeType?[e]:e);else if(xb.test(e)){f=f||l.appendChild(b.createElement("div"));g=(mb.exec(e)||["",""])[1].toLowerCase();g=La[g]||La._default;f.innerHTML=g[1]+e.replace(s,"<$1></$2>")+g[2];for(g=g[0];g--;)f=f.firstChild;r.merge(m,f.childNodes);f=l.firstChild;f.textContent=""}else m.push(b.createTextNode(e));l.textContent="";for(h=0;e=m[h++];)if(!d||-1===r.inArray(e,d))if(a=r.contains(e.ownerDocument,e),f=v(l.appendChild(e),"script"),a&&u(f),c)for(g=
0;e=f[g++];)jb.test(e.type||"")&&c.push(e);return l},cleanData:function(a){for(var c,d,f,g,h,k,l=r.event.special,m=0;(d=a[m])!==b;m++){if(e.accepts(d)&&(h=d[U.expando])&&(c=U.cache[h])){f=Object.keys(c.events||{});if(f.length)for(k=0;(g=f[k])!==b;k++)l[g]?r.event.remove(d,g):r.removeEvent(d,g,c.handle);U.cache[h]&&delete U.cache[h]}delete oa.cache[d[oa.expando]]}},_evalUrl:function(a){return r.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}});r.fn.extend({wrapAll:function(a){var b;
if(r.isFunction(a))return this.each(function(b){r(this).wrapAll(a.call(this,b))});this[0]&&(b=r(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this));return this},wrapInner:function(a){return r.isFunction(a)?this.each(function(b){r(this).wrapInner(a.call(this,b))}):this.each(function(){var b=r(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=
r.isFunction(a);return this.each(function(c){r(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){r.nodeName(this,"body")||r(this).replaceWith(this.childNodes)}).end()}});var Za,kb,uc=/^(none|table(?!-c[ea]).+)/,fc=/^margin/,vc=new RegExp("^("+Ha+")(.*)$","i"),zb=new RegExp("^("+Ha+")(?!px)[a-z%]+$","i"),wc=new RegExp("^([+-])=("+Ha+")","i"),Ab={BODY:"block"},Kb={position:"absolute",visibility:"hidden",display:"block"},rb={letterSpacing:0,fontWeight:400},db=
["Top","Right","Bottom","Left"],Fb=["Webkit","O","Moz","ms"];r.fn.extend({css:function(c,d){return r.access(this,function(c,d,e){var f,g={},h=0;if(r.isArray(d)){e=a.getComputedStyle(c,null);for(f=d.length;h<f;h++)g[d[h]]=r.css(c,d[h],!1,e);return g}return e!==b?r.style(c,d,e):r.css(c,d)},c,d,1<arguments.length)},show:function(){return y(this,!0)},hide:function(){return y(this)},toggle:function(a){var b="boolean"===typeof a;return this.each(function(){(b?a:w(this))?r(this).show():r(this).hide()})}});
r.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Za(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g,h,k=r.camelCase(c),l=a.style;c=r.cssProps[k]||(r.cssProps[k]=x(l,k));h=r.cssHooks[c]||r.cssHooks[k];if(d!==b)g=typeof d,"string"===g&&(f=wc.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(r.css(a,
c)),g="number"),null==d||"number"===g&&isNaN(d)||("number"!==g||r.cssNumber[k]||(d+="px"),r.support.clearCloneStyle||""!==d||0!==c.indexOf("background")||(l[c]="inherit"),h&&"set"in h&&(d=h.set(a,d,e))===b||(l[c]=d));else return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:l[c]}},css:function(a,c,d,e){var f,g;g=r.camelCase(c);c=r.cssProps[g]||(r.cssProps[g]=x(a.style,g));(g=r.cssHooks[c]||r.cssHooks[g])&&"get"in g&&(f=g.get(a,!0,d));f===b&&(f=Za(a,c,e));"normal"===f&&c in rb&&(f=rb[c]);return""===d||d?(a=
parseFloat(f),!0===d||r.isNumeric(a)?a||0:f):f}});Za=function(c,d,e){var f,g=(e=e||a.getComputedStyle(c,null))?e.getPropertyValue(d)||e[d]:b,h=c.style;e&&(""!==g||r.contains(c.ownerDocument,c)||(g=r.style(c,d)),zb.test(g)&&fc.test(d)&&(c=h.width,d=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=e.width,h.width=c,h.minWidth=d,h.maxWidth=f));return g};r.each(["height","width"],function(b,c){r.cssHooks[c]={get:function(a,b,d){if(b)return 0===a.offsetWidth&&uc.test(r.css(a,"display"))?r.swap(a,
Kb,function(){return K(a,c,d)}):K(a,c,d)},set:function(b,d,e){var f=e&&a.getComputedStyle(b,null);return M(b,d,e?z(b,c,e,r.support.boxSizing&&"border-box"===r.css(b,"boxSizing",!1,f),f):0)}}});r(function(){r.support.reliableMarginRight||(r.cssHooks.marginRight={get:function(a,b){if(b)return r.swap(a,{display:"inline-block"},Za,[a,"marginRight"])}});!r.support.pixelPosition&&r.fn.position&&r.each(["top","left"],function(a,b){r.cssHooks[b]={get:function(a,c){if(c)return c=Za(a,b),zb.test(c)?r(a).position()[b]+
"px":c}}})});r.expr&&r.expr.filters&&(r.expr.filters.hidden=function(a){return 0>=a.offsetWidth&&0>=a.offsetHeight},r.expr.filters.visible=function(a){return!r.expr.filters.hidden(a)});r.each({margin:"",padding:"",border:"Width"},function(a,b){r.cssHooks[a+b]={expand:function(c){var d=0,e={};for(c="string"===typeof c?c.split(" "):[c];4>d;d++)e[a+db[d]+b]=c[d]||c[d-2]||c[0];return e}};fc.test(a)||(r.cssHooks[a+b].set=M)});var gc=/%20/g,cc=/\[\]$/,zc=/\r?\n/g,Mc=/^(?:submit|button|image|reset|file)$/i,
Nc=/^(?:input|select|textarea|keygen)/i;r.fn.extend({serialize:function(){return r.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=r.prop(this,"elements");return a?r.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!r(this).is(":disabled")&&Nc.test(this.nodeName)&&!Mc.test(a)&&(this.checked||!Wa.test(a))}).map(function(a,b){var c=r(this).val();return null==c?null:r.isArray(c)?r.map(c,function(a){return{name:b.name,value:a.replace(zc,
"\r\n")}}):{name:b.name,value:c.replace(zc,"\r\n")}}).get()}});r.param=function(a,c){var d,e=[],f=function(a,b){b=r.isFunction(b)?b():null==b?"":b;e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=r.ajaxSettings&&r.ajaxSettings.traditional);if(r.isArray(a)||a.jquery&&!r.isPlainObject(a))r.each(a,function(){f(this.name,this.value)});else for(d in a)L(d,a[d],c,f);return e.join("&").replace(gc,"+")};r.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),
function(a,b){r.fn[b]=function(a,c){return 0<arguments.length?this.on(b,null,a,c):this.trigger(b)}});r.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var Jb,Eb,pc=r.now(),qc=/\?/,Oc=/#.*$/,Ac=/([?&])_=[^&]*/,Pc=/^(.*?):[ \t]*([^\r\n]*)$/mg,
Qc=/^(?:GET|HEAD)$/,Rc=/^\/\//,Bc=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Cc=r.fn.load,Dc={},rc={},Ec="*/".concat("*");try{Eb=S.href}catch(bd){Eb=I.createElement("a"),Eb.href="",Eb=Eb.href}Jb=Bc.exec(Eb.toLowerCase())||[];r.fn.load=function(a,c,d){if("string"!==typeof a&&Cc)return Cc.apply(this,arguments);var e,f,g,h=this,k=a.indexOf(" ");0<=k&&(e=a.slice(k),a=a.slice(0,k));r.isFunction(c)?(d=c,c=b):c&&"object"===typeof c&&(f="POST");0<h.length&&r.ajax({url:a,type:f,dataType:"html",data:c}).done(function(a){g=
arguments;h.html(e?r("<div>").append(r.parseHTML(a)).find(e):a)}).complete(d&&function(a,b){h.each(d,g||[a.responseText,b,a])});return this};r.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){r.fn[b]=function(a){return this.on(b,a)}});r.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Eb,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Jb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",
accepts:{"*":Ec,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":r.parseJSON,"text xml":r.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?F(F(a,r.ajaxSettings),b):F(r.ajaxSettings,a)},ajaxPrefilter:A(Dc),ajaxTransport:A(rc),ajax:function(a,
c){function d(a,c,h,l){var n,w,x,z;z=c;if(2!==y){y=2;k&&clearTimeout(k);e=b;g=l||"";A.readyState=0<a?4:0;l=200<=a&&300>a||304===a;if(h){x=p;for(var ra=A,B,C,E,D,F=x.contents,G=x.dataTypes;"*"===G[0];)G.shift(),B===b&&(B=x.mimeType||ra.getResponseHeader("Content-Type"));if(B)for(C in F)if(F[C]&&F[C].test(B)){G.unshift(C);break}if(G[0]in h)E=G[0];else{for(C in h){if(!G[0]||x.converters[C+" "+G[0]]){E=C;break}D||(D=C)}E=E||D}E?(E!==G[0]&&G.unshift(E),x=h[E]):x=void 0}a:{h=p;B=x;C=A;E=l;var I,H,J,ra=
{},F=h.dataTypes.slice();if(F[1])for(H in h.converters)ra[H.toLowerCase()]=h.converters[H];for(D=F.shift();D;)if(h.responseFields[D]&&(C[h.responseFields[D]]=B),!J&&E&&h.dataFilter&&(B=h.dataFilter(B,h.dataType)),J=D,D=F.shift())if("*"===D)D=J;else if("*"!==J&&J!==D){H=ra[J+" "+D]||ra["* "+D];if(!H)for(I in ra)if(x=I.split(" "),x[1]===D&&(H=ra[J+" "+x[0]]||ra["* "+x[0]])){!0===H?H=ra[I]:!0!==ra[I]&&(D=x[0],F.unshift(x[1]));break}if(!0!==H)if(H&&h["throws"])B=H(B);else try{B=H(B)}catch(K){x={state:"parsererror",
error:H?K:"No conversion from "+J+" to "+D};break a}}x={state:"success",data:B}}if(l)p.ifModified&&((z=A.getResponseHeader("Last-Modified"))&&(r.lastModified[f]=z),(z=A.getResponseHeader("etag"))&&(r.etag[f]=z)),204===a||"HEAD"===p.type?z="nocontent":304===a?z="notmodified":(z=x.state,n=x.data,w=x.error,l=!w);else if(w=z,a||!z)z="error",0>a&&(a=0);A.status=a;A.statusText=(c||z)+"";l?s.resolveWith(q,[n,z,A]):s.rejectWith(q,[A,z,w]);A.statusCode(v);v=b;m&&u.trigger(l?"ajaxSuccess":"ajaxError",[A,p,
l?n:w]);t.fireWith(q,[A,z]);m&&(u.trigger("ajaxComplete",[A,p]),--r.active||r.event.trigger("ajaxStop"))}}"object"===typeof a&&(c=a,a=b);c=c||{};var e,f,g,h,k,l,m,n,p=r.ajaxSetup({},c),q=p.context||p,u=p.context&&(q.nodeType||q.jquery)?r(q):r.event,s=r.Deferred(),t=r.Callbacks("once memory"),v=p.statusCode||{},w={},x={},y=0,z="canceled",A={readyState:0,getResponseHeader:function(a){var b;if(2===y){if(!h)for(h={};b=Pc.exec(g);)h[b[1].toLowerCase()]=b[2];b=h[a.toLowerCase()]}return null==b?null:b},
getAllResponseHeaders:function(){return 2===y?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();y||(a=x[c]=x[c]||a,w[a]=b);return this},overrideMimeType:function(a){y||(p.mimeType=a);return this},statusCode:function(a){var b;if(a)if(2>y)for(b in a)v[b]=[v[b],a[b]];else A.always(a[A.status]);return this},abort:function(a){a=a||z;e&&e.abort(a);d(0,a);return this}};s.promise(A).complete=t.add;A.success=A.done;A.error=A.fail;p.url=((a||p.url||Eb)+"").replace(Oc,"").replace(Rc,Jb[1]+"//");p.type=
c.method||c.type||p.method||p.type;p.dataTypes=r.trim(p.dataType||"*").toLowerCase().match(va)||[""];null==p.crossDomain&&(l=Bc.exec(p.url.toLowerCase()),p.crossDomain=!(!l||l[1]===Jb[1]&&l[2]===Jb[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(Jb[3]||("http:"===Jb[1]?"80":"443"))));p.data&&p.processData&&"string"!==typeof p.data&&(p.data=r.param(p.data,p.traditional));E(Dc,p,c,A);if(2===y)return A;(m=p.global)&&0===r.active++&&r.event.trigger("ajaxStart");p.type=p.type.toUpperCase();p.hasContent=!Qc.test(p.type);
f=p.url;p.hasContent||(p.data&&(f=p.url+=(qc.test(f)?"&":"?")+p.data,delete p.data),!1===p.cache&&(p.url=Ac.test(f)?f.replace(Ac,"$1_="+pc++):f+(qc.test(f)?"&":"?")+"_="+pc++));p.ifModified&&(r.lastModified[f]&&A.setRequestHeader("If-Modified-Since",r.lastModified[f]),r.etag[f]&&A.setRequestHeader("If-None-Match",r.etag[f]));(p.data&&p.hasContent&&!1!==p.contentType||c.contentType)&&A.setRequestHeader("Content-Type",p.contentType);A.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?
p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Ec+"; q=0.01":""):p.accepts["*"]);for(n in p.headers)A.setRequestHeader(n,p.headers[n]);if(p.beforeSend&&(!1===p.beforeSend.call(q,A,p)||2===y))return A.abort();z="abort";for(n in{success:1,error:1,complete:1})A[n](p[n]);if(e=E(rc,p,c,A)){A.readyState=1;m&&u.trigger("ajaxSend",[A,p]);p.async&&0<p.timeout&&(k=setTimeout(function(){A.abort("timeout")},p.timeout));try{y=1,e.send(w,d)}catch(B){if(2>y)d(-1,B);else throw B;}}else d(-1,"No Transport");
return A},getJSON:function(a,b,c){return r.get(a,b,c,"json")},getScript:function(a,c){return r.get(a,b,c,"script")}});r.each(["get","post"],function(a,c){r[c]=function(a,d,e,f){r.isFunction(d)&&(f=f||e,e=d,d=b);return r.ajax({url:a,type:c,dataType:f,data:d,success:e})}});r.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){r.globalEval(a);return a}}});
r.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1);a.crossDomain&&(a.type="GET")});r.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=r("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove();c=null;a&&e("error"===a.type?404:200,a.type)});I.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Fc=[],sc=/(=)\?(?=&|$)|\?\?/;r.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Fc.pop()||r.expando+
"_"+pc++;this[a]=!0;return a}});r.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,k=!1!==c.jsonp&&(sc.test(c.url)?"url":"string"===typeof c.data&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&sc.test(c.data)&&"data");if(k||"jsonp"===c.dataTypes[0])return f=c.jsonpCallback=r.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,k?c[k]=c[k].replace(sc,"$1"+f):!1!==c.jsonp&&(c.url+=(qc.test(c.url)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){h||r.error(f+
" was not called");return h[0]},c.dataTypes[0]="json",g=a[f],a[f]=function(){h=arguments},e.always(function(){a[f]=g;c[f]&&(c.jsonpCallback=d.jsonpCallback,Fc.push(f));h&&r.isFunction(g)&&g(h[0]);h=g=b}),"script"});r.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Rb=r.ajaxSettings.xhr(),Sc={0:200,1223:204},Tc=0,Sb={};if(a.ActiveXObject)r(a).on("unload",function(){for(var a in Sb)Sb[a]();Sb=b});r.support.cors=!!Rb&&"withCredentials"in Rb;r.support.ajax=Rb=!!Rb;r.ajaxTransport(function(a){var c;
if(r.support.cors||Rb&&!a.crossDomain)return{send:function(d,e){var f,g,h=a.xhr();h.open(a.type,a.url,a.async,a.username,a.password);if(a.xhrFields)for(f in a.xhrFields)h[f]=a.xhrFields[f];a.mimeType&&h.overrideMimeType&&h.overrideMimeType(a.mimeType);a.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(f in d)h.setRequestHeader(f,d[f]);c=function(a){return function(){c&&(delete Sb[g],c=h.onload=h.onerror=null,"abort"===a?h.abort():"error"===a?e(h.status||404,h.statusText):
e(Sc[h.status]||h.status,h.statusText,"string"===typeof h.responseText?{text:h.responseText}:b,h.getAllResponseHeaders()))}};h.onload=c();h.onerror=c("error");c=Sb[g=Tc++]=c("abort");h.send(a.hasContent&&a.data||null)},abort:function(){c&&c()}}});var Ob,dc,Uc=/^(?:toggle|show|hide)$/,Gc=new RegExp("^(?:([+-])=|)("+Ha+")([a-z%]*)$","i"),Vc=/queueHooks$/,ec=[function(a,c,d){var e,f,g,h,k,l=this,m={},n=a.style,p=a.nodeType&&w(a),q=U.get(a,"fxshow");d.queue||(h=r._queueHooks(a,"fx"),null==h.unqueued&&
(h.unqueued=0,k=h.empty.fire,h.empty.fire=function(){h.unqueued||k()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--;r.queue(a,"fx").length||h.empty.fire()})}));1===a.nodeType&&("height"in c||"width"in c)&&(d.overflow=[n.overflow,n.overflowX,n.overflowY],"inline"===r.css(a,"display")&&"none"===r.css(a,"float")&&(n.display="inline-block"));d.overflow&&(n.overflow="hidden",l.always(function(){n.overflow=d.overflow[0];n.overflowX=d.overflow[1];n.overflowY=d.overflow[2]}));for(e in c)if(f=
c[e],Uc.exec(f)){delete c[e];g=g||"toggle"===f;if(f===(p?"hide":"show"))if("show"===f&&q&&q[e]!==b)p=!0;else continue;m[e]=q&&q[e]||r.style(a,e)}if(!r.isEmptyObject(m))for(e in q?"hidden"in q&&(p=q.hidden):q=U.access(a,"fxshow",{}),g&&(q.hidden=!p),p?r(a).show():l.done(function(){r(a).hide()}),l.done(function(){var b;U.remove(a,"fxshow");for(b in m)r.style(a,b,m[b])}),m)c=N(p?q[e]:0,e,l),e in q||(q[e]=c.start,p&&(c.end=c.start,c.start="width"===e||"height"===e?1:0))}],Tb={"*":[function(a,b){var c=
this.createTween(a,b),d=c.cur(),e=Gc.exec(b),f=e&&e[3]||(r.cssNumber[a]?"":"px"),g=(r.cssNumber[a]||"px"!==f&&+d)&&Gc.exec(r.css(c.elem,a)),h=1,k=20;if(g&&g[3]!==f){f=f||g[3];e=e||[];g=+d||1;do h=h||".5",g/=h,r.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--k)}e&&(c.unit=f,c.start=+g||+d||0,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]);return c}]};r.Animation=r.extend(B,{tweener:function(a,b){r.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;d<e;d++)c=a[d],Tb[c]=Tb[c]||[],Tb[c].unshift(b)},
prefilter:function(a,b){b?ec.unshift(a):ec.push(a)}});r.Tween=G;G.prototype={constructor:G,init:function(a,b,c,d,e,f){this.elem=a;this.prop=c;this.easing=e||"swing";this.options=b;this.start=this.now=this.cur();this.end=d;this.unit=f||(r.cssNumber[c]?"":"px")},cur:function(){var a=G.propHooks[this.prop];return a&&a.get?a.get(this):G.propHooks._default.get(this)},run:function(a){var b,c=G.propHooks[this.prop];this.pos=this.options.duration?b=r.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):
b=a;this.now=(this.end-this.start)*b+this.start;this.options.step&&this.options.step.call(this.elem,this.now,this);c&&c.set?c.set(this):G.propHooks._default.set(this);return this}};G.prototype.init.prototype=G.prototype;G.propHooks={_default:{get:function(a){return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(a=r.css(a.elem,a.prop,""))&&"auto"!==a?a:0:a.elem[a.prop]},set:function(a){if(r.fx.step[a.prop])r.fx.step[a.prop](a);else a.elem.style&&(null!=a.elem.style[r.cssProps[a.prop]]||
r.cssHooks[a.prop])?r.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}};G.propHooks.scrollTop=G.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}};r.each(["toggle","show","hide"],function(a,b){var c=r.fn[b];r.fn[b]=function(a,d,e){return null==a||"boolean"===typeof a?c.apply(this,arguments):this.animate(Q(b,!0),a,d,e)}});r.fn.extend({fadeTo:function(a,b,c,d){return this.filter(w).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,
b,c,d){var e=r.isEmptyObject(a),f=r.speed(b,c,d),g=function(){var b=B(this,r.extend({},a),f);g.finish=function(){b.stop(!0)};(e||U.get(this,"finish"))&&b.stop(!0)};g.finish=g;return e||!1===f.queue?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop;b(d)};"string"!==typeof a&&(d=c,c=a,a=b);c&&!1!==a&&this.queue(a||"fx",[]);return this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",f=r.timers,g=U.get(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&
g[c].stop&&Vc.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem!==this||null!=a&&f[c].queue!==a||(f[c].anim.stop(d),b=!1,f.splice(c,1));!b&&d||r.dequeue(this,a)})},finish:function(a){!1!==a&&(a=a||"fx");return this.each(function(){var b,c=U.get(this),d=c[a+"queue"];b=c[a+"queueHooks"];var e=r.timers,f=d?d.length:0;c.finish=!0;r.queue(this,a,[]);b&&b.cur&&b.cur.finish&&b.cur.finish.call(this);for(b=e.length;b--;)e[b].elem===this&&e[b].queue===a&&(e[b].anim.stop(!0),e.splice(b,1));for(b=0;b<f;b++)d[b]&&
d[b].finish&&d[b].finish.call(this);delete c.finish})}});r.each({slideDown:Q("show"),slideUp:Q("hide"),slideToggle:Q("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){r.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}});r.speed=function(a,b,c){var d=a&&"object"===typeof a?r.extend({},a):{complete:c||!c&&b||r.isFunction(a)&&a,duration:a,easing:c&&b||b&&!r.isFunction(b)&&b};d.duration=r.fx.off?0:"number"===typeof d.duration?d.duration:d.duration in
r.fx.speeds?r.fx.speeds[d.duration]:r.fx.speeds._default;if(null==d.queue||!0===d.queue)d.queue="fx";d.old=d.complete;d.complete=function(){r.isFunction(d.old)&&d.old.call(this);d.queue&&r.dequeue(this,d.queue)};return d};r.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}};r.timers=[];r.fx=G.prototype.init;r.fx.tick=function(){var a,c=r.timers,d=0;for(Ob=r.now();d<c.length;d++)a=c[d],a()||c[d]!==a||c.splice(d--,1);c.length||r.fx.stop();Ob=b};r.fx.timer=function(a){a()&&
r.timers.push(a)&&r.fx.start()};r.fx.interval=13;r.fx.start=function(){dc||(dc=setInterval(r.fx.tick,r.fx.interval))};r.fx.stop=function(){clearInterval(dc);dc=null};r.fx.speeds={slow:600,fast:200,_default:400};r.fx.step={};r.expr&&r.expr.filters&&(r.expr.filters.animated=function(a){return r.grep(r.timers,function(b){return a===b.elem}).length});r.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){r.offset.setOffset(this,a,b)});var c,d;d=this[0];var e={top:0,left:0},
f=d&&d.ownerDocument;if(f){c=f.documentElement;if(!r.contains(c,d))return e;typeof d.getBoundingClientRect!==V&&(e=d.getBoundingClientRect());d=Z(f);return{top:e.top+d.pageYOffset-c.clientTop,left:e.left+d.pageXOffset-c.clientLeft}}};r.offset={setOffset:function(a,b,c){var d,e,f,g=r.css(a,"position"),h=r(a),k={};"static"===g&&(a.style.position="relative");f=h.offset();e=r.css(a,"top");d=r.css(a,"left");("absolute"===g||"fixed"===g)&&-1<(e+d).indexOf("auto")?(d=h.position(),e=d.top,d=d.left):(e=parseFloat(e)||
0,d=parseFloat(d)||0);r.isFunction(b)&&(b=b.call(a,c,f));null!=b.top&&(k.top=b.top-f.top+e);null!=b.left&&(k.left=b.left-f.left+d);"using"in b?b.using.call(a,k):h.css(k)}};r.fn.extend({position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};"fixed"===r.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),r.nodeName(a[0],"html")||(d=a.offset()),d.top+=r.css(a[0],"borderTopWidth",!0),d.left+=r.css(a[0],"borderLeftWidth",!0));return{top:b.top-d.top-r.css(c,
"marginTop",!0),left:b.left-d.left-r.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||Y;a&&!r.nodeName(a,"html")&&"static"===r.css(a,"position");)a=a.offsetParent;return a||Y})}});r.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(c,d){var e="pageYOffset"===d;r.fn[c]=function(f){return r.access(this,function(c,f,g){var h=Z(c);if(g===b)return h?h[d]:c[f];h?h.scrollTo(e?a.pageXOffset:g,e?g:a.pageYOffset):c[f]=g},c,f,arguments.length,
null)}});r.each({Height:"height",Width:"width"},function(a,c){r.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){r.fn[e]=function(e,f){var g=arguments.length&&(d||"boolean"!==typeof e),h=d||(!0===e||!0===f?"margin":"border");return r.access(this,function(c,d,e){return r.isWindow(c)?c.document.documentElement["client"+a]:9===c.nodeType?(d=c.documentElement,Math.max(c.body["scroll"+a],d["scroll"+a],c.body["offset"+a],d["offset"+a],d["client"+a])):e===b?r.css(c,d,h):r.style(c,d,e,h)},c,
g?e:b,g,null)}})});r.fn.size=function(){return this.length};r.fn.andSelf=r.fn.addBack;"object"===typeof module&&module&&"object"===typeof module.exports?module.exports=r:"function"===typeof define&&define.amd&&define("jquery",[],function(){return r});"object"===typeof a&&"object"===typeof a.document&&(a.jQuery=a.$=r)})(window);(function(){var a=this,b;b="undefined"!==typeof exports?exports:a.Springy={};var c=!0,d=b.Graph=function(a){this.nodeSet={};this.nodes=[];this.edges=[];this.adjacency={};this.nextEdgeId=this.nextNodeId=0;this.eventListeners=[];c=a};d.prototype.setPerspective=function(a){c=a};var e=b.Node=function(a,b){this.id=a;this.data=void 0!==b?b:{}},f=b.Edge=function(a,b,c,d){this.id=a;this.source=b;this.target=c;this.data=void 0!==d?d:{}};d.prototype.addNode=function(a){a.id in this.nodeSet||this.nodes.push(a);
this.nodeSet[a.id]=a;this.notify();return a};d.prototype.addNodes=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],b=new e(b,{label:b});this.addNode(b)}};d.prototype.addEdge=function(a){var b=!1;this.edges.forEach(function(c){a.id===c.id&&(b=!0)});b||this.edges.push(a);a.source.id in this.adjacency||(this.adjacency[a.source.id]={});a.target.id in this.adjacency[a.source.id]||(this.adjacency[a.source.id][a.target.id]=[]);b=!1;this.adjacency[a.source.id][a.target.id].forEach(function(c){a.id===
c.id&&(b=!0)});b||this.adjacency[a.source.id][a.target.id].push(a);this.notify();return a};d.prototype.addEdges=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],c=this.nodeSet[b[0]];if(void 0==c)throw new TypeError("invalid node name: "+b[0]);var d=this.nodeSet[b[1]];if(void 0==d)throw new TypeError("invalid node name: "+b[1]);this.newEdge(c,d,b[2])}};d.prototype.newNode=function(a){a=new e(this.nextNodeId++,a);this.addNode(a);return a};d.prototype.newEdge=function(a,b,c){a=new f(this.nextEdgeId++,
a,b,c);this.addEdge(a);return a};d.prototype.loadJSON=function(a){if("string"==typeof a||a instanceof String)a=JSON.parse(a);if("nodes"in a||"edges"in a)this.addNodes.apply(this,a.nodes),this.addEdges.apply(this,a.edges)};d.prototype.getEdges=function(a,b){return a.id in this.adjacency&&b.id in this.adjacency[a.id]?this.adjacency[a.id][b.id]:[]};d.prototype.removeNode=function(a){if(void 0!=a&&null!=a){a.id in this.nodeSet&&delete this.nodeSet[a.id];for(var b=this.nodes.length-1;0<=b;b--)this.nodes[b].id===
a.id&&this.nodes.splice(b,1);this.detachNode(a)}};d.prototype.detachNode=function(a){this.edges.slice().forEach(function(b){b.source.id!==a.id&&b.target.id!==a.id||this.removeEdge(b)},this);this.notify()};d.prototype.removeEdge=function(a){for(var b=this.edges.length-1;0<=b;b--)this.edges[b].id===a.id&&this.edges.splice(b,1);for(var c in this.adjacency){for(var d in this.adjacency[c]){for(b=this.adjacency[c][d].length-1;0<=b;b--)this.adjacency[c][d][b].id===a.id&&this.adjacency[c][d].splice(b,1);
0==this.adjacency[c][d].length&&delete this.adjacency[c][d]}a:{var b=this.adjacency[c],e=void 0;for(e in b)if(b.hasOwnProperty(e)){b=!1;break a}b=!0}b&&delete this.adjacency[c]}this.notify()};d.prototype.merge=function(a){var b=[];a.nodes.forEach(function(a){b.push(this.addNode(new e(a.id,a.data)))},this);a.edges.forEach(function(a){var c=b[a.from],d=b[a.to],e=a.directed?e=a.type+"-"+c.id+"-"+d.id:c.id<d.id?a.type+"-"+c.id+"-"+d.id:a.type+"-"+d.id+"-"+c.id;this.addEdge(new f(e,c,d,a.data)).data.type=
a.type},this)};d.prototype.filterNodes=function(a){this.nodes.slice().forEach(function(b){a(b)||this.removeNode(b)},this)};d.prototype.filterEdges=function(a){this.edges.slice().forEach(function(b){a(b)||this.removeEdge(b)},this)};d.prototype.addGraphListener=function(a){this.eventListeners.push(a)};d.prototype.notify=function(){this.eventListeners.forEach(function(a){a.graphChanged()})};var g=b.Layout={};g.ForceDirected=function(a,b,c,d){this.graph=a;this.stiffness=b;this.repulsion=c;this.damping=
d;this.nodePoints={};this.edgeSprings={}};g.ForceDirected.prototype.point=function(a){if(!(a.id in this.nodePoints)){var b=void 0!==a.data.mass?a.data.mass:10;this.nodePoints[a.id]=new g.ForceDirected.Point(h.random(),b)}return this.nodePoints[a.id]};g.ForceDirected.prototype.spring=function(a){if(!(a.id in this.edgeSprings)){var b=void 0!==a.data.length?a.data.length:1,c=!1,d=this.graph.getEdges(a.source,a.target);d.forEach(function(a){!1===c&&a.id in this.edgeSprings&&(c=this.edgeSprings[a.id])},
this);if(!1!==c)return new g.ForceDirected.Spring(c.point1,c.point2,0,0);this.graph.getEdges(a.target,a.source);d.forEach(function(a){!1===c&&a.id in this.edgeSprings&&(c=this.edgeSprings[a.id])},this);if(!1!==c)return new g.ForceDirected.Spring(c.point2,c.point1,0,0);d=void 0==a.data||void 0==a.data.stiffness?this.stiffness:a.data.stiffness;this.edgeSprings[a.id]=new g.ForceDirected.Spring(this.point(a.source),this.point(a.target),b,d)}return this.edgeSprings[a.id]};g.ForceDirected.prototype.eachNode=
function(a){var b=this;this.graph.nodes.forEach(function(c){a.call(b,c,b.point(c))})};g.ForceDirected.prototype.eachEdge=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,c,b.spring(c))})};g.ForceDirected.prototype.eachSpring=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,b.spring(c))})};g.ForceDirected.prototype.applyCoulombsLaw=function(){this.eachNode(function(a,b){this.eachNode(function(a,c){if(b!==c){var d=b.p.subtract(c.p),e=d.magnitude()+.1,d=d.normalise();
b.applyForce(d.multiply(this.repulsion).divide(e*e*.5));c.applyForce(d.multiply(this.repulsion).divide(e*e*-.5))}})})};g.ForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(a){var b=a.point2.p.subtract(a.point1.p),c=a.length-b.magnitude(),b=b.normalise();a.point1.applyForce(b.multiply(a.k*c*-.5));a.point2.applyForce(b.multiply(a.k*c*.5))})};g.ForceDirected.springyCenterAttraction=100;g.ForceDirected.prototype.attractToCentre=function(){this.eachNode(function(a,b){var c=b.p.multiply(-1);
b.applyForce(c.multiply(this.repulsion/g.ForceDirected.springyCenterAttraction))})};g.ForceDirected.prototype.updateVelocity=function(a){this.eachNode(function(b,c){c.v=c.v.add(c.a.multiply(a)).multiply(this.damping);c.a=new h(0,0,0)})};g.ForceDirected.prototype.updatePosition=function(a){this.eachNode(function(b,c){c.p=c.p.add(c.v.multiply(a))})};g.ForceDirected.prototype.totalEnergy=function(a){var b=0;this.eachNode(function(a,c){var d=c.v.magnitude();b+=.5*c.m*d*d});return b};b.requestAnimationFrame=
function(a,b){return function(){return a.apply(b,arguments)}}(a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b,c){a.setTimeout(b,10)},a);g.ForceDirected.prototype.start=function(a,c){var d=this;this._started||(this._started=!0,this._stop=!1,b.requestAnimationFrame(function t(){d.applyCoulombsLaw();d.applyHookesLaw();d.attractToCentre();d.updateVelocity(.03);d.updatePosition(.03);void 0!==a&&a();d._stop||
.01>d.totalEnergy()?(d._started=!1,void 0!==c&&c()):b.requestAnimationFrame(t)}))};g.ForceDirected.prototype.stop=function(){this._stop=!0};g.ForceDirected.prototype.nearest=function(a){var b={node:null,point:null,distance:null},c=this;this.graph.nodes.forEach(function(d){var e=c.point(d),f=e.p.subtract(a).magnitude();if(null===b.distance||f<b.distance)b={node:d,point:e,distance:f}});return b};g.ForceDirected.prototype.getBoundingBox=function(){var a=new h(-2,-2,-2),b=new h(2,2,2);c||(a=new h(-2,
0,-2),b=new h(2,0,2));this.eachNode(function(c,d){d.p.x<a.x&&(a.x=d.p.x);d.p.y<a.y&&(a.y=d.p.y);d.p.z<a.z&&(a.z=d.p.z);d.p.x>b.x&&(b.x=d.p.x);d.p.y>b.y&&(b.y=d.p.y);d.p.z>b.z&&(b.z=d.p.z)});var d=b.subtract(a).multiply(.07);return{bottomleftclose:a.subtract(d),toprightfar:b.add(d)}};var h=b.Vector=function(a,b,d){this.x=a;this.z=d;this.y=c?b:0};h.random=function(){return c?new h(10*(Math.random()-.5),10*(Math.random()-.5),10*(Math.random()-.5)):new h(10*(Math.random()-.5),0,10*(Math.random()-.5))};
h.prototype.add=function(a){return c?new h(this.x+a.x,this.y+a.y,this.z+a.z):new h(this.x+a.x,0,this.z+a.z)};h.prototype.subtract=function(a){return c?new h(this.x-a.x,this.y-a.y,this.z-a.z):new h(this.x-a.x,0,this.z-a.z)};h.prototype.multiply=function(a){return c?new h(this.x*a,this.y*a,this.z*a):new h(this.x*a,0,this.z*a)};h.prototype.divide=function(a){return c?new h(this.x/a||0,this.y/a||0,this.z/a||0):new h(this.x/a||0,0,this.z/a||0)};h.prototype.magnitude=function(){return c?Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z):Math.sqrt(this.x*this.x+this.z*this.z)};h.prototype.normalise=function(){return this.divide(this.magnitude())};g.ForceDirected.Point=function(a,b){this.p=a;this.m=b;this.v=new h(0,0,0);this.a=new h(0,0,0)};g.ForceDirected.Point.prototype.applyForce=function(a){this.a=this.a.add(a.divide(this.m))};g.ForceDirected.Spring=function(a,b,c,d){this.point1=a;this.point2=b;this.length=c;this.k=d};d=b.Renderer=function(a,b,c,d){this.layout=a;this.clear=b;this.drawEdge=c;
this.drawNode=d;this.layout.graph.addGraphListener(this)};d.prototype.graphChanged=function(a){this.start()};d.prototype.start=function(){var a=this;this.layout.start(function(){a.clear();a.layout.eachEdge(function(b,c){a.drawEdge(b,c.point1.p,c.point2.p)});a.layout.eachNode(function(b,c){a.drawNode(b,c.p)})})};d.prototype.stop=function(){this.layout.stop()};Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=
Object(this),f=e.length>>>0;if("[object Function]"!={}.toString.call(a))throw new TypeError(a+" is not a function");b&&(c=b);for(d=0;d<f;){var g;d in e&&(g=e[d],a.call(c,g,d,e));d++}})}).call(this);var Utils=function(){};Utils.generateUUID=function(){var a="",b,c;for(b=0;32>b;b++){c=16*Math.random()|0;if(8==b||12==b||16==b||20==b)a+="-";a+=(12==b?4:16==b?c&3|8:c).toString(16)}return a};function hexToColor(a){var b=0,c=0,d=0,b=parseInt(a.substring(0,2),16),c=parseInt(a.substring(2,4),16),d=parseInt(a.substring(4,6),16);return new CommsColor(b,c,d,1)}function colorToHex(a){return rgbToHex(a.r)+rgbToHex(a.g)+rgbToHex(a.b)}
function rgbToHex(a){a=Number(a).toString(16);2>a.length&&(a="0"+a);return a}
function dragElement(a){function b(a){a=a||window.event;a.preventDefault();g=a.clientX;h=a.clientY;document.onmouseup=d;document.onmousemove=c}function c(b){b=b||window.event;b.preventDefault();e=g-b.clientX;f=h-b.clientY;g=b.clientX;h=b.clientY;a.style.top=a.offsetTop-f+"px";a.style.left=a.offsetLeft-e+"px"}function d(){document.onmouseup=null;document.onmousemove=null}var e=0,f=0,g=0,h=0;document.getElementById(a.id+"header")?document.getElementById(a.id+"header").onmousedown=b:a.onmousedown=b}
;WebGLUtils=function(){var a=function(a,c){for(var d=["webgl","experimental-webgl","webkit-3d","moz-webgl"],e=null,f=0;f<d.length;++f){try{e=a.getContext(d[f],c)}catch(g){}if(e)break}return e};return{create3DContext:a,setupWebGL:function(b,c,d){function e(a){var c=b.parentNode;if(c){var d=window.WebGLRenderingContext?'It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>':'This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>';
a&&(d+="<br/><br/>Status: "+a);c.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+d+"</div></div></td></tr></table>"}}d=d||e;b.addEventListener&&b.addEventListener("webglcontextcreationerror",function(a){d(a.statusMessage)},!1);(c=a(b,c))||window.WebGLRenderingContext||d("");return c}}}();
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1E3/60)}}();var FormattingUtils=function(){};FormattingUtils.prototype.convertRGBAColorToHex=function(a){return FormattingUtils.prototype.rgbToHex(a[0],a[1],a[2])};FormattingUtils.prototype.convertHexColorToRGBA=function(a){a="#"==a.substr(0,1)?a.substr(1):a;return[parseInt(a.substr(0,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(4,2),16)]};FormattingUtils.prototype.componentToHex=function(a){a=a.toString(16);return 1==a.length?"0"+a:a};
FormattingUtils.prototype.rgbToHex=function(a,b,c){return"#"+FormattingUtils.prototype.componentToHex(a)+FormattingUtils.prototype.componentToHex(b)+FormattingUtils.prototype.componentToHex(c)};(function(){var a=function(a){THREE.MeshBasicMaterial.call(this);this.depthWrite=this.depthTest=!1;this.side=THREE.FrontSide;this.transparent=!0;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var b=function(a){THREE.LineBasicMaterial.call(this);this.depthWrite=this.depthTest=
!1;this.transparent=!0;this.linewidth=1;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype);THREE.TransformGizmo=function(){var a=this;this.init=function(){THREE.Object3D.call(this);this.handles=new THREE.Object3D;this.pickers=new THREE.Object3D;this.planes=new THREE.Object3D;
this.add(this.handles);this.add(this.pickers);this.add(this.planes);var a=new THREE.PlaneGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({wireframe:!0});b.side=THREE.DoubleSide;a={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=a.XYZE;a.YZ.rotation.set(0,Math.PI/2,0);a.XZ.rotation.set(-Math.PI/2,0,0);for(var c in a)a[c].name=c,this.planes.add(a[c]),this.planes[c]=a[c],a[c].visible=!1;a=function(a,b){for(var d in a)for(c=a[d].length;c--;){var e=
a[d][c][0],l=a[d][c][1],n=a[d][c][2];e.name=d;l&&e.position.set(l[0],l[1],l[2]);n&&e.rotation.set(n[0],n[1],n[2]);b.add(e)}};a(this.handleGizmos,this.handles);a(this.pickerGizmos,this.pickers);this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var b=new THREE.Geometry;b.merge(a.geometry,a.matrix);a.geometry=b;a.position.set(0,0,0);a.rotation.set(0,0,0);a.scale.set(1,1,1)}})};this.hide=function(){this.traverse(function(a){a.visible=!1})};this.show=function(){this.traverse(function(b){b.visible=
!0;b.parent==a.pickers&&(b.visible=!1);b.parent==a.planes&&(b.visible=!1)});this.activePlane.visible=!1};this.highlight=function(a){this.traverse(function(b){b.material&&b.material.highlight&&(b.name==a?b.material.highlight(!0):b.material.highlight(!1))})}};THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformGizmo.prototype.update=function(a,b){var e=new THREE.Vector3(0,0,0),f=new THREE.Vector3(0,1,0),g=new THREE.Matrix4;this.traverse(function(h){-1!=h.name.search("E")?
h.quaternion.setFromRotationMatrix(g.lookAt(b,e,f)):-1==h.name.search("X")&&-1==h.name.search("Y")&&-1==h.name.search("Z")||h.quaternion.setFromEuler(a)})};THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);var c=new THREE.Geometry,d=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,!1));d.position.y=.5;d.updateMatrix();c.merge(d.geometry,d.matrix);d=new THREE.Geometry;d.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0));var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,
0,0),new THREE.Vector3(0,1,0));var f=new THREE.Geometry;f.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(d,new b({color:16711680}))]],Y:[[new THREE.Mesh(c,new a({color:65280})),[0,.5,0]],[new THREE.Line(e,new b({color:65280}))]],Z:[[new THREE.Mesh(c,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(f,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,
0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneGeometry(.29,.29),new a({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,
opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new a({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneGeometry(.4,.4),new a({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneGeometry(.4,
.4),new a({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneGeometry(.4,.4),new a({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=
this.planes.YZ));"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"==a&&(this.activePlane=this.planes.XYZE);"XY"==a&&(this.activePlane=this.planes.XY);"YZ"==a&&(this.activePlane=this.planes.YZ);"XZ"==a&&(this.activePlane=this.planes.XZ);this.hide();this.show()};this.init()};THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var c=function(a,
b,c){var g=new THREE.Geometry;c=c?c:1;for(var h=0;h<=64*c;++h)"x"==b&&g.vertices.push((new THREE.Vector3(0,Math.cos(h/32*Math.PI),Math.sin(h/32*Math.PI))).multiplyScalar(a)),"y"==b&&g.vertices.push((new THREE.Vector3(Math.cos(h/32*Math.PI),0,Math.sin(h/32*Math.PI))).multiplyScalar(a)),"z"==b&&g.vertices.push((new THREE.Vector3(Math.sin(h/32*Math.PI),Math.cos(h/32*Math.PI),0)).multiplyScalar(a));return g};this.handleGizmos={X:[[new THREE.Line(new c(1,"x",.5),new b({color:16711680}))]],Y:[[new THREE.Line(new c(1,
"y",.5),new b({color:65280}))]],Z:[[new THREE.Line(new c(1,"z",.5),new b({color:255}))]],E:[[new THREE.Line(new c(1.25,"z",1),new b({color:13421568}))]],XYZE:[[new THREE.Line(new c(1,"z",1),new b({color:7895160}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(1,
.12,4,12,Math.PI),new a({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new a({color:16776960,opacity:.25}))]],XYZE:[[new THREE.Mesh(new THREE.Geometry)]]};this.setActivePlane=function(a){"E"==a&&(this.activePlane=this.planes.XYZE);"X"==a&&(this.activePlane=this.planes.YZ);"Y"==a&&(this.activePlane=this.planes.XZ);"Z"==a&&(this.activePlane=this.planes.XY);this.hide();this.show()};this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,
arguments);var c=new THREE.Matrix4,g=new THREE.Euler(0,0,1),h=new THREE.Quaternion,k=new THREE.Vector3(1,0,0),m=new THREE.Vector3(0,1,0),l=new THREE.Vector3(0,0,1),n=new THREE.Quaternion,t=new THREE.Quaternion,q=new THREE.Quaternion,u=b.clone();g.copy(this.planes.XY.rotation);h.setFromEuler(g);c.makeRotationFromQuaternion(h).getInverse(c);u.applyMatrix4(c);this.traverse(function(a){h.setFromEuler(g);"X"==a.name&&(n.setFromAxisAngle(k,Math.atan2(-u.y,u.z)),h.multiplyQuaternions(h,n),a.quaternion.copy(h));
"Y"==a.name&&(t.setFromAxisAngle(m,Math.atan2(u.x,u.z)),h.multiplyQuaternions(h,t),a.quaternion.copy(h));"Z"==a.name&&(q.setFromAxisAngle(l,Math.atan2(u.y,u.x)),h.multiplyQuaternions(h,q),a.quaternion.copy(h))})};this.init()};THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);var c=new THREE.Geometry,d=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125));d.position.y=.5;d.updateMatrix();c.merge(d.geometry,
d.matrix);d=new THREE.Geometry;d.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0));var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var f=new THREE.Geometry;f.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(d,new b({color:16711680}))]],Y:[[new THREE.Mesh(c,new a({color:65280})),[0,.5,0]],[new THREE.Line(e,new b({color:65280}))]],
Z:[[new THREE.Mesh(c,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(f,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,
0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new a({color:16777215,opacity:.25}))]]};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));
"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"==a&&(this.activePlane=this.planes.XYZE);this.hide();this.show()};this.init()};THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformControls=function(a,b,e,f,g,h){function k(a){void 0!==q.object&&!0!==u&&(a.preventDefault(),(a=t(a.touches?a.touches[0]:a,q.gizmo[p].pickers.children))?(q.axis=a.object.name,q.update(),q.dispatchEvent(v)):null!==q.axis&&
(q.axis=null,q.update(),q.dispatchEvent(v)))}function m(a){if(void 0!==q.object&&!0!==u){a=a.touches?a.touches[0]:a;if(0===a.button||void 0===a.button){var b=t(a,q.gizmo[p].pickers.children);b&&(q.axis=b.object.name,q.update(),L.copy(na).sub($).normalize(),q.gizmo[p].setActivePlane(q.axis,L),a=t(a,[q.gizmo[p].activePlane]),ba.copy(q.object.position),V.copy(q.object.scale),h||q.visualizationSandbox.saveSelectedNodeLocations(),q.visualizationSandbox.setCanRotate(!1),S.extractRotation(q.object.matrix),
P.extractRotation(q.object.matrixWorld),I.extractRotation(q.object.parent.matrixWorld),Y.setFromMatrixScale(A.getInverse(q.object.parent.matrixWorld)),M.copy(a.point))}u=!0}}function l(a){if(void 0!==q.object&&null!==q.axis&&!1!==u){a=t(a.touches?a.touches[0]:a,[q.gizmo[p].activePlane]);y.copy(a.point);if("translate"==p){y.sub(M);y.multiply(Y);"local"==q.space&&(y.applyMatrix4(A.getInverse(P)),-1==q.axis.search("X")&&(y.x=0),-1==q.axis.search("Y")&&(y.y=0),-1==q.axis.search("Z")&&(y.z=0),y.applyMatrix4(S),
q.object.position.copy(ba),q.object.position.add(y));if("world"==q.space||-1!=q.axis.search("XYZ"))-1==q.axis.search("X")&&(y.x=0),-1==q.axis.search("Y")&&(y.y=0),-1==q.axis.search("Z")&&(y.z=0),y.applyMatrix4(A.getInverse(I)),h?(q.object.position.copy(ba),q.object.position.add(y)):q.visualizationSandbox.transformUpdated(y);null!==q.snap&&(-1!=q.axis.search("X")&&(q.object.position.x=Math.round(q.object.position.x/q.snap)*q.snap),-1!=q.axis.search("Y")&&(q.object.position.y=Math.round(q.object.position.y/
q.snap)*q.snap),-1!=q.axis.search("Z")&&(q.object.position.z=Math.round(q.object.position.z/q.snap)*q.snap))}else"scale"==p?(y.sub(M),y.multiply(Y),"local"==q.space&&("XYZ"==q.axis?(H=1+y.y/50,q.object.scale.x=V.x*H,q.object.scale.y=V.y*H,q.object.scale.z=V.z*H):(y.applyMatrix4(A.getInverse(P)),"X"==q.axis&&(q.object.scale.x=V.x*(1+y.x/50)),"Y"==q.axis&&(q.object.scale.y=V.y*(1+y.y/50)),"Z"==q.axis&&(q.object.scale.z=V.z*(1+y.z/50))))):"rotate"==p&&(y.sub($),y.multiply(Y),E.copy(M).sub($),E.multiply(Y),
"E"==q.axis?(y.applyMatrix4(A.getInverse(D)),E.applyMatrix4(A.getInverse(D)),z.set(Math.atan2(y.z,y.y),Math.atan2(y.x,y.z),Math.atan2(y.y,y.x)),K.set(Math.atan2(E.z,E.y),Math.atan2(E.x,E.z),Math.atan2(E.y,E.x)),F.setFromRotationMatrix(A.getInverse(I)),T.setFromAxisAngle(L,z.z-K.z),C.setFromRotationMatrix(P),F.multiplyQuaternions(F,T),F.multiplyQuaternions(F,C),q.object.quaternion.copy(F)):"XYZE"==q.axis?(T.setFromEuler(y.clone().cross(E).normalize()),F.setFromRotationMatrix(A.getInverse(I)),G.setFromAxisAngle(T,
-y.clone().angleTo(E)),C.setFromRotationMatrix(P),F.multiplyQuaternions(F,G),F.multiplyQuaternions(F,C),q.object.quaternion.copy(F)):"local"==q.space?(y.applyMatrix4(A.getInverse(P)),E.applyMatrix4(A.getInverse(P)),z.set(Math.atan2(y.z,y.y),Math.atan2(y.x,y.z),Math.atan2(y.y,y.x)),K.set(Math.atan2(E.z,E.y),Math.atan2(E.x,E.z),Math.atan2(E.y,E.x)),C.setFromRotationMatrix(S),G.setFromAxisAngle(J,z.x-K.x),Q.setFromAxisAngle(N,z.y-K.y),Z.setFromAxisAngle(B,z.z-K.z),"X"==q.axis&&C.multiplyQuaternions(C,
G),"Y"==q.axis&&C.multiplyQuaternions(C,Q),"Z"==q.axis&&C.multiplyQuaternions(C,Z),q.object.quaternion.copy(C)):"world"==q.space&&(z.set(Math.atan2(y.z,y.y),Math.atan2(y.x,y.z),Math.atan2(y.y,y.x)),K.set(Math.atan2(E.z,E.y),Math.atan2(E.x,E.z),Math.atan2(E.y,E.x)),F.setFromRotationMatrix(A.getInverse(I)),G.setFromAxisAngle(J,z.x-K.x),Q.setFromAxisAngle(N,z.y-K.y),Z.setFromAxisAngle(B,z.z-K.z),C.setFromRotationMatrix(P),"X"==q.axis&&F.multiplyQuaternions(F,G),"Y"==q.axis&&F.multiplyQuaternions(F,Q),
"Z"==q.axis&&F.multiplyQuaternions(F,Z),F.multiplyQuaternions(F,C),q.object.quaternion.copy(F)));q.update();q.dispatchEvent(v)}}function n(a){u=!1;k(a);h||q.visualizationSandbox.clearSelectedNodeLocations();q.visualizationSandbox.setCanRotate(!0)}function t(a,c){if(g){var e=new THREE.Vector3(f.x,f.y,1);w.unprojectVector(e,b);x.set(b.position,e.sub(b.position).normalize())}else{var h=new THREE.Vector3,e=new THREE.Vector3(f.x,f.y,1);e.set(f.x,f.y,-1);w.unprojectVector(e,b);h.set(0,0,-1).transformDirection(b.matrixWorld);
x.set(e,h)}e=x.intersectObjects(c);return e[0]?e[0]:!1}THREE.Object3D.call(this);e=void 0!==e?e:document;this.noCallbacks=h;this.visualizationSandbox=a;this.gizmo={};this.gizmo.translate=new THREE.TransformGizmoTranslate;this.gizmo.rotate=new THREE.TransformGizmoRotate;this.gizmo.scale=new THREE.TransformGizmoScale;this.add(this.gizmo.translate);this.add(this.gizmo.rotate);this.add(this.gizmo.scale);this.gizmo.translate.hide();this.gizmo.rotate.hide();this.gizmo.scale.hide();this.object=void 0;this.snap=
null;this.space="world";this.size=1;this.axis=null;var q=this,u=!1,p="translate",v={type:"change"},x=new THREE.Raycaster,w=new THREE.Projector;new THREE.Vector3;var y=new THREE.Vector3,M=new THREE.Vector3,z=new THREE.Vector3,K=new THREE.Vector3,H=1,D=new THREE.Matrix4,L=new THREE.Vector3,A=new THREE.Matrix4,E=new THREE.Vector3,F=new THREE.Quaternion,J=new THREE.Vector3(1,0,0),N=new THREE.Vector3(0,1,0),B=new THREE.Vector3(0,0,1),C=new THREE.Quaternion,G=new THREE.Quaternion,Q=new THREE.Quaternion,
Z=new THREE.Quaternion,T=new THREE.Quaternion,ba=new THREE.Vector3,V=new THREE.Vector3,S=new THREE.Matrix4,I=new THREE.Matrix4,Y=new THREE.Vector3,$=new THREE.Vector3,ca=new THREE.Euler,P=new THREE.Matrix4,na=new THREE.Vector3,ua=new THREE.Euler;e.addEventListener("mousedown",m,!1);e.addEventListener("touchstart",m,!1);e.addEventListener("mousemove",k,!1);e.addEventListener("touchmove",k,!1);e.addEventListener("mousemove",l,!1);e.addEventListener("touchmove",l,!1);e.addEventListener("mouseup",n,!1);
e.addEventListener("mouseout",n,!1);e.addEventListener("touchend",n,!1);e.addEventListener("touchcancel",n,!1);e.addEventListener("touchleave",n,!1);this.attach=function(a){q.object=a;this.gizmo.translate.hide();this.gizmo.rotate.hide();this.gizmo.scale.hide();this.gizmo[p].show();q.update()};this.detach=function(){this.axis=q.object=void 0;this.gizmo.translate.hide();this.gizmo.rotate.hide();this.gizmo.scale.hide()};this.setMode=function(a){p=a?a:p;"scale"==p&&(q.space="local");this.gizmo.translate.hide();
this.gizmo.rotate.hide();this.gizmo.scale.hide();this.gizmo[p].show();this.update();q.dispatchEvent(v)};this.getMode=function(){return p};this.setSnap=function(a){q.snap=a};this.setSize=function(a){q.size=a;this.update();q.dispatchEvent(v)};this.setSpace=function(a){q.space=a;this.update();q.dispatchEvent(v)};this.update=function(){void 0!==q.object&&(q.object.updateMatrixWorld(),$.setFromMatrixPosition(q.object.matrixWorld),ca.setFromRotationMatrix(A.extractRotation(q.object.matrixWorld)),b.updateMatrixWorld(),
na.setFromMatrixPosition(b.matrixWorld),ua.setFromRotationMatrix(A.extractRotation(b.matrixWorld)),H=$.distanceTo(na)/6*q.size,this.position.copy($),this.scale.set(H,H,H),L.copy(na).sub($).normalize(),"local"==q.space?this.gizmo[p].update(ca,L):"world"==q.space&&this.gizmo[p].update(new THREE.Euler,L),this.gizmo[p].highlight(q.axis))}};THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)})();/*
 For open source use: GPLv3
          For commercial use: JSColor Commercial License
 @author  Jan Odvarko
 @version 2.0.5

 See usage examples at http://jscolor.com/examples/
*/
window.jscolor||(window.jscolor=function(){var a={register:function(){a.attachDOMReadyEvent(a.init);a.attachEvent(document,"mousedown",a.onDocumentMouseDown);a.attachEvent(document,"touchstart",a.onDocumentTouchStart);a.attachEvent(window,"resize",a.onWindowResize)},init:function(){a.jscolor.lookupClass&&a.jscolor.installByClassName(a.jscolor.lookupClass)},tryInstallOnElements:function(b,c){for(var d=new RegExp("(^|\\s)("+c+")(\\s*(\\{[^}]*\\})|\\s|$)","i"),e=0;e<b.length;e+=1)if(void 0===b[e].type||
"color"!=b[e].type.toLowerCase()||!a.isColorAttrSupported){var f;if(!b[e].jscolor&&b[e].className&&(f=b[e].className.match(d))){var g=b[e],h=null,k=a.getDataAttr(g,"jscolor");null!==k?h=k:f[4]&&(h=f[4]);k={};if(h)try{k=(new Function("return ("+h+")"))()}catch(m){a.warn("Error parsing jscolor options: "+m+":\n"+h)}g.jscolor=new a.jscolor(g,k)}}},isColorAttrSupported:function(){var a=document.createElement("input");return a.setAttribute&&(a.setAttribute("type","color"),"color"==a.type.toLowerCase())?
!0:!1}(),isCanvasSupported:function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}(),fetchElement:function(a){return"string"===typeof a?document.getElementById(a):a},isElementType:function(a,c){return a.nodeName.toLowerCase()===c.toLowerCase()},getDataAttr:function(a,c){var d=a.getAttribute("data-"+c);return null!==d?d:null},attachEvent:function(a,c,d){a.addEventListener?a.addEventListener(c,d,!1):a.attachEvent&&a.attachEvent("on"+c,d)},detachEvent:function(a,
c,d){a.removeEventListener?a.removeEventListener(c,d,!1):a.detachEvent&&a.detachEvent("on"+c,d)},_attachedGroupEvents:{},attachGroupEvent:function(b,c,d,e){a._attachedGroupEvents.hasOwnProperty(b)||(a._attachedGroupEvents[b]=[]);a._attachedGroupEvents[b].push([c,d,e]);a.attachEvent(c,d,e)},detachGroupEvents:function(b){if(a._attachedGroupEvents.hasOwnProperty(b)){for(var c=0;c<a._attachedGroupEvents[b].length;c+=1){var d=a._attachedGroupEvents[b][c];a.detachEvent(d[0],d[1],d[2])}delete a._attachedGroupEvents[b]}},
attachDOMReadyEvent:function(a){var c=!1,d=function(){c||(c=!0,a())};if("complete"===document.readyState)setTimeout(d,1);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",d,!1),window.addEventListener("load",d,!1);else if(document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),d())}),window.attachEvent("onload",d),document.documentElement.doScroll&&window==
window.top)){var e=function(){if(document.body)try{document.documentElement.doScroll("left"),d()}catch(a){setTimeout(e,1)}};e()}},warn:function(a){window.console&&window.console.warn&&window.console.warn(a)},preventDefault:function(a){a.preventDefault&&a.preventDefault();a.returnValue=!1},captureTarget:function(b){b.setCapture&&(a._capturedTarget=b,a._capturedTarget.setCapture())},releaseTarget:function(){a._capturedTarget&&(a._capturedTarget.releaseCapture(),a._capturedTarget=null)},fireEvent:function(a,
c){if(a)if(document.createEvent){var d=document.createEvent("HTMLEvents");d.initEvent(c,!0,!0);a.dispatchEvent(d)}else if(document.createEventObject)d=document.createEventObject(),a.fireEvent("on"+c,d);else if(a["on"+c])a["on"+c]()},classNameToList:function(a){return a.replace(/^\s+|\s+$/g,"").split(/\s+/)},hasClass:function(a,c){return c?-1!=(" "+a.className.replace(/\s+/g," ")+" ").indexOf(" "+c+" "):!1},setClass:function(b,c){for(var d=a.classNameToList(c),e=0;e<d.length;e+=1)a.hasClass(b,d[e])||
(b.className+=(b.className?" ":"")+d[e])},unsetClass:function(b,c){for(var d=a.classNameToList(c),e=0;e<d.length;e+=1)b.className=b.className.replace(new RegExp("^\\s*"+d[e]+"\\s*|\\s*"+d[e]+"\\s*$|\\s+"+d[e]+"(\\s+)","g"),"$1")},getStyle:function(a){return window.getComputedStyle?window.getComputedStyle(a):a.currentStyle},setStyle:function(){var a=document.createElement("div"),c=function(c){for(var d=0;d<c.length;d+=1)if(c[d]in a.style)return c[d]},d={borderRadius:c(["borderRadius","MozBorderRadius",
"webkitBorderRadius"]),boxShadow:c(["boxShadow","MozBoxShadow","webkitBoxShadow"])};return function(a,b,c){switch(b.toLowerCase()){case "opacity":b=Math.round(100*parseFloat(c));a.style.opacity=c;a.style.filter="alpha(opacity="+b+")";break;default:a.style[d[b]]=c}}}(),setBorderRadius:function(b,c){a.setStyle(b,"borderRadius",c||"0")},setBoxShadow:function(b,c){a.setStyle(b,"boxShadow",c||"none")},getElementPos:function(b,c){var d=0,e=0,e=b.getBoundingClientRect(),d=e.left,e=e.top;if(!c)var f=a.getViewPos(),
d=d+f[0],e=e+f[1];return[d,e]},getElementSize:function(a){return[a.offsetWidth,a.offsetHeight]},getAbsPointerPos:function(a){a||(a=window.event);var c=0,d=0;"undefined"!==typeof a.changedTouches&&a.changedTouches.length?(c=a.changedTouches[0].clientX,d=a.changedTouches[0].clientY):"number"===typeof a.clientX&&(c=a.clientX,d=a.clientY);return{x:c,y:d}},getRelPointerPos:function(a){a||(a=window.event);var c=(a.target||a.srcElement).getBoundingClientRect(),d=0,e=0,e=d=0;"undefined"!==typeof a.changedTouches&&
a.changedTouches.length?(d=a.changedTouches[0].clientX,e=a.changedTouches[0].clientY):"number"===typeof a.clientX&&(d=a.clientX,e=a.clientY);d-=c.left;e-=c.top;return{x:d,y:e}},getViewPos:function(){var a=document.documentElement;return[(window.pageXOffset||a.scrollLeft)-(a.clientLeft||0),(window.pageYOffset||a.scrollTop)-(a.clientTop||0)]},getViewSize:function(){var a=document.documentElement;return[window.innerWidth||a.clientWidth,window.innerHeight||a.clientHeight]},redrawPosition:function(){if(a.picker&&
a.picker.owner){var b=a.picker.owner,c,d;b.fixed?(c=a.getElementPos(b.targetElement,!0),d=[0,0]):(c=a.getElementPos(b.targetElement),d=a.getViewPos());var e=a.getElementSize(b.targetElement),f=a.getViewSize(),g=a.getPickerOuterDims(b),h,k,m;switch(b.position.toLowerCase()){case "left":h=1;k=0;m=-1;break;case "right":h=1;k=0;m=1;break;case "top":h=0;k=1;m=-1;break;default:h=0,m=k=1}var l=(e[k]+g[k])/2;d=b.smartPosition?[-d[h]+c[h]+g[h]>f[h]?-d[h]+c[h]+e[h]/2>f[h]/2&&0<=c[h]+e[h]-g[h]?c[h]+e[h]-g[h]:
c[h]:c[h],-d[k]+c[k]+e[k]+g[k]-l+l*m>f[k]?-d[k]+c[k]+e[k]/2>f[k]/2&&0<=c[k]+e[k]-l-l*m?c[k]+e[k]-l-l*m:c[k]+e[k]-l+l*m:0<=c[k]+e[k]-l+l*m?c[k]+e[k]-l+l*m:c[k]+e[k]-l-l*m]:[c[h],c[k]+e[k]-l+l*m];a._drawPosition(b,d[h],d[k],b.fixed?"fixed":"absolute",(d[0]+g[0]>c[0]||d[0]<c[0]+e[0])&&d[1]+g[1]<c[1]+e[1])}},_drawPosition:function(b,c,d,e,f){f=f?0:b.shadowBlur;a.picker.wrap.style.position=e;a.picker.wrap.style.left=c+"px";a.picker.wrap.style.top=d+"px";a.setBoxShadow(a.picker.boxS,b.shadow?new a.BoxShadow(0,
f,b.shadowBlur,0,b.shadowColor):null)},getPickerDims:function(b){var c=!!a.getSliderComponent(b);return[2*b.insetWidth+2*b.padding+b.width+(c?2*b.insetWidth+a.getPadToSliderPadding(b)+b.sliderSize:0),2*b.insetWidth+2*b.padding+b.height+(b.closable?2*b.insetWidth+b.padding+b.buttonHeight:0)]},getPickerOuterDims:function(b){var c=a.getPickerDims(b);return[c[0]+2*b.borderWidth,c[1]+2*b.borderWidth]},getPadToSliderPadding:function(a){return Math.max(a.padding,1.5*(2*a.pointerBorderWidth+a.pointerThickness))},
getPadYComponent:function(a){switch(a.mode.charAt(1).toLowerCase()){case "v":return"v"}return"s"},getSliderComponent:function(a){if(2<a.mode.length)switch(a.mode.charAt(2).toLowerCase()){case "s":return"s";case "v":return"v"}return null},onDocumentMouseDown:function(b){b||(b=window.event);var c=b.target||b.srcElement;if(c._jscLinkedInstance)c._jscLinkedInstance.showOnClick&&c._jscLinkedInstance.show();else if(c._jscControlName)a.onControlPointerStart(b,c,c._jscControlName,"mouse");else a.picker&&
a.picker.owner&&a.picker.owner.hide()},onDocumentTouchStart:function(b){b||(b=window.event);var c=b.target||b.srcElement;if(c._jscLinkedInstance)c._jscLinkedInstance.showOnClick&&c._jscLinkedInstance.show();else if(c._jscControlName)a.onControlPointerStart(b,c,c._jscControlName,"touch");else a.picker&&a.picker.owner&&a.picker.owner.hide()},onWindowResize:function(b){a.redrawPosition()},onParentScroll:function(b){a.picker&&a.picker.owner&&a.picker.owner.hide()},_pointerMoveEvent:{mouse:"mousemove",
touch:"touchmove"},_pointerEndEvent:{mouse:"mouseup",touch:"touchend"},_pointerOrigin:null,_capturedTarget:null,onControlPointerStart:function(b,c,d,e){var f=c._jscInstance;a.preventDefault(b);a.captureTarget(c);var g=function(f,g){a.attachGroupEvent("drag",f,a._pointerMoveEvent[e],a.onDocumentPointerMove(b,c,d,e,g));a.attachGroupEvent("drag",f,a._pointerEndEvent[e],a.onDocumentPointerEnd(b,c,d,e))};g(document,[0,0]);if(window.parent&&window.frameElement){var h=window.frameElement.getBoundingClientRect();
g(window.parent.window.document,[-h.left,-h.top])}g=a.getAbsPointerPos(b);h=a.getRelPointerPos(b);a._pointerOrigin={x:g.x-h.x,y:g.y-h.y};switch(d){case "pad":switch(a.getSliderComponent(f)){case "s":0===f.hsv[1]&&f.fromHSV(null,100,null);break;case "v":0===f.hsv[2]&&f.fromHSV(null,null,100)}a.setPad(f,b,0,0);break;case "sld":a.setSld(f,b,0)}a.dispatchFineChange(f)},onDocumentPointerMove:function(b,c,d,e,f){return function(b){var e=c._jscInstance;switch(d){case "pad":b||(b=window.event);a.setPad(e,
b,f[0],f[1]);a.dispatchFineChange(e);break;case "sld":b||(b=window.event),a.setSld(e,b,f[1]),a.dispatchFineChange(e)}}},onDocumentPointerEnd:function(b,c,d,e){return function(b){b=c._jscInstance;a.detachGroupEvents("drag");a.releaseTarget();a.dispatchChange(b)}},dispatchChange:function(b){b.valueElement&&a.isElementType(b.valueElement,"input")&&a.fireEvent(b.valueElement,"change")},dispatchFineChange:function(a){a.onFineChange&&("string"===typeof a.onFineChange?new Function(a.onFineChange):a.onFineChange).call(a)},
setPad:function(b,c,d,e){c=a.getAbsPointerPos(c);d=360/(b.width-1)*(d+c.x-a._pointerOrigin.x-b.padding-b.insetWidth);e=100-100/(b.height-1)*(e+c.y-a._pointerOrigin.y-b.padding-b.insetWidth);switch(a.getPadYComponent(b)){case "s":b.fromHSV(d,e,null,a.leaveSld);break;case "v":b.fromHSV(d,null,e,a.leaveSld)}},setSld:function(b,c,d){c=a.getAbsPointerPos(c);d=100-100/(b.height-1)*(d+c.y-a._pointerOrigin.y-b.padding-b.insetWidth);switch(a.getSliderComponent(b)){case "s":b.fromHSV(null,d,null,a.leavePad);
break;case "v":b.fromHSV(null,null,d,a.leavePad)}},_vmlNS:"jsc_vml_",_vmlCSS:"jsc_vml_css_",_vmlReady:!1,initVML:function(){if(!a._vmlReady){var b=document;b.namespaces[a._vmlNS]||b.namespaces.add(a._vmlNS,"urn:schemas-microsoft-com:vml");if(!b.styleSheets[a._vmlCSS]){var c="shape shapetype group background path formulas handles fill stroke shadow textbox textpath imagedata line polyline curve rect roundrect oval arc image".split(" "),b=b.createStyleSheet();b.owningElement.id=a._vmlCSS;for(var d=
0;d<c.length;d+=1)b.addRule(a._vmlNS+"\\:"+c[d],"behavior:url(#default#VML);")}a._vmlReady=!0}},createPalette:function(){var b={elm:null,draw:null};if(a.isCanvasSupported){var c=document.createElement("canvas"),d=c.getContext("2d"),e=function(a,b,e){c.width=a;c.height=b;d.clearRect(0,0,c.width,c.height);a=d.createLinearGradient(0,0,c.width,0);a.addColorStop(0,"#F00");a.addColorStop(1/6,"#FF0");a.addColorStop(2/6,"#0F0");a.addColorStop(.5,"#0FF");a.addColorStop(4/6,"#00F");a.addColorStop(5/6,"#F0F");
a.addColorStop(1,"#F00");d.fillStyle=a;d.fillRect(0,0,c.width,c.height);a=d.createLinearGradient(0,0,0,c.height);switch(e.toLowerCase()){case "s":a.addColorStop(0,"rgba(255,255,255,0)");a.addColorStop(1,"rgba(255,255,255,1)");break;case "v":a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(1,"rgba(0,0,0,1)")}d.fillStyle=a;d.fillRect(0,0,c.width,c.height)};b.elm=c}else{a.initVML();var f=document.createElement("div");f.style.position="relative";f.style.overflow="hidden";var g=document.createElement(a._vmlNS+
":fill");g.type="gradient";g.method="linear";g.angle="90";g.colors="16.67% #F0F, 33.33% #00F, 50% #0FF, 66.67% #0F0, 83.33% #FF0";var h=document.createElement(a._vmlNS+":rect");h.style.position="absolute";h.style.left="-1px";h.style.top="-1px";h.stroked=!1;h.appendChild(g);f.appendChild(h);var k=document.createElement(a._vmlNS+":fill");k.type="gradient";k.method="linear";k.angle="180";k.opacity="0";var m=document.createElement(a._vmlNS+":rect");m.style.position="absolute";m.style.left="-1px";m.style.top=
"-1px";m.stroked=!1;m.appendChild(k);f.appendChild(m);e=function(a,b,c){f.style.width=a+"px";f.style.height=b+"px";h.style.width=m.style.width=a+1+"px";h.style.height=m.style.height=b+1+"px";g.color="#F00";g.color2="#F00";switch(c.toLowerCase()){case "s":k.color=k.color2="#FFF";break;case "v":k.color=k.color2="#000"}};b.elm=f}b.draw=e;return b},createSliderGradient:function(){var b={elm:null,draw:null};if(a.isCanvasSupported){var c=document.createElement("canvas"),d=c.getContext("2d"),e=function(a,
b,e,f){c.width=a;c.height=b;d.clearRect(0,0,c.width,c.height);a=d.createLinearGradient(0,0,0,c.height);a.addColorStop(0,e);a.addColorStop(1,f);d.fillStyle=a;d.fillRect(0,0,c.width,c.height)};b.elm=c}else{a.initVML();var f=document.createElement("div");f.style.position="relative";f.style.overflow="hidden";var g=document.createElement(a._vmlNS+":fill");g.type="gradient";g.method="linear";g.angle="180";var h=document.createElement(a._vmlNS+":rect");h.style.position="absolute";h.style.left="-1px";h.style.top=
"-1px";h.stroked=!1;h.appendChild(g);f.appendChild(h);e=function(a,b,c,d){f.style.width=a+"px";f.style.height=b+"px";h.style.width=a+1+"px";h.style.height=b+1+"px";g.color=c;g.color2=d};b.elm=f}b.draw=e;return b},leaveValue:1,leaveStyle:2,leavePad:4,leaveSld:8,BoxShadow:function(){var a=function(a,b,e,f,g,h){this.hShadow=a;this.vShadow=b;this.blur=e;this.spread=f;this.color=g;this.inset=!!h};a.prototype.toString=function(){var a=[Math.round(this.hShadow)+"px",Math.round(this.vShadow)+"px",Math.round(this.blur)+
"px",Math.round(this.spread)+"px",this.color];this.inset&&a.push("inset");return a.join(" ")};return a}(),jscolor:function(b,c){function d(a,b,c){c=c/100*255;if(null===a)return[c,c,c];a/=60;b/=100;var d=Math.floor(a),e=c*(1-b);a=c*(1-b*(d%2?a-d:1-(a-d)));switch(d){case 6:case 0:return[c,a,e];case 1:return[a,c,e];case 2:return[e,c,a];case 3:return[e,a,c];case 4:return[a,e,c];case 5:return[c,e,a]}}function e(){l._processParentElementsInDOM();a.picker||(a.picker={owner:null,wrap:document.createElement("div"),
box:document.createElement("div"),boxS:document.createElement("div"),boxB:document.createElement("div"),pad:document.createElement("div"),padB:document.createElement("div"),padM:document.createElement("div"),padPal:a.createPalette(),cross:document.createElement("div"),crossBY:document.createElement("div"),crossBX:document.createElement("div"),crossLY:document.createElement("div"),crossLX:document.createElement("div"),sld:document.createElement("div"),sldB:document.createElement("div"),sldM:document.createElement("div"),
sldGrad:a.createSliderGradient(),sldPtrS:document.createElement("div"),sldPtrIB:document.createElement("div"),sldPtrMB:document.createElement("div"),sldPtrOB:document.createElement("div"),btn:document.createElement("div"),btnT:document.createElement("span")},a.picker.pad.appendChild(a.picker.padPal.elm),a.picker.padB.appendChild(a.picker.pad),a.picker.cross.appendChild(a.picker.crossBY),a.picker.cross.appendChild(a.picker.crossBX),a.picker.cross.appendChild(a.picker.crossLY),a.picker.cross.appendChild(a.picker.crossLX),
a.picker.padB.appendChild(a.picker.cross),a.picker.box.appendChild(a.picker.padB),a.picker.box.appendChild(a.picker.padM),a.picker.sld.appendChild(a.picker.sldGrad.elm),a.picker.sldB.appendChild(a.picker.sld),a.picker.sldB.appendChild(a.picker.sldPtrOB),a.picker.sldPtrOB.appendChild(a.picker.sldPtrMB),a.picker.sldPtrMB.appendChild(a.picker.sldPtrIB),a.picker.sldPtrIB.appendChild(a.picker.sldPtrS),a.picker.box.appendChild(a.picker.sldB),a.picker.box.appendChild(a.picker.sldM),a.picker.btn.appendChild(a.picker.btnT),
a.picker.box.appendChild(a.picker.btn),a.picker.boxB.appendChild(a.picker.box),a.picker.wrap.appendChild(a.picker.boxS),a.picker.wrap.appendChild(a.picker.boxB));var b=a.picker,c=!!a.getSliderComponent(l),d=a.getPickerDims(l),e=2*l.pointerBorderWidth+l.pointerThickness+2*l.crossSize,h=a.getPadToSliderPadding(l),k=Math.min(l.borderRadius,Math.round(l.padding*Math.PI));b.wrap.style.clear="both";b.wrap.style.width=d[0]+2*l.borderWidth+"px";b.wrap.style.height=d[1]+2*l.borderWidth+"px";b.wrap.style.zIndex=
l.zIndex;b.box.style.width=d[0]+"px";b.box.style.height=d[1]+"px";b.boxS.style.position="absolute";b.boxS.style.left="0";b.boxS.style.top="0";b.boxS.style.width="100%";b.boxS.style.height="100%";a.setBorderRadius(b.boxS,k+"px");b.boxB.style.position="relative";b.boxB.style.border=l.borderWidth+"px solid";b.boxB.style.borderColor=l.borderColor;b.boxB.style.background=l.backgroundColor;a.setBorderRadius(b.boxB,k+"px");b.padM.style.background=b.sldM.style.background="#FFF";a.setStyle(b.padM,"opacity",
"0");a.setStyle(b.sldM,"opacity","0");b.pad.style.position="relative";b.pad.style.width=l.width+"px";b.pad.style.height=l.height+"px";b.padPal.draw(l.width,l.height,a.getPadYComponent(l));b.padB.style.position="absolute";b.padB.style.left=l.padding+"px";b.padB.style.top=l.padding+"px";b.padB.style.border=l.insetWidth+"px solid";b.padB.style.borderColor=l.insetColor;b.padM._jscInstance=l;b.padM._jscControlName="pad";b.padM.style.position="absolute";b.padM.style.left="0";b.padM.style.top="0";b.padM.style.width=
l.padding+2*l.insetWidth+l.width+h/2+"px";b.padM.style.height=d[1]+"px";b.padM.style.cursor="crosshair";b.cross.style.position="absolute";b.cross.style.left=b.cross.style.top="0";b.cross.style.width=b.cross.style.height=e+"px";b.crossBY.style.position=b.crossBX.style.position="absolute";b.crossBY.style.background=b.crossBX.style.background=l.pointerBorderColor;b.crossBY.style.width=b.crossBX.style.height=2*l.pointerBorderWidth+l.pointerThickness+"px";b.crossBY.style.height=b.crossBX.style.width=e+
"px";b.crossBY.style.left=b.crossBX.style.top=Math.floor(e/2)-Math.floor(l.pointerThickness/2)-l.pointerBorderWidth+"px";b.crossBY.style.top=b.crossBX.style.left="0";b.crossLY.style.position=b.crossLX.style.position="absolute";b.crossLY.style.background=b.crossLX.style.background=l.pointerColor;b.crossLY.style.height=b.crossLX.style.width=e-2*l.pointerBorderWidth+"px";b.crossLY.style.width=b.crossLX.style.height=l.pointerThickness+"px";b.crossLY.style.left=b.crossLX.style.top=Math.floor(e/2)-Math.floor(l.pointerThickness/
2)+"px";b.crossLY.style.top=b.crossLX.style.left=l.pointerBorderWidth+"px";b.sld.style.overflow="hidden";b.sld.style.width=l.sliderSize+"px";b.sld.style.height=l.height+"px";b.sldGrad.draw(l.sliderSize,l.height,"#000","#000");b.sldB.style.display=c?"block":"none";b.sldB.style.position="absolute";b.sldB.style.right=l.padding+"px";b.sldB.style.top=l.padding+"px";b.sldB.style.border=l.insetWidth+"px solid";b.sldB.style.borderColor=l.insetColor;b.sldM._jscInstance=l;b.sldM._jscControlName="sld";b.sldM.style.display=
c?"block":"none";b.sldM.style.position="absolute";b.sldM.style.right="0";b.sldM.style.top="0";b.sldM.style.width=l.sliderSize+h/2+l.padding+2*l.insetWidth+"px";b.sldM.style.height=d[1]+"px";b.sldM.style.cursor="default";b.sldPtrIB.style.border=b.sldPtrOB.style.border=l.pointerBorderWidth+"px solid "+l.pointerBorderColor;b.sldPtrOB.style.position="absolute";b.sldPtrOB.style.left=-(2*l.pointerBorderWidth+l.pointerThickness)+"px";b.sldPtrOB.style.top="0";b.sldPtrMB.style.border=l.pointerThickness+"px solid "+
l.pointerColor;b.sldPtrS.style.width=l.sliderSize+"px";b.sldPtrS.style.height=t+"px";b.btn.style.display=l.closable?"block":"none";b.btn.style.position="absolute";b.btn.style.left=l.padding+"px";b.btn.style.bottom=l.padding+"px";b.btn.style.padding="0 15px";b.btn.style.height=l.buttonHeight+"px";b.btn.style.border=l.insetWidth+"px solid";(function(){var a=l.insetColor.split(/\s+/);b.btn.style.borderColor=2>a.length?a[0]:a[1]+" "+a[0]+" "+a[0]+" "+a[1]})();b.btn.style.color=l.buttonColor;b.btn.style.font=
"12px sans-serif";b.btn.style.textAlign="center";try{b.btn.style.cursor="pointer"}catch(m){b.btn.style.cursor="hand"}b.btn.onmousedown=function(){l.hide()};b.btnT.style.lineHeight=l.buttonHeight+"px";b.btnT.innerHTML="";b.btnT.appendChild(document.createTextNode(l.closeText));f();g();a.picker.owner&&a.picker.owner!==l&&a.unsetClass(a.picker.owner.targetElement,l.activeClass);a.picker.owner=l;a.isElementType(n,"body")?a.redrawPosition():a._drawPosition(l,0,0,"relative",!1);b.wrap.parentNode!=n&&n.appendChild(b.wrap);
a.setClass(l.targetElement,l.activeClass)}function f(){switch(a.getPadYComponent(l)){case "s":var b=1;break;case "v":b=2}var c=Math.round(l.hsv[0]/360*(l.width-1)),b=Math.round((1-l.hsv[b]/100)*(l.height-1)),e=-Math.floor((2*l.pointerBorderWidth+l.pointerThickness+2*l.crossSize)/2);a.picker.cross.style.left=c+e+"px";a.picker.cross.style.top=b+e+"px";switch(a.getSliderComponent(l)){case "s":b=d(l.hsv[0],100,l.hsv[2]);c=d(l.hsv[0],0,l.hsv[2]);b="rgb("+Math.round(b[0])+","+Math.round(b[1])+","+Math.round(b[2])+
")";c="rgb("+Math.round(c[0])+","+Math.round(c[1])+","+Math.round(c[2])+")";a.picker.sldGrad.draw(l.sliderSize,l.height,b,c);break;case "v":c=d(l.hsv[0],l.hsv[1],100),b="rgb("+Math.round(c[0])+","+Math.round(c[1])+","+Math.round(c[2])+")",a.picker.sldGrad.draw(l.sliderSize,l.height,b,"#000")}}function g(){var b=a.getSliderComponent(l);if(b){switch(b){case "s":var c=1;break;case "v":c=2}b=Math.round((1-l.hsv[c]/100)*(l.height-1));a.picker.sldPtrOB.style.top=b-(2*l.pointerBorderWidth+l.pointerThickness)-
Math.floor(t/2)+"px"}}function h(){return a.picker&&a.picker.owner===l}function k(){l.importColor()}this.value=null;this.styleElement=this.valueElement=b;this.refine=this.required=!0;this.hash=!1;this.uppercase=!0;this.onFineChange=null;this.activeClass="jscolor-active";this.overwriteImportant=!1;this.minS=0;this.maxS=100;this.minV=0;this.maxV=100;this.hsv=[0,0,100];this.rgb=[255,255,255];this.width=181;this.height=101;this.showOnClick=!0;this.mode="HSV";this.position="bottom";this.smartPosition=
!0;this.sliderSize=16;this.crossSize=8;this.closable=!1;this.closeText="Close";this.buttonColor="#000000";this.buttonHeight=18;this.padding=12;this.backgroundColor="#FFFFFF";this.borderWidth=1;this.borderColor="#BBBBBB";this.borderRadius=8;this.insetWidth=1;this.insetColor="#BBBBBB";this.shadow=!0;this.shadowBlur=15;this.shadowColor="rgba(0,0,0,0.2)";this.pointerColor="#4C4C4C";this.pointerBorderColor="#FFFFFF";this.pointerBorderWidth=1;this.pointerThickness=2;this.zIndex=1E3;this.container=null;
for(var m in c)c.hasOwnProperty(m)&&(this[m]=c[m]);this.hide=function(){h()&&(a.unsetClass(l.targetElement,l.activeClass),a.picker.wrap.parentNode.removeChild(a.picker.wrap),delete a.picker.owner)};this.show=function(){e()};this.redraw=function(){h()&&e()};this.importColor=function(){this.valueElement?a.isElementType(this.valueElement,"input")?this.refine?!this.required&&/^\s*$/.test(this.valueElement.value)?(this.valueElement.value="",this.styleElement&&(this.styleElement.style.backgroundImage=this.styleElement._jscOrigStyle.backgroundImage,
this.styleElement.style.backgroundColor=this.styleElement._jscOrigStyle.backgroundColor,this.styleElement.style.color=this.styleElement._jscOrigStyle.color),this.exportColor(a.leaveValue|a.leaveStyle)):this.fromString(this.valueElement.value)||this.exportColor():this.fromString(this.valueElement.value,a.leaveValue)||(this.styleElement&&(this.styleElement.style.backgroundImage=this.styleElement._jscOrigStyle.backgroundImage,this.styleElement.style.backgroundColor=this.styleElement._jscOrigStyle.backgroundColor,
this.styleElement.style.color=this.styleElement._jscOrigStyle.color),this.exportColor(a.leaveValue|a.leaveStyle)):this.exportColor():this.exportColor()};this.exportColor=function(b){if(!(b&a.leaveValue)&&this.valueElement){var c=this.toString();this.uppercase&&(c=c.toUpperCase());this.hash&&(c="#"+c);a.isElementType(this.valueElement,"input")?this.valueElement.value=c:this.valueElement.innerHTML=c}if(!(b&a.leaveStyle)&&this.styleElement){var c="#"+this.toString(),d=this.isLight()?"#000":"#FFF";this.styleElement.style.backgroundImage=
"none";this.styleElement.style.backgroundColor=c;this.styleElement.style.color=d;this.overwriteImportant&&this.styleElement.setAttribute("style","background: "+c+" !important; color: "+d+" !important;")}b&a.leavePad||!h()||f();b&a.leaveSld||!h()||g()};this.fromHSV=function(a,b,c,e){if(null!==a){if(isNaN(a))return!1;a=Math.max(0,Math.min(360,a))}if(null!==b){if(isNaN(b))return!1;b=Math.max(0,Math.min(100,this.maxS,b),this.minS)}if(null!==c){if(isNaN(c))return!1;c=Math.max(0,Math.min(100,this.maxV,
c),this.minV)}this.rgb=d(null===a?this.hsv[0]:this.hsv[0]=a,null===b?this.hsv[1]:this.hsv[1]=b,null===c?this.hsv[2]:this.hsv[2]=c);this.exportColor(e)};this.fromRGB=function(a,b,c,e){if(null!==a){if(isNaN(a))return!1;a=Math.max(0,Math.min(255,a))}if(null!==b){if(isNaN(b))return!1;b=Math.max(0,Math.min(255,b))}if(null!==c){if(isNaN(c))return!1;c=Math.max(0,Math.min(255,c))}a=null===a?this.rgb[0]:a;b=null===b?this.rgb[1]:b;var f=null===c?this.rgb[2]:c;a/=255;b/=255;var f=f/255,g=Math.min(Math.min(a,
b),f);c=Math.max(Math.max(a,b),f);var h=c-g;0===h?a=[null,0,100*c]:(a=a===g?3+(f-b)/h:b===g?5+(a-f)/h:1+(b-a)/h,a=[60*(6===a?0:a),h/c*100,100*c]);null!==a[0]&&(this.hsv[0]=Math.max(0,Math.min(360,a[0])));0!==a[2]&&(this.hsv[1]=null===a[1]?null:Math.max(0,this.minS,Math.min(100,this.maxS,a[1])));this.hsv[2]=null===a[2]?null:Math.max(0,this.minV,Math.min(100,this.maxV,a[2]));a=d(this.hsv[0],this.hsv[1],this.hsv[2]);this.rgb[0]=a[0];this.rgb[1]=a[1];this.rgb[2]=a[2];this.exportColor(e)};this.fromString=
function(a,b){var c;if(c=a.match(/^\W*([0-9A-F]{3}([0-9A-F]{3})?)\W*$/i))return 6===c[1].length?this.fromRGB(parseInt(c[1].substr(0,2),16),parseInt(c[1].substr(2,2),16),parseInt(c[1].substr(4,2),16),b):this.fromRGB(parseInt(c[1].charAt(0)+c[1].charAt(0),16),parseInt(c[1].charAt(1)+c[1].charAt(1),16),parseInt(c[1].charAt(2)+c[1].charAt(2),16),b),!0;if(c=a.match(/^\W*rgba?\(([^)]*)\)\W*$/i)){c=c[1].split(",");var d=/^\s*(\d*)(\.\d+)?\s*$/,e,f,g;if(3<=c.length&&(e=c[0].match(d))&&(f=c[1].match(d))&&
(g=c[2].match(d)))return e=parseFloat((e[1]||"0")+(e[2]||"")),f=parseFloat((f[1]||"0")+(f[2]||"")),g=parseFloat((g[1]||"0")+(g[2]||"")),this.fromRGB(e,f,g,b),!0}return!1};this.toString=function(){return(256|Math.round(this.rgb[0])).toString(16).substr(1)+(256|Math.round(this.rgb[1])).toString(16).substr(1)+(256|Math.round(this.rgb[2])).toString(16).substr(1)};this.toHEXString=function(){return"#"+this.toString().toUpperCase()};this.toRGBString=function(){return"rgb("+Math.round(this.rgb[0])+","+Math.round(this.rgb[1])+
","+Math.round(this.rgb[2])+")"};this.isLight=function(){return 127.5<.213*this.rgb[0]+.715*this.rgb[1]+.072*this.rgb[2]};this._processParentElementsInDOM=function(){if(!this._linkedElementsProcessed){this._linkedElementsProcessed=!0;var b=this.targetElement;do{var c=a.getStyle(b);c&&"fixed"===c.position.toLowerCase()&&(this.fixed=!0);b===this.targetElement||b._jscEventsAttached||(a.attachEvent(b,"scroll",a.onParentScroll),b._jscEventsAttached=!0)}while((b=b.parentNode)&&!a.isElementType(b,"body"))}};
"string"===typeof b?(m=document.getElementById(b))?this.targetElement=m:a.warn("Could not find target element with ID '"+b+"'"):b?this.targetElement=b:a.warn("Invalid target element: '"+b+"'");if(this.targetElement._jscLinkedInstance)a.warn("Cannot link jscolor twice to the same element. Skipping.");else{this.targetElement._jscLinkedInstance=this;this.valueElement=a.fetchElement(this.valueElement);this.styleElement=a.fetchElement(this.styleElement);var l=this,n=this.container?a.fetchElement(this.container):
document.getElementsByTagName("body")[0],t=3;if(a.isElementType(this.targetElement,"button"))if(this.targetElement.onclick){var q=this.targetElement.onclick;this.targetElement.onclick=function(a){q.call(this,a);return!1}}else this.targetElement.onclick=function(){return!1};this.valueElement&&a.isElementType(this.valueElement,"input")&&(m=function(){l.fromString(l.valueElement.value,a.leaveValue);a.dispatchFineChange(l)},a.attachEvent(this.valueElement,"keyup",m),a.attachEvent(this.valueElement,"input",
m),a.attachEvent(this.valueElement,"blur",k),this.valueElement.setAttribute("autocomplete","off"));this.styleElement&&(this.styleElement._jscOrigStyle={backgroundImage:this.styleElement.style.backgroundImage,backgroundColor:this.styleElement.style.backgroundColor,color:this.styleElement.style.color});this.value?this.fromString(this.value)||this.exportColor():this.importColor()}}};a.jscolor.lookupClass="jscolor";a.jscolor.installByClassName=function(b){var c=document.getElementsByTagName("input"),
d=document.getElementsByTagName("button");a.tryInstallOnElements(c,b);a.tryInstallOnElements(d,b)};a.register();return a.jscolor}());var AnimationManager=function(){this.scene;this.synchronize;this.animationOptions;this.animationGroups;this.lastUpdate;this.progress;this.init=function(){this.animationOptions.Scale_Change=new Animation(null,"scale",null,null,1,!0,!1);this.animationOptions.Position_Change=new Animation(null,"position",null,null,1,!0,!1)};this.getOptions=function(){return this.animationOptions};this.makeAnimationGroup=function(a,b){this.animationGroups[a]=new AnimationGroup(a,b,this)};this.getAnimationGroup=function(a){return this.animationGroups[a]};
this.removeAnimationGroup=function(a){a=this.animationGroups[a];void 0!=a&&null!=a&&delete animationGroups.animationGroupId};this.update=function(){var a=Date.now(),b=a-this.lastUpdate;this.progress+=b/1E3;var c=!1;1<=this.progress&&(this.progress=0,c=!0);for(var d in this.animationGroups){var e=this.animationGroups[d];void 0!=e&&null!=e&&(this.synchronize?e.update(b,this.progress,c):e.update(b,null,c))}this.lastUpdate=a};this.pause=function(a,b){var c=this.animationGroups[a];void 0!=c&&null!=c&&
(c=c[b],void 0!=c&&null!=c&&c.pause())};this.resume=function(a,b){var c=this.animationGroups[a];void 0!=c&&null!=c&&(c=c[b],void 0!=c&&null!=c&&c.resume())};this.reset=function(a,b){var c=this.animationGroups[a];void 0!=c&&null!=c&&(c=c[b],void 0!=c&&null!=c&&c.reset())};AnimationManager=function(a,b){this.scene=a;this.synchronize=b;this.animationOptions={};this.animationGroups={};this.lastUpdate=Date.now();this.progress=0;this.init()};AnimationManager.prototype={constructor:AnimationManager,init:this.init,
getOptions:this.getOptions,makeAnimationGroup:this.makeAnimationGroup,getAnimationGroup:this.getAnimationGroup,removeAnimationGroup:this.removeAnimationGroup,update:this.update,pause:this.pause,resume:this.resume,reset:this.reset};return AnimationManager}(),AnimationGroup=function(){this.paused;this.id;this.synchronize;this.animationManager;this.paused;this.progress;this.animations;this.addAnimation=function(a,b){b.animationGroup=this;b.objectId=a;this.animations[b.id]=b};this.getAnimation=function(a){return this.animations[a]};
this.update=function(a,b,c){if(!this.paused){var d=!1;void 0!=b&&null!=b?(this.progress=b,d=c):(this.progress+=a/1E3,1<=this.progress&&(this.progress=0,d=!0));for(var e in this.animations)b=this.animations[e],void 0!=b&&null!=b&&(this.synchronize?b.update(a,this.progress,d):b.update(a,null,d))}};this.pause=function(){var a=animationGroup[animationId];void 0!=a&&null!=a&&a.pause()};this.resume=function(){var a=animationGroup[animationId];void 0!=a&&null!=a&&a.resume()};this.reset=function(){var a=
animationGroup[animationId];void 0!=a&&null!=a&&a.reset()};AnimationGroup=function(a,b,c){this.paused=!1;this.id=a;this.synchronize=b;this.animationManager=c;this.paused=!1;this.progress=0;this.animations={}};AnimationGroup.prototype={constructor:AnimationGroup,addAnimation:this.addAnimation,getAnimation:this.getAnimation,update:this.update,pause:this.pause,resume:this.resume,reset:this.reset};return AnimationGroup}(),Animation=function(){this.id;this.objectId;this.paused;this.parameterName;this.initialValue;
this.finalValue;this.speedMultiplier;this.loop;this.shouldReset;this.progress;this.forward;this.clone=function(){return new Animation(this.id,this.parameterName,this.initialValue,this.finalValue,this.speedMultiplier,this.loop,this.shouldReset)};this.setId=function(a){this.id=a};this.setObjectId=function(a){this.objectId=a};this.setInitialValue=function(a){this.initialValue=a};this.setFinalValue=function(a){this.finalValue=a};this.update=function(a,b,c){this.paused||this.animationGroup.paused||(void 0!=
b&&null!=b?(this.progress=b,c&&(this.loop?this.forward=!this.forward:this.paused=!0)):(this.progress+=a/1E3/this.speedMultiplier,1<=this.progress&&(this.loop?(this.progress=0,this.forward=!this.forward):(this.progress=1,this.paused=!0))),a=this.animationGroup.animationManager.scene.getObjectByName(this.objectId)[this.parameterName],this.forward?"number"!==typeof a&&a instanceof THREE.Vector3&&(a.x=(1-this.progress)*this.initialValue.x+this.progress*this.finalValue.x,a.y=(1-this.progress)*this.initialValue.y+
this.progress*this.finalValue.y,a.z=(1-this.progress)*this.initialValue.z+this.progress*this.finalValue.z):"number"!==typeof a&&a instanceof THREE.Vector3&&(a.x=(1-this.progress)*this.finalValue.x+this.progress*this.initialValue.x,a.y=(1-this.progress)*this.finalValue.y+this.progress*this.initialValue.y,a.z=(1-this.progress)*this.finalValue.z+this.progress*this.initialValue.z))};this.pause=function(){this.paused=!0};this.resume=function(){this.paused=!1};this.reset=function(){this.progress=0;this.forward=
!0;var a=this.animationGroup.animationManager.scene.getObjectByName(this.objectId)[this.parameterName];"number"!==typeof a&&a instanceof THREE.Vector3&&(a.x=this.initialValue.x,a.y=this.initialValue.y,a.z=this.initialValue.z)};Animation=function(a,b,c,d,e,f,g){this.id=a;this.objectId=null;this.paused=!0;this.parameterName=b;this.initialValue=c;this.finalValue=d;this.speedMultiplier=e;this.loop=f;this.shouldReset=g;this.progress=0;this.forward=!0};Animation.prototype={constructor:Animation,clone:this.clone,
setId:this.setId,setObjectId:this.setObjectId,setInitialValue:this.setInitialValue,setFinalValue:this.setFinalValue,update:this.update,pause:this.pause,resume:this.resume,reset:this.reset};return Animation}();var CallbackHandler=function(){};CallbackHandler.prototype={sandboxStateChanged:function(a,b){},visualizationSetupChanged:function(a,b,c,d){},dataChanged:function(a,b,c,d){},hidingChanged:function(a,b,c,d){},selectionChanged:function(a,b,c,d){},highlightingChanged:function(a,b,c,d){}};var VisualizationDataset=function(){this.id;this.nodes;this.connections;this.clusters;this.getId=function(){return this.id};this.setId=function(a){this.id=a};this.getNodes=function(){return this.nodes};this.setNodes=function(a){this.nodes=a};this.addNode=function(a){this.nodes[a.getId()]=a};this.getNode=function(a){return a in this.nodes?this.nodes[a]:null};this.removeNode=function(a){delete this.nodes[a]};this.getConnections=function(){return this.connections};this.setConnections=function(a){this.connections=
a};this.addConnection=function(a){this.connections[a.getId()]=a};this.getConnection=function(a){return a in this.connections?this.connections[a]:null};this.removeConnection=function(a){delete this.connections[a]};this.getClusters=function(){return this.clusters};this.setClusters=function(a){this.clusters=a};VisualizationDataset=function(a,b,c){this.id=a;this.nodes=void 0!=b&&null!=b?b:{};this.connections=void 0!=c&&null!=c?c:{};this.clusters={}};VisualizationDataset.prototype={constructor:VisualizationDataset,
getId:this.getId,setId:this.setId,getNodes:this.getNodes,setNodes:this.setNodes,addNode:this.addNode,getNode:this.getNode,removeNode:this.removeNode,getConnections:this.getConnections,setConnections:this.setConnections,addConnection:this.addConnection,getConnection:this.getConnection,removeConnection:this.removeConnection,getClusters:this.getClusters,setClusters:this.setClusters};return VisualizationDataset}(),Node=function(){this.id;this.name;this.nodeType;this.getId=function(){return this.id};this.setId=
function(a){this.id=a};this.getName=function(){return this.name};this.setName=function(a){this.name=a};this.getNodeType=function(){return this.nodeType};this.setNodeType=function(a){this.nodeType=a};this.getClusterMembership=function(){return this.clusterMembership};this.setClusterMembership=function(a){this.clusterMembership=a};Node=function(a,b,c){this.id=a;this.name=b;this.nodeType=c};Node.prototype={constructor:Node,getId:this.getId,setId:this.setId,getName:this.getName,setName:this.setName,getNodeType:this.getNodeType,
setNodeType:this.setNodeType,getClusterMembership:this.getClusterMembership,setClusterMembership:this.setClusterMembership};return Node}(),NodeType=function(){this.name;this.defaultLookAndFeel;this.getName=function(){return this.name};this.setName=function(a){this.name=a};this.getDefaultLookAndFeel=function(){return this.defaultLookAndFeel};this.setDefaultLookAndFeel=function(a){this.defaultLookAndFeel=a};NodeType=function(a,b){this.name=a;this.defaultLookAndFeel=b};NodeType.prototype={constructor:NodeType,
getName:this.getName,setName:this.setName,getDefaultLookAndFeel:this.getDefaultLookAndFeel,setDefaultLookAndFeel:this.setDefaultLookAndFeel};return NodeType}(),NodeLookAndFeel=function(){this.model;this.color;this.labelColor;this.texture;this.size;this.transparency;this.wireframe;this.selectionAnimation;this.metaData;this.clone=function(){return new NodeLookAndFeel(this.model,this.color,this.labelColor,this.texture,this.size,this.transparency,this.wireframe,this.selectionAnimation)};this.getModel=
function(){return this.model};this.setModel=function(a){this.model=a};this.getColor=function(){return this.color};this.setColor=function(a){this.color=a};this.getLabelColor=function(){return this.labelColor};this.setLabelColor=function(a){this.labelColor=a};this.getTexture=function(){return this.texture};this.setTexture=function(a){this.texture=a};this.getSize=function(){return this.size};this.setSize=function(a){this.size=a};this.getTransparency=function(){return this.transparency};this.setTransparency=
function(a){this.transparency=a};this.getWireframe=function(){return this.wireframe};this.setWireframe=function(a){this.wireframe=a};this.getSelectionAnimation=function(){return this.selectionAnimation};this.setSelectionAnimation=function(a){this.selectionAnimation=a};this.getMetaData=function(){return this.metaData};this.setMetaData=function(a){this.metaData=a};NodeLookAndFeel=function(a,b,c,d,e,f,g,h,k){this.model=a;this.color=b;this.labelColor=c;this.texture=d;this.size=e;this.transparency=f;this.wireframe=
g;this.selectionAnimation=h;this.metaData=k};NodeLookAndFeel.prototype={constructor:NodeLookAndFeel,clone:this.clone,getModel:this.getModel,setModel:this.setModel,getColor:this.getColor,setColor:this.setColor,getLabelColor:this.getLabelColor,setLabelColor:this.setLabelColor,getTexture:this.getTexture,setTexture:this.setTexture,getSize:this.getSize,setSize:this.setSize,getTransparency:this.getTransparency,setTransparency:this.setTransparency,getWireframe:this.getWireframe,setWireframe:this.setWireframe,
getSelectionAnimation:this.getSelectionAnimation,setSelectionAnimation:this.setSelectionAnimation,getMetaData:this.getMetaData,setMetaData:this.setMetaData};return NodeLookAndFeel}(),NodeLocation=function(){this.x;this.y;this.z;this.yaw;this.pitch;this.roll;this.getX=function(){return this.x};this.setX=function(a){this.x=a};this.getY=function(){return this.y};this.setY=function(a){this.y=a};this.getZ=function(){return this.z};this.setZ=function(a){this.z=a};this.getYaw=function(){return this.yaw};
this.setYaw=function(a){this.yaw=a};this.getPitch=function(){return this.pitch};this.setPitch=function(a){this.pitch=a};this.getRoll=function(){return this.roll};this.setRoll=function(a){this.roll=a};NodeLocation=function(){};NodeLocation.prototype={constructor:NodeLocation,getX:this.getX,setX:this.setX,getY:this.getY,setY:this.setY,getZ:this.getZ,setZ:this.setZ,getYaw:this.getYaw,setYaw:this.setYaw,getPitch:this.getPitch,setPitch:this.setPitch,getRoll:this.getRoll,setRoll:this.setRoll};return NodeLocation}(),
Connection=function(){this.id;this.name;this.sourceId;this.targetId;this.connectionType;this.weight;this.getId=function(){return this.id};this.setId=function(a){this.id=a};this.getName=function(){return this.name};this.setName=function(a){this.name=a};this.getSourceId=function(){return this.sourceId};this.setSourceId=function(a){this.sourceId=a};this.getTargetId=function(){return this.targetId};this.setTargetId=function(a){this.targetId=a};this.getBidirectional=function(){return this.bidirectional};
this.setBidirectional=function(a){this.bidirectional=a};this.getConnectionType=function(){return this.connectionType};this.setConnectionType=function(a){this.connectionType=a};this.getWeight=function(){return this.weight};this.setWeight=function(a){this.weight=a};Connection=function(a,b,c,d,e,f,g){this.id=a;this.name=b;this.sourceId=c;this.targetId=d;this.bidirectional=e;this.connectionType=f;this.weight=g};Connection.prototype={constructor:Connection,getId:this.getId,setId:this.setId,getWeight:this.getWeight,
setWeight:this.setWeight,getName:this.getName,setName:this.setName,getConnectionType:this.getConnectionType,setConnectionType:this.setConnectionType,getSourceId:this.getSourceId,setSourceId:this.setSourceId,getTargetId:this.getTargetId,setTargetId:this.setTargetId,getBidirectional:this.getBidirectional,setBidirectional:this.setBidirectional};return Connection}(),ConnectionType=function(){this.name;this.defaultLookAndFeel;this.getName=function(){return this.name};this.setName=function(a){this.name=
a};this.getDefaultLookAndFeel=function(){return this.defaultLookAndFeel};this.setDefaultLookAndFeel=function(a){this.defaultLookAndFeel=a};ConnectionType=function(a,b){this.name=a;this.defaultLookAndFeel=b};ConnectionType.prototype={constructor:ConnectionType,getName:this.getName,setName:this.setName,getDefaultLookAndFeel:this.getDefaultLookAndFeel,setDefaultLookAndFeel:this.setDefaultLookAndFeel,getWeight:this.getWeight,setWeight:this.setWeight};return ConnectionType}(),ConnectionLookAndFeel=function(){this.model;
this.componentLookAndFeel;this.color;this.labelColor;this.texture;this.size;this.transparency;this.wireframe;this.selectionAnimation;this.clone=function(){return new ConnectionLookAndFeel(this.model,this.componentLookAndFeel.clone(),this.texture,this.color,this.labelColor,this.size,this.transparency,this.wireframe,this.selectionAnimation)};this.getModel=function(){return this.model};this.setModel=function(a){this.model=a};this.getComponentLookAndFeel=function(){return this.componentLookAndFeel};this.setComponentLookAndFeel=
function(a){this.componentLookAndFeel=a};this.getColor=function(){return this.color};this.setColor=function(a){this.color=a};this.getLabelColor=function(){return this.labelColor};this.setLabelColor=function(a){this.labelColor=a};this.getTexture=function(){return this.texture};this.setTexture=function(a){this.texture=a};this.getSize=function(){return this.size};this.setSize=function(a){this.size=a};this.getTransparency=function(){return this.transparency};this.setTransparency=function(a){this.transparency=
a};this.getWireframe=function(){return this.wireframe};this.setWireframe=function(a){this.wireframe=a};this.getSelectionAnimation=function(){return this.selectionAnimation};this.setSelectionAnimation=function(a){this.selectionAnimation=a};ConnectionLookAndFeel=function(a,b,c,d,e,f,g,h,k){this.model=a;this.componentLookAndFeel=b;this.color=d;this.labelColor=e;this.texture=c;this.size=f;this.transparency=g;this.wireframe=h;this.selectionAnimation=k};ConnectionLookAndFeel.prototype={constructor:ConnectionLookAndFeel,
clone:this.clone,getModel:this.getModel,setModel:this.setModel,getColor:this.getColor,setColor:this.setColor,getLabelColor:this.getLabelColor,setLabelColor:this.setLabelColor,getTexture:this.getTexture,setTexture:this.setTexture,getSize:this.getSize,setSize:this.setSize,getTransparency:this.getTransparency,setTransparency:this.setTransparency,getWireframe:this.getWireframe,setWireframe:this.setWireframe,getSelectionAnimation:this.getSelectionAnimation,setSelectionAnimation:this.setSelectionAnimation,
getComponentLookAndFeel:this.getComponentLookAndFeel,setComponentLookAndFeel:this.setComponentLookAndFeel};return ConnectionLookAndFeel}(),CameraSetup=function(){this.x;this.y;this.z;this.targetX;this.targetY;this.targetZ;this.getX=function(){return this.x};this.setX=function(a){this.x=a};this.getY=function(){return this.y};this.setY=function(a){this.y=a};this.getZ=function(){return this.z};this.setZ=function(a){this.z=a};this.getTargetX=function(){return this.yaw};this.setTargetX=function(a){this.targetX=
a};this.getTargetY=function(){return this.targetX};this.setTargetY=function(a){this.targetY=a};this.getTargetZ=function(){return this.targetZ};this.setTargetZ=function(a){this.targetZ=a};this.getZoom=function(){return this.zoom};this.setZoom=function(a){this.zoom=a};CameraSetup=function(a,b,c,d,e,f,g){this.x=a;this.y=b;this.z=c;this.targetX=d;this.targetY=e;this.targetZ=f;this.zoom=g};CameraSetup.prototype={constructor:CameraSetup,getX:this.getX,setX:this.setX,getY:this.getY,setY:this.setY,getZ:this.getZ,
setZ:this.setZ,getTargetX:this.getTargetX,setTargetX:this.setTargetX,getTargetY:this.getTargetY,setTargetY:this.setTargetY,getTargetZ:this.getTargetZ,setTargetZ:this.setTargetZ,getZoom:this.getZoom,setZoom:this.setZoom};return CameraSetup}();var ForceDirectedLayout=function(a,b,c){this.diameter=a;this.layoutManager=b;this.datasetId;this.springyGraph;this.springyLayout;this.springyRenderer;this.springyUserNode;this.springyNodeArray;this.springyEdgeArray;this.nodeLocations={};this.connectionSourceLocations={};this.connectionTargetLocations={};this.perspective=c;var d=this;this.init=function(){if(void 0==c||null==c)d.perspective=!0;d.id="Force_Directed";d.minAxisCount=1;d.maxAxisCount=3;d.currentAxisCount=3;d.springyNodeArray={};d.springyEdgeArray=
{};d.springyGraph=new Springy.Graph(d.perspective);d.springyLayout=new Springy.Layout.ForceDirected(d.springyGraph,400,12800,.5);var a=d.drawNode.bind(d),b=d.drawEdge.bind(d);d.springyRenderer=new Springy.Renderer(d.springyLayout,function(){},b,a);d.springyRenderer.start()};this.addNode=function(a){if(void 0==d.nodeLocations[a]||null==d.nodeLocations[a])if(null!=d.layoutManager&&(d.nodeLocations[a]=new THREE.Vector3(-d.diameter/2+Math.random()*d.diameter,-d.diameter/2+Math.random()*d.diameter,-d.diameter/
2+Math.random()*d.diameter)),void 0==d.springyNodeArray[a]||null==d.springyNodeArray[a]){var b=d.springyGraph.newNode({label:a});d.springyNodeArray[a]=b}d.layoutManager.updateNodePosition(d.datasetId,a,d.getNodeLocation(a))};this.addConnection=function(a,b,c,h,k){if(void 0==d.connectionSourceLocations[a]||null==d.connectionSourceLocations[a])if(null!=d.layoutManager&&(d.connectionSourceLocations[a]=d.nodeLocations[b],d.connectionTargetLocations[a]=d.nodeLocations[c]),void 0==d.springyEdgeArray[a]||
null==d.springyEdgeArray[a])b=d.springyGraph.newEdge(d.springyNodeArray[b],d.springyNodeArray[c],{label:a,stiffness:void 0==k?100:k}),d.springyEdgeArray[a]=b;d.layoutManager.updateConnectionPosition(d.datasetId,a,d.getConnectionSourceLocation(a),d.getConnectionTargetLocation(a))};this.removeNode=function(a){delete d.nodeLocations[a];d.springyGraph.removeNode(d.springyNodeArray[a]);delete d.springyNodeArray[a]};this.removeConnection=function(a){delete d.connectionSourceLocations[a];delete d.connectionTargetLocations[a];
d.springyGraph.removeEdge(d.springyEdgeArray[a]);delete d.springyEdgeArray[a]};this.drawNode=function(a,b){d.nodeLocations[a.data.label]=new THREE.Vector3(b.x,b.y,b.z);d.layoutManager.getPerspective()||(d.nodeLocations[a.data.label]=new THREE.Vector3(b.x,b.z,b.y));null!=d.layoutManager&&d.layoutManager.updateNodePosition(d.datasetId,a.data.label,d.nodeLocations[a.data.label])};this.drawEdge=function(a,b,c){var h=new THREE.Vector3(b.x,b.y,b.z),k=new THREE.Vector3(c.x,c.y,c.z);d.layoutManager.getPerspective()||
(h=new THREE.Vector3(b.x,b.z,b.y),k=new THREE.Vector3(c.x,c.z,c.y));d.setConnectionSourceLocation(a.data.label,h);d.setConnectionTargetLocation(a.data.label,k);null!=d.layoutManager&&d.layoutManager.updateConnectionPosition(d.datasetId,a.data.label,h,k)};this.setNodeLocation=function(a,b){d.springyGraph.nodes.forEach(function(c){c.data.label==a&&(d.nodeLocations[a]=b,c=d.springyLayout.point(c),c.p.x=b.x,c.p.y=b.y,c.p.z=b.z,d.layoutManager.getPerspective()||(c.p.x=b.x,c.p.y=0,c.p.z=b.z))});d.springyRenderer.start()};
this.getNodeLocation=function(a){return d.nodeLocations[a]};this.getConnectionSourceLocation=function(a){return d.connectionSourceLocations[a]};this.setConnectionSourceLocation=function(a,b){d.connectionSourceLocations[a]=b};this.getConnectionTargetLocation=function(a){return d.connectionTargetLocations[a]};this.setConnectionTargetLocation=function(a,b){d.connectionTargetLocations[a]=b};this.setLayoutManager=function(a){d.layoutManager=a};this.getDatasetId=function(a){return d.datasetId};this.setDatasetId=
function(a){d.datasetId=a};this.getDiameter=function(){return d.diameter};this.setDiameter=function(a){d.diameter=a};this.clear=function(){d.nodeLocations={};d.connectionSourceLocations={};d.connectionTargetLocations={};d.springyNodeArray={};d.springyEdgeArray={};d.springyGraph=null;d.springyGraph=new Springy.Graph(d.perspective);d.springyLayout=new Springy.Layout.ForceDirected(d.springyGraph,400,6400,.5);var a=d.drawNode.bind(d),b=d.drawEdge.bind(d);d.springyRenderer.stop();d.springyRenderer=new Springy.Renderer(d.springyLayout,
function(){},b,a);d.springyRenderer.start()};this.reset=function(){for(var a in d.nodeLocations)d.layoutManager.updateNodePosition(d.datasetId,a,d.nodeLocations[a]);for(var b in d.connectionSourceNodeIds)d.layoutManager.updateConnectionPosition(d.datasetId,b,d.connectionSourceLocations[b],d.connectionTargetLocations[b]);d.springyGraph.nodes.forEach(function(a){d.springyLayout.point(a).m=10});d.springyRenderer.start()};this.setPaused=function(a){(d.paused=a)?d.springyRenderer.stop():d.springyRenderer.start()};
this.setPerspective=function(a){d.perspective=a;d.springyGraph.setPerspective(a)};this.init();return{clone:d.clone,init:d.init,clear:d.clear,reset:d.reset,getId:d.getId,setId:d.setId,getDatasetId:d.getDatasetId,setDatasetId:d.setDatasetId,getMinAxisCount:d.getMinAxisCount,getMaxAxisCount:d.getMaxAxisCount,getCurrentAxisCount:d.getCurrentAxisCount,setCurrentAxisCount:d.setCurrentAxisCount,getDiameter:d.getDiameter,setDiameter:d.setDiameter,setLayoutManager:d.setLayoutManager,addNode:d.addNode,addConnection:d.addConnection,
removeNode:d.removeNode,removeConnection:d.removeConnection,setNodeLocation:d.setNodeLocation,getNodeLocation:d.getNodeLocation,getConnectionSourceLocation:d.getConnectionSourceLocation,setConnectionSourceLocation:d.setConnectionSourceLocation,getConnectionTargetLocation:d.getConnectionTargetLocation,setConnectionTargetLocation:d.setConnectionTargetLocation,drawNode:d.drawNode,drawEdge:d.drawEdge,setLayoutManager:d.setLayoutManager,setPerspective:d.setPerspective,setPaused:d.setPaused,getPaused:d.getPaused}};var LayoutManager=function(a,b){this.visualizationSandbox=a;this.datasetLayouts;this.diameter=b;this.paused=!1;this.datasetLayouts={};var c=this;this.getDatasetLayout=function(a){return c.datasetLayouts[a]};this.setDatasetLayout=function(a,b){b.setDatasetId(a);b.setLayoutManager(c);b.setDiameter(c.diameter);c.datasetLayouts[a]=b};this.addNode=function(a,b,f){void 0!=c.datasetLayouts[a]&&null!=c.datasetLayouts[a]&&(a=c.datasetLayouts[a],void 0!=a&&null!=a&&a.addNode(b))};this.addConnection=function(a,
b,f,g,h,k,m){void 0!=c.datasetLayouts[a]&&null!=c.datasetLayouts[a]&&(a=c.datasetLayouts[a],void 0!=a&&null!=a&&a.addConnection(b,f,g,h,k))};this.removeNode=function(a,b){if(void 0!=c.datasetLayouts[a]&&null!=c.datasetLayouts[a]){var f=c.datasetLayouts[a];void 0!=f&&null!=f&&f.removeNode(b)}};this.removeConnection=function(a,b){if(void 0!=c.datasetLayouts[a]&&null!=c.datasetLayouts[a]){var f=c.datasetLayouts[a];void 0!=f&&null!=f&&f.removeConnection(b)}};this.updateNodePosition=function(a,b,f){c.visualizationSandbox.updateNodePosition(a,
b,f)};this.updateConnectionPosition=function(a,b,f,g){c.visualizationSandbox.updateConnectionPosition(a,b,f,g)};this.getNodeLocation=function(a,b){return void 0!=c.datasetLayouts[a]&&null!=c.datasetLayouts[a]?c.datasetLayouts[a].getNodeLocation(b):[0,0,0]};this.setNodeLocation=function(a,b,f){void 0!=c.datasetLayouts[a]&&null!=c.datasetLayouts[a]&&c.datasetLayouts[a].setNodeLocation(b,f)};this.getConnectionSourceLocation=function(a,b){return void 0!=c.datasetLayouts[a]&&null!=c.datasetLayouts[a]?
c.datasetLayouts[a].getConnectionSourceLocation(b):[0,0,0]};this.setConnectionSourceLocation=function(a,b,f){void 0!=c.datasetLayouts[a]&&null!=c.datasetLayouts[a]&&c.datasetLayouts[a].setConnectionSourceLocation(b,f)};this.getConnectionTargetLocation=function(a,b){return void 0!=c.datasetLayouts[a]&&null!=c.datasetLayouts[a]?c.datasetLayouts[a].getConnectionTargetLocation(b):[0,0,0]};this.setConnectionTargetLocation=function(a,b,f){void 0!=c.datasetLayouts[a]&&null!=c.datasetLayouts[a]&&c.datasetLayouts[a].setConnectionTargetLocation(b,
f)};this.getPerspective=function(){return c.visualizationSandbox.getPerspective()};this.reset=function(a){c.datasetLayouts[a].reset()};return{setDatasetLayout:c.setDatasetLayout,getDatasetLayout:c.getDatasetLayout,addNode:c.addNode,addConnection:c.addConnection,removeNode:c.removeNode,removeConnection:c.removeConnection,updateNodePosition:c.updateNodePosition,updateConnectionPosition:c.updateConnectionPosition,setNodeLocation:c.setNodeLocation,getNodeLocation:c.getNodeLocation,getConnectionSourceLocation:c.getConnectionSourceLocation,
setConnectionSourceLocation:c.setConnectionSourceLocation,getConnectionTargetLocation:c.getConnectionTargetLocation,setConnectionTargetLocation:c.setConnectionTargetLocation,getPerspective:c.getPerspective,reset:c.reset}},Layout=function(a,b,c,d,e){this.paused=!1;this.id=a;this.layoutManager=this.datasetId=null;this.minAxisCount=b;this.maxAxisCount=c;this.currentAxisCount=d;this.diameter=e;this.nodeLocations={};this.connectionSourceLocations={};this.connectionTargetLocations={};var f=this;this.setPaused=
function(a){f.paused=a};this.getPaused=function(){return f.paused};this.clone=function(){return new Layout(f.id,f.minAxisCount,f.maxAxisCount,f.currentAxisCount)};this.init=function(){};this.getId=function(){return f.id};this.setId=function(a){f.id=a};this.getDatasetId=function(a){return f.datasetId};this.setDatasetId=function(a){f.datasetId=a};this.getMinAxisCount=function(){return f.minAxisCount};this.getMaxAxisCount=function(){return f.maxAxisCount};this.getCurrentAxisCount=function(){return f.currentAxisCount};
this.setCurrentAxisCount=function(a){f.currentAxisCount=a};this.getDiameter=function(){return f.diameter};this.setDiameter=function(a){f.diameter=a};this.setLayoutManager=function(a){f.layoutManager=a};this.addNode=function(a){};this.addConnection=function(a,b,c,d){};this.removeNode=function(a){};this.removeConnection=function(a){};this.setNodeLocation=function(a,b){f.nodeLocations[a]=b};this.getNodeLocation=function(a){return f.nodeLocations[a]};this.getConnectionSourceLocation=function(a){return f.connectionSourceLocations[a]};
this.setConnectionSourceLocation=function(a,b){return f.connectionSourceLocations[a]};this.getConnectionTargetLocation=function(a){return f.connectionTargetLocations[a]};this.setConnectionTargetLocation=function(a,b){return f.connectionTargetLocations[a]};this.clear=function(){};this.reset=function(){};return{clone:f.clone,init:f.init,clear:f.clear,reset:f.reset,getId:f.getId,setId:f.setId,getDatasetId:f.getDatasetId,setDatasetId:f.setDatasetId,getMinAxisCount:f.getMinAxisCount,getMaxAxisCount:f.getMaxAxisCount,
getCurrentAxisCount:f.getCurrentAxisCount,setCurrentAxisCount:f.setCurrentAxisCount,getDiameter:f.getDiameter,setDiameter:f.setDiameter,setLayoutManager:f.setLayoutManager,addNode:f.addNode,addConnection:f.addConnection,removeNode:f.removeNode,removeConnection:f.removeConnection,setNodeLocation:f.setNodeLocation,getNodeLocation:f.getNodeLocation,getConnectionSourceLocation:f.getConnectionSourceLocation,setConnectionSourceLocation:f.setConnectionSourceLocation,getConnectionTargetLocation:f.getConnectionTargetLocation,
setConnectionTargetLocation:f.setConnectionTargetLocation,setPaused:f.setPaused,getPaused:f.getPaused}};var ModelRepository=function(a){this.vs=a;this.contrastColor=16777215;this.contrastColorRGB=[255,255,255];this.backgroundColorRGB=[0,0,0];var b=this;b.resetColor=function(){for(var a=b.vs.getCurrentVisualizationSetup().getBackgroundColor(),d=0;3>d;d++)b.contrastColorRGB[d]=a[d]+128,255<b.contrastColorRGB[d]&&(b.contrastColorRGB[d]-=255),Math.abs(b.contrastColorRGB[d]-a[d])<Math.abs(255-a[d]-a[d])&&(b.contrastColorRGB[d]=255-a[d]);b.contrastColor=b.contrastColorRGB[2]+256*b.contrastColorRGB[1]+65536*
b.contrastColorRGB[0];b.backgroundColorRGB=[a[0],a[1],a[2]]};b.getContrastColor=function(a){for(var b=[255,255,255,a[3]],e=0;3>e;e++)b[e]=a[e]+128,255<b[e]&&(b[e]-=255),Math.abs(b[e]-a[e])<Math.abs(255-a[e]-a[e])&&(b[e]=255-a[e]);return b};b.getBestFontColor=function(a){var b=[255,255,255,a[3]];382<a[0]+a[1]+a[2]&&(b=[0,0,0,a[3]]);return b};b.getNodeModel=function(a,d,e,f,g,h,k){var m=f.getModel();b["get"+m]?b["get"+m].call(b,a,d,e,f,g,h,k):b.getCube.call(b,a,d,e,f,g,h,k)};b.getConnectionModel=function(a,
d,e,f,g,h,k,m,l,n,t){var q=h.getModel();b["get"+q]?b["get"+q].call(b,a,d,e,f,g,k,m,h,l,n,t):b.getLine.call(b,a,d,e,f,g,k,m,h,l,n,t)};b.applyMaterialAndTexture=function(a,d,e,f,g,h,k,m,l,n,t,q){a.castShadow=m;a.receiveShadow=l;a.name=d+"_"+e;a.datasetId=d;a.sourceId=g;a.targetId=h;a.labelText=f;for(var u=0;u<a.children.length;u++){var p=a.children[u];p.castShadow=m;p.receiveShadow=l;p.name=d+" "+e;p.datasetId=d;p.labelText=f;p.sourceId=g;p.targetId=h}if(void 0==k||null==k)a.type="Unknown",b.applyTextureToObject(a,
null,n,t);else{void 0!=k.getModel()&&null!=k.getModel()&&(a.type=k.getModel());if(void 0==a.material||null==a.material)for(a.material=new THREE.MeshPhongMaterial({ambient:16777215,color:16777215,specular:5592405,shininess:5,shading:THREE.FlatShading}),u=0;u<a.children.length;u++)if(p=a.children[u],void 0==p.material||null==p.material)if(void 0==q||!0==q)p.material=new THREE.MeshPhongMaterial({ambient:16777215,color:16777215,specular:5592405,shininess:5,shading:THREE.FlatShading});if(void 0!=k.getColor()&&
null!=k.getColor())if(void 0==a.materials||null==a.materials){if(void 0!=a.material.color&&null!=a.material.color)for(d=k.getColor(),a.material.color.set(FormattingUtils.prototype.convertRGBAColorToHex(d)),void 0!=a.material.ambient&&null!=a.material.ambient&&a.material.ambient.set(FormattingUtils.prototype.convertRGBAColorToHex(d)),a.material.wireframe=k.getWireframe(),a.material.transparent=!0,a.material.opacity=1-k.getTransparency(),u=0;u<a.children.length;u++)p=a.children[u],void 0!=p.material.color&&
null!=p.material.color&&(p.material.color.set(FormattingUtils.prototype.convertRGBAColorToHex(d)),void 0!=p.material.ambient&&null!=a.material.ambient&&(void 0!=q&&!0!=q||p.material.ambient.set(FormattingUtils.prototype.convertRGBAColorToHex(d))),p.material.wireframe=k.getWireframe(),p.material.transparent=!0,p.material.opacity=1-k.getTransparency())}else for(u=0;u<a.materials.length;u++)if(p=a.materials[u],void 0!=p.color&&null!=p.color)for(d=k.getColor(),p.color.set(FormattingUtils.prototype.convertRGBAColorToHex(d)),
void 0!=p.ambient&&null!=p.ambient&&p.ambient.set(FormattingUtils.prototype.convertRGBAColorToHex(d)),p.wireframe=k.getWireframe(),p.transparent=!0,p.opacity=1-k.getTransparency(),u=0;u<a.children.length;u++)if(p=a.children[u],void 0==p.materials||null==p.materials)void 0!=p.material.color&&null!=p.material.color&&(p.material.color.set(FormattingUtils.prototype.convertRGBAColorToHex(d)),void 0!=p.material.ambient&&null!=a.material.ambient&&(void 0!=q&&!0!=q||p.material.ambient.set(FormattingUtils.prototype.convertRGBAColorToHex(d))),
p.material.wireframe=k.getWireframe(),p.material.transparent=!0,p.material.opacity=1-k.getTransparency());else for(u=0;u<p.materials.length;u++)e=p.materials[u],void 0!=e.color&&null!=e.color&&(e.color.set(FormattingUtils.prototype.convertRGBAColorToHex(d)),void 0!=e.ambient&&null!=e.ambient&&(void 0!=q&&!0!=q||e.ambient.set(FormattingUtils.prototype.convertRGBAColorToHex(d))),e.wireframe=k.getWireframe(),e.transparent=!0,e.opacity=1-k.getTransparency());b.applyTextureToObject(a,k,n,t,q)}};b.applyTextureToObject=
function(a,d,e,f,g){if(null!=d.getTexture()){if(-1<d.getTexture().indexOf("http")){var h=d.getTexture(),k=document.createElement("img");k.crossOrigin="";k.onload=function(){var b=new THREE.Texture;b.image=k;b.needsUpdate=!0;a.traverse(function(a){a instanceof THREE.Mesh&&(void 0==g||!0==g)&&(a.material.map=b,a.material.needsUpdate=!0)})};k.src=h}else k=document.createElement("img"),k.onload=function(){var b=new THREE.Texture;b.image=k;b.needsUpdate=!0;a.traverse(function(a){a instanceof THREE.Mesh&&
(a.material.map=b,a.material.needsUpdate=!0)})},k.src="data/textures/"+d.getTexture();void 0!=a.sourceId&&null!=a.sourceId||void 0!=f&&null!=f?void 0==a.sourceId||null==a.sourceId||void 0!=f&&null!=f?b.makeVSObject(f,d,e,a):null!=d.getComponentLookAndFeel()?(d=d.getComponentLookAndFeel(),f=d.getModel(),b["get"+f]?b["get"+f].call(b,a.datasetId,a.name+"_component",a.name+"_component",d,!1,!1,e,a):b.getCube.call(b,a.datasetId,a.name+"_component",a.name+"_component",d,!1,!1,e,a)):b.makeVSObject(a,d,e,
null):b.makeVSObject.call(b,a,d,e,null)}else void 0!=a.sourceId&&null!=a.sourceId||void 0!=f&&null!=f?void 0==a.sourceId||null==a.sourceId||void 0!=f&&null!=f?b.makeVSObject(f,d,e,a):null!=d.getComponentLookAndFeel()?(d=d.getComponentLookAndFeel(),f=d.getModel(),b["get"+f]?b["get"+f].call(b,a.datasetId,a.name+"_component",a.name+"_component",d,!1,!1,e,a):b.getCube.call(b,a.datasetId,a.name+"_component",a.name+"_component",d,!1,!1,e,a)):b.makeVSObject(a,d,e,null):b.makeVSObject(a,d,e,null)};b.makeVSObject=
function(a,d,e,f){var g;void 0==a.sourceId||null==a.sourceId?(g=new VSNode,g.setIsConnection(!1)):(g=new VSConnection,g.setIsConnection(!0));g.setVisualizationObject(a);g.getVisualizationObject().castShadow=a.castShadow;g.getVisualizationObject().receiveShadow=a.receiveShadow;g.setId(a.name);g.setType(a.type);g.setOffset(a.offset);g.setOrienorientationOffsetAxis(a.orientationOffsetAxis);g.setOrientationOffsetAngle(a.orientationOffsetAngle);g.setScaleMultiplier(a.scaleMultiplier);g.setDatasetId(a.datasetId);
g.setScale(d.getSize());g.labelColor=d.getLabelColor();g.getIsConnection()?g.setSelectionObject(b.getConnectionSelectionMesh(a)):g.setSelectionObject(b.getSelectionMesh(a));g.getSelectionObject().name=g.getId();g.getSelectionObject().datasetId=a.datasetId;g.getSelectionObject().castShadow=!1;g.getSelectionObject().receiveShadow=!1;g.setHighlightingObject(b.getOutlineMesh(a,g.getIsConnection()));g.getHighlightingObject().datasetId=a.datasetId;g.getHighlightingObject().castShadow=!1;g.getHighlightingObject().receiveShadow=
!1;if("Axes"!=a.type){var h=b.makeLabelSprite(a.labelText,[b.backgroundColorRGB[0],b.backgroundColorRGB[1],b.backgroundColorRGB[2],0],[g.labelColor[0],g.labelColor[1],g.labelColor[2],1],b.vs.getLayoutScale(),g.getScale());h.position=a.position;h.name=a.name+"_label";h.id=a.name;h.datasetId=a.datasetId;h.castShadow=!1;h.receiveShadow=!1;g.setLabelSprite(h)}else g.setLabelSprite(new THREE.Sprite);g.setLabelText(a.labelText);void 0!=f&&null!=f&&(f.name=g.getId()+"_firstComponent",f.datasetId=a.datasetId,
f.castShadow=a.castShadow,f.receiveShadow=a.receiveShadow,g.setFirstComponentObject(f),f=f.clone(),f.name=g.getId()+"_secondComponent",b.offsetScaleRotate(f,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,0,1),Math.PI),g.setSecondComponentObject(f));g.getVisualizationObject().geometry&&g.getVisualizationObject().geometry.faces[0]&&(g.getVisualizationObject().geometry=THREE.BufferGeometryUtils.fromGeometry(g.getVisualizationObject().geometry),g.getSelectionObject().geometry=THREE.BufferGeometryUtils.fromGeometry(g.getSelectionObject().geometry),
g.getHighlightingObject().geometry=THREE.BufferGeometryUtils.fromGeometry(g.getHighlightingObject().geometry));g.setVisibility(!1,!1);g.getIsConnection()?(g.getFirstComponentObject()&&g.getFirstComponentObject().geometry&&g.getFirstComponentObject().geometry.faces[0]&&(g.getFirstComponentObject().geometry=THREE.BufferGeometryUtils.fromGeometry(g.getFirstComponentObject().geometry)),g.getSecondComponentObject()&&g.getSecondComponentObject().geometry&&g.getSecondComponentObject().geometry.faces[0]&&
(g.getSecondComponentObject().geometry=THREE.BufferGeometryUtils.fromGeometry(g.getSecondComponentObject().geometry)),g.setSourceId(a.sourceId),g.setTargetId(a.targetId),g.applyPosition(a.sourcePosition,a.targetPosition),g.setIsConnection(!0)):(g.applyPosition(a.position),g.setIsConnection(!1));e(g,d.getSelectionAnimation())};b.getGrid=function(a,d,e,f,g,h,k){b.getPlanes(a,d,e,f,g,h,k)};b.getMirrorSurface=function(a,d,e,f,g,h,k){var m=FormattingUtils.prototype.convertRGBAColorToHex([128,128,128,1]),
m=new THREE.MeshBasicMaterial({color:m,opacity:1}),l=f.getSize();if(void 0==l||null==l)l=1;l=new THREE.BoxGeometry(l,0,l);m=new THREE.Mesh(l,m);b.offsetScaleRotate(m,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(m,a,d,e,null,null,f,g,h,k)};b.getPlane=function(a,d,e,f,g,h,k,m){var l=f.getSize();if(void 0==l||null==l)l=1;var l=new THREE.BoxGeometry(l,l,0),n=new THREE.MeshPhongMaterial({ambient:14540253,color:14540253,specular:5592405,shininess:5,
shading:THREE.FlatShading}),l=new THREE.Mesh(l,n);b.offsetScaleRotate(l,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,0,0),0);b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m)};b.getPlanes=function(a,d,e,f,g,h,k){var m=f.getSize();if(void 0==m||null==m)m=1;var l=FormattingUtils.prototype.convertRGBAColorToHex([255,255,255,1]);FormattingUtils.prototype.convertRGBAColorToHex([255,128,128,1]);FormattingUtils.prototype.convertRGBAColorToHex([128,255,128,1]);FormattingUtils.prototype.convertRGBAColorToHex([128,
128,255,1]);void 0==f.getTexture()||f.getTexture();l=new THREE.MeshPhongMaterial({ambient:l,color:l,specular:5592405,shininess:5,shading:THREE.FlatShading});l.side=THREE.BackSide;m=new THREE.BoxGeometry(m,m,m);m=new THREE.Mesh(m,l);b.offsetScaleRotate(m,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(m,a,d,e,null,null,f,g,h,k)};b.getAxes=function(a,d,e,f,g,h,k){var m=new THREE.Object3D,l=f.getSize();if(void 0==l||null==l)l=1;m.add(b.buildAxis(new THREE.Vector3(0,
0,0),new THREE.Vector3(l,0,0),16711680,!1));m.add(b.buildAxis(new THREE.Vector3(0,0,0),new THREE.Vector3(-l,0,0),16711680,!0));m.add(b.buildAxis(new THREE.Vector3(0,0,0),new THREE.Vector3(0,l,0),65280,!1));m.add(b.buildAxis(new THREE.Vector3(0,0,0),new THREE.Vector3(0,-l,0),65280,!0));m.add(b.buildAxis(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,l),255,!1));m.add(b.buildAxis(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,-l),255,!0));b.offsetScaleRotate(m,new THREE.Vector3(0,0,0),new THREE.Vector3(1,
1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(m,a,d,e,null,null,f,g,h,k)};b.getAffiliation=function(c,d,e,f,g,h,k){f=new THREE.TorusGeometry(50,1.5,16,100);g=new THREE.MeshBasicMaterial({color:237265});f=new THREE.Mesh(f,g);g=new NodeLookAndFeel(null,[3,158,209],[3,158,209],null,100,0,!1,null,null);b.offsetScaleRotate(f,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,0,1),Math.PI/2);b.applyMaterialAndTexture(f,c,d+"f",e+"f",null,null,g,!1,!1,k);f=new THREE.TorusGeometry(50,
1.5,16,100);g=new THREE.MeshBasicMaterial({color:16776960});f=new THREE.Mesh(f,g);g=new NodeLookAndFeel(null,[255,255,0],[255,255,0],null,100,0,!1,null,null);a.getPerspective()?(b.rotateAroundObjectAxis(f,new THREE.Vector3(1,0,0),0),b.offsetScaleRotate(f,new THREE.Vector3(-0,0,-0),new THREE.Vector3(1,1,1),new THREE.Vector3(-1/Math.sqrt(2),1/Math.sqrt(2),0),Math.PI/4)):b.offsetScaleRotate(f,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,0,1),Math.PI/2);b.applyMaterialAndTexture(f,
c,d+"u",e+"u",null,null,g,!1,!1,k);f=new THREE.TorusGeometry(50,1.5,16,100);g=new THREE.MeshBasicMaterial({color:65280});f=new THREE.Mesh(f,g);g=new NodeLookAndFeel(null,[0,255,0],[0,255,0],null,100,0,!1,null,null);a.getPerspective()?(b.rotateAroundObjectAxis(f,new THREE.Vector3(1,0,0),0),b.offsetScaleRotate(f,new THREE.Vector3(0,0,-0),new THREE.Vector3(1,1,1),new THREE.Vector3(-1/Math.sqrt(2),-1/Math.sqrt(2),0),Math.PI/4)):b.offsetScaleRotate(f,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,
0,1),Math.PI/2);b.applyMaterialAndTexture(f,c,d+"n",e+"n",null,null,g,!1,!1,k);f=new THREE.TorusGeometry(50,1.5,16,100);g=new THREE.MeshBasicMaterial({color:16711680});f=new THREE.Mesh(f,g);g=new NodeLookAndFeel(null,[255,0,0],[255,0,0],null,100,0,!1,null,null);a.getPerspective()?b.offsetScaleRotate(f,new THREE.Vector3(0,0,0*Math.sqrt(2)),new THREE.Vector3(1,1,1),new THREE.Vector3(1,0,0),Math.PI/4):b.offsetScaleRotate(f,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,0,1),Math.PI/
2);b.applyMaterialAndTexture(f,c,d+"s",e+"s",null,null,g,!1,!1,k)};b.buildAxis=function(a,b,e,f){var g=new THREE.Geometry;e=f?new THREE.LineDashedMaterial({linewidth:1,color:e,dashSize:2,gapSize:2}):new THREE.LineBasicMaterial({linewidth:1,color:e});g.vertices.push(a.clone());g.vertices.push(b.clone());g.computeLineDistances();return new THREE.Line(g,e,THREE.LinePieces)};b.getPctower=function(a,d,e,f,g,h,k,m){var l=f.getSize();if(void 0==l||null==l)l=1;if(void 0==ModelRepositoryModelCache["data/objects/pctower/pctower.obj"]||
null==ModelRepositoryModelCache["data/objects/pctower/pctower.obj"])(new THREE.OBJMTLLoader).load("data/objects/pctower/pctower.obj","data/objects/pctower/pctower.mtl",function(n){ModelRepositoryModelCache["data/objects/pctower/pctower.obj"]=n.clone();n.scale.set(l,l,l);b.offsetScaleRotate(n,new THREE.Vector3(-25,-4,-7),new THREE.Vector3(.004,.004,.004),new THREE.Vector3(0,1,0),Math.PI);b.applyMaterialAndTexture(n,a,d,e,null,null,f,g,h,k,m)});else{var n=ModelRepositoryModelCache["data/objects/pctower/pctower.obj"].clone();
n.scale.set(l,l,l);b.offsetScaleRotate(n,new THREE.Vector3(-25,-4,-7),new THREE.Vector3(.004,.004,.004),new THREE.Vector3(0,1,0),Math.PI);b.applyMaterialAndTexture(n,a,d,e,null,null,f,g,h,k,m)}};b.getPilotFishUAV=function(a,d,e,f,g,h,k,m){var l=null,n=f.getSize();if(void 0==n||null==n)n=1;void 0==ModelRepositoryModelCache["data/objects/pilotfishuav/PilotFish_UAV.obj"]||null==ModelRepositoryModelCache["data/objects/pilotfishuav/PilotFish_UAV.obj"]?(new THREE.OBJMTLLoader).load("data/objects/pilotfishuav/PilotFish_UAV.obj",
"data/objects/pilotfishuav/PilotFish_UAV.mtl",function(l){ModelRepositoryModelCache["data/objects/pilotfishuav/PilotFish_UAV.obj"]=l.clone();l.scale.set(n,n,n);b.offsetScaleRotate(l,new THREE.Vector3(0,0,1),new THREE.Vector3(.25,.25,.25),new THREE.Vector3(-1,0,0),Math.PI/2);b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m)}):(l=ModelRepositoryModelCache["data/objects/pilotfishuav/PilotFish_UAV.obj"].clone(),l.scale.set(n,n,n),b.offsetScaleRotate(l,new THREE.Vector3(0,0,1),new THREE.Vector3(.25,
.25,.25),new THREE.Vector3(-1,0,0),Math.PI/2),b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m))};b.getSpiderman=function(a,d,e,f,g,h,k,m){var l=f.getSize();if(void 0==l||null==l)l=1;if(void 0==ModelRepositoryModelCache["data/objects/spiderman/spiderman.obj"]||null==ModelRepositoryModelCache["data/objects/spiderman/spiderman.obj"])(new THREE.OBJMTLLoader).load("data/objects/spiderman/spiderman.obj","data/objects/spiderman/spiderman.mtl",function(n){ModelRepositoryModelCache["data/objects/spiderman/spiderman.obj"]=
n.clone();n.scale.set(l,l,l);b.offsetScaleRotate(n,new THREE.Vector3(0,-10,0),new THREE.Vector3(.05,.05,.05),new THREE.Vector3(0,1,0),Math.PI/2);b.applyMaterialAndTexture(n,a,d,e,null,null,f,g,h,k,m)});else{var n=ModelRepositoryModelCache["data/objects/spiderman/spiderman.obj"].clone();n.scale.set(l,l,l);b.offsetScaleRotate(n,new THREE.Vector3(0,-10,0),new THREE.Vector3(.05,.05,.05),new THREE.Vector3(0,1,0),Math.PI/2);b.applyMaterialAndTexture(n,a,d,e,null,null,f,g,h,k,m)}};b.getTrafficCone=function(a,
d,e,f,g,h,k,m){var l=null,n=f.getSize();if(void 0==n||null==n)n=1;void 0==ModelRepositoryModelCache["data/objects/cone/cone1.obj"]||null==ModelRepositoryModelCache["data/objects/cone/cone1.obj"]?(new THREE.OBJMTLLoader).load("data/objects/cone/cone1.obj","data/objects/cone/cone1.mtl",function(l){ModelRepositoryModelCache["data/objects/cone/cone1.obj"]=l.clone();l.scale.set(n,n,n);b.offsetScaleRotate(l,new THREE.Vector3(0,0,0),new THREE.Vector3(.05,.05,.05),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(l,
a,d,e,null,null,f,g,h,k,m)}):(l=ModelRepositoryModelCache["data/objects/cone/cone1.obj"].clone(),l.scale.set(n,n,n),b.offsetScaleRotate(l,new THREE.Vector3(0,0,0),new THREE.Vector3(.05,.05,.05),new THREE.Vector3(0,1,0),0),b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m))};b.getTriangle=function(a,d,e,f,g,h,k,m){var l=f.getSize();if(void 0==l||null==l)l=1;var n=new THREE.Geometry,t=new THREE.Vector3(-l/2,-l/2,0),q=new THREE.Vector3(0,l/2,0),l=new THREE.Vector3(l/2,-l/2,0);n.vertices.push(t);
n.vertices.push(q);n.vertices.push(l);n.faces.push(new THREE.Face3(0,1,2));n.computeFaceNormals();t=new THREE.MeshPhongMaterial({ambient:14540253,color:14540253,specular:5592405,shininess:5,shading:THREE.FlatShading});t.side=THREE.DoubleSide;n=new THREE.Mesh(n,t);b.offsetScaleRotate(n,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(n,a,d,e,null,null,f,g,h,k,m)};b.getCube=function(a,d,e,f,g,h,k,m){var l=f.getSize();if(void 0==l||null==l)l=1;var l=
new THREE.BoxGeometry(l,l,l),n=new THREE.MeshPhongMaterial({ambient:14540253,color:14540253,specular:5592405,shininess:5,shading:THREE.FlatShading}),l=new THREE.Mesh(l,n);b.offsetScaleRotate(l,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m)};b.getDisk=function(a,d,e,f,g,h,k,m){var l=f.getSize();if(void 0==l||null==l)l=1;var l=new THREE.CylinderGeometry(l,l,1,60,1,!1),n=new THREE.MeshPhongMaterial({ambient:14540253,
color:14540253,specular:5592405,shininess:5,shading:THREE.FlatShading}),l=new THREE.Mesh(l,n);b.offsetScaleRotate(l,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m)};b.getTetrahedron=function(a,d,e,f,g,h,k,m){var l=f.getSize();if(void 0==l||null==l)l=1;var l=new THREE.TetrahedronGeometry(l),n=new THREE.MeshPhongMaterial({ambient:14540253,color:14540253,specular:5592405,shininess:5,shading:THREE.FlatShading}),l=new THREE.Mesh(l,
n);b.offsetScaleRotate(l,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m)};b.getIcosahedron=function(a,d,e,f,g,h,k,m){var l=f.getSize();if(void 0==l||null==l)l=1;var l=new THREE.IcosahedronGeometry(l),n=new THREE.MeshPhongMaterial({ambient:14540253,color:14540253,specular:5592405,shininess:5,shading:THREE.FlatShading}),l=new THREE.Mesh(l,n);b.offsetScaleRotate(l,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,
1,0),0);b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m)};b.getOctahedron=function(a,d,e,f,g,h,k,m){var l=f.getSize();if(void 0==l||null==l)l=1;var l=new THREE.OctahedronGeometry(l),n=new THREE.MeshPhongMaterial({ambient:14540253,color:14540253,specular:5592405,shininess:5,shading:THREE.FlatShading}),l=new THREE.Mesh(l,n);b.offsetScaleRotate(l,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m)};b.getCone=function(a,
d,e,f,g,h,k,m){var l=f.getSize();if(void 0==l||null==l)l=1;var l=new THREE.CylinderGeometry(l,0,3,20,1,!1),n=new THREE.MeshPhongMaterial({ambient:14540253,color:14540253,specular:5592405,shininess:5,shading:THREE.FlatShading}),l=new THREE.Mesh(l,n);b.offsetScaleRotate(l,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m)};b.getArrowHead=function(a,d,e,f,g,h,k,m){var l=f.getSize();if(void 0==l||null==l)l=1;var l=new THREE.CylinderGeometry(l/
4,l,1.5*l,20,1,!1),n=new THREE.MeshPhongMaterial({ambient:14540253,color:14540253,specular:5592405,shininess:5,shading:THREE.FlatShading}),l=new THREE.Mesh(l,n);b.offsetScaleRotate(l,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m)};b.getSphere=function(a,d,e,f,g,h,k,m){var l=f.getSize();if(void 0==l||null==l)l=1;var l=new THREE.SphereGeometry(5*l/6,32,32),n=new THREE.MeshPhongMaterial({ambient:14540253,color:14540253,
specular:5592405,shininess:5,shading:THREE.FlatShading}),l=new THREE.Mesh(l,n);b.offsetScaleRotate(l,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m)};b.getTube=function(a,d,e,f,g,h,k,m){var l=f.getSize(),n=[16764108,16755370,16744576,16732240,16720418,16711680],t=f.getMetaData().flags,q=[50,50,50,50,50,50];if(void 0==l||null==l)l=1;var l=2*l,u=f.getMetaData().levels,p=new THREE.CylinderGeometry(0,0,0,30,1,!1),v=new THREE.MeshPhongMaterial({ambient:16777215,
color:16777215,specular:5592405,shininess:5,shading:THREE.FlatShading}),p=new THREE.Mesh(p,v);for(index=0;index<u.length;index++){var v=new THREE.CylinderGeometry(Math.max(2*u[index],.05),Math.max(2*u[index],.05),l/6,q[index],1,!1),x=new THREE.MeshPhongMaterial({ambient:n[index],color:n[index],specular:5592405,shininess:5,shading:THREE.FlatShading});t[index]||(x=new THREE.MeshPhongMaterial({ambient:16777215,color:16777215,specular:5592405,shininess:5,shading:THREE.FlatShading}));v=new THREE.Mesh(v,
x);b.offsetScaleRotate(v,new THREE.Vector3(0,l/6*(u.length-1-index),0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);p.add(v)}b.offsetScaleRotate(p,new THREE.Vector3(0,-l/2+l/3,0),new THREE.Vector3(1,1,1),new THREE.Vector3(1,0,0),0);b.applyMaterialAndTexture(p,a,d,e,null,null,f,g,h,k,m,!1)};b.getSpherePrism=function(a,d,e,f,g,h,k,m){console.log("HERE");var l=f.getSize();if(void 0==l||null==l)l=1;var l=new THREE.CylinderGeometry(l/2,l/2,l,6,1,!1),n=new THREE.MeshPhongMaterial({ambient:14540253,
color:14540253,specular:5592405,shininess:5,shading:THREE.FlatShading}),l=new THREE.Mesh(l,n);b.offsetScaleRotate(l,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(l,a,d,e,null,null,f,g,h,k,m)};b.getLine=function(a,d,e,f,g,h,k,m,l,n,t){if(void 0==h||null==h)h=-1;if(void 0==k||null==k)k=1;var q=new THREE.Geometry;q.vertices.push(new THREE.Vector3(0,-.5,0));q.vertices.push(new THREE.Vector3(0,.5,0));var u=new THREE.LineBasicMaterial({color:14540253,
linewidth:1,fog:!0});h.distanceTo(k);q=new THREE.Line(q,u);q.position=new THREE.Vector3((h.x+k.x)/2,(h.y+k.y)/2,(h.z+k.z)/2);new THREE.Matrix4;var p=new THREE.Vector3(0,1,0),u=new THREE.Vector3,v=new THREE.Vector3(k.x-h.x,k.y-h.y,k.z-h.z),v=v.normalize();u.crossVectors(p,v).normalize();p=Math.acos(p.dot(v));q.quaternion.setFromAxisAngle(u,p);q.sourcePosition=h;q.targetPosition=k;b.offsetScaleRotate(q,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0),0);b.applyMaterialAndTexture(q,
a,d,e,f,g,m,l,n,t)};b.getCylinder=function(a,d,e,f,g,h,k,m,l,n,t){var q=m.getSize();if(void 0==q||null==q)q=1;if(void 0==h||null==h)h=new THREE.Vector3(-.5,-.5,-.5);if(void 0==k||null==k)k=new THREE.Vector3(.5,.5,.5);var u=new THREE.MeshPhongMaterial({ambient:14540253,color:14540253,specular:5592405,shininess:5,shading:THREE.FlatShading});h.distanceTo(k);q=new THREE.CylinderGeometry(q,q,1,6,1,!1);u=new THREE.Mesh(q,u);u.position=h;new THREE.Matrix4;var p=new THREE.Vector3(0,1,0),q=new THREE.Vector3,
v=new THREE.Vector3(k.x-h.x,k.y-h.y,k.z-h.z),v=v.normalize();q.crossVectors(p,v).normalize();p=Math.acos(p.dot(v));u.quaternion.setFromAxisAngle(q,p);u.sourcePosition=h;u.targetPosition=k;b.offsetScaleRotate(u,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),q,p);b.applyMaterialAndTexture(u,a,d,e,f,g,m,l,n,t)};b.makeLabelSprite=function(a,d,e,f,g){f=b.getBestFontColor(e);return b.makeTextSprite(a,1,g,{fontsize:24,borderColor:{r:d[0],g:d[1],b:d[2],a:d[3]},backgroundColor:{r:e[0],g:e[1],b:e[2],a:e[3]},
fontColor:{r:f[0],g:f[1],b:f[2],a:1}})};b.makeTextSprite=function(a,d,e,f){void 0===f&&(f={});var g=f.hasOwnProperty("fontface")?f.fontface:"Arial",h=f.hasOwnProperty("fontsize")?f.fontsize:400,k=f.hasOwnProperty("fontColor")?f.fontColor:{r:0,g:0,b:0,a:1},m=f.hasOwnProperty("borderThickness")?f.borderThickness:16,l=f.hasOwnProperty("borderColor")?f.borderColor:{r:0,g:0,b:0,a:1},n=f.hasOwnProperty("backgroundColor")?f.backgroundColor:{r:255,g:255,b:255,a:1};f=document.createElement("canvas");f.width=
2E3;f.height=100;var t=f.getContext("2d");t.font="Bold "+h+"px "+g;var q=t.measureText(a).width;f=document.createElement("canvas");f.width=2*(q+2*m+50*e);f.height=1.4*h+2*m;t=f.getContext("2d");t.font="Bold "+h+"px "+g;t.lineWidth=m;t.strokeStyle="rgba("+l.r+","+l.g+","+l.b+","+l.a+")";t.fillStyle="rgba("+l.r+","+l.g+","+l.b+","+l.a+")";b.roundRect(t,m/2,m/2,q+m,1.4*h+m,6);t.fillStyle="rgba("+n.r+","+n.g+","+n.b+","+n.a+")";b.roundRect(t,m,m,q,1.4*h,6);t.fillStyle="rgba("+k.r+","+k.g+","+k.b+","+
k.a+")";t.fillText(a,m,h+m);g=new THREE.Texture(f);g.needsUpdate=!0;e=.5+25*e/f.width;g=new THREE.SpriteMaterial({map:g,useScreenCoordinates:!0});g.map.offset.set(-1*e,0);e=new THREE.Sprite(g);e.type="Label";e.scale.set(f.width/f.height*d,1,1);e.labelText=a;e.width=q+2*m;e.height=1.4*h+2*m;return e};b.roundRect=function(a,b,e,f,g,h){a.moveTo(b+h,e);a.beginPath();a.lineTo(b+f-h,e);a.quadraticCurveTo(b+f,e,b+f,e+h);a.lineTo(b+f,e+g-h);a.quadraticCurveTo(b+f,e+g,b+f-h,e+g);a.lineTo(b+h,e+g);a.quadraticCurveTo(b,
e+g,b,e+g-h);a.lineTo(b,e+h);a.quadraticCurveTo(b,e,b+h,e);a.closePath();a.fill()};b.getCompoundBoundingSphere=function(a){var b=null;return 0<a.children.length?(a.traverse(function(a){a=a.geometry;void 0!==a&&(a.computeBoundingBox(),null===b?b=a.boundingBox:b.union(a.boundingBox))}),new THREE.SphereGeometry(b.getBoundingSphere().radius,32,32)):new THREE.SphereGeometry(childObj.geometry.boundingBox.getBoundingSphere().radius,32,32)};b.getOutlineMesh=function(a,d){var e=new THREE.MeshBasicMaterial({color:65535,
side:THREE.BackSide,opacity:1}),f=new THREE.Geometry;void 0!=a.geometry&&null!=a.geometry&&(a instanceof THREE.Line?f=new THREE.CylinderGeometry(.2,.2,1,6,1,!1):f.merge(a.geometry));for(var g=0;g<a.children.length;g++)f.merge(b.getOutlineMesh(a.children[g]).geometry);e=new THREE.Mesh(f,e);e.name=a.name+"_highlight";e.castShadow=!1;e.receiveShadow=!1;e.visible=!1;e.position=a.position;f=new THREE.Vector3(-a.offset.x,-a.offset.y,-a.offset.z);b.offsetScaleRotate(e,f,new THREE.Vector3(1,1,1),a.orientationOffsetAxis,
0);f=new THREE.Vector3(0,0,0);b.offsetScaleRotate(e,f,new THREE.Vector3(1,1,1),a.orientationOffsetAxis,a.orientationOffsetAngle);f=new THREE.Vector3(1.1*a.offset.x,1.1*a.offset.y,1.1*a.offset.z);b.offsetScaleRotate(e,f,new THREE.Vector3(1,1,1),a.orientationOffsetAxis,0);void 0!=a.scale&&null!=a.scale&&(e.scale.set(a.scale.x,a.scale.y,a.scale.z),d?(e.scale.x*=10,e.scale.y*=1,e.scale.z*=10):(e.scale.x*=1.3,e.scale.y*=1.3,e.scale.z*=1.3));return e};b.getConnectionSelectionMesh=function(a){var d=new THREE.Geometry;
void 0!=a.geometry&&null!=a.geometry&&(a instanceof THREE.Line?d=new THREE.CylinderGeometry(.2,.2,1,6,1,!1):d.merge(a.geometry));var e=new THREE.MeshBasicMaterial({color:16776960}),d=new THREE.Mesh(d,e);d.name=a.name;d.position=a.position;d.visible=!1;void 0!=a.scale&&null!=a.scale&&d.scale.set(a.scale.x,a.scale.y,a.scale.z);b.offsetScaleRotate(d,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),a.orientationOffsetAxis,a.orientationOffsetAngle);return d};b.getSelectionMesh=function(a){var d=new THREE.Geometry;
void 0!=a.geometry&&null!=a.geometry&&d.merge(a.geometry);var e=new THREE.MeshBasicMaterial({color:16776960}),e=new THREE.Mesh(d,e);e.name=a.name;e.position=a.position;e.visible=!1;void 0!=a.scale&&null!=a.scale&&e.scale.set(a.scale.x,a.scale.y,a.scale.z);b.offsetScaleRotate(e,new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),a.orientationOffsetAxis,a.orientationOffsetAngle);for(var f=0;f<a.children.length;f++)d.merge(b.getSelectionMesh(a.children[f]).geometry);return e};b.rotateAroundObjectAxis=
function(a,b,e){if(void 0!=b&&null!=b&&void 0!=a.matrix&&null!=a.matrix){var f=new THREE.Matrix4;f.makeRotationAxis(b.normalize(),e);a.matrix.multiply(f);a.rotation.setFromRotationMatrix(a.matrix)}};b.offsetScaleRotate=function(a,d,e,f,g){if(void 0!=a.geometry&&null!=a.geometry)for(var h=a.geometry,k=0;k<h.vertices.length;k++){var m=h.vertices;m[k].x+=d.x;m[k].y+=d.y;m[k].z+=d.z}a.offset=d;a.orientationOffsetAxis=f;a.orientationOffsetAngle=g;a.scaleMultiplier=e;void 0!=a.scale&&null!=a.scale?a.scale.set(a.scale.x*
e.x,a.scale.y*e.y,a.scale.z*e.z):a.scale.set(e.x,e.y,e.z);b.rotateAroundObjectAxis(a,f,g);if(void 0!=a.children&&null!=a.children)for(e=0;e<a.children.length;e++)b.offsetScaleRotate(a.children[e],d,new THREE.Vector3(1,1,1),f,0)};return{constructor:ModelRepository,getNodeModel:b.getNodeModel,getConnectionModel:b.getConnectionModel,makeLabelSprite:b.makeLabelSprite,resetColor:b.resetColor}};var RandomLayout=function(a,b){this.diameter=a;this.layoutManager=b;this.datasetId;this.nodeLocations={};this.connectionSourceNodeIds={};this.connectionSourceLocations={};this.connectionTargetNodeIds={};this.connectionTargetLocations={};var c=this;this.init=function(){c.nodeLocations={};c.connectionSourceNodeIds={};c.connectionSourceLocations={};c.connectionTargetNodeIds={};c.connectionTargetLocations={};c.layoutManager=b;c.id="Random";c.minAxisCount=1;c.maxAxisCount=3;c.currentAxisCount=3;c.diameter=
a};this.addNode=function(a){void 0!=c.nodeLocations[a]&&null!=c.nodeLocations[a]||c.setNodeLocation(a,new THREE.Vector3(-c.diameter/2+Math.random()*c.diameter,-c.diameter/2+Math.random()*c.diameter,-c.diameter/2+Math.random()*c.diameter));c.layoutManager.updateNodePosition(c.datasetId,a,c.getNodeLocation(a))};this.addConnection=function(a,b,f,g,h){if(void 0==c.connectionSourceLocations[a]||null==c.connectionSourceLocations[a])c.connectionSourceNodeIds[a]=b,c.connectionTargetNodeIds[a]=f,c.connectionSourceLocations[a]=
void 0!=c.nodeLocations[b]&&null!=c.nodeLocations[b]?c.nodeLocations[b]:0,c.connectionTargetLocations[a]=void 0!=c.nodeLocations[f]&&null!=c.nodeLocations[f]?c.nodeLocations[f]:0;c.layoutManager.updateConnectionPosition(c.datasetId,a,c.getConnectionSourceLocation(a),c.getConnectionTargetLocation(a))};this.removeNode=function(a){delete c.nodeLocations.nodeId};this.removeConnection=function(a){delete c.connectionSourceNodeIds.connectionId;delete c.connectionTargetNodeIds.connectionId;delete c.connectionSourceLocations.connectionId;
delete c.connectionTargetLocations.connectionId};this.getNodeLocation=function(a){return c.nodeLocations[a]};this.setNodeLocation=function(a,b){var f={};c.nodeLocations[a]=b;c.layoutManager.updateNodePosition(c.datasetId,a,b);for(var g in c.connectionSourceNodeIds)c.connectionSourceNodeIds[g]==a&&(c.setConnectionSourceLocation(g,c.nodeLocations[a]),f[g]=1);for(g in c.connectionTargetNodeIds)c.connectionTargetNodeIds[g]==a&&(c.setConnectionTargetLocation(g,c.nodeLocations[a]),f[g]=1);for(g in f)c.layoutManager.updateConnectionPosition(c.datasetId,
g,c.getConnectionSourceLocation(g),c.getConnectionTargetLocation(g))};this.getConnectionSourceLocation=function(a){return c.connectionSourceLocations[a]};this.setConnectionSourceLocation=function(a,b){c.connectionSourceLocations[a]=b};this.getConnectionTargetLocation=function(a){return c.connectionTargetLocations[a]};this.setConnectionTargetLocation=function(a,b){c.connectionTargetLocations[a]=b};this.setLayoutManager=function(a){c.layoutManager=a};this.getDatasetId=function(a){return c.datasetId};
this.setDatasetId=function(a){c.datasetId=a};this.getDiameter=function(){return c.diameter};this.setDiameter=function(a){c.diameter=a};this.clear=function(){c.nodeLocations={};c.connectionSourceNodeIds={};c.connectionSourceLocations={};c.connectionTargetNodeIds={};c.connectionTargetLocations={};c.layoutManager=b;c.id="Random";c.minAxisCount=1;c.maxAxisCount=3;c.currentAxisCount=3;c.diameter=a};this.reset=function(){for(var a in c.nodeLocations)c.nodeLocations[a]=new THREE.Vector3(-c.diameter/2+Math.random()*
c.diameter,-c.diameter/2+Math.random()*c.diameter,-c.diameter/2+Math.random()*c.diameter),c.layoutManager.updateNodePosition(c.datasetId,a,c.nodeLocations[a]);for(var b in c.connectionSourceNodeIds)c.connectionSourceLocations[b]=c.nodeLocations[c.connectionSourceNodeIds[b]],c.connectionTargetLocations[b]=c.nodeLocations[c.connectionTargetNodeIds[b]],c.layoutManager.updateConnectionPosition(c.datasetId,b,c.connectionSourceLocations[b],c.connectionTargetLocations[b])};this.init();return{clone:c.clone,
init:c.init,clear:c.clear,reset:c.reset,getId:c.getId,setId:c.setId,getDatasetId:c.getDatasetId,setDatasetId:c.setDatasetId,getMinAxisCount:c.getMinAxisCount,getMaxAxisCount:c.getMaxAxisCount,getCurrentAxisCount:c.getCurrentAxisCount,setCurrentAxisCount:c.setCurrentAxisCount,getDiameter:c.getDiameter,setDiameter:c.setDiameter,setLayoutManager:c.setLayoutManager,addNode:c.addNode,addConnection:c.addConnection,removeNode:c.removeNode,removeConnection:c.removeConnection,setNodeLocation:c.setNodeLocation,
getNodeLocation:c.getNodeLocation,getConnectionSourceLocation:c.getConnectionSourceLocation,setConnectionSourceLocation:c.setConnectionSourceLocation,getConnectionTargetLocation:c.getConnectionTargetLocation,setConnectionTargetLocation:c.setConnectionTargetLocation,setLayoutManager:c.setLayoutManager}};var TypeRepository=function(){this.nodeTypes;this.connectionTypes;this.getNodeTypes=function(){return this.nodeTypes};this.getConnectionTypes=function(){return this.connectionTypes};TypeRepository=function(){this.nodeTypes={};this.connectionTypes={};var a=new NodeLookAndFeel("Triangle",[64,0,255],[128,128,128],null,1,0,!1,"Scale_Change"),a=new NodeType("Simple",a),b=new NodeLookAndFeel("Plane",[255,32,255],[128,128,128],null,1,0,!1,"Scale_Change");new NodeType("Plane",b);var b=new NodeLookAndFeel("Cube",
[32,32,255],[128,128,128],null,1,0,!1,"Scale_Change"),b=new NodeType("Cube",b),c=new NodeLookAndFeel("Sphere",[255,255,255],[128,128,128],"brick.png",1,0,!1,"Scale_Change"),c=new NodeType("Firewall",c),d=new NodeLookAndFeel("Sphere",[255,32,32],[128,128,128],null,.65,0,!1,"Scale_Change"),d=new NodeType("Sphere",d),e=new NodeLookAndFeel("SpherePrism",[32,255,32],[128,128,128],null,.65,0,!1,"Scale_Change"),e=new NodeType("SpherePrism",e),f=new NodeLookAndFeel("ArrowHead",[32,32,255],[128,128,128],null,
1,0,!1,"Scale_Change"),f=new NodeType("ArrowHead",f),g=new NodeLookAndFeel("Cube",[128,128,128],[128,128,128],"light_marble.png",1,0,!1,"Scale_Change"),g=new NodeType("TexturedCube",g),h=new NodeLookAndFeel("Cone",[255,255,255],[128,128,128],null,1,0,!1,"Scale_Change"),h=new NodeType("Cone",h),k=new NodeLookAndFeel("Cylinder",[255,255,255],[128,128,128],null,1,0,!1,"Scale_Change"),k=new NodeType("Cylinder",k),m=new NodeLookAndFeel("TrafficCone",[255,255,255],[128,128,128],null,1,0,!1,"Scale_Change"),
m=new NodeType("TrafficCone",m),l=new NodeLookAndFeel("Pctower",[128,128,128],[128,128,128],null,1,0,!1,"Scale_Change"),l=new NodeType("Pctower",l),n=new NodeLookAndFeel("PilotFishUAV",[255,255,255],[128,128,128],null,1,0,!1,"Scale_Change"),n=new NodeType("PilotFishUAV",n),t=new NodeLookAndFeel("Spiderman",[255,255,255],[128,128,128],null,1,0,!1,"Scale_Change"),t=new NodeType("Spiderman",t),q=new NodeLookAndFeel("Icosahedron",[64,0,255],[128,128,128],null,1,0,!1,"Scale_Change"),q=new NodeType("Complex",
q),u=new NodeLookAndFeel("Cube",[64,0,255],[128,128,128],null,100,0,!1,"Scale_Change"),u=new NodeType("HugeCube",u),p=new NodeLookAndFeel("Axes",null,[128,128,128],null,500,0,!1,"Scale_Change"),p=new NodeType("Axes",p),v=new NodeLookAndFeel("Planes",[255,255,255],[128,128,128],"chessboard.png",500,.8,!1,"Scale_Change"),v=new NodeType("Grid",v),x=new NodeLookAndFeel("Planes",[192,192,192],[128,128,128],null,500,0,!1,"Scale_Change"),x=new NodeType("Planes",x),w=new NodeLookAndFeel("MirrorSurface",[255,
255,255],[128,128,128],null,100,0,!1,"Scale_Change"),w=new NodeType("MirrorSurface",w);this.nodeTypes[a.getName()]=a;this.nodeTypes[b.getName()]=b;this.nodeTypes[c.getName()]=c;this.nodeTypes[d.getName()]=d;this.nodeTypes[e.getName()]=e;this.nodeTypes[f.getName()]=f;this.nodeTypes[g.getName()]=g;this.nodeTypes[h.getName()]=h;this.nodeTypes[k.getName()]=k;this.nodeTypes[m.getName()]=m;this.nodeTypes[l.getName()]=l;this.nodeTypes[n.getName()]=n;this.nodeTypes[t.getName()]=t;this.nodeTypes[q.getName()]=
q;this.nodeTypes[p.getName()]=p;this.nodeTypes[v.getName()]=v;this.nodeTypes[x.getName()]=x;this.nodeTypes[u.getName()]=u;this.nodeTypes[w.getName()]=w;a=new ConnectionLookAndFeel("Line",new NodeLookAndFeel("ArrowHead",[128,128,128],[128,128,128],null,.4,0,!1,"Scale_Change"),null,[128,128,128],[128,128,128],.125,0,!1,"Move_Component");a=new ConnectionType("Simple",a);b=new ConnectionLookAndFeel("Cylinder",new NodeLookAndFeel("ArrowHead",[128,128,128],[128,128,128],null,.4,0,!1,"Scale_Change"),null,
[128,128,128],[128,128,128],.125,0,!1,"Move_Component");b=new ConnectionType("Thick",b);c=new ConnectionLookAndFeel("Cylinder",new NodeLookAndFeel("ArrowHead",[128,128,128],[128,128,128],null,.4,0,!1,"Scale_Change"),null,[128,128,128],[128,128,128],.05,0,!1,"Move_Component");c=new ConnectionType("Thin",c);d=new ConnectionLookAndFeel("Cylinder",new NodeLookAndFeel("ArrowHead",[128,128,128],[128,128,128],null,.4,0,!1,"Scale_Change"),"striped.png",[255,255,255],[128,128,128],.125,0,!1,"Move_Component");
d=new ConnectionType("Textured",d);this.connectionTypes[a.getName()]=a;this.connectionTypes[b.getName()]=b;this.connectionTypes[c.getName()]=c;this.connectionTypes[d.getName()]=d};TypeRepository.prototype={constructor:TypeRepository,getNodeTypes:this.getNodeTypes,getConnectionTypes:this.getConnectionTypes};return TypeRepository}();var UserDefinedLayout=function(a,b){this.diameter=a;this.layoutManager=b;this.datasetId;this.nodeArray;this.edgeArray;this.nodeLocations={};this.connectionSourceLocations={};this.connectionTargetLocations={};var c=this;this.init=function(){c.nodeArray={};c.edgeArray={};c.layoutManager=b;c.minAxisCount=1;c.maxAxisCount=3;c.currentAxisCount=3;c.diameter=a;c.nodeLocations={};c.connectionSourceLocations={};c.connectionTargetLocations={}};this.addNode=function(a){null!=c.layoutManager&&(void 0==c.nodeLocations[a]||
null==c.nodeLocations[a]?c.setNodeLocation(a,[0,0,0]):c.layoutManager.updateNodePosition(c.datasetId,a,c.nodeLocations[a]))};this.addConnection=function(a,b,f,g){c.setConnectionSourceLocation(a,c.nodeLocations[b]);c.setConnectionTargetLocation(a,c.nodeLocations[f]);c.edgeArray[a]={id:a,source:b,target:f,birdirectional:g};null!=c.layoutManager&&c.layoutManager.updateConnectionPosition(c.datasetId,a,c.nodeLocations[b],c.nodeLocations[f])};c.removeNode=function(a){delete c.nodeArray.nodeId};this.removeConnection=
function(a){delete c.edgeArray.connectionId};this.setNodeLocation=function(a,b){c.nodeLocations[a]=b;null!=c.layoutManager&&c.layoutManager.updateNodePosition(c.datasetId,a,b)};this.clear=function(){c.init()};this.reset=function(){};this.setLayoutManager=function(a){c.layoutManager=a};this.init();return{clone:this.clone,init:this.init,clear:this.clear,reset:this.reset,getId:this.getId,setId:this.setId,getDatasetId:this.getDatasetId,setDatasetId:this.setDatasetId,getMinAxisCount:this.getMinAxisCount,
getMaxAxisCount:this.getMaxAxisCount,getCurrentAxisCount:this.getCurrentAxisCount,setCurrentAxisCount:this.setCurrentAxisCount,getDiameter:this.getDiameter,setDiameter:this.setDiameter,setLayoutManager:this.setLayoutManager,addNode:this.addNode,addConnection:this.addConnection,removeNode:this.removeNode,removeConnection:this.removeConnection,setNodeLocation:this.setNodeLocation,getNodeLocation:this.getNodeLocation,getConnectionSourceLocation:this.getConnectionSourceLocation,setConnectionSourceLocation:this.setConnectionSourceLocation,
getConnectionTargetLocation:this.getConnectionTargetLocation,setConnectionTargetLocation:this.setConnectionTargetLocation,setLayoutManager:this.setLayoutManager}};var VSObject=function(){this.castShadow;this.receiveShadow;this.id;this.datasetId;this.labelText;this.type;this.objectType;this.model;this.scale=1;this.isConnection;this.selectionAnimation;this.offset;this.orientationOffsetAxis;this.orientationOffsetAngle;this.scaleMultiplier;this.color;this.texture;this.sourcePosition;this.targetPosition;this.rotation;this.layoutScale=1;this.position;this.visualizationObject;this.selectionObject;this.highlightingObject;this.labelSprite;this.selected;this.highlighted;
this.setVisibility=function(a,b,c){this.visibility=a;this.labelVisibility=b;this.visualizationObject.visible=a;this.selectionObject.visible=!1;c||(this.highlightingObject.visible=!1);this.labelSprite.visible=b};this.getVisibility=function(){return this.visibility};this.applyColor=function(a){void 0!=this.visualizationObject.material.color&&null!=this.visualizationObject.material.color&&(this.visualizationObject.material.color.set(FormattingUtils.prototype.convertRGBAColorToHex(a)),void 0!=this.visualizationObject.material.ambient&&
null!=this.visualizationObject.material.ambient&&this.visualizationObject.material.ambient.set(FormattingUtils.prototype.convertRGBAColorToHex(a)));for(var b=0;b<this.visualizationObject.children.length;b++){var c=this.visualizationObject.children[b];void 0!=c.material.color&&null!=c.material.color&&(c.material.color.set(FormattingUtils.prototype.convertRGBAColorToHex(a)),void 0!=c.material.ambient&&null!=obj.material.ambient&&c.material.ambient.set(FormattingUtils.prototype.convertRGBAColorToHex(a)))}};
this.updateLabel=function(a,b,c,d,e){a=a.makeLabelSprite(this.labelText,b,c,this.layoutScale,this.scale);b=new THREE.Vector3(this.getVisualizationObject().position.x,this.getVisualizationObject().position.y,this.getVisualizationObject().position.z);a.position=b;a.name=this.getVisualizationObject().name+"_label";a.id=this.getVisualizationObject().name;a.castShadow=!1;a.receiveShadow=!1;a.visible=d;this.labelSprite=a};this.setIsConnection=function(a){this.isConnection=a};this.getIsConnection=function(){return this.isConnection};
this.setVisualizationObject=function(a){this.visualizationObject=a};this.getVisualizationObject=function(){return this.visualizationObject};this.setSelectionObject=function(a){this.selectionObject=a};this.getSelectionObject=function(){return this.selectionObject};this.setHighlightingObject=function(a){this.highlightingObject=a};this.getHighlightingObject=function(){return this.highlightingObject};this.setLabelSprite=function(a){this.labelSprite=a};this.getLabelSprite=function(){return this.labelSprite};
this.setScale=function(a){this.scale=a};this.getScale=function(){return this.scale};this.setSelected=function(a,b){var c=new THREE.MeshBasicMaterial({color:b,side:THREE.BackSide,opacity:1}),d=new THREE.MeshBasicMaterial({color:b,side:THREE.BackSide,opacity:1});(this.selected=a)?(this.highlightingObject.material=d,this.highlightingObject.visible=!0):this.highlighted?this.highlightingObject.material=c:this.highlightingObject.visible=!1};this.getSelected=function(){return this.selected};this.setHighlighted=
function(a,b){var c=new THREE.MeshBasicMaterial({color:b,side:THREE.BackSide,opacity:1}),d=new THREE.MeshBasicMaterial({color:b,side:THREE.BackSide,opacity:1});(this.highlighted=a)?(this.highlightingObject.material=c,this.highlightingObject.visible=!0):this.selected?this.highlightingObject.material=d:this.highlightingObject.visible=!1};this.getHighlighted=function(){return this.highlighted};this.setId=function(a){this.id=a;null!=this.getVisualizationObject()&&(this.getVisualizationObject().name=this.id);
null!=this.getSelectionObject()&&(this.getSelectionObject().name=this.id);null!=this.getHighlightingObject()&&(this.getHighlightingObject().name=this.id+"_highlight");null!=this.getLabelSprite()&&(this.getLabelSprite().name=this.id)};this.getId=function(){return this.id};this.setType=function(a){this.type=a};this.getType=function(){return this.type};this.setObjectType=function(a){this.objectType=a};this.getObjectType=function(){return this.objectType};this.setLabelText=function(a){this.labelText=
a};this.getLabelText=function(){return this.labelText};this.setOffset=function(a){this.offset=a};this.getOffset=function(){return this.offset};this.setOrienorientationOffsetAxis=function(a){this.orientationOffsetAxis=a};this.setOrientationOffsetAngle=function(a){this.orientationOffsetAngle=a};this.setScaleMultiplier=function(a){this.scaleMultiplier=a};this.getScaleMultiplier=function(){return this.scaleMultiplier};this.setDatasetId=function(a){this.datasetId=a};this.getDatasetId=function(){return this.datasetId};
return{position:this.position,layoutScale:this.layoutScale,setScale:this.setScale,setSelected:this.setSelected,setHighlighted:this.setHighlighted,setVisualizationObject:this.setVisualizationObject,setSelectionObject:this.setSelectionObject,setHighlightingObject:this.setHighlightingObject,setLabelSprite:this.setLabelSprite,setVisibility:this.setVisibility,setIsConnection:this.setIsConnection,getScale:this.getScale,getSelected:this.getSelected,getHighlighted:this.getHighlighted,getVisualizationObject:this.getVisualizationObject,
getSelectionObject:this.getSelectionObject,getHighlightingObject:this.getHighlightingObject,getLabelSprite:this.getLabelSprite,getVisibility:this.getVisibility,getIsConnection:this.getIsConnection,setId:this.setId,getId:this.getId,setType:this.setType,getType:this.getType,setObjectType:this.setObjectType,getObjectType:this.getObjectType,setOffset:this.setOffset,getOffset:this.getOffset,getScaleMultiplier:this.getScaleMultiplier,setOrienorientationOffsetAxis:this.setOrienorientationOffsetAxis,setOrientationOffsetAngle:this.setOrientationOffsetAngle,
setScaleMultiplier:this.setScaleMultiplier,setDatasetId:this.setDatasetId,getDatasetId:this.getDatasetId,setHighlight:this.setHighlight,applyColor:this.applyColor,updateLabel:this.updateLabel,setLabelText:this.setLabelText}},VSNode=function(){this.size;this.scale=1;this.objectType="node";this.getPosition=function(){return this.position};this.applyPosition=function(a){this.position=a;a=new THREE.Vector3(this.position.x*this.layoutScale,this.position.y*this.layoutScale,this.position.z*this.layoutScale);
this.getVisualizationObject().position=a;this.getSelectionObject().position=a;this.getHighlightingObject().position=a;a=new THREE.Vector3(this.position.x*this.layoutScale,this.position.y*this.layoutScale+3,this.position.z*this.layoutScale);this.getLabelSprite().position=a};this.applyLayoutScale=function(a){this.layoutScale=a;this.applyPosition(this.position)};this.applyScale=function(a){this.getVisualizationObject().scale.set(a.x*this.scaleMultiplier.x,a.y*this.scaleMultiplier.y,a.z*this.scaleMultiplier.z);
this.getSelectionObject().scale.set(a.x*this.scaleMultiplier.x,a.y*this.scaleMultiplier.y,a.z*this.scaleMultiplier.z);this.getHighlightingObject().scale.set(a.x*this.scaleMultiplier.x*1.1,a.y*this.scaleMultiplier.y*1.1,a.z*this.scaleMultiplier.z*1.1)};return{setScale:this.setScale,setSelected:this.setSelected,setHighlighted:this.setHighlighted,setVisualizationObject:this.setVisualizationObject,setSelectionObject:this.setSelectionObject,setHighlightingObject:this.setHighlightingObject,setLabelSprite:this.setLabelSprite,
setVisibility:this.setVisibility,setIsConnection:this.setIsConnection,getScale:this.getScale,getSelected:this.getSelected,getHighlighted:this.getHighlighted,getVisualizationObject:this.getVisualizationObject,getSelectionObject:this.getSelectionObject,getHighlightingObject:this.getHighlightingObject,getLabelSprite:this.getLabelSprite,getVisibility:this.getVisibility,getIsConnection:this.getIsConnection,setOrienorientationOffsetAxis:this.setOrienorientationOffsetAxis,setOrientationOffsetAngle:this.setOrientationOffsetAngle,
setScaleMultiplier:this.setScaleMultiplier,setDatasetId:this.setDatasetId,getDatasetId:this.getDatasetId,setId:this.setId,getId:this.getId,setType:this.setType,getType:this.getType,setObjectType:this.setObjectType,getObjectType:this.getObjectType,setOffset:this.setOffset,getOffset:this.getOffset,getScaleMultiplier:this.getScaleMultiplier,setHighlight:this.setHighlight,updateLabel:this.updateLabel,applyPosition:this.applyPosition,getPosition:this.getPosition,applyLayoutScale:this.applyLayoutScale,
applyScale:this.applyScale,applyColor:this.applyColor,setLabelText:this.setLabelText}};VSNode.prototype=new VSObject;
var VSConnection=function(){this.firstComponentObject;this.secondComponentObject;this.sourceId;this.targetId;this.sourcePosition;this.targetPosition;this.scale=this.thickness=1;this.objectType="connection";this.updateLabel=function(a,b,c,d,e){a=a.makeLabelSprite(this.labelText,b,c,this.layoutScale,this.scale);a.position=this.getVisualizationObject().position;a.name=this.getVisualizationObject().name+"_label";a.id=this.getVisualizationObject().name;a.castShadow=!1;a.receiveShadow=!1;a.visible=d;this.labelSprite=
a};this.setVisibility=function(a,b,c){this.visibility=a;this.labelVisibility=b;null!=this.firstComponentObject&&(this.firstComponentObject.visible=a);null!=this.secondComponentObject&&(this.secondComponentObject.visible=a);this.visualizationObject.visible=a;this.selectionObject.visible=!1;c||(this.highlightingObject.visible=!1);this.labelSprite.visible=b};this.setFirstComponentObject=function(a){this.firstComponentObject=a;null!=this.sourcePosition&&null!=this.targetPosition&&this.applyPosition(this.sourcePosition,
this.targetPosition)};this.getFirstComponentObject=function(){return this.firstComponentObject};this.setSecondComponentObject=function(a){this.secondComponentObject=a;null!=this.sourcePosition&&null!=this.targetPosition&&this.applyPosition(this.sourcePosition,this.targetPosition)};this.getSecondComponentObject=function(){return this.secondComponentObject};this.setSourceId=function(a){this.sourceId=a};this.getSourceId=function(){return this.sourceId};this.setTargetId=function(a){this.targetId=a};this.getTargetId=
function(){return this.targetId};this.setSourcePosition=function(a){this.sourcePosition=a};this.getSourcePosition=function(){return this.sourcePosition};this.setTargetPosition=function(a){this.targetPosition=a};this.getTargetPosition=function(){return this.targetPosition};this.setThickness=function(a){this.thickness=a};this.getThickness=function(){return this.thickness};this.applyLayoutScale=function(a){this.layoutScale=a;this.applyPosition(this.sourcePosition,this.targetPosition)};this.applyScale=
function(a){this.getVisualizationObject().scale.set(a.x*this.scaleMultiplier.x,a.y,a.z*this.scaleMultiplier.z);this.getSelectionObject().scale.set(a.x*this.scaleMultiplier.x,a.y,a.z*this.scaleMultiplier.z);this.getHighlightingObject().scale.set(a.x*this.scaleMultiplier.x*3,a.y,a.z*this.scaleMultiplier.z*3)};this.applyPosition=function(a,b){this.sourcePosition=a;this.targetPosition=b;new THREE.Matrix4;var c=new THREE.Vector3(0,1,0),d=new THREE.Vector3,e=new THREE.Vector3(this.sourcePosition.x*this.layoutScale,
this.sourcePosition.y*this.layoutScale,this.sourcePosition.z*this.layoutScale),f=new THREE.Vector3(this.targetPosition.x*this.layoutScale,this.targetPosition.y*this.layoutScale,this.targetPosition.z*this.layoutScale),g=e.distanceTo(f),h=new THREE.Vector3(f.x-e.x,f.y-e.y,f.z-e.z),h=h.normalize();d.crossVectors(c,h).normalize();h=Math.acos(c.dot(h));g=new THREE.Vector3(this.getVisualizationObject().scale.x,0<g?g:1E-4,this.getVisualizationObject().scale.z);null!=this.getFirstComponentObject()&&(this.getFirstComponentObject().position=
new THREE.Vector3((e.x+f.x)/2,(e.y+f.y)/2,(e.z+f.z)/2),this.getFirstComponentObject().quaternion.setFromAxisAngle(d,h));h=new THREE.Vector3(e.x-f.x,e.y-f.y,e.z-f.z);h=h.normalize();d.crossVectors(c,h).normalize();h=Math.acos(c.dot(h));null!=this.getSecondComponentObject()&&(this.getSecondComponentObject().position=new THREE.Vector3((e.x+f.x)/2,(e.y+f.y)/2,(e.z+f.z)/2),this.getSecondComponentObject().quaternion.setFromAxisAngle(d,h));this.getVisualizationObject().position=new THREE.Vector3((e.x+f.x)/
2,(e.y+f.y)/2,(e.z+f.z)/2);this.getVisualizationObject().quaternion.setFromAxisAngle(d,h);this.getSelectionObject().position=this.getVisualizationObject().position;this.getSelectionObject().quaternion.setFromAxisAngle(d,h);this.getHighlightingObject().position=this.getVisualizationObject().position;this.getHighlightingObject().quaternion.setFromAxisAngle(d,h);this.applyScale(g);this.getLabelSprite().position=this.getVisualizationObject().position};return{setScale:this.setScale,setSelected:this.setSelected,
setHighlighted:this.setHighlighted,setFirstComponentObject:this.setFirstComponentObject,setSecondComponentObject:this.setSecondComponentObject,setVisualizationObject:this.setVisualizationObject,setSelectionObject:this.setSelectionObject,setHighlightingObject:this.setHighlightingObject,setLabelSprite:this.setLabelSprite,setVisibility:this.setVisibility,setIsConnection:this.setIsConnection,getScale:this.getScale,getSelected:this.getSelected,getHighlighted:this.getHighlighted,getFirstComponentObject:this.getFirstComponentObject,
getSecondComponentObject:this.getSecondComponentObject,getVisualizationObject:this.getVisualizationObject,getSelectionObject:this.getSelectionObject,getHighlightingObject:this.getHighlightingObject,getLabelSprite:this.getLabelSprite,getVisibility:this.getVisibility,getIsConnection:this.getIsConnection,setOrienorientationOffsetAxis:this.setOrienorientationOffsetAxis,setOrientationOffsetAngle:this.setOrientationOffsetAngle,setScaleMultiplier:this.setScaleMultiplier,setDatasetId:this.setDatasetId,getDatasetId:this.getDatasetId,
setId:this.setId,getId:this.getId,setType:this.setType,getType:this.getType,setObjectType:this.setObjectType,getObjectType:this.getObjectType,setOffset:this.setOffset,getOffset:this.getOffset,setHighlight:this.setHighlight,updateLabel:this.updateLabel,setSourceId:this.setSourceId,setTargetId:this.setTargetId,setSourcePosition:this.setSourcePosition,setTargetPosition:this.setTargetPosition,setThickness:this.setThickness,getSourceId:this.getSourceId,getTargetId:this.getTargetId,applyPosition:this.applyPosition,
applyScale:this.applyScale,applyColor:this.applyColor,getThickness:this.getThickness,applyLayoutScale:this.applyLayoutScale,setLabelText:this.setLabelText}};VSConnection.prototype=new VSObject;var VisualizationSandbox=function(){this.canvas=null;this.selectionChangeCallback;this.transformControls=this.controls=this.camera=this.scene=this.renderer=null;this.shortcutsEnabled=!0;this.layoutManager=this.animationManager=this.modelRepository=this.typeRepository=this.INTERSECTED=this.mouse=this.raycaster=this.projector=null;this.editing=!1;this.cameraSetup=this.mouseDownObject=null;this.visualizationSetups={};this.visualizationStyles={};this.datasets={};this.callbackHandlers={};this.pendingDatasetId=
this.backgroundObjectsBeingAdded=this.connectionsBeingAdded=this.nodesBeingAdded=this.backgroundObjectsBeingRendered=this.connectionsBeingRendered=this.nodesBeingRendered=null;this.pendingConnections={};this.selectables=null;this.datasetVSObjects={};this.backgroundVSObjects={};this.layoutScale=2;this.perspective=!1;this.lastContext=this.selectedLayout=this.selectedVisualizationStyle=this.selectedDataset=this.selectedVisualizationSetup=null;this.layoutPending=this.currentShowShadow=!1;this.selectedNodes=
{};this.selectedConnections={};this.selectedNodePositions={};this.drawingConnection=!1;this.targetNode=this.sourceNode=this.connectionDrawnCallback=null;this.controlDown=!1;this.tempConnection;this.areaSelect=!1;this.lastMouseDownY=this.lastMouseDownX=this.selectionTransformControls=this.selectionCube=null;this.contrastColor=16777215;this.contrastColorRGB=[255,255,255];this.backgroundColorRGB=[0,0,0];this.followingCamera=!1;this.labelProperty=this.showConnections=this.showNodes=!0;this.jammedAssetIds=
[];this.jammedIcons=[];this.hiddenNodeIds={};this.hoverCallback;var a=this;this.init=function(b,d,e){a.canvas=b;b=a.canvas.offsetWidth;var f=a.canvas.offsetHeight;a.selectionChangeCallback=e;a.nodesBeingAdded=!1;a.connectionsBeingAdded=!1;a.backgroundObjectsBeingAdded=!1;a.nodesBeingRendered=[];a.connectionsBeingRendered=[];a.backgroundObjectsBeingRendered=[];a.selectables=[];a.editing=!1;a.renderer=window.WebGLRenderingContext?new THREE.WebGLRenderer({canvas:a.canvas,alpha:!0,antialias:!0}):new THREE.CanvasRenderer({canvas:a.canvas,
alpha:!0});a.scene=new THREE.Scene;a.typeRepository=new TypeRepository;a.modelRepository=new ModelRepository(a);a.animationManager=new AnimationManager(a.scene,!0);a.layoutManager=new LayoutManager(a,50);a.animationManager.makeAnimationGroup("SelectionAnimations",!1);a.camera=new THREE.CombinedCamera(a.getWidth()/2,a.getHeight()/2,70,1,5E3,-500,5E3);a.camera.up.set(0,0,1);a.projector=new THREE.Projector;a.raycaster=new THREE.Raycaster;a.mouse=new THREE.Vector2;a.renderer.setSize(b,f);a.renderer.shadowMapEnabled=
!0;a.renderer.shadowMapType=THREE.PCFSoftShadowMap;a.renderer.shadowMapSoft=!1;a.renderer.shadowCameraNear=0;a.renderer.shadowCameraFar=a.camera.far;a.renderer.shadowCameraFov=50;a.renderer.shadowMapBias=.001;a.renderer.shadowMapDarkness=1;a.cameraSetup=new CameraSetup(0,0,0,0,0,0,1);a.controls=new THREE.OrbitControls(a.camera,a.canvas);a.transformControls=null;a.updateSize.call(a,b,f);a.canvas.addEventListener("mouseup",a.onMouseUp.bind(a),!1);a.canvas.addEventListener("mousedown",a.onMouseDown.bind(a),
!1);a.canvas.addEventListener("mousemove",a.onDocumentMouseMove.bind(a),!1);a.canvas.addEventListener("mousewheel",a.onMouseWheel.bind(a),!1);window.addEventListener("keypress",a.onKeyPress.bind(a),!1);window.addEventListener("keydown",a.onKeyDown.bind(a),!1);window.addEventListener("keyup",a.onKeyUp.bind(a),!1);a.makeLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,5));void 0!=d&&null!=d?a.addVisualizationSetup(d):a.addVisualizationSetup(VisualizationSetup.prototype.getDefault());a.setPerspective(a.perspective);
a.render.call(a)};this.setFollowCamera=function(b){if(b&&!a.followingCamera)a.updateOrientations(),a.controls.addEventListener("change",a.updateOrientations);else if(!b){a.controls.removeEventListener("change",a.updateOrientations);for(var d in a.datasetVSObjects[a.selectedDataset]){var e=a.datasetVSObjects[a.selectedDataset][d];e.getIsConnection()||(e.getVisualizationObject().rotation.set(0,0,0),e.getHighlightingObject().rotation.set(0,0,0),e.getSelectionObject().rotation.set(0,0,0))}}a.followingCamera=
b};this.updateOrientations=function(){for(var b in a.datasetVSObjects[a.selectedDataset]){var d=a.datasetVSObjects[a.selectedDataset][b];d.getIsConnection()||(d.getVisualizationObject().rotation.set(a.camera.rotation.x,a.camera.rotation.y,a.camera.rotation.z),d.getHighlightingObject().rotation.set(a.camera.rotation.x,a.camera.rotation.y,a.camera.rotation.z),d.getSelectionObject().rotation.set(a.camera.rotation.x,a.camera.rotation.y,a.camera.rotation.z))}};this.makeLine=function(b,d){var e=new THREE.Geometry;
e.vertices.push(new THREE.Vector3(0,-.5,0));e.vertices.push(new THREE.Vector3(0,.5,0));var f=new THREE.LineBasicMaterial({color:a.contrastColor,linewidth:1,fog:!0}),g=b.distanceTo(d);a.tempConnection=new THREE.Line(e,f);a.tempConnection.position=new THREE.Vector3((b.x+d.x)/2,(b.y+d.y)/2,(b.z+d.z)/2);new THREE.Matrix4;var h=new THREE.Vector3(0,1,0),e=new THREE.Vector3,k=new THREE.Vector3(d.x-b.x,d.y-b.y,d.z-b.z),k=k.normalize();e.crossVectors(h,k).normalize();h=Math.acos(h.dot(k));a.tempConnection.quaternion.setFromAxisAngle(e,
h);new THREE.Matrix4;var h=new THREE.Vector3(0,1,0),e=new THREE.Vector3,f=new THREE.Vector3(b.x*a.layoutScale,b.y*a.layoutScale,b.z*a.layoutScale),m=new THREE.Vector3(d.x*a.layoutScale,d.y*a.layoutScale,d.z*a.layoutScale),g=f.distanceTo(m),k=new THREE.Vector3(m.x-f.x,m.y-f.y,m.z-f.z),k=k.normalize();e.crossVectors(h,k).normalize();h=Math.acos(h.dot(k));g=new THREE.Vector3(.5,0<g?g:1E-4,.5);a.tempConnection.scale.set(g.x,g.y,g.z);a.tempConnection.position=new THREE.Vector3((f.x+m.x)/2,(f.y+m.y)/2,
(f.z+m.z)/2);a.tempConnection.quaternion.setFromAxisAngle(e,h)};this.updateLine=function(){new THREE.Matrix4;var b=new THREE.Vector3(0,1,0),d=new THREE.Vector3,e=a.datasetVSObjects[a.selectedDataset][a.selectedDataset+"_"+a.sourceNode+"_node"].getVisualizationObject().position,f=a.datasetVSObjects[a.selectedDataset][a.selectedDataset+"_"+a.targetNode+"_node"].getVisualizationObject().position,e=new THREE.Vector3(e.x,e.y,e.z),f=new THREE.Vector3(f.x,f.y,f.z),g=e.distanceTo(f),h=new THREE.Vector3(f.x-
e.x,f.y-e.y,f.z-e.z),h=h.normalize();d.crossVectors(b,h).normalize();b=Math.acos(b.dot(h));g=new THREE.Vector3(.5,0<g?g:1E-4,.5);a.tempConnection.scale.set(g.x,g.y,g.z);a.tempConnection.position=new THREE.Vector3((e.x+f.x)/2,(e.y+f.y)/2,(e.z+f.z)/2);a.tempConnection.quaternion.setFromAxisAngle(d,b)};this.deleteDataset=function(){a.removeDataset(a.selectedDataset)};this.deleteAllNodesAndConnections=function(){if(void 0!=a.selectedDataset&&null!=a.selectedDataset){for(var b in a.datasets[a.selectedDataset].getNodes())a.removeNode(a.selectedDataset,
b);for(var d in a.datasets[a.selectedDataset].getConnections())a.removeConnection(a.selectedDataset,d)}};this.updateNodeLookAndFeel=function(b,d,e){null!=d&&d in a.datasets[b].getNodes()&&(a.removeNodeFromScene(b,b+"_"+d+"_node"),a.visualizationStyles[b].Simple.setNodeTypeLookAndFeel(d,e),a.generateNodeObject(b,d+"_node",a.datasets[b].getNode(d),!0,!0))};this.updateConnectionLookAndFeel=function(b,d,e){null!=d&&d in a.datasets[b].getConnections()&&(a.visualizationStyles[b].Simple.setConnectionTypeLookAndFeel(d,
e),void 0!=a.datasetVSObjects[b][b+"_"+d+"_connection"]&&null!=a.datasetVSObjects[b][b+"_"+d+"_connection"]&&a.removeConnectionFromScene(b,b+"_"+d+"_connection"),a.pendingDatasetId=a.selectedDataset,a.pendingConnections[d]=a.datasets[b].getConnection(d),0==a.nodesBeingRendered.length&&a.addPendingConnections())};this.updateSelectedDataset=function(b){null!=a.selectedDataset&&a.removeDatasetFromScene(a.selectedDataset);a.selectedDataset=null;for(var d in a.datasets){a.selectedDataset=d;break}for(var e in a.visualizationStyles[a.selectedDataset]){a.selectedVisualizationStyle=
a.visualizationStyles[a.selectedDataset][e];break}for(var f in a.selectedVisualizationStyle.getLayouts()){a.selectedLayout=a.selectedVisualizationStyle.getLayouts()[f];break}a.layoutManager.setDatasetLayout(a.selectedDataset,a.selectedLayout);a.addSelectedDatasetToScene();a.updateSelectedLayout()};var b=1;this.mouseWheel=function(c){if(!a.perspective){c.preventDefault();c.stopPropagation();var d=0;c.wheelDelta?d=c.wheelDelta/40:c.detail&&(d=-c.detail/3);c=a.camera.right/b;var e=a.camera.top/b;b-=
.1*d;a.camera.left=-b*c;a.camera.right=b*c;a.camera.top=b*e;a.camera.bottom=-b*e;a.camera.updateProjectionMatrix()}};this.updateSelectedLayout=function(){if(null==a.pendingDatasetId){if(null!=a.selectedDataset){var b=a.datasets[a.selectedDataset],d;for(d in b.getNodes())a.hiddenNodeIds.hasOwnProperty(d)&&!0==a.hiddenNodeIds[d]&&a.layoutManager.addNode(a.selectedDataset,a.selectedDataset+"_"+d+"_node",!0);for(var e in b.getConnections())d=b.getConnections()[e],a.layoutManager.addConnection(a.selectedDataset,
a.selectedDataset+"_"+e+"_connection",a.selectedDataset+"_"+d.getSourceId()+"_node",a.selectedDataset+"_"+d.getTargetId()+"_node",!0,d.getWeight(),!0)}a.layoutPending=!1}else a.layoutPending=!0};this.updateSize=function(b,d){a.setWidth(b);a.setHeight(d);a.camera.cameraO.left=b/-32;a.camera.cameraO.right=b/32;a.camera.cameraO.top=d/32;a.camera.cameraO.bottom=d/-32;a.camera.cameraP.aspect=b/d;a.camera.updateProjectionMatrix();a.renderer.setSize(b,d)};this.render=function(){a.controls.update();null!=
a.transformControls&&a.transformControls.update();a.checkIntersections.call(a);a.animate();a.renderer.render(a.scene,a.camera);requestAnimationFrame(a.render.bind(a))};this.animate=function(){a.animationManager.update()};this.getCanvas=function(){return a.canvas};this.setCanvas=function(b){a.canvas=b};this.getWidth=function(){return a.canvas.width};this.setWidth=function(b){a.canvas.width=b;a.canvas.style.width=b+"px"};this.getHeight=function(){return a.canvas.height};this.setHeight=function(b){a.canvas.height=
b;a.canvas.style.height=b+"px"};this.getAvailableNodeTypes=function(){return a.typeRepository.getNodeTypes()};this.getAvailableConnectionTypes=function(){return a.typeRepository.getConnectionTypes()};this.getAvailableLayouts=function(){return a.typeRepository.getLayoutTypes()};this.getVisualizationSetups=function(){return a.visualizationSetups};this.addVisualizationSetup=function(b){a.visualizationSetups[b.getId()]=b;void 0!=a.selectedVisualizationSetup&&null!=a.selectedVisualizationSetup||a.setVisualizationSetup(b.getId())};
this.removeVisualizationSetup=function(b){a.selectedVisualizationSetup.getId()==b&&a.clearScene(!1,!0,!0);delete a.visualizationSetups[visualizationSetup.getId()]};this.setVisualizationSetup=function(b){a.clearScene(!1,!0,!0);a.selectedVisualizationSetup=a.visualizationSetups[b];a.renderer.setClearColor(FormattingUtils.prototype.convertRGBAColorToHex(a.selectedVisualizationSetup.getBackgroundColor()),a.selectedVisualizationSetup.getBackgroundColor()[3]);a.scene.fog=new THREE.FogExp2(16777215,a.selectedVisualizationSetup.getFogIntensity());
b=a.selectedVisualizationSetup.getLights();for(var d in b){var e=b[d];if("ambient"===e.getLightType()){var f=new THREE.AmbientLight(FormattingUtils.prototype.convertRGBAColorToHex(e.getColor()));f.name=e.getId();a.addLightToScene(f)}else"directional"===e.getLightType()&&(f=new THREE.DirectionalLight(FormattingUtils.prototype.convertRGBAColorToHex(e.getColor()),e.getIntensity()),f.intensity=e.getIntensity(),f.castShadow=a.selectedVisualizationSetup.getShowShadows(),f.shadowDarkness=.75,f.shadowMapWidth=
1024,f.shadowMapHeight=1024,f.position.set(e.getX(),e.getY(),e.getZ()),f.rotation.set(e.getYaw(),e.getPitch(),e.getRoll()),f.name=e.getId(),a.addLightToScene(f));"spot"===e.getLightType()&&(f=new THREE.SpotLight(FormattingUtils.prototype.convertRGBAColorToHex(e.getColor()),e.getIntensity()),f.intensity=e.getIntensity(),f.castShadow=a.selectedVisualizationSetup.getShowShadows(),f.shadowDarkness=.75,f.shadowMapWidth=1024,f.shadowMapHeight=1024,f.position.set(e.getX(),e.getY(),e.getZ()),f.rotation.set(e.getYaw(),
e.getPitch(),e.getRoll()),f.name=e.getId(),a.addLightToScene(f));"point"===e.getLightType()?(f=new THREE.PointLight(FormattingUtils.prototype.convertRGBAColorToHex(e.getColor()),e.getIntensity()),f.intensity=e.getIntensity(),f.position.set(e.getX(),e.getY(),e.getZ()),f.name=e.getId(),a.addLightToScene(f)):"mobile"===e.getLightType()&&(a.mobilelight=new THREE.SpotLight(16777215,1),a.mobilelight.castShadow=a.selectedVisualizationSetup.getShowShadows(),a.mobilelight.shadowDarkness=0,a.mobilelight.shadowDarkness=
.75,a.mobilelight.shadowMapWidth=1024,a.mobilelight.shadowMapHeight=1024,a.mobilelight.target.position.set(0,0,0),a.mobilelightangle=Math.PI/2,a.mobilelight.name=e.getId(),a.addLightToScene(a.mobilelight))}d=a.selectedVisualizationSetup.getBackgroundObjects();for(var g in d)a.generateBackgroundObject(g,d[g],!1,a.selectedVisualizationSetup.getShowShadows());a.currentShowShadow!=a.selectedVisualizationSetup.getShowShadows()&&a.updateSelectedDataset();a.currentShowShadow=a.selectedVisualizationSetup.getShowShadows();
g=a.selectedVisualizationSetup.getBackgroundColor();for(d=0;3>d;d++)a.contrastColorRGB[d]=g[d]+128,255<a.contrastColorRGB[d]&&(a.contrastColorRGB[d]-=255),Math.abs(a.contrastColorRGB[d]-g[d])<Math.abs(255-g[d]-g[d])&&(a.contrastColorRGB[d]=255-g[d]);a.contrastColor=a.contrastColorRGB[2]+256*a.contrastColorRGB[1]+65536*a.contrastColorRGB[0];a.backgroundColorRGB=[g[0],g[1],g[2]];a.modelRepository.resetColor();a.tempConnection.material=new THREE.LineBasicMaterial({color:a.contrastColor,linewidth:5,fog:!0})};
this.generateBackgroundObject=function(b,d,e,f){a.backgroundObjectsBeingRendered.push(b+"_background_object");var g=null,h=a.addBackgroundObjectToScene.bind(this),g=a.selectedVisualizationStyle;if(void 0==g||null==g)g=VisualizationStyle.getDefault();g=g.getNodeLookAndFeel(d.getId(),d.getNodeType());null!=a.typeRepository.getNodeTypes()[d.getNodeType()]&&(g=a.typeRepository.getNodeTypes()[d.getNodeType()].getDefaultLookAndFeel());if(void 0==g||null==g)g=a.typeRepository.getNodeTypes().Cube.getDefaultLookAndFeel();
a.modelRepository.getNodeModel("VisualizationSetup",b+"_background_object",d.getName(),g,e,f,h)};this.generateNodeObject=function(b,d,e,f,g){a.nodesBeingRendered.push(d);var h=null,h=a.selectedVisualizationStyle;if(void 0==h||null==h)h=VisualizationStyle.getDefault();h=h.getNodeLookAndFeel(e.getId(),e.getNodeType());if(void 0==h||null==h)if(void 0!=a.typeRepository.getNodeTypes()[e.getNodeType()]||null!=a.typeRepository.getNodeTypes()[e.getNodeType()])h=a.typeRepository.getNodeTypes()[e.getNodeType()].getDefaultLookAndFeel();
if(void 0==h||null==h)h=a.typeRepository.getNodeTypes().Cube.getDefaultLookAndFeel();var k=a.addNodeVSObject.bind(this);a.modelRepository.getNodeModel(b,d,e.getName(),h,f,g,k)};this.generateConnectionObject=function(b,d,e,f,g,h,k){a.connectionsBeingRendered.push(d);var m=a.addConnectionVSObject.bind(this),l=null,l=a.selectedVisualizationStyle;if(void 0==l||null==l)l=VisualizationStyle.getDefault();l=l.getConnectionLookAndFeel(e.getId(),e.getConnectionType());if(void 0==l||null==l)if(void 0!=a.typeRepository.getConnectionTypes()[e.getConnectionType()]||
null!=a.typeRepository.getConnectionTypes()[e.getConnectionType()])l=a.typeRepository.getConnectionTypes()[e.getConnectionType()].getDefaultLookAndFeel();if(void 0==l||null==l)l=a.typeRepository.getConnectionTypes().Thick.getDefaultLookAndFeel();a.modelRepository.getConnectionModel(b,d,e.getName(),e.getSourceId(),e.getTargetId(),l,f,g,h,k,m)};this.addNodeVSObject=function(b,d){var e=b.getId().substring(b.getId().indexOf("_")+1),e=e.substring(0,e.lastIndexOf("_"));if(null!=a.datasets[a.selectedDataset].getNode(e)){a.datasetVSObjects[b.getDatasetId()][b.getId()]=
b;b.applyPosition(new THREE.Vector3(0,0,0));b.applyLayoutScale(a.layoutScale);1==a.selectedVisualizationSetup.getShowNodeLabels()?b.getLabelSprite().visible=!0:b.getLabelSprite().visible=!1;var f=a.animationManager.getOptions()[d].clone();f.setId(b.getId()+"_SelectionAnimation");f.setInitialValue(new THREE.Vector3(b.getScaleMultiplier().x,b.getScaleMultiplier().y,b.getScaleMultiplier().z));f.setFinalValue(new THREE.Vector3(2*b.getScaleMultiplier().x,2*b.getScaleMultiplier().y,2*b.getScaleMultiplier().z));
f.setObjectId(b.getId());a.animationManager.getAnimationGroup("SelectionAnimations").addAnimation(b.getId(),f);b.setVisibility(a.showNodes,a.selectedVisualizationSetup.getShowNodeLabels());a.hiddenNodeIds.hasOwnProperty(e)&&!0==a.hiddenNodeIds[e]&&a.addNodeToScene(b.getDatasetId(),b.getId());a.nodesBeingRendered.splice(a.nodesBeingRendered.indexOf(b.getId()),1);0!=a.nodesBeingRendered.length||null==a.pendingDatasetId||a.nodesBeingAdded?a.nodesBeingAdded||a.connectionsBeingAdded||0!=a.nodesBeingRendered.length||
0!=a.connectionsBeingRendered.length||(a.pendingDatasetId=null,a.layoutPending&&a.updateSelectedLayout()):a.addPendingConnections()}};this.addConnectionVSObject=function(b,d){var e=b.getId().substring(b.getId().indexOf("_")+1),e=e.substring(0,e.lastIndexOf("_"));null!=a.datasets[a.selectedDataset].getConnection(e)&&(a.datasetVSObjects[b.getDatasetId()][b.getId()]=b,b.applyLayoutScale(a.layoutScale),1==a.selectedVisualizationSetup.getShowConnectionLabels()?b.getLabelSprite().visible=!0:b.getLabelSprite().visible=
!1,b.setVisibility(a.showConnections,a.selectedVisualizationSetup.getShowConnectionLabels()),a.addConnectionToScene(b.getDatasetId(),b.getId()),a.connectionsBeingRendered.splice(a.connectionsBeingRendered.indexOf(b.getId()),1),a.nodesBeingAdded||a.connectionsBeingAdded||0!=a.nodesBeingRendered.length||0!=a.connectionsBeingRendered.length||(a.pendingDatasetId=null,a.layoutPending&&a.updateSelectedLayout()))};this.addNodeToScene=function(b,d){var e=a.datasetVSObjects[b][d];d.replace(b+"_","").replace("_node",
"");a.scene.add(e.getVisualizationObject());a.scene.add(e.getSelectionObject());a.scene.add(e.getHighlightingObject());a.scene.add(e.getLabelSprite());a.layoutManager.addNode(e.getDatasetId(),e.getId());a.setHighlighted(e,!1);a.selectables.push(e.getSelectionObject())};this.addConnectionToScene=function(b,d){var e=a.datasetVSObjects[b][d],f=d.substring(d.indexOf("_")+1),f=f.substring(0,f.lastIndexOf("_"));a.scene.add(e.getVisualizationObject());a.scene.add(e.getSelectionObject());a.scene.add(e.getHighlightingObject());
null!=e.getFirstComponentObject()&&a.scene.add(e.getFirstComponentObject());null!=e.getSecondComponentObject()&&null!=a.datasets[b].getConnection(f)&&"TRUE"==a.datasets[b].getConnection(f).getBidirectional()&&a.scene.add(e.getSecondComponentObject());a.datasets[b].getConnection(f);a.layoutManager.addConnection(e.getDatasetId(),d,e.getDatasetId()+"_"+e.getSourceId()+"_node",e.getDatasetId()+"_"+e.getTargetId()+"_node",!0,a.datasets[b].getConnection(f).getWeight())};this.removeNodeFromScene=function(b,
d){var e=null;void 0!=a.datasetVSObjects[b]&&null!=a.datasetVSObjects[b]&&(e=a.datasetVSObjects[b][d]);void 0!=e&&null!=e&&(delete a.datasetVSObjects[b].nodeVisId,a.layoutManager.removeNode(b,d),a.scene.remove(e.getSelectionObject()),a.scene.remove(e.getLabelSprite()),a.scene.remove(e.getHighlightingObject()),a.scene.remove(e.getVisualizationObject()),-1!=a.selectables.indexOf(e.getSelectionObject())&&a.selectables.splice(a.selectables.indexOf(e.getSelectionObject()),1))};this.removeConnectionFromScene=
function(b,d){var e=null;void 0!=a.datasetVSObjects[b]&&null!=a.datasetVSObjects[b]&&(e=a.datasetVSObjects[b][d]);void 0!=e&&null!=e&&(delete a.datasetVSObjects[b].connectionVisId,a.layoutManager.removeConnection(b,d),null!=e.getFirstComponentObject()&&a.scene.remove(e.getFirstComponentObject()),null!=e.getSecondComponentObject()&&a.scene.remove(e.getSecondComponentObject()),a.scene.remove(e.getSelectionObject()),a.scene.remove(e.getLabelSprite()),a.scene.remove(e.getHighlightingObject()),a.scene.remove(e.getVisualizationObject()),
a.selectables.splice(a.selectables.indexOf(e.getSelectionObject()),1))};this.addLightToScene=function(b){a.scene.add(b)};this.addBackgroundObjectToScene=function(b,d){"MirrorSurface"===b.type&&(b.getVisualizationObject().material=new THREE.MeshBasicMaterial({color:16777215,envMap:a.reflectionCamera.renderTarget}),b.applyPosition(new THREE.Vector3(0,0,249.9)));b.setVisibility(!0,!1);a.backgroundVSObjects[b.getId()]=b;a.scene.add(b.getVisualizationObject());a.backgroundObjectsBeingRendered.splice(a.backgroundObjectsBeingRendered.indexOf(b.getId()),
1)};this.removeNode=function(b,d){if(null!=a.datasets[b].getNode(d)){a.datasets[b].removeNode(d);void 0!=a.selectedNodes[d]&&null!=a.selectedNodes[d]&&delete a.selectedNodes.nodeId;var e=b+"_"+d+"_node";null!=a.datasetVSObjects[b][e]&&a.removeNodeFromScene(b,e)}};this.removeConnection=function(b,d){a.datasets[b].removeConnection(d);void 0!=a.selectedConnections[d]&&null!=a.selectedConnections[d]&&delete a.selectedConnections.connectionId;a.removeConnectionFromScene(b,b+"_"+d+"_connection")};this.removeLightFromScene=
function(b,d){a.removeFromScene(b)};this.removeBackgroundObjectFromScene=function(b,d){a.removeFromScene(b)};this.removeFromScene=function(b){b=a.scene.getObjectByName(b);void 0!=b&&null!=b&&a.scene.remove(b)};this.getFromScene=function(b){b=a.scene.getObjectByName(b);return void 0==b||null==b?null:b};this.clearScene=function(b,d,e){if(b)for(var f in a.datasets)a.removeDatasetFromScene(f);if(void 0!=a.selectedVisualizationSetup&&null!=a.selectedVisualizationSetup){if(d){b=a.selectedVisualizationSetup.getLights();
for(var g in b)a.removeLightFromScene(g)}if(e){e=a.selectedVisualizationSetup.getBackgroundObjects();for(var h in e)a.removeBackgroundObjectFromScene("VisualizationSetup_"+h+"_background_object")}}};this.getDatasets=function(){return a.datasets};this.setDatasets=function(b){a.clearScene(!0,!1,!1);for(var d in b)a.addDataset(b[d])};this.getPerspective=function(){return a.perspective};this.setPerspective=function(b){a.setTransformEnabled(a.INTERSECTED,!1);b?(a.perspective=!0,a.camera.toPerspective(),
a.controls.noRotate=!0,a.controls.zoom=!1,a.setCameraSetup(new CameraSetup(0,-100,100,0,0,0,1))):(a.perspective=!1,a.camera.toOrthographic(),a.controls.noRotate=!0,a.controls.zoom=!1,a.controls.panSpeed=1E-4,a.setCameraSetup(new CameraSetup(0,100,0,0,0,0,1)));null!=a.selectedDataset&&(a.layoutManager.setDatasetLayout(a.selectedDataset,new ForceDirectedLayout(100,a.layoutManager,a.perspective)),a.updateSelectedLayout())};this.addVisualizationStyle=function(b,d){if(void 0==a.visualizationStyles[b]||
null==a.visualizationStyles[b])a.visualizationStyles[b]={};a.visualizationStyles[b][d.getId()]=d};this.addDataset=function(b,d){a.datasets[b.getId()]=b;if(void 0!=d&&null!=d)a.visualizationStyles[b.getId()]=d;else{var e={};e[VisualizationStyle.prototype.getDefault().getId()]=VisualizationStyle.prototype.getDefault();a.visualizationStyles[b.getId()]=e}};this.addSelectedDatasetToScene=function(){a.pendingDatasetId=a.selectedDataset;var b=a.datasets[a.selectedDataset];a.datasetVSObjects[a.selectedDataset]=
{};var d=b.getNodes(),e=b.getConnections(),f;for(f in e){var g=e[f];a.pendingConnections[g.getId()]=g}a.nodesBeingAdded=!0;for(f in d)e=d[f],a.generateNodeObject(b.getId(),e.getId()+"_node",e,!0,!0);a.nodesBeingAdded=!1;0==a.nodesBeingRendered.length&&a.addPendingConnections();a.nodesBeingAdded||a.connectionsBeingAdded||0!=a.nodesBeingRendered.length||0!=a.connectionsBeingRendered.length||(a.pendingDatasetId=null,a.layoutPending&&a.updateSelectedLayout())};this.addPendingConnections=function(){a.connectionsBeingAdded=
!0;for(var b in a.pendingConnections){var d=a.pendingConnections[b];delete a.pendingConnections[b];var e=a.datasetVSObjects[a.selectedDataset][a.selectedDataset+"_"+d.getSourceId()+"_node"].getVisualizationObject(),f=a.datasetVSObjects[a.selectedDataset][a.selectedDataset+"_"+d.getTargetId()+"_node"].getVisualizationObject();null!=e&&null!=f?a.generateConnectionObject(a.pendingDatasetId,d.getId()+"_connection",d,e.position,f.position,!0,!0):console.log("Problem generating connection!")}a.connectionsBeingAdded=
!1;a.nodesBeingAdded||a.connectionsBeingAdded||0!=a.nodesBeingRendered.length||0!=a.connectionsBeingRendered.length||(a.pendingDatasetId=null,a.layoutPending&&a.updateSelectedLayout())};this.removeDataset=function(b){a.selectedDataset==b&&(a.selectedDataset=null);b in a.datasets&&(a.removeDatasetFromScene(b),delete a.datasets[b])};this.removeAllDatasets=function(){a.INTERSECTED=null;a.selectables=[];a.setTransformEnabled(a.INTERSECTED,!1);a.selectedNodes={};a.selectedConnections={};a.hiddenNodeIds=
{};for(datasetId in a.datasets)a.removeDataset(datasetId)};this.removeDatasetFromScene=function(b){if(b in a.datasets){b=a.datasets[b];var d=b.getNodes(),e=b.getConnections(),f;for(f in d)a.removeNodeFromScene(b.getId(),b.getId()+"_"+f+"_node");for(var g in e)a.removeConnectionFromScene(b.getId(),b.getId()+"_"+g+"_connection")}};this.getCamera=function(){return a.camera};this.getCameraSetup=function(){return a.cameraSetup};this.setCameraSetup=function(b){null!=b&&(a.cameraSetup=b);null==a.cameraSetup&&
(a.cameraSetup=new CameraSetup(0,0,0,0,0,0,1));try{a.controls.center.x=0,a.controls.center.y=0,a.controls.center.z=0}catch(d){}try{a.camera.position.set(a.cameraSetup.getX(),a.cameraSetup.getY(),a.cameraSetup.getZ())}catch(e){}try{a.camera.lookAt(new THREE.Vector3(a.cameraSetup.getTargetX(),a.cameraSetup.getTargetY(),a.cameraSetup.getTargetZ()))}catch(f){}a.perspective&&(a.camera.rotation.y=-Math.PI/2);a.camera.zoom=b.getZoom();a.camera.updateProjectionMatrix()};this.getEditing=function(){return a.editing};
this.setEditing=function(b){a.editing=b};this.getHighlightedNodes=function(){};this.setHighlightedNodes=function(a){};this.highlightNode=function(a){};this.dehighlightNode=function(a){};this.getHighlightedConnections=function(){};this.setHighlightedConnections=function(a){};this.highlightConnection=function(a){};this.dehighlightConnection=function(a){};this.setNodeVisibility=function(b,d,e){var f=d.substring(d.indexOf("_")+1);f.substring(0,f.lastIndexOf("_"));b=a.datasetVSObjects[b][d];null!=b&&(a.setShowNodes&&
e?(b.setVisibility(e,a.selectedVisualizationSetup.getShowNodeLabels(),!0,!0),a.addNodeToScene(b.getDatasetId(),b.getId())):(b.setVisibility(e,!1,!1),a.removeNodeFromScene(b.getDatasetId(),b.getId())))};this.setConnectionVisibility=function(b,d,e){b=a.datasetVSObjects[b][d];null!=b&&(a.setShowConnections&&e?(b.setVisibility(e,a.selectedVisualizationSetup.getShowConnectionLabels(),!0),-1==a.selectables.indexOf(b.getSelectionObject())&&a.selectables.push(b.getSelectionObject())):(b.setVisibility(e,!1,
!1),a.selectables.splice(a.selectables.indexOf(b.getSelectionObject()),1)))};this.addCallbackHandler=function(a){};this.removeCallbackHandler=function(a){};this.pauseAnimations=function(){};this.resumeAnimations=function(){};this.getAnimationState=function(){};this.setOffscreenRendering=function(a){};this.onDocumentMouseMove=function(b){var d=a.canvas.getBoundingClientRect();a.mouse.x=(b.clientX-d.left)/(a.canvas.width/window.devicePixelRatio)*2-1;a.mouse.y=2*-((b.clientY-d.top)/(a.canvas.height/
window.devicePixelRatio))+1;if(a.areaSelect&&null!=a.lastMouseDownX){if(a.perspective){a.selectionCube.scale.x=100*Math.abs(a.mouse.x-a.lastMouseDownX);a.selectionCube.scale.y=100*Math.abs(a.mouse.y-a.lastMouseDownY);a.selectionCube.scale.z=Math.sqrt(Math.pow(a.selectionCube.scale.x,2)+Math.pow(a.selectionCube.scale.y,2));var e=new THREE.Vector3((a.mouse.x+a.lastMouseDownX)/2*50,(a.mouse.y+a.lastMouseDownY)/2*50,0);a.projector.unprojectVector(e,a.camera);a.selectionCube.position=e;a.selectionCube.rotation.x=
a.camera.rotation.x;a.selectionCube.rotation.y=a.camera.rotation.y;a.selectionCube.rotation.z=a.camera.rotation.z;a.selectionCube.translateZ(-1*a.selectionCube.scale.z-Math.sqrt(50))}else{e=new THREE.Vector3(a.mouse.x,a.mouse.y,-1);a.projector.unprojectVector(e,a.camera);e.z=0;var f=new THREE.Vector3(a.lastMouseDownX,a.lastMouseDownY,-1);a.projector.unprojectVector(f,a.camera);f.z=0;b=Math.abs(e.x-f.x);var d=Math.abs(e.y-f.y),g=(e.x+f.x)/2,e=(e.y+f.y)/2;a.selectionCube.scale.x=b;a.selectionCube.scale.y=
d;a.selectionCube.scale.z=20;a.selectionCube.position=new THREE.Vector3(g,centerY,e)}a.selectionTransformControls.update()}};this.onMouseUp=function(b){void 0!=a.INTERSECTED&&null!=a.INTERSECTED?a.detectLeftButton(b)?a.INTERSECTED.getId()===a.mouseDownObjectName&&a.lastMouseDownX==a.mouse.x&&a.lastMouseDownY==a.mouse.y&&a.toggleSelected():a.detectRightButton(b):a.detectRightButton(b);a.lastMouseDownX=null;a.lastMouseDownY=null;a.mouseDownObjectName=null};this.toggleSelected=function(){if(a.drawingConnection||
null!=a.selectionCube)a.drawingConnection&&null==a.selectionCube&&!a.INTERSECTED.getIsConnection()&&(null==a.sourceNode?(b=a.INTERSECTED.getId().substring(a.INTERSECTED.getId().indexOf("_")+1),b=b.substring(0,b.lastIndexOf("_")),a.sourceNode=b,a.targetNode=b,a.updateLine(),a.scene.add(a.tempConnection)):(b=a.INTERSECTED.getId().substring(a.INTERSECTED.getId().indexOf("_")+1),b=b.substring(0,b.lastIndexOf("_")),a.sourceNode!=b&&a.connectionDrawnCallback(a.sourceNode,b),a.sourceNode=null,a.targetNode=
null,a.scene.remove(a.tempConnection)));else{if(a.controlDown)a.INTERSECTED.getSelected()?(a.INTERSECTED.getIsConnection()?a.setConnectionSelected(a.INTERSECTED.getId(),!1):a.setNodeSelected(a.INTERSECTED.getId(),!1),a.attachTransformRandomly()):a.INTERSECTED.getIsConnection()?(a.setConnectionSelected(a.INTERSECTED.getId(),!0),a.attachTransformRandomly()):(a.setNodeSelected(a.INTERSECTED.getId(),!0),a.setTransformEnabled(a.INTERSECTED,!0));else{var b=!1;if(!a.INTERSECTED.getSelected()||1<Object.keys(a.selectedNodes).length+
Object.keys(a.selectedConnections).length)b=!0;a.clearSelectedNodes();a.clearSelectedConnections();a.INTERSECTED.getIsConnection()?(b?a.setConnectionSelected(a.INTERSECTED.getId(),!0):a.setConnectionSelected(a.INTERSECTED.getId(),!1),a.attachTransformRandomly()):b?(a.setNodeSelected(a.INTERSECTED.getId(),!0),a.setTransformEnabled(a.INTERSECTED,!0)):(a.setNodeSelected(a.INTERSECTED.getId(),!1),a.attachTransformRandomly())}void 0!==a.selectionChangeCallback&&a.selectionChangeCallback(a.INTERSECTED)}};
this.attachTransformRandomly=function(){var b=!1,d;for(d in a.selectedNodes){a.setTransformEnabled(a.datasetVSObjects[a.selectedDataset][d],!0);b=!0;break}b||a.setTransformEnabled(a.INTERSECTED,!1)};this.setNodeSelected=function(b,d){var e=a.datasetVSObjects[a.selectedDataset][b];void 0!=e&&null!=e&&(d?(e.setSelected(!0,a.contrastColor),a.selectedNodes[e.getId()]=1):(e.setSelected(!1,a.contrastColor),delete a.selectedNodes[e.getId()]))};this.setConnectionSelected=function(b,d){var e=a.datasetVSObjects[a.selectedDataset][b];
d?(e.setSelected(!0,a.contrastColor),a.selectedConnections[e.getId()]=1):(e.setSelected(!1,a.contrastColor),delete a.selectedConnections[e.getId()])};this.getSelectedNodes=function(){var b={};Object.keys(a.selectedNodes).forEach(function(a,e){var f=a.substring(a.indexOf("_")+1),f=f.substring(0,f.lastIndexOf("_"));b[f]=1});return b};this.getSelectedConnections=function(){var b={};Object.keys(a.selectedConnections).forEach(function(a,e){var f=a.substring(a.indexOf("_")+1),f=f.substring(0,f.lastIndexOf("_"));
b[f]=1});return b};this.setSelectedNodes=function(b){a.setTransformEnabled(a.INTERSECTED,!1);a.selectedNodeLocations={};a.clearSelectedNodes();for(var d=0;d<b.length;d++)a.setNodeSelected(a.selectedDataset+"_"+b[d]+"_node",!0)};this.setSelectedConnections=function(b){a.clearSelectedConnections();for(var d=0;d<b.length;d++)a.setConnectionSelected(a.selectedDataset+"_"+b[d]+"_connection",!0)};this.clearSelectedNodes=function(){a.setTransformEnabled(a.INTERSECTED,!1);Object.keys(a.datasetVSObjects[a.selectedDataset]).forEach(function(b,
d){a.datasetVSObjects[a.selectedDataset][b].getIsConnection()||a.setNodeSelected(b,!1)});a.selectedNodeLocations={}};this.clearSelectedConnections=function(){Object.keys(a.datasetVSObjects[a.selectedDataset]).forEach(function(b,d){a.datasetVSObjects[a.selectedDataset][b].getIsConnection()&&a.setConnectionSelected(b,!1)})};this.toggleAnimation=function(){var b=a.animationManager.getAnimationGroup("SelectionAnimations").getAnimation(a.INTERSECTED.getId()+"_SelectionAnimation");void 0!=b&&null!=b&&(b.paused?
b.resume():(b.pause(),b.reset()))};this.setNodeAnimation=function(b,d){var e=a.animationManager.getAnimationGroup("SelectionAnimations").getAnimation(a.selectedDataset+"_"+b+"_node_SelectionAnimation");void 0!=e&&null!=e&&(d?e.resume():(e.pause(),e.reset()))};this.onMouseDown=function(b){a.lastMouseDownX=a.mouse.x;a.lastMouseDownY=a.mouse.y;if(a.areaSelect&&null==a.selectionCube){b=new THREE.BoxGeometry(1,1,1);var d=new THREE.MeshBasicMaterial({color:a.contrastColor,wireframe:!0});a.selectionCube=
new THREE.Mesh(b,d);a.selectionCube.scale.x=20;a.selectionCube.scale.y=20;a.selectionCube.scale.z=20;a.selectionCube.rotation.x=a.camera.rotation.x;a.selectionCube.rotation.y=a.camera.rotation.y;a.selectionCube.rotation.z=a.camera.rotation.z;a.scene.add(a.selectionCube);a.perspective?(b=new THREE.Vector3(50*a.mouse.x,50*a.mouse.y,-1),a.projector.unprojectVector(b,a.camera),a.selectionCube.position=b,a.selectionCube.translateZ(-50)):(b=new THREE.Vector3(a.mouse.x,a.mouse.y,-1),a.projector.unprojectVector(b,
a.camera),b.z=-.5,a.selectionCube.position=b);a.selectionTransformControls=new THREE.TransformControls(a,a.camera,a.renderer.domElement,a.mouse,a.perspective,!0);a.selectionTransformControls.setSpace("local");a.scene.add(a.selectionTransformControls);a.selectionTransformControls.attach(a.selectionCube);a.selectionTransformControls.update()}else void 0!=a.INTERSECTED&&null!=a.INTERSECTED?(a.lastContext=a.INTERSECTED,a.detectLeftButton(b),a.mouseDownObjectName=a.INTERSECTED.getId()):a.detectLeftButton(b)||
(a.lastContext=null,a.setSelectedNodes([]),a.setTransformEnabled(a.INTERSECTED,!1))};this.saveSelectedNodeLocations=function(){a.selectedNodePositions={};for(var b in a.selectedNodes)a.selectedNodePositions[b]=new THREE.Vector3(a.datasetVSObjects[a.selectedDataset][b].position.x,a.datasetVSObjects[a.selectedDataset][b].position.y,a.datasetVSObjects[a.selectedDataset][b].position.z)};this.clearSelectedNodeLocations=function(){a.selectedNodePositions={}};this.setTransformEnabled=function(b,d){d?(null!=
a.transformControls&&a.scene.remove(a.transformControls),void 0!=a.transformControls&&null!=a.transformControls&&(a.transformControls.detach(),a.transformControls=null),a.transformControls=new THREE.TransformControls(a,a.camera,a.renderer.domElement,a.mouse,a.perspective,!1),a.transformControls.setSize(.5),a.scene.add(a.transformControls),a.transformControls.attach(b.getVisualizationObject())):void 0!=a.transformControls&&null!=a.transformControls&&(a.transformControls.detach(),a.scene.remove(a.transformControls),
a.transformControls=null)};this.onMouseWheel=function(b){b.preventDefault();if(!1==a.perspective){var d=0;void 0!==b.wheelDelta?d=b.wheelDelta:void 0!==b.detail&&(d=-b.detail);a.camera.zoom=0<d?Math.max(0,Math.min(Infinity,this.camera.zoom/.95)):Math.max(0,Math.min(Infinity,.95*this.camera.zoom));a.camera.updateProjectionMatrix()}};this.setShortcutsEnabled=function(b){a.shortcutsEnabled=b};this.onKeyDown=function(b){var d=null,d=null==b.which?b.keyCode:0!=b.which?b.which:null;17==d?a.controlDown=
!0:16==d&&(this.setCanRotate(!1),a.areaSelect||null==a.selectionCube||(a.selectionTransformControls.detach(),a.scene.remove(a.selectionTransformControls),a.scene.remove(a.selectionCube),a.updateAreaSelection(),a.selectionCube=null),a.areaSelect=!0)};this.updateAreaSelection=function(){var b=a.selectionCube.scale.clone().multiplyScalar(.5),d=a.selectionCube.position.clone().sub(b),b=a.selectionCube.position.clone().add(b),d=new THREE.Box3(d,b),b=a.controlDown;b||(a.clearSelectedNodes(),a.clearSelectedConnections());
for(var e in a.datasetVSObjects[a.selectedDataset]){var f=a.datasetVSObjects[a.selectedDataset][e];if(f.getIsConnection()){var g=f.sourcePosition.clone(),g=g.add(f.targetPosition),g=g.multiplyScalar(.5*a.layoutScale);d.containsPoint(g)&&(b?f.getSelected()?a.setConnectionSelected(e,!1):a.setConnectionSelected(e,!0):a.setConnectionSelected(e,!0))}else g=f.position.clone().multiplyScalar(a.layoutScale),d.containsPoint(g)&&(b?f.getSelected()?a.setNodeSelected(e,!1):a.setNodeSelected(e,!0):a.setNodeSelected(e,
!0))}a.attachTransformRandomly();void 0==a.selectionChangeCallback&&null==a.selectionChangeCallback||a.selectionChangeCallback.call(a);0<document.getElementById("searchBox").value.length&&!document.getElementById("searchBox").value.includes("MODIFIED")&&(a.controlDown?(document.getElementById("searchBox").value="MODIFIED "+document.getElementById("searchBox").value,document.getElementById("advancedSearchText").innerHTML="MODIFIED"):(document.getElementById("searchBox").value="",document.getElementById("advancedSearchText").innerHTML=
""));a.controlDown||(document.getElementById("searchBox").value="",document.getElementById("advancedSearchText").innerHTML="")};this.onKeyUp=function(b){var d=null,d=null==b.which?b.keyCode:0!=b.which?b.which:null;17==d?a.controlDown=!1:16==d&&(this.setCanRotate(!0),a.areaSelect=!1)};this.onKeyPress=function(a){null==a.which?String.fromCharCode(a.keyCode):0!=a.which&&0!=a.charCode&&String.fromCharCode(a.which)};this.detectLeftButton=function(a){a=a||window.event;return 1==(a.which||a.button)};this.detectRightButton=
function(a){a=a||window.event;return 3==(a.which||a.button)};this.enableTransformOnIntersected=function(){a.INTERSECTED.getVisualizationObject()};this.disableTransformOnIntersected=function(){a.INTERSECTED.getVisualizationObject()};this.setCanRotate=function(b){void 0!=a.controls&&null!=a.controls&&(b?!0==a.perspective&&(a.controls.noRotate=!0):!0==a.perspective&&(a.controls.noRotate=!1))};this.getCanRotate=function(){};this.getIntersected=function(){if(null!=a.INTERSECTED){var b=a.INTERSECTED.id.substring(a.INTERSECTED.id.indexOf("_")+
1);return b=b.substring(0,b.lastIndexOf("_"))}return null};this.checkIntersections=function(){for(var b=null,b=[],d=0;d<a.selectables.length;d++)a.datasetVSObjects[a.selectables[d].datasetId][a.selectables[d].name].getVisibility()&&b.push(a.selectables[d]);if(a.perspective)d=new THREE.Vector3(a.mouse.x,a.mouse.y,1),a.projector.unprojectVector(d,a.camera),a.raycaster.set(a.camera.position,d.sub(a.camera.position).normalize());else{var e=new THREE.Vector3,d=new THREE.Vector3(a.mouse.x,a.mouse.y,1);
d.set(a.mouse.x,a.mouse.y,-1);a.projector.unprojectVector(d,a.camera);e.set(0,0,-1).transformDirection(a.camera.matrixWorld);a.raycaster.set(d,e)}b=a.raycaster.intersectObjects(b);0<b.length?(b=a.datasetVSObjects[b[0].object.datasetId][b[0].object.name],a.INTERSECTED!=b&&(a.INTERSECTED&&a.setHighlighted(a.INTERSECTED,!1),a.INTERSECTED=b,a.setHighlighted(a.INTERSECTED,!0),void 0!=a.hoverCallback&&null!=a.hoverCallback&&(a.INTERSECTED.id.includes("_node")?(b=a.INTERSECTED.id.substring(a.INTERSECTED.id.indexOf("_")+
1),b=b.substring(0,b.lastIndexOf("_")),a.hoverCallback(b,null)):(b=a.INTERSECTED.id.substring(a.INTERSECTED.id.indexOf("_")+1),b=b.substring(0,b.lastIndexOf("_")),a.hoverCallback(null,b))))):(null!=a.INTERSECTED&&(a.setHighlighted(a.INTERSECTED,!1),void 0!=a.hoverCallback&&null!=a.hoverCallback&&a.hoverCallback(null,null)),a.INTERSECTED=null)};this.setHighlighted=function(b,d){if(d){if(b.setHighlighted(!0,a.contrastColor),b.getIsConnection()&&(1==a.selectedVisualizationSetup.getShowConnectionLabels()||
2==a.selectedVisualizationSetup.getShowConnectionLabels())||!b.getIsConnection()&&(1==a.selectedVisualizationSetup.getShowNodeLabels()||2==a.selectedVisualizationSetup.getShowNodeLabels())?(a.removeFromScene(b.getLabelSprite().name),b.updateLabel(a.modelRepository,[a.contrastColorRGB[0],a.contrastColorRGB[1],a.contrastColorRGB[2],1],[b.labelColor[0],b.labelColor[1],b.labelColor[2],1],!0,a.layoutScale),a.scene.add(b.getLabelSprite())):b.updateLabel(a.modelRepository,[a.contrastColorRGB[0],a.contrastColorRGB[1],
a.contrastColorRGB[2],0],[b.labelColor[0],b.labelColor[1],b.labelColor[2],1],!1,a.layoutScale),!a.INTERSECTED.getIsConnection()&&a.drawingConnection&&null!=a.sourceNode){var e=a.INTERSECTED.getId().substring(a.INTERSECTED.getId().indexOf("_")+1),e=e.substring(0,e.lastIndexOf("_"));a.targetNode=e;a.updateLine()}}else b.setHighlighted(!1,a.contrastColor),b.getIsConnection()&&(1==a.selectedVisualizationSetup.getShowConnectionLabels()||2==a.selectedVisualizationSetup.getShowConnectionLabels())||!b.getIsConnection()&&
(1==a.selectedVisualizationSetup.getShowNodeLabels()||2==a.selectedVisualizationSetup.getShowNodeLabels())?(a.removeFromScene(b.getLabelSprite().name),b.getIsConnection()&&1==a.selectedVisualizationSetup.getShowConnectionLabels()||!b.getIsConnection()&&1==a.selectedVisualizationSetup.getShowNodeLabels()?b.updateLabel(a.modelRepository,[a.backgroundColorRGB[0],a.backgroundColorRGB[1],a.backgroundColorRGB[2],0],[b.labelColor[0],b.labelColor[1],b.labelColor[2],1],!0,a.layoutScale):b.updateLabel(a.modelRepository,
[a.backgroundColorRGB[0],a.backgroundColorRGB[1],a.backgroundColorRGB[2],0],[b.labelColor[0],b.labelColor[1],b.labelColor[2],1],!1,a.layoutScale),a.scene.add(b.getLabelSprite())):b.updateLabel(a.modelRepository,[a.backgroundColorRGB[0],a.backgroundColorRGB[1],a.backgroundColorRGB[2],0],[b.labelColor[0],b.labelColor[1],b.labelColor[2],1],!1,a.layoutScale)};this.setLayoutScale=function(b){if(0<b){a.layoutScale=b;for(var d in a.datasetVSObjects)for(var e in a.datasetVSObjects[d])a.datasetVSObjects[d][e].applyLayoutScale(a.layoutScale)}};
this.transformUpdated=function(b){b=b.multiplyScalar(1/a.layoutScale);for(var d in a.selectedNodes){var e=a.selectedNodePositions[d].clone();a.perscpective?e.add(b):e.add(new THREE.Vector3(b.x,0,b.z));a.setNodePosition(a.selectedDataset,d,e)}};this.setNodePosition=function(b,d,e){a.layoutManager.getDatasetLayout(b).setNodeLocation(d,e)};this.setBackgroundObjectPosition=function(b,d){a.scene.getObjectByName(b).position=d};this.overrideNodePosition=function(b,d,e){a.layoutManager.getDatasetLayout(b).setNodeLocation(b+
"_"+d+"_node",e)};this.getNodePosition=function(b,d){a.layoutManager.getDatasetLayout(b).getNodeLocation(d)};this.getLayout=function(b){var d={},e;for(e in a.datasets[b].getNodes())d[e]=a.layoutManager.getDatasetLayout(b).getNodeLocation(b+"_"+e+"_node");return d};this.setLayout=function(b,d,e,f){for(var g in h)h[g]instanceof ForceDirectedLayout&&h[g].setPaused(!0);var h={};"ForceDirected"==d?(h[d]=new ForceDirectedLayout(e,a.layoutManager,a.perspective),a.selectedVisualizationStyle.setLayouts(h)):
"Random"==d&&(h[d]=new RandomLayout(e,a.layoutManager),a.selectedVisualizationStyle.setLayouts(h));for(var k in a.selectedVisualizationStyle.getLayouts()){a.selectedLayout=a.selectedVisualizationStyle.getLayouts()[k];break}a.layoutManager.setDatasetLayout(a.selectedDataset,a.selectedLayout);a.updateSelectedLayout();for(var m in f)a.setNodePosition(b,b+"_"+m+"_node",new THREE.Vector3(f[m][0],f[m][1],f[m][2]))};this.updateNodePosition=function(b,d,e){void 0!=b&&void 0!=a.datasetVSObjects[b][d]&&null!=
a.datasetVSObjects[b][d]&&(a.perspective?a.datasetVSObjects[b][d].applyPosition(e):a.datasetVSObjects[b][d].applyPosition(new THREE.Vector3(e.x,0,e.y)),a.drawingConnection&&(a.selectedDataset+"_"+a.sourceNode+"_node"!=d&&a.selectedDataset+"_"+a.targetNode+"_node"!=d||a.updateLine()))};this.updateConnectionPosition=function(b,d,e,f){if(void 0!=a.datasetVSObjects[b][d]&&null!=a.datasetVSObjects[b][d]){var g=d.replace(b+"_","").replace("_connection",""),g=a.datasets[b].getConnection(g);g.getSourceId();
g.getTargetId();var g=f.x-e.x,h=f.y-e.y,k=new THREE.Vector3;k.x=g*Math.cos(Math.PI/2)-h*Math.sin(Math.PI/2);k.y=g*Math.sin(Math.PI/2)+h*Math.cos(Math.PI/2);k.z=0;k.normalize();k.multiplyScalar(.25);e.add(k);f.add(k);a.perspective?a.datasetVSObjects[b][d].applyPosition(e,f):a.datasetVSObjects[b][d].applyPosition(new THREE.Vector3(e.x,0,e.y),new THREE.Vector3(f.x,0,f.y))}};this.getLayoutScale=function(){return a.layoutScale};this.getLayoutManager=function(){return a.layoutManager};this.setDrawingConnection=
function(b){a.drawingConnection&&null!=a.sourceNode&&a.scene.remove(a.tempConnection);a.sourceNode=null;a.targetNode=null;a.drawingConnection=b};this.registerConnectionDrawnCallback=function(b){a.connectionDrawnCallback=b};this.setNodeType=function(b,d,e,f){a.visualizationStyles[b][d].setNodeTypeLookAndFeel(e,f);if(null!=a.selectedDataset&&null!=a.selectedVisualizationStyle&&a.selectedDataset==b&&a.selectedVisualizationStyle.getId()==d)for(var g in a.datasets[b].getNodes())null!=a.datasets[b].getNode(g)&&
a.datasets[b].getNode(g).getNodeType()==e&&a.updateNodeLookAndFeel(b,g,f)};this.removeNodeType=function(b,d,e){a.visualizationStyles[b][d].removeNodeTypeLookAndFeel(e)};this.addNode=function(b,d){var e=a.nodesBeingAdded;a.nodesBeingAdded=!0;a.datasets[b].addNode(d);a.generateNodeObject(b,d.id+"_node",d,!0,!0);a.nodesBeingAdded=e};this.setConnectionType=function(b,d,e,f){a.visualizationStyles[b][d].setConnectionTypeLookAndFeel(e,f);if(null!=a.selectedDataset&&null!=a.selectedVisualizationStyle&&a.selectedDataset==
b&&a.selectedVisualizationStyle.getId()==d)for(var g in a.datasets[b].getConnections())a.datasets[b].getConnection(g).getConnectionType()==e&&a.updateConnectionLookAndFeel(b,g,f)};this.removeConnectionType=function(b,d,e){a.visualizationStyles[b][d].removeConnectionTypeLookAndFeel(e)};this.addConnection=function(b,d){var e=a.connectionsBeingAdded;a.connectionsBeingAdded=!0;a.datasets[b].addConnection(d);a.selectedDataset==b&&(a.pendingDatasetId=a.selectedDataset,a.pendingConnections[d.id]=d,0==a.nodesBeingRendered.length&&
a.addPendingConnections());a.connectionsBeingAdded=e};this.resetLayout=function(b){a.layoutManager.getDatasetLayout(b).reset()};this.getCurrentVisualizationSetup=function(){return a.selectedVisualizationSetup};this.overrideNodeLookAndFeel=function(b,d,e){null!=d&&d in a.datasets[b].getNodes()&&(a.datasetVSObjects[b][b+"_"+d+"_node"].visualizationObject.material.ambient=new THREE.Color(e[0],e[1],e[2]),a.datasetVSObjects[b][b+"_"+d+"_node"].visualizationObject.material.color=new THREE.Color(e[0],e[1],
e[2]),a.datasetVSObjects[b][b+"_"+d+"_node"].visualizationObject.material.opacity=1,a.datasetVSObjects[b][b+"_"+d+"_node"].visualizationObject.material.needsUpdate=!0)};this.overrideConnectionLookAndFeel=function(b,d,e){null!=d&&d in a.datasets[b].getConnections()&&(a.datasetVSObjects[b][b+"_"+d+"_connection"].visualizationObject.material.ambient=new THREE.Color(e[0],e[1],e[2]),a.datasetVSObjects[b][b+"_"+d+"_connection"].visualizationObject.material.color=new THREE.Color(e[0],e[1],e[2]),a.datasetVSObjects[b][b+
"_"+d+"_connection"].visualizationObject.material.opacity=1,a.datasetVSObjects[b][b+"_"+d+"_connection"].visualizationObject.material.needsUpdate=!0,a.datasetVSObjects[b][b+"_"+d+"_connection"].firstComponentObject.material.ambient=new THREE.Color(e[0],e[1],e[2]),a.datasetVSObjects[b][b+"_"+d+"_connection"].firstComponentObject.material.color=new THREE.Color(e[0],e[1],e[2]),a.datasetVSObjects[b][b+"_"+d+"_connection"].firstComponentObject.material.opacity=1,a.datasetVSObjects[b][b+"_"+d+"_connection"].firstComponentObject.material.needsUpdate=
!0,a.datasetVSObjects[b][b+"_"+d+"_connection"].secondComponentObject.material.ambient=new THREE.Color(e[0],e[1],e[2]),a.datasetVSObjects[b][b+"_"+d+"_connection"].secondComponentObject.material.color=new THREE.Color(e[0],e[1],e[2]),a.datasetVSObjects[b][b+"_"+d+"_connection"].secondComponentObject.material.opacity=1,a.datasetVSObjects[b][b+"_"+d+"_connection"].secondComponentObject.material.needsUpdate=!0)};this.updateBackgroundColor=function(b){a.renderer.setClearColor(b,1)};this.updateHighlightColor=
function(b,d){a.contrastColor=d;a.contrastColorRGB=FormattingUtils.prototype.convertHexColorToRGBA(d);var e=a.datasetVSObjects[b],f;for(f in e)e=a.datasetVSObjects[b][f],e.getHighlighted()?e.setHighlighted(!0,a.contrastColor):e.setHighlighted(!1,a.contrastColor)};this.setShowLabels=function(b,d){d?a.selectedVisualizationSetup.setShowNodeLabels(1):a.selectedVisualizationSetup.setShowNodeLabels(0);a.selectedVisualizationSetup.setShowConnectionLabels(0);var e=a.datasetVSObjects[b],f;for(f in e)e=a.datasetVSObjects[b][f],
e.getIsConnection()?e.setVisibility(e.getVisibility(),!1,!0):e.setVisibility(e.getVisibility(),d,!0),a.setHighlighted(e,e.getHighlighted())};this.setShowNodes=function(b,d){a.setShowNodes=d;var e=a.datasetVSObjects[b],f;for(f in e)e=a.datasetVSObjects[b][f],e.getIsConnection()||e.setVisibility(d,a.selectedVisualizationSetup.getShowNodeLabels(),!0)};this.setShowConnections=function(b,d){a.setShowConnections=d;var e=a.datasetVSObjects[b],f;for(f in e)e=a.datasetVSObjects[b][f],e.getIsConnection()&&
e.setVisibility(d,a.selectedVisualizationSetup.getShowConnectionLabels(),!0)};this.updateLabels=function(b,d,e){var f=a.datasetVSObjects[b],g;for(g in f){var f=g.replace(b+"_","").replace("_node",""),h=a.datasetVSObjects[b][g];!h.getIsConnection()&&h&&("Id"==e?h.setLabelText(f):d.nodes[f].attributes.hasOwnProperty(e)?h.setLabelText(d.nodes[f].attributes[e]):h.setLabelText("N/A"),a.setHighlighted(h,h.getHighlighted()),h.setVisibility(h.getVisibility(),h.getVisibility()&&a.selectedVisualizationSetup.getShowNodeLabels()))}};
this.setHiddenNodes=function(b){a.hiddenNodeIds=b};this.focusNode=function(b,d){var e=a.datasetVSObjects[b][b+"_"+d+"_node"],f=e.getVisualizationObject().position;if(null!=e){try{a.controls.center.x=f.x,a.controls.center.y=f.y,a.controls.center.z=f.z}catch(g){}try{a.camera.position.set(f.x,f.y+10,f.z)}catch(h){}try{a.camera.lookAt(new THREE.Vector3(f.x,f.y,f.z))}catch(k){}a.camera.zoom=a.perspective?1:25;a.camera.updateProjectionMatrix()}};this.removeBackgroundObject=function(b){a.removeFromScene(b)};
this.setHoverCallback=function(b){a.hoverCallback=b};return{init:a.init,addVisualizationSetup:a.addVisualizationSetup,setVisualizationSetup:a.setVisualizationSetup,getCurrentVisualizationSetup:a.getCurrentVisualizationSetup,updateBackgroundColor:a.updateBackgroundColor,updateHighlightColor:a.updateHighlightColor,getCamera:a.getCamera,generateBackgroundObject:a.generateBackgroundObject,removeBackgroundObject:a.removeBackgroundObject,setBackgroundObjectPosition:a.setBackgroundObjectPosition,setCameraSetup:a.setCameraSetup,
addDataset:a.addDataset,removeAllDatasets:a.removeAllDatasets,updateSelectedDataset:a.updateSelectedDataset,setLayoutScale:a.setLayoutScale,getLayoutScale:a.getLayoutScale,setShortcutsEnabled:a.setShortcutsEnabled,setPerspective:a.setPerspective,getPerspective:a.getPerspective,getLayoutManager:a.getLayoutManager,getIntersected:a.getIntersected,updateSize:a.updateSize,setNodeAnimation:a.setNodeAnimation,getIntersected:a.getIntersected,getSelectedNodes:a.getSelectedNodes,getSelectedConnections:a.getSelectedConnections,
setSelectedNodes:a.setSelectedNodes,setSelectedConnections:a.setSelectedConnections,transformUpdated:a.transformUpdated,saveSelectedNodeLocations:a.saveSelectedNodeLocations,clearSelectedNodeLocations:a.clearSelectedNodeLocations,setDrawingConnection:a.setDrawingConnection,registerConnectionDrawnCallback:a.registerConnectionDrawnCallback,setCanRotate:a.setCanRotate,setNodeType:a.setNodeType,removeNodeType:a.removeNodeType,addNode:a.addNode,removeNode:a.removeNode,setConnectionType:a.setConnectionType,
removeConnectionType:a.removeConnectionType,addConnection:a.addConnection,removeConnection:a.removeConnection,setNodePosition:a.setNodePosition,overrideNodePosition:a.overrideNodePosition,setLayout:a.setLayout,getLayout:a.getLayout,resetLayout:a.resetLayout,setFollowCamera:a.setFollowCamera,overrideNodeLookAndFeel:a.overrideNodeLookAndFeel,overrideConnectionLookAndFeel:a.overrideConnectionLookAndFeel,setShowLabels:a.setShowLabels,setShowNodes:a.setShowNodes,setShowConnections:a.setShowConnections,
updateLabels:a.updateLabels,setNodeVisibility:a.setNodeVisibility,setConnectionVisibility:a.setConnectionVisibility,setHiddenNodes:a.setHiddenNodes,setJammedAssetIds:a.setJammedAssetIds,focusNode:a.focusNode,setHoverCallback:a.setHoverCallback,updateNodeLookAndFeel:a.updateNodeLookAndFeel,updateConnectionLookAndFeel:a.updateConnectionLookAndFeel}};var VisualizationSetup=function(){this.id;this.backgroundColor;this.lights;this.backgroundObjects;this.hudSetup;this.showNodeLabels;this.showConnectionLabels;this.showShadows;this.fogIntensity;this.getDefault=function(){return new VisualizationSetup("Default",[230,230,230,1],{Default_Ambient:new Light("Default_Ambient",null,null,null,null,null,null,[128,128,128],null,"ambient"),Default_Directional1:new Light("Default_Directional1",100,100,100,Math.PI/2,Math.PI/2,Math.PI/2,[255,255,255],.35,"directional"),
Default_Directional2:new Light("Default_Directional2",-100,100,100,-Math.PI/2,Math.PI/2,Math.PI/2,[255,255,255],.35,"directional"),Default_Directional3:new Light("Default_Directional3",100,-100,-100,Math.PI/2,-Math.PI/2,-Math.PI/2,[255,255,255],.35,"directional"),Default_Directional4:new Light("Default_Directional4",-100,100,-100,-Math.PI/2,Math.PI/2,-Math.PI/2,[255,255,255],.35,"directional"),Default_Directional5:new Light("Default_Directional5",-0,-500,-0,Math.PI,0,0,[255,255,255],.15,"directional")},
0,{},null,1,0,!1)};this.getId=function(){return this.id};this.setId=function(a){this.id=a};this.getBackgroundColor=function(){return this.backgroundColor};this.setBackgroundColor=function(a){this.backgroundColor=a};this.getLights=function(){return this.lights};this.setLights=function(a){this.lights=a};this.getFogIntensity=function(){return this.fogIntensity};this.setFogIntensity=function(a){this.fogIntensity=a};this.getBackgroundObjects=function(){return this.backgroundObjects};this.setBackgroundObjects=
function(a){this.backgroundObjects=a};this.getHudSetup=function(){return this.hudSetup};this.setHudSetup=function(a){this.hudSetup=a};this.getShowNodeLabels=function(){return this.showNodeLabels};this.setShowNodeLabels=function(a){this.showNodeLabels=a};this.getShowConnectionLabels=function(){return this.showConnectionLabels};this.setShowConnectionLabels=function(a){this.showConnectionLabels=a};this.getShowShadows=function(){return this.showShadows};this.setShowShadows=function(a){this.showShadows=
a};VisualizationSetup=function(a,b,c,d,e,f,g,h,k){this.id=a;this.backgroundColor=b;this.lights=c;this.backgroundObjects=e;this.hudSetup=f;this.showNodeLabels=g;this.showConnectionLabels=h;this.showShadows=k;this.fogIntensity=d};VisualizationSetup.prototype={constructor:VisualizationSetup,getId:this.getId,setId:this.setId,getBackgroundColor:this.getBackgroundColor,setBackgroundColor:this.setBackgroundColor,getLights:this.getLights,setLights:this.setLights,getFogIntensity:this.getFogIntensity,setFogIntensity:this.setFogIntensity,
getBackgroundObjects:this.getBackgroundObjects,setBackgroundObjects:this.setBackgroundObjects,getHudSetup:this.getHudSetup,setHudSetup:this.setHudSetup,getShowNodeLabels:this.getShowNodeLabels,setShowNodeLabels:this.setShowNodeLabels,getShowConnectionLabels:this.getShowConnectionLabels,setShowConnectionLabels:this.setShowConnectionLabels,getShowShadows:this.getShowShadows,setShowShadows:this.setShowShadows,getDefault:this.getDefault};return VisualizationSetup}(),VisualizationStyle=function(){this.id;
this.nodeTypeLookAndFeel;this.connectionTypeLookAndFeel;this.nodeLookAndFeel;this.connectionLookAndFeel;this.layouts;this.getDefault=function(){return new VisualizationStyle("Default_Style",{Random:new RandomLayout(50),Force_Directed:new ForceDirectedLayout(50)})};this.getId=function(){return this.id};this.setId=function(a){this.id=a};this.getDatasetId=function(){return this.datasetId};this.setDatasetId=function(a){this.datasetId=a};this.getNodeLookAndFeel=function(a,b){var c=this.nodeLookAndFeel[a];
if(void 0==c||null==c)c=this.nodeTypeLookAndFeel[b];return c};this.getConnectionLookAndFeel=function(a,b){var c=this.connectionLookAndFeel[a];if(void 0==c||null==c)c=this.connectionTypeLookAndFeel[b];return c};this.setNodeLookAndFeel=function(a,b){this.nodeLookAndFeel[a]=b};this.setConnectionLookAndFeel=function(a,b){this.connectionLookAndFeel[a]=b};this.setNodeTypeLookAndFeel=function(a,b){this.nodeTypeLookAndFeel[a]=b};this.setConnectionTypeLookAndFeel=function(a,b){this.connectionTypeLookAndFeel[a]=
b};this.removeNodeTypeLookAndFeel=function(a){void 0!=this.nodeTypeLookAndFeel[a]&&delete this.nodeTypeLookAndFeel.nodeType};this.removeConnectionTypeLookAndFeel=function(a,b){void 0!=this.connectionTypeLookAndFeel[a]&&delete this.connectionTypeLookAndFeel.connectionType};this.getNodeTypeLookAndFeels=function(){return this.nodeTypeLookAndFeel};this.setNodeTypeLookAndFeels=function(a){this.nodeTypeLookAndFeel=a};this.getConnectionTypeLookAndFeels=function(){return this.connectionTypeLookAndFeel};this.setConnectionTypeLookAndFeels=
function(a){this.connectionTypeLookAndFeel=a};this.getNodeLookAndFeels=function(){return this.nodeLookAndFeel};this.setNodeLookAndFeels=function(a){this.nodeLookAndFeel=a};this.getConnectionLookAndFeels=function(){return this.connectionLookAndFeel};this.setConnectionLookAndFeels=function(a){this.connectionLookAndFeel=a};this.getLayouts=function(){return this.layouts};this.setLayouts=function(a){this.layouts=a};VisualizationStyle=function(a,b){this.id=a;this.nodeTypeLookAndFeel={};this.connectionTypeLookAndFeel=
{};this.nodeLookAndFeel={};this.connectionLookAndFeel={};this.layouts=b};VisualizationStyle.prototype={constructor:VisualizationStyle,getId:this.getId,setId:this.setId,getDatasetId:this.getDatasetId,setDatasetId:this.setDatasetId,getNodeLookAndFeel:this.getNodeLookAndFeel,setNodeLookAndFeel:this.setNodeLookAndFeel,getConnectionLookAndFeel:this.getConnectionLookAndFeel,setConnectionLookAndFeel:this.setConnectionLookAndFeel,setNodeTypeLookAndFeel:this.setNodeTypeLookAndFeel,setConnectionTypeLookAndFeel:this.setConnectionTypeLookAndFeel,
removeNodeTypeLookAndFeel:this.removeNodeTypeLookAndFeel,removeConnectionTypeLookAndFeel:this.removeConnectionTypeLookAndFeel,getNodeTypeLookAndFeels:this.getNodeTypeLookAndFeels,setNodeTypeLookAndFeels:this.setNodeTypeLookAndFeels,getConnectionTypeLookAndFeels:this.getConnectionTypeLookAndFeels,setConnectionTypeLookAndFeels:this.setConnectionTypeLookAndFeels,getNodeLookAndFeels:this.getNodeLookAndFeels,setNodeLookAndFeels:this.setNodeLookAndFeels,getConnectionLookAndFeels:this.getConnectionLookAndFeels,
setConnectionLookAndFeels:this.setConnectionLookAndFeels,getLayouts:this.getLayouts,setLayouts:this.setLayouts,getDefault:this.getDefault};return VisualizationStyle}(),Light=function(){this.id;this.x;this.y;this.z;this.yaw;this.pitch;this.roll;this.color;this.intensity;this.lightType;this.getId=function(){return this.id};this.setId=function(a){this.id=a};this.getX=function(){return this.x};this.setX=function(a){this.x=a};this.getY=function(){return this.y};this.setY=function(a){this.y=a};this.getZ=
function(){return this.z};this.setZ=function(a){this.z=a};this.getYaw=function(){return this.yaw};this.setYaw=function(a){this.yaw=a};this.getPitch=function(){return this.pitch};this.setPitch=function(a){this.pitch=a};this.getRoll=function(){return this.roll};this.setRoll=function(a){this.roll=a};this.getColor=function(){return this.color};this.setColor=function(a){this.color=a};this.getIntensity=function(){return this.intensity};this.setIntensity=function(a){this.intensity=a};this.getLightType=function(){return this.lightType};
this.setLightType=function(a){this.lightType=a};Light=function(a,b,c,d,e,f,g,h,k,m){this.id=a;this.x=b;this.y=c;this.z=d;this.yaw=e;this.pitch=f;this.roll=g;this.color=h;this.intensity=k;this.lightType=m};Light.prototype={constructor:Light,getId:this.getId,setId:this.setId,getX:this.getX,setX:this.setX,getY:this.getY,setY:this.setY,getZ:this.getZ,setZ:this.setZ,getYaw:this.getYaw,setYaw:this.setYaw,getPitch:this.getPitch,setPitch:this.setPitch,getRoll:this.getRoll,setRoll:this.setRoll,getColor:this.getColor,
setColor:this.setColor,getIntensity:this.getIntensity,setIntensity:this.setIntensity,getLightType:this.getLightType,setLightType:this.setLightType};return Light}(),HUDSetup=function(){this.showHUD;this.showEditingButton;this.showHideLabelsButton;this.showNodeTypeLegend;this.showConnectionTypeLegend;this.showAxisLegend;this.showVisualizationStatus;this.showEditingTools;this.showLayoutScaleSlider;this.showSizingScaleSlider;this.showHideHUDButton;this.getShowHUD=function(){return this.showHUD};this.setShowHUD=
function(a){this.showHUD=a};this.getShowEditingButton=function(){return this.showEditingButton};this.setShowEditingButton=function(a){this.showEditingButton=a};this.getShowHideNodeLabelsButton=function(){return this.showHideLabelsButton};this.setShowHideNodeLabelsButton=function(a){this.showHideLabelsButton=a};this.getShowHideConnectionLabelsButton=function(){return this.showHideLabelsButton};this.setShowHideConnectionLabelsButton=function(a){this.showHideLabelsButton=a};this.getShowNodeTypeLegend=
function(){return this.showNodeTypeLegend};this.setShowNodeTypeLegend=function(a){this.showNodeTypeLegend=a};this.getShowConnectionTypeLegend=function(){return this.showConnectionTypeLegend};this.setShowConnectionTypeLegend=function(a){this.showConnectionTypeLegend=a};this.getShowAxisLegend=function(){return this.showAxisLegend};this.setShowAxisLegend=function(a){this.showAxisLegend=a};this.getShowVisualizationStatus=function(){return this.showVisualizationStatus};this.setShowVisualizationStatus=
function(a){this.showVisualizationStatus=a};this.getShowEditingTools=function(){return this.showEditingTools};this.setShowEditingTools=function(a){this.showEditingTools=a};this.getShowLayoutScaleSlider=function(){return this.showLayoutScaleSlider};this.setShowLayoutScaleSlider=function(a){this.showLayoutScaleSlider=a};this.getShowSizingScaleSlider=function(){return this.showSizingScaleSlider};this.setShowSizingScaleSlider=function(a){this.showSizingScaleSlider=a};this.getShowHideHUDButton=function(){return this.showHideHUDButton};
this.setShowHideHUDButton=function(a){this.showHideHUDButton=a};HUDSetup=function(){};HUDSetup.prototype={constructor:HUDSetup,getShowHUD:this.getShowHUD,setShowHUD:this.setShowHUD,getShowEditingButton:this.getShowEditingButton,setShowEditingButton:this.setShowEditingButton,getShowHideNodeLabelsButton:this.getShowHideNodeLabelsButton,setShowHideNodeLabelsButton:this.setShowHideNodeLabelsButton,getShowHideConnectionLabelsButton:this.getShowHideConnectionLabelsButton,setShowHideConnectionLabelsButton:this.setShowHideConnectionLabelsButton,
getShowNodeTypeLegend:this.getShowNodeTypeLegend,setShowNodeTypeLegend:this.setShowNodeTypeLegend,getShowConnectionTypeLegend:this.getShowConnectionTypeLegend,setShowConnectionTypeLegend:this.setShowConnectionTypeLegend,getShowAxisLegend:this.getShowAxisLegend,setShowAxisLegend:this.setShowAxisLegend,getShowVisualizationStatus:this.getShowVisualizationStatus,setShowVisualizationStatus:this.setShowVisualizationStatus,getShowEditingTools:this.getShowEditingTools,setShowEditingTools:this.setShowEditingTools,
getShowLayoutScaleSlider:this.getShowLayoutScaleSlider,setShowLayoutScaleSlider:this.setShowLayoutScaleSlider,getShowSizingScaleSlider:this.getShowSizingScaleSlider,setShowSizingScaleSlider:this.setShowSizingScaleSlider,getShowHideHUDButton:this.getShowHideHUDButton,setShowHideHUDButton:this.setShowHideHUDButton};return HUDSetup}();
